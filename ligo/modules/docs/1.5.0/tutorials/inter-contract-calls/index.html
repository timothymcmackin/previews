<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-1.5.0 plugin-docs plugin-id-default docs-doc-id-tutorials/inter-contract-calls/inter-contract-calls">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Inter-contract invocations | Ligo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ligolang.org/previews/ligo/modules/img/logo/logo.png"><meta data-rh="true" name="twitter:image" content="https://ligolang.org/previews/ligo/modules/img/logo/logo.png"><meta data-rh="true" property="og:url" content="https://ligolang.org/previews/ligo/modules/docs/1.5.0/tutorials/inter-contract-calls/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.5.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.5.0"><meta data-rh="true" name="docsearch:version" content="1.5.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.5.0"><meta data-rh="true" property="og:title" content="Inter-contract invocations | Ligo"><meta data-rh="true" name="description" content="In this guide, we will look into contract interactions on Tezos. We will provide examples of how one contract can invoke and create other contracts on the same chain. We will also describe the execution model Tezos contracts live in and see how it is different from a more conventional &quot;direct calls&quot; model."><meta data-rh="true" property="og:description" content="In this guide, we will look into contract interactions on Tezos. We will provide examples of how one contract can invoke and create other contracts on the same chain. We will also describe the execution model Tezos contracts live in and see how it is different from a more conventional &quot;direct calls&quot; model."><link data-rh="true" rel="icon" href="/previews/ligo/modules/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://ligolang.org/previews/ligo/modules/docs/1.5.0/tutorials/inter-contract-calls/"><link data-rh="true" rel="alternate" href="https://ligolang.org/previews/ligo/modules/docs/1.5.0/tutorials/inter-contract-calls/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ligolang.org/previews/ligo/modules/docs/1.5.0/tutorials/inter-contract-calls/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZJTW93II01-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/previews/ligo/modules/blog/rss.xml" title="Ligo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/previews/ligo/modules/blog/atom.xml" title="Ligo Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Ligo" href="/previews/ligo/modules/opensearch.xml"><link rel="stylesheet" href="/previews/ligo/modules/assets/css/styles.95ea01ea.css">
<link rel="preload" href="/previews/ligo/modules/assets/js/runtime~main.f86f8c60.js" as="script">
<link rel="preload" href="/previews/ligo/modules/assets/js/main.86e62175.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#003ee0;color:#efefef" role="banner"><div class="content_knG7 announcementBarContent_xLdY"><b>Ligo v1 is now available ! <a href="/blog/v1-migration-guide">Check the migration guide</a> ! </b></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/previews/ligo/modules/"><div class="navbar__logo"><img src="/previews/ligo/modules/img/logo/logo.svg" alt="LIGO Logo" class="themedImage_ToTc themedImage--light_HNdA" height="32" width="104"><img src="/previews/ligo/modules/img/logo/logo-night.svg" alt="LIGO Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="32" width="104"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/previews/ligo/modules/docs/1.5.0/intro/introduction">1.5.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/previews/ligo/modules/docs/next/tutorials/inter-contract-calls/">Next</a></li><li><a class="dropdown__link" href="/previews/ligo/modules/docs/tutorials/inter-contract-calls/">1.7.0</a></li><li><a class="dropdown__link" href="/previews/ligo/modules/docs/1.6.0/tutorials/inter-contract-calls/">1.6.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/previews/ligo/modules/docs/1.5.0/tutorials/inter-contract-calls/">1.5.0</a></li></ul></div><a class="navbar__item navbar__link" target="_self" href="/previews/ligo/modules/docs/intro/introduction">Docs</a><a class="navbar__item navbar__link" href="/previews/ligo/modules/docs/reference/toplevel-reference">API</a><a class="navbar__item navbar__link" href="/previews/ligo/modules/docs/faq/intro">FAQ</a><a class="navbar__item navbar__link" href="/previews/ligo/modules/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://packages.ligolang.org/packages" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a href="https://ide.ligolang.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Web IDE</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Ligo<!-- --> <b>1.5.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/previews/ligo/modules/docs/tutorials/inter-contract-calls/">latest version</a></b> (<!-- -->1.7.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 1.5.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Inter-contract invocations</h1></header><p>In this guide, we will look into contract interactions on Tezos. We will provide examples of how one contract can invoke and create other contracts on the same chain. We will also describe the execution model Tezos contracts live in and see how it is different from a more conventional &quot;direct calls&quot; model.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-operations">Internal operations<a href="#internal-operations" class="hash-link" aria-label="Direct link to Internal operations" title="Direct link to Internal operations">​</a></h2><p>When you make a transaction to a contract, this contract may, in turn, emit other operations. Those operations are called &quot;internal&quot;. There are three kinds of internal operations:</p><ol><li>Transaction – an operation that transfers value and, if the callee is an originated contract, executes the code of the callee.</li><li>Origination – creates a new smart contract.</li><li>Delegation – sets a delegate for the current contract.</li></ol><p>We will mainly focus on internal <em>transactions,</em> as this is the most common type of internal operations. We will also show how contracts can originate other contracts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-note-on-complexity">A note on complexity<a href="#a-note-on-complexity" class="hash-link" aria-label="Direct link to A note on complexity" title="Direct link to A note on complexity">​</a></h2><p>Usually, you do not want to have overly-complex contract interactions when you develop your Tezos contracts. There are several reasons for this:</p><ol><li>Transactions between contracts are expensive. Tezos bakers need to fetch the callee from the context (this is how internal blockchain storage is called in Tezos), deserialise and type-check it, then perform the requested operation and store the result. Among these actions, code execution is the cheapest one in terms of gas.</li><li>Transactions between contracts are hard and error-prone. When you split your business logic across several contracts, you need to think of how these contracts interact. This may cause unforeseen vulnerabilities if you do not give it enough attention.</li><li>Tezos most probably has other means to achieve what you want. Lambdas make it possible to alter the behaviour of the contract after origination, new cryptographic primitives get introduced via protocol upgrades, separation of concerns can be achieved by splitting your business logic into LIGO modules that will eventually get compiled into a single contract, etc.</li></ol><p>However, there are legit reasons for using internal operations, including the following:</p><ol><li>You communicate with an external entity, e.g., transfer a third-party FA2 token.</li><li>You develop a universal caller contract, e.g., a multisig contract.</li><li>You implement a standard that explicitly forbids you to extend the functionality.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-transactions-in-ligo">Internal transactions in LIGO<a href="#internal-transactions-in-ligo" class="hash-link" aria-label="Direct link to Internal transactions in LIGO" title="Direct link to Internal transactions in LIGO">​</a></h2><p>The simplest example of an internal transaction is sending Tez to a contract. Note that in Tezos, implicit accounts owned by people holding private keys are contracts as well. Implicit accounts have no code and accept <em>unit</em> as the parameter. Consider the following code snippet:</p><p>It accepts a destination address as the parameter. Then we need to check whether the address points to a contract that accepts a unit. We do this with <code>Tezos.get_contract_opt</code>. This function returns <code>Some (value)</code> if the contract exists and the parameter type is correct. Otherwise, it returns <code>None</code>. In case it is <code>None</code>, we fail with an error, otherwise we use <code>Tezos.transaction</code> to forge the internal transaction to the destination contract.</p><blockquote><p>Note: since <code>Tezos.transaction</code> is called with unit as its first argument, LIGO infer that <code>destination_addr</code> has to point to a contract that accepts unit</p></blockquote><p>Let us also examine a contract that stores the address of another contract and passes an argument to it. Here is how this &quot;proxy&quot; can look like:</p><p>To call a contract, we need to add a type annotation <code>: int contract
option</code> for <code>Tezos.get_contract_opt</code>. LIGO knows that
<code>Tezos.get_contract_opt</code> returns a <code>contract option</code> but at the time
of type inference it does not know that the callee accepts an
<code>int</code>. In this case, we expect the callee to accept an <code>int</code>. Such a
callee can be implemented like this:</p><p>But what if we want to make a transaction to a contract but do not know the full type of its parameter? For example, we may know that some contract accepts <code>Add 5</code> as its parameter, but we do not know what other entrypoints are there.</p><p>LIGO compiler generates the following Michelson type for the parameter of this contract:</p><div class="codeBlockContent_vqWU"><button type="button" aria-label="Copy code to clipboard" class="copyButton_H_xL">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_wPnj"><div class="codeBlockLines_fQUY" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">(or (or (or (int %add)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            (int %multiply))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        (or (unit %reset)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            (int %set)))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    (int %subtract));</span></div></div></div></div><p>The type got transformed to an annotated tree of Michelson union types (denoted with <code>or typeA typeB</code>). The annotations (<code>%add</code>, <code>%multiply</code>, etc.) here represent <em>entrypoints</em> – a construct Tezos has special support for.</p><p>In Tezos, we are not required to provide the <em>full</em> type of the contract parameter if we specify an entrypoint. In this case, we just need to know the type of the <em>entrypoint</em> parameter – in case of <code>%add</code>, it is an <code>int</code> – not the full type.</p><p>To specify an entrypoint, we can use <code>Tezos.get_entrypoint_opt</code> instead of <code>Tezos.get_contract_opt</code>. It accepts an extra argument with an entrypoint name:</p><p>To get the entrypoint names from parameter constructors, you should make the first letters lowercase and prepend a percent sign: <code>Add</code> -&gt; <code>%add</code>, <code>CallThePolice</code> -&gt; <code>%callThePolice</code>. LIGO does this transformation internally when it compiles your code into Michelson.</p><p>Entrypoints are especially useful for standardisation. For example, FA2 token standard does not force the contracts to have some specific parameter type – it would be too limiting for tokens that want to have additional functionality. Instead, the standard requires the tokens to have some predefined set of entrypoints, and other contracts may expect these entrypoints to be present in FA2-compliant tokens.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interoperability-and-standards-compliance">Interoperability and standards compliance<a href="#interoperability-and-standards-compliance" class="hash-link" aria-label="Direct link to Interoperability and standards compliance" title="Direct link to Interoperability and standards compliance">​</a></h2><p>There are several high-level languages for Tezos, and you should not expect that all the contracts you interact with are written in LIGO.</p><p>Internally, Tezos stores and operates on contracts in Michelson. Currently, Michelson does not support record and variant types of arbitrary length natively. It only has <code>pair a b</code> and <code>or a b</code>, each containing just <em>two</em> type parameters.</p><div class="codeBlockContent_vqWU"><button type="button" aria-label="Copy code to clipboard" class="copyButton_H_xL">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_wPnj"><div class="codeBlockLines_fQUY" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">(pair (pair (pair (string %g)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                  (int %hello))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            (pair (bytes %i)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                  (nat %l)))</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      (address %o))</span></div></div></div></div><p>However, other languages may use a different representation. For example, they can use a right-hand comb:</p><div class="codeBlockContent_vqWU"><button type="button" aria-label="Copy code to clipboard" class="copyButton_H_xL">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_wPnj"><div class="codeBlockLines_fQUY" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">(pair (int %hello)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      (pair (nat %l)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            (pair (bytes %i)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                  (pair (string %g)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                        (address %o)))))</span></div></div></div></div><p>It is not a problem for top-level parameter types: we can expect the callers to specify an entrypoint. But if we pass structures and values of variant types as entrypoint arguments, we need to make sure their internal representation is the same.</p><p>If you interact with other contracts, or expect other contracts to interact with your contract, we strongly advise you to consider using special types and annotations described in the <a href="https://ligolang.org/docs/advanced/interop" target="_blank" rel="noopener noreferrer">Interop</a> section of the documentation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution-order">Execution order<a href="#execution-order" class="hash-link" aria-label="Direct link to Execution order" title="Direct link to Execution order">​</a></h2><p>When you emit an internal operation, Tezos puts it into the <em>internal operations queue.</em>
Here is how this queue looks like when you have one contract that emits two internal operations:</p><table><thead><tr><th>Current call</th><th>Queue before</th><th>Queue after</th></tr></thead><tbody><tr><td><code>A %doSomething</code></td><td>[]</td><td>[<code>B %foo</code>, <code>C %bar</code>]</td></tr><tr><td><code>B %foo</code></td><td>[<code>C %bar</code>]</td><td>[<code>C %bar</code>]</td></tr><tr><td><code>C %bar</code></td><td>[]</td><td>[]</td></tr></tbody></table><p>Now imagine that <code>B %foo</code> emits another operation, e.g. it calls back to <code>A %fooCallback</code>. Tezos will put this internal operation to the end of the queue:</p><table><thead><tr><th>Current call</th><th>Queue before</th><th>Queue after</th></tr></thead><tbody><tr><td><code>A %doSomething</code></td><td>[]</td><td>[<code>B %foo</code>, <code>C %bar</code>]</td></tr><tr><td><code>B %foo</code></td><td>[<code>C %bar</code>]</td><td>[<code>C %bar</code>, <code>A %fooCallback</code>]</td></tr><tr><td><code>C %bar</code></td><td>[<code>A %fooCallback</code>]</td><td>[<code>A %fooCallback</code>]</td></tr><tr><td><code>A %fooCallback</code></td><td>[]</td><td>[]</td></tr></tbody></table><p>Notice how this callback gets executed <em>after</em> <code>C %bar</code>. If we construct a tree of internal operations, such queuing would be analogous to a breadth-first search (BFS):</p><p><img loading="lazy" alt="BFS order of execution" src="/previews/ligo/modules/assets/images/bfs_order-bc7495c58c94e66c33ea2dfcc1378549.png" width="376" height="201" class="img_ev3q"></p><p>This BFS execution order is very different from Ethereum&#x27;s direct synchronous method calls, which are analogous to depth-first search. Here is how the transactions would be ordered in Ethereum:</p><p><img loading="lazy" alt="DFS order of execution" src="/previews/ligo/modules/assets/images/dfs_order-2c97346462af8f73720db7e4103cbb61.png" width="385" height="201" class="img_ev3q"></p><p>Here is a more complex scenario featuring a graph of 12 different operations. We omit the contract and entrypoint names and use lowercase letters and numbers to identify operations.</p><ol><li>BFS order (Tezos):</li></ol><p><img loading="lazy" alt="BFS order of execution" src="/previews/ligo/modules/assets/images/complex_bfs-5e7d9a3a5159a0d4204358cfd61086ee.png" width="466" height="343" class="img_ev3q"></p><ol start="2"><li>DFS order (Ethereum):</li></ol><p><img loading="lazy" alt="DFS order of execution" src="/previews/ligo/modules/assets/images/complex_dfs-3f05f083f075ce1820f043d323d2e32b.png" width="464" height="349" class="img_ev3q"></p><p>In practice, you should always bear in mind that the internal operations are queued and not executed immediately. It means that:</p><ul><li>There is no guarantee that there would be no operations in between the current transaction and an emitted operation (e.g., on the BFS graph above, <code>b2</code> emits <code>b2a</code>, but 4 operations are executed in between these two).</li><li>If you emit a sequence of operations, they will be executed one after the other, with no operations in between. In other words, it is guaranteed that <code>b</code>, <code>c</code>, and <code>d</code>, emitted by <code>a</code>, will not be interleaved by other operations. This property holds true even if <code>a</code> is not the root of the call graph.</li><li>If you emit a sequence of operations, the whole sequence will be executed <em>before</em> any possible internal operations that may arise as a result of any of these operations.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="returning-values">Returning values<a href="#returning-values" class="hash-link" aria-label="Direct link to Returning values" title="Direct link to Returning values">​</a></h2><p>When trying to port an existing distributed application to Tezos, you may want to <em>read</em> the storage of another contract or call some entrypoint to get a computed value. In Tezos, entrypoints can only update storage and emit other operations.</p><p>In theory, one can use a callback – the callee could emit an operation back to the caller with the computed value. However, this pattern is often insecure:</p><ul><li>You should somehow make sure that the response matches the request. Due to the breadth-first order of execution, you cannot assume that there have been no other requests in between.</li><li>Some contracts use <code>Tezos.get_sender</code> value for authorisation. If a third-party contract can make a contract emit an operation, the dependent contracts may no longer be sure that the operation coming from the sender is indeed <em>authorised</em> by the sender.</li></ul><p>Let us look at a simple access control contract with a &quot;view&quot; entrypoint:</p><p>Now imagine we want to control a contract with the following interface (we omit the full code of the contract for clarity; you can find it in the <a href="https://gitlab.com/ligolang/ligo/-/tree/dev/gitlab-pages/docs/tutorials/inter-contract-calls/examples" target="_blank" rel="noopener noreferrer">examples folder</a>):</p><p>You may notice that we can abuse the <code>IsWhitelisted</code> entrypoint to pause and unpause the token, even if we are not among the whitelisted senders. Try it out:</p><p><code>tezos-client call &quot;$ACCESS_CONTROLLER&quot; from &quot;$EVA&quot; --entrypoint &quot;%isWhitelisted&quot; --arg &quot;Pair ($WHITELISTED_ADDRESS, $TARGET %setPaused)&quot;</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="contract-factories">Contract factories<a href="#contract-factories" class="hash-link" aria-label="Direct link to Contract factories" title="Direct link to Contract factories">​</a></h2><p>So far, we have covered only one type of operation – transaction. But we can <em>originate</em> contracts from LIGO a well! There is a special instruction <code>Tezos.create_contract</code>. It accepts four arguments:</p><ol><li>Contract code. Note that the code must be an inline function that does not use any existing bindings.</li><li>Optional delegate.</li><li>The amount of Tez to send to the contract upon origination.</li><li>The initial storage value.</li></ol><p>For example, we can create a new counter contract with</p><p><code>Tezos.create_contract</code> returns a pair of <em>origination operation</em> and the <em>address</em> of the new contract. Note that, at this stage, the contract has not been originated yet! That is why you cannot forge a transaction to the newly-created contract: <code>Tezos.get_{contract, entrypoint}_opt</code> would fail if called before the origination operation has been processed.</p><p><code>CreateAndCall</code> contract in the examples folder shows how we can call the created contract with a callback mechanism:</p><p>By the time <code>%callback</code> is called, the <code>create_op</code> would be completed. Thus, the factory <code>%callback</code> can forge yet another operation to call the default entrypoint of the new contract:</p><table><thead><tr><th>Current call</th><th>Queue before</th><th>Queue after</th></tr></thead><tbody><tr><td><code>A %createAndCall</code></td><td>[]</td><td>[Originate <code>B</code>, <code>A %callback</code>]</td></tr><tr><td>Originate <code>B</code></td><td>[<code>A %callback</code>]</td><td>[<code>A %callback</code>]</td></tr><tr><td><code>A %callback</code></td><td>[]</td><td>[<code>B %default</code>]</td></tr><tr><td><code>B %default</code></td><td>[]</td><td>[]</td></tr></tbody></table><p>If you use this pattern, please mind the execution model and check whether the guarantees it provides are enough for security of your application.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#internal-operations" class="table-of-contents__link toc-highlight">Internal operations</a></li><li><a href="#a-note-on-complexity" class="table-of-contents__link toc-highlight">A note on complexity</a></li><li><a href="#internal-transactions-in-ligo" class="table-of-contents__link toc-highlight">Internal transactions in LIGO</a></li><li><a href="#interoperability-and-standards-compliance" class="table-of-contents__link toc-highlight">Interoperability and standards compliance</a></li><li><a href="#execution-order" class="table-of-contents__link toc-highlight">Execution order</a></li><li><a href="#returning-values" class="table-of-contents__link toc-highlight">Returning values</a></li><li><a href="#contract-factories" class="table-of-contents__link toc-highlight">Contract factories</a></li></ul></div></div></div></div></main></div></div><footer><div class="footer"><div class="container footer__content_WVEf"><div class="footer__brand_I2nm"><div class="footer__bottom"><div class="margin-bottom--sm"><img src="/previews/ligo/modules/img/ligo-logo.svg" alt="Ligo Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="50" height="50"><img src="/previews/ligo/modules/img/ligo-logo-light.svg" alt="Ligo Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="50" height="50"></div></div><h3>Ligo</h3><p class="footer__brand-subtitle_zMnG">The smart-contract language tailored for Tezos.</p></div><div class="footer__links_r5Qx"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">LEARN LIGO</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/previews/ligo/modules/docs/intro/introduction">Get started</a></li><li class="footer__item"><a href="https://packages.ligolang.org/packages" target="_blank" rel="noopener noreferrer" class="footer__link-item">Registry<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/previews/ligo/modules/docs/api/cli-commands">Ligo CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/previews/ligo/modules/docs/intro/changelog">Changelog</a></li><li class="footer__item"><a class="footer__link-item" href="/previews/ligo/modules/docs/faq/intro">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">COMMUNITY</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/tezos" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/playlist?list=PLmDOlM4rqLvInuervAU4YuU39ThuHw3fM" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/LigoLang" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/LigoLang" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/marigold-ligolang/" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">CONTRIBUTE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://gitlab.com/ligolang/ligo" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">Sources<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitlab.com/ligolang/ligo/-/issues" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bounties.ligolang.org" target="_blank" rel="noopener noreferrer nofollow" class="footer__link-item">Bounties<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></div></div><div class="footer__after_KMLT"><div class="container footer__after-content_aHcP"><div class="footer__copyright">Copyright © 2024 LIGO. All rights reserved.</div><ul class="footer__socials_NwWN"><li class="footer__socials-item_RXZT"><a href="https://discord.gg/tezos" target="_blank" rel="noopener noreferrer nofollow"><img src="/previews/ligo/modules/img/communication_channels/discord.svg" height="30" width="30" alt="" loading="lazy" decoding="async"><span class="sr-only">Join the Ligo Discord server. We&#x27;re here to help.</span></a></li><li class="footer__socials-item_RXZT"><a href="https://www.youtube.com/playlist?list=PLmDOlM4rqLvInuervAU4YuU39ThuHw3fM" target="_blank" rel="noopener noreferrer nofollow"><img src="/previews/ligo/modules/img/communication_channels/youtube.svg" height="26" width="33" alt="" loading="lazy" decoding="async"><span class="sr-only">See Ligo latest videos on YouTube</span></a></li><li class="footer__socials-item_RXZT"><a href="https://gitlab.com/ligolang/ligo/issues" target="_blank" rel="noopener noreferrer nofollow"><img src="/previews/ligo/modules/img/communication_channels/gitlab.svg" height="30" width="30" alt="" loading="lazy" decoding="async"><span class="sr-only">Need a fix? Create an issue on the Ligo GitLab.</span></a></li><li class="footer__socials-item_RXZT"><a href="https://x.com/ligolang" target="_blank" rel="noopener noreferrer nofollow"><img src="/previews/ligo/modules/img/communication_channels/x.svg" height="26" width="26" alt="" loading="lazy" decoding="async"><span class="sr-only">Follow Ligo on X / Twitter to get news.</span></a></li><li class="footer__socials-item_RXZT"><a href="https://t.me/LigoLang" target="_blank" rel="noopener noreferrer nofollow"><img src="/previews/ligo/modules/img/communication_channels/telegram.svg" height="30" width="30" alt="" loading="lazy" decoding="async"><span class="sr-only">Talk with Ligo team on Telegram</span></a></li><li class="footer__socials-item_RXZT"><a href="https://www.linkedin.com/company/marigold-ligolang/" target="_blank" rel="noopener noreferrer nofollow"><img src="/previews/ligo/modules/img/communication_channels/linkedin.svg" height="30" width="30" alt="" loading="lazy" decoding="async"><span class="sr-only">Discover Ligo on LinkedIn</span></a></li></ul></div></div></footer></div>
<script src="/previews/ligo/modules/assets/js/runtime~main.f86f8c60.js"></script>
<script src="/previews/ligo/modules/assets/js/main.86e62175.js"></script>
</body>
</html>