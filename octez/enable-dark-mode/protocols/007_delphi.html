
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Protocol Delphi &#8212; Octez &amp; Protocol products documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1cb20957" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=fcbf31fd"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KT3Z3X4Y82"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'protocols/007_delphi';</script>
    <script src="../_static/js/custom.js?v=e7f469e6"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Protocol Carthage" href="006_carthage.html" />
    <link rel="prev" title="Protocol Edo" href="008_edo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Octez & Protocol products documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Octez & Protocol products documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/tezos.html">Octez &amp; Protocol overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/howtoget.html">Installing Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/cosign-verify.html">Verifying Octez Docker Images with Cosign</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/get_troubleshooting.html">Installation troubleshooting</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtouse.html">Getting started with Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtorun.html">Running Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/services.html">Setting up Octez Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/versioning.html">Octez &amp; Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/breaking_changes.html">BREAKING CHANGES</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez User manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-client.html">Setting up the client</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/client-configuration.html">Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/key-management.html">Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sandbox.html">Sandboxed mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/mockup.html">Mockup mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy.html">Proxy mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/light.html">Light mode</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-node.html">Setting up the node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/node-configuration.html">Node Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/multinetwork.html">Connecting to a Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/history_modes.html">History modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/snapshots.html">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy-server.html">Proxy server</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user/node-monitoring.html">Monitoring an Octez Node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/openmetrics.html">Supported Open Metrics</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../user/teztale.html">Monitoring the consensus protocol</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../user/multisig.html">Built-in multisig contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/fa12.html">FA1.2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/logging.html">Logging features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/exits.html">Exit codes and signals</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez Reference manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../shell/the_big_picture.html">Octez Software Architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/shell.html">The Octez Shell</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/validation.html">The validation subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/prevalidation.html">The Prevalidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/storage.html">The storage layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/sync.html">Synchronisation heuristic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/p2p.html">The peer-to-peer layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/protocol_environment.html">Protocol Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/micheline.html">Micheline</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/data_availability_committees.html">Data Availability Committees</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/dal.html">Data Availability Layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_overview.html">DAL overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_node.html">The DAL node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_bakers.html">Bakers &amp; the DAL</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/smart_rollup_node.html">Smart rollup node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/p2p_api.html">P2P message format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/rpc.html">Shell RPCs - Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Protocol Reference Manuals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../active/index.html">Paris Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../active/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../active/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_issuance.html">Adaptive Issuance and Staking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../active/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/rpc.html">Paris RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../quebeca/index.html">Quebeca Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../quebeca/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebeca/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../quebeca/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quebeca/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quebeca/rpc.html">Quebeca RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alpha/index.html">Alpha Dev Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../alpha/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../alpha/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/rpc.html">Alpha RPCs - Reference</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tezos developer Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developer/rpc.html">JSON/RPC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/openapi.html">RPCs - OpenAPI reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in Octez releases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../releases/releases.html">Release System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/version-20.html">Version 20.2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../releases/history.html">Older Versions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-19.html">Version 19.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-18.html">Version 18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-17.html">Version 17.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-16.html">Version 16.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-15.html">Version 15.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-14.html">Version 14.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-13.html">Version 13.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-12.html">Version 12.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-11.html">Version 11.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-10.html">Version 10.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-9.html">Version 9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-8.html">Version 8.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-7.html">Version 7.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/january-2020.html">Mainnet January 2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/december-2019.html">Mainnet December 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/october-2019.html">Mainnet-Staging October 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/september-2019.html">Mainnet September 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/may-2019.html">Mainnet May 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/april-2019.html">Mainnet April 2019</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in protocol versions</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="naming.html">Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="019_paris.html">Protocol Paris</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_quebeca.html">Protocol Quebeca</a></li>
<li class="toctree-l1"><a class="reference internal" href="alpha.html">Protocol Alpha</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="history.html">Older Protocols</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="018_oxford.html">Protocol Oxford</a></li>
<li class="toctree-l2"><a class="reference internal" href="017_nairobi.html">Protocol Nairobi</a></li>
<li class="toctree-l2"><a class="reference internal" href="016_mumbai.html">Protocol Mumbai</a></li>
<li class="toctree-l2"><a class="reference internal" href="015_lima.html">Protocol Lima</a></li>
<li class="toctree-l2"><a class="reference internal" href="014_kathmandu.html">Protocol Kathmandu</a></li>
<li class="toctree-l2"><a class="reference internal" href="013_jakarta.html">Protocol Jakarta</a></li>
<li class="toctree-l2"><a class="reference internal" href="012_ithaca.html">Protocol Ithaca</a></li>
<li class="toctree-l2"><a class="reference internal" href="011_hangzhou.html">Protocol Hangzhou</a></li>
<li class="toctree-l2"><a class="reference internal" href="010_granada.html">Protocol Granada</a></li>
<li class="toctree-l2"><a class="reference internal" href="009_florence.html">Protocol Florence</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_edo.html">Protocol Edo</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Protocol Delphi</a></li>
<li class="toctree-l2"><a class="reference internal" href="006_carthage.html">Protocol Carthage</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_babylon.html">Protocol Babylon</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_Pt24m4xi.html">Protocol Athens</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_PsddFKi3.html">Protocol 003_PsddFKi3</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/contributing_index.html">How to contribute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/contributing.html">How to contribute to Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/contributing-adding-a-new-opam-dependency.html">How to add or update opam dependencies</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merge_team.html">Octez Merge Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/guidelines.html">Documentation and coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/repository_scope.html">Scope of the Octez repository</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/programming.html">Programming tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/gadt.html">Generalized Algebraic Data Types (GADTs)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/error_monad.html">The Error Monad</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p1_result.html">Part 1: <code class="docutils literal notranslate"><span class="pre">result</span></code>, Lwt, and Lwt-<code class="docutils literal notranslate"><span class="pre">result</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p2_tzresult.html">Part 2: <code class="docutils literal notranslate"><span class="pre">tzresult</span></code> and Lwt-<code class="docutils literal notranslate"><span class="pre">tzresult</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p3_advanced.html">Part 3: Advanced topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p4_appendices.html">Part 4: Appendices</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/clic.html">The <code class="docutils literal notranslate"><span class="pre">clic</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/data_encoding.html">The <code class="docutils literal notranslate"><span class="pre">data_encoding</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/event_logging_framework.html">Using The Event Logging Framework</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/testing_index.html">Testing in Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/testing.html">Overview of Testing in Octez</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/ppx_expect.html">Ppx_expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/tezt.html">Tezt: OCaml Tezos Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/long-tezts.html">Tezt: Long Tests and Performance Regression Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/alcotezt.html">Alcotezt: An Alcotest Compatibility Wrapper for Tezt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/unit_testing_legacy_code.html">Making legacy code unit-testable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/proposal_testing.html">How to Test a Protocol Proposal</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/maintaining.html">Maintaining</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/entering_alpha.html">How to start reading protocol Alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/michelson_instructions.html">Adding a new instruction to Michelson language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/protocol_release_checklist.html">Protocol Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/howto-freeze-protocols.html">How to Freeze Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/protocol_environment_upgrade.html">Adding a new protocol environment</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Documenting</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/tools.html">Platform Development tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/profiling.html">Profiling the Octez node</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/snoop.html">Benchmarking with Snoop</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_arch.html">Architecture of <code class="docutils literal notranslate"><span class="pre">octez-snoop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_tutorial.html">Snoop usage tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_example.html">In-depth usage example: more control over your benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/tezos_micheline_rewriting.html">Rewriting Micheline with <code class="docutils literal notranslate"><span class="pre">tezos-micheline-rewriting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_interpreter.html">Snoop and the Michelson Interpreter</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/time_measurement_ppx.html">Time measurement PPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/python_environment.html">Python Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/pre_commit_hook.html">Pre-Commit Hook</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/encodings.html">Encodings</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/merkle-proof-encoding-formats.html">Merkle Proof Encoding Formats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v1-tree32.html">V1 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v1-tree2.html">V1 for Tree2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v2-tree32.html">V2 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v2-tree2.html">V2 for Tree2</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api-inline.html">OCaml APIs - Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-gitlab"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-gitlab"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos/-/issues/new?issue[title]=Issue%20on%20page%20%2Fprotocols/007_delphi.html&issue[description]=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Protocol Delphi</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-improvements">Performance Improvements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gas-changes">Gas Changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#change-in-format-of-receipts-related-to-gas">Change in format of receipts related to gas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lowered-storage-costs">Lowered storage costs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-fixes">Bug fixes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compatibility-with-32-bit-platforms">Compatibility with 32-bit platforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-change-michelson-annotations">BREAKING CHANGE: Michelson annotations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellanous-bug-fixes">Miscellanous bug fixes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-code-cleanup-and-refactoring">General code cleanup and refactoring</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removal-of-lwt-when-possible">Removal of <code class="docutils literal notranslate"><span class="pre">Lwt</span></code> when possible</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellanous-code-improvements-refactors">Miscellanous code improvements &amp; refactors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-of-michelson">Safety of Michelson</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explicit-limitations-in-the-michelson-typechecker-and-interpreter">Explicit limitations in the Michelson typechecker and interpreter</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="protocol-delphi">
<h1>Protocol Delphi<a class="headerlink" href="#protocol-delphi" title="Link to this heading">#</a></h1>
<p>This page contains all the relevant information for protocol 007 Delphi (007_PsDELPH1).
Each of the main changes is briefly described with links to relevant
external documentation and commits.
The changelog section contains the most significant commit messages
and instructions to regenerate the protocol sources from the
Gitlab branch.</p>
<p>Test network Delphinet is available to test Delphi.
See details in <a class="reference internal" href="../user/multinetwork.html#test-networks"><span class="std std-ref">Test Networks</span></a>
and instructions to join in <a class="reference internal" href="../introduction/howtoget.html#howtoget"><span class="std std-ref">How to get Tezos</span></a>.</p>
<p>The source code of this proposal is available in <a class="reference external" href="https://research-development.nomadic-labs.com/files/delphi_007_PsDELPH1.tar">this tar archive</a> and its
full hash is <code class="docutils literal notranslate"><span class="pre">PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo</span></code>.</p>
<p><strong>This protocol contains several breaking changes with respect to Carthage.</strong>
Developers are particularly encouraged to carefully read this page and
to monitor it for updates.</p>
<section id="performance-improvements">
<h2>Performance Improvements<a class="headerlink" href="#performance-improvements" title="Link to this heading">#</a></h2>
<p>Some effort was directed to streamline the Michelson interpreter and
improve its performance. This mostly consisted in factoring gas
consumption, simplifying logging and removing some calls to <code class="docutils literal notranslate"><span class="pre">Lwt</span></code>
(cf. the dedicated section on that last point).</p>
<p>Patches:</p>
<ul class="simple">
<li><p>217b4fd025 Proto/Michelson: abstract logging facility</p></li>
<li><p>7504b35b94 Proto/Michelson: make lists carry their size and type of
elements</p></li>
<li><p>c744b2e36e Proto/Michelson: hoist gas consumption in
Slice_{string,bytes}</p></li>
<li><p>9854ddc12a Proto/Michelson: hoist Gas.consume out of interp. pattern
matching</p></li>
</ul>
</section>
<section id="gas-changes">
<h2>Gas Changes<a class="headerlink" href="#gas-changes" title="Link to this heading">#</a></h2>
<p>Gas accounting has seen a significant update. Even though gas limits are
the same as in Carthage, the amount of computation per unit of gas
should see a significant increase in Delphi.</p>
<p>More precisely, the following parts of the gas subsystem have been
updated. - Following the optimization work on the interpreter, gas costs
for all instructions have been recomputed. - The cost model for IOs has
been updated and should account better for performances of modern
storage hardware. - The typechecking system has an entirely new cost
model. - Finally, the base gas cost of manager operations has been
reduced from 10000 to 1000 units of gas.</p>
<p>Overall, users should see significant gas cost reductions accross the
board.</p>
<p>Patches:</p>
<ul class="simple">
<li><p>8747f0a987 Proto/Michelson: Use the right cost function for
SET_DELEGATE instr</p></li>
<li><p>6825b14cc0 Protocol/Michelson: fix gas consumption in Loop exit case</p></li>
<li><p>267ddd55d9 Protocol/gas: fix scaling of gas accounting for number of
writes</p></li>
<li><p>f1397bffb6 Proto/gas: make internal gas visible in interpreter traces</p></li>
<li><p>1a874fb990 Proto/gas: rescale gas by 2^7, making internal_gas always
0</p></li>
<li><p>866fa99e71 Proto/gas: remove internal_gas</p></li>
<li><p>3eab3718a4 Proto/Michelson: properly carbonate
extract_big_map_updates and collect_big_maps</p></li>
<li><p>a5baf0ed59 Proto/Michelson: Remove gas cost of ‘map_to_list’ and
‘set_to_list’ conversions</p></li>
<li><p>1ae30c0932 Protocol/Migration: scale gas limit constants in the
context by 128</p></li>
<li><p>76918bf6fa Proto/Gas: remove intermediary cost record</p></li>
<li><p>3e11d74d91 Proto/Gas: factor calls to scaling function</p></li>
<li><p>07f89a7a9e Proto/Gas: inline calls to scale</p></li>
<li><p>c67f0dd61c Proto/Gas: perform rescaling from x128 to x1000</p></li>
<li><p>786bdb360f Proto/Gas: arithmetic optimization (remove multiplication
by 1)</p></li>
<li><p>6c611b948d Protocol/Migration: scale gas limit constants in the
context by 1000</p></li>
<li><p>5dfb79a814 Revert “Protocol/Migration: scale gas limit constants in
the context by 1000”</p></li>
<li><p>fbccb2390a Revert “Vendors/flextesa: scale gas limit constants in the
context by 1000”</p></li>
<li><p>f3201231f2 Revert “Protocol/Migration: scale gas limit constants in
the context by 128”</p></li>
<li><p>b50d6f870a Revert “Vendors/flextesa: scale gas limit constants in the
context by 128”</p></li>
<li><p>27bb7aeb2d Proto/gas: set 1 milligas = 1 atomic_step_cost</p></li>
<li><p>7e50a74755 Proto/Gas: add new gas cost functions in dedicated module</p></li>
<li><p>097e79f626 Proto/Gas: inject new cost functions in <code class="docutils literal notranslate"><span class="pre">Gas.cost</span></code>,
expose in .mli</p></li>
<li><p>78a2e8069c Proto/Gas: plug new costs on the interpreter</p></li>
<li><p>02b5fc516c Proto/Gas: fix gas for Concat_string &amp; Concat_bytes</p></li>
<li><p>e00ec5eff8 Proto/Gas: unplug 006 interpreter gas</p></li>
<li><p>1838b7da21 Proto/Gas: introduce Storage_costs module</p></li>
<li><p>a21c1ed287 Proto/Gas: use Storage_costs in carbonated storage
functors</p></li>
<li><p>3281de90c2 Proto/Gas: introduce Contract.get_balance_carbonated</p></li>
<li><p>2e1a9d88e3 Proto/Gas: adding encoding/decoding cost constants</p></li>
<li><p>68b4c2c37d Proto/Gas: injecting Gas_limit_repr.cost into
Alpha_context.Gas.cost</p></li>
<li><p>33a0d8f015 Proto/Gas: expose 007 typechecking costs</p></li>
<li><p>be9c3159d8 Proto/Gas: Adapt translator to 007 typechecking costs</p></li>
<li><p>bd205ad65e Proto/Gas: expose 007 unparsing costs</p></li>
<li><p>eb784b35be Proto/Gas: adapt translator to 007 unparsing costs</p></li>
<li><p>9b478326fd Proto/Gas: add cost functions and helpers for
strip_locations</p></li>
<li><p>b574bff205 Proto/Gas: carbonate calls to Micheline.strip_locations</p></li>
<li><p>6e6d59f578 Proto/Gas: Unplug 006 translator gas</p></li>
<li><p>9ae9b3c771 Proto/Gas: prettify constants</p></li>
<li><p>987c4f93a7 Proto/Gas: remove useless <code class="docutils literal notranslate"><span class="pre">let</span></code> bindings in cost
functions</p></li>
<li><p>4ffc37e769 Proto/tests: add basic unit test for cost functions</p></li>
<li><p>5ef9a9aae1 Proto/Gas: reduce gas cost of manager op</p></li>
</ul>
<section id="change-in-format-of-receipts-related-to-gas">
<h3>Change in format of receipts related to gas<a class="headerlink" href="#change-in-format-of-receipts-related-to-gas" title="Link to this heading">#</a></h3>
<p>The protocol now internally handles <em>milligas</em> but exposes gas to the
user. - Protocol constants such as per-block and per-operation gas
limits are <strong>still specified in gas</strong>. - On the input side of the
protocol, the <code class="docutils literal notranslate"><span class="pre">gas_limit</span></code> field in manager operations is <strong>still
specified in gas</strong>, as before. - On the output side, receipts contain
both the <code class="docutils literal notranslate"><span class="pre">consumed_gas</span></code> (as before) and a new field
<code class="docutils literal notranslate"><span class="pre">consumed_milligas</span></code>. The relationship between this two fields is the
following:</p>
<div class="math notranslate nohighlight">
\[consumed\_gas = \lceil consumed\_milligas / 1000 \rceil\]</div>
<p>In other terms, <code class="docutils literal notranslate"><span class="pre">consumed_gas</span></code>, provided for backwards compatibility,
is the rounded-up version of <code class="docutils literal notranslate"><span class="pre">consumed_milligas</span></code>. Users wanting to
have the most accurate description of the gas consumption of their
transfers should consider using <code class="docutils literal notranslate"><span class="pre">consumed_milligas</span></code>.</p>
<p>To make understanding the change easier, here is a small example
illustrating a transfer in sandboxed mode to a toy <code class="docutils literal notranslate"><span class="pre">minimal.tz</span></code>
contract:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ parameter int ;
  storage unit ;
  code { CDR ; NIL operation; PAIR } }
</pre></div>
</div>
<p>Let us originate this contract.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tezos-client -l originate contract mini transferring 0 from bootstrap1 running minimal.tz --burn-cap 0.07375 --init &#39;Unit&#39;
</pre></div>
</div>
<p>During simulation, the <code class="docutils literal notranslate"><span class="pre">preapply</span></code> RPC is given the following
operation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ &quot;protocol&quot;: &quot;ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK&quot;,
  &quot;branch&quot;: &quot;BMSAKmQD2Q2Ghk2jtHMGpx5Zww98oLsFdh4XW1863TizUjyfY8S&quot;,
  &quot;contents&quot;:
  [ { &quot;kind&quot;: &quot;origination&quot;,
      &quot;source&quot;: ..., &quot;fee&quot;: &quot;434&quot;, &quot;counter&quot;: &quot;1&quot;,
      &quot;gas_limit&quot;: &quot;1690&quot;,
      &quot;storage_limit&quot;: &quot;315&quot;,
      &quot;balance&quot;: &quot;0&quot;,
      &quot;script&quot;: ... }
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gas_limit</span></code>, equal to <code class="docutils literal notranslate"><span class="pre">1690</span></code> in this example, is labelled in
<strong>gas</strong>. The outcome of the simulation is the following receipt:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ &quot;kind&quot;: &quot;origination&quot;,
            &quot;source&quot;: ..., &quot;fee&quot;: &quot;434&quot;,
            &quot;counter&quot;: &quot;1&quot;,
            &quot;gas_limit&quot;: &quot;1690&quot;,
            &quot;storage_limit&quot;: &quot;315&quot;, &quot;balance&quot;: &quot;0&quot;,
            &quot;script&quot;: ...,
            &quot;metadata&quot;:
              { &quot;balance_updates&quot;: ...,
                &quot;operation_result&quot;:
                  { &quot;status&quot;: &quot;applied&quot;, &quot;big_map_diff&quot;: [],
                    &quot;balance_updates&quot;: ...,
                    &quot;originated_contracts&quot;: ...,
                    &quot;consumed_gas&quot;: &quot;1590&quot;,
                    &quot;consumed_milligas&quot;: &quot;1589562&quot;,
                    &quot;storage_size&quot;: &quot;38&quot;,
                    &quot;paid_storage_size_diff&quot;: &quot;38&quot; } } }
</pre></div>
</div>
<p>The metadata contains both: - the field <code class="docutils literal notranslate"><span class="pre">consumed_milligas</span></code>,
corresponding to the <strong>exact</strong> amount of gas consumed, labelled in
<strong>milligas</strong>; - the field <code class="docutils literal notranslate"><span class="pre">consumed_gas</span></code>, obtained by ceiling the
milligas value as described above, labelled in <strong>gas</strong>.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">tezos-client</span></code> binary prints gas, not milligas. However
it displays three decimals:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This sequence of operations was run:
  Manager signed operations:
    From: tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx
    Fee to the baker: ꜩ0.000434
    Expected counter: ...
    Gas limit: 1690
    Storage limit: 315 bytes
    Balance updates:
      tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx ........... -ꜩ0.000434
      fees(tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx,0) ... +ꜩ0.000434
    Origination:
      From: tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx
      Credit: ꜩ0
      Script:
        { parameter int ; storage unit ; code { CDR ; NIL operation ; PAIR } }
        Initial storage: Unit
        No delegate for this contract
        This origination was successfully applied
        Originated contracts:
          KT1HUgv4V8RnEhzNXUxWSqU2PGZ6MgRh34n3
        Storage size: 38 bytes
        Paid storage size diff: 38 bytes
        Consumed gas: 1589.562
        Balance updates:
          tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx ... -ꜩ0.0095
          tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx ... -ꜩ0.06425
</pre></div>
</div>
<p>Patches:</p>
<ul class="simple">
<li><p>7868fa947b Proto/gas: introduce Fixed_point_repr module</p></li>
<li><p>c436869c49 Proto/tests: unit tests for Fixed_point_repr</p></li>
<li><p>5a4f408582 Proto/gas: edit TEZOS_PROTOCOL for Fixed_point, move
Gas_limit_repr</p></li>
<li><p>e939017844 Proto/gas: use fixed-point computations for gas (FIXME)</p></li>
<li><p>6031a0dc8c Proto/client: use fixed-point computations for gas</p></li>
<li><p>7d9f76418d Proto/delegate: use fixed-point computations for gas</p></li>
<li><p>804b42cd86 Proto: restore format of receipts to a retrocompatible
schema</p></li>
</ul>
</section>
</section>
<section id="lowered-storage-costs">
<h2>Lowered storage costs<a class="headerlink" href="#lowered-storage-costs" title="Link to this heading">#</a></h2>
<p>In Tezos, storing data in the state leads to a burn of tez proportional
to the size of the storage increase. This happens when creating a new
account, originationg a new smart contract or making the storage of a
smart contract grow above its historical higher size. This is different
from fees that are paid to the baker proportionally to the size of
operations. Indeed, operations are transient (and can be forgotten by
nodes in the lighweight rolling mode), while data in the state is
replicated by all nodes and can be so forever.</p>
<p>In Delphi, the amount of tez burned to store data in the ledger’s state
is decreased by a factor of 4, going from 1 tez to 0.25 tez for a
kilobyte. The price to create a new account is thus lowered from 0.257
tez to 0.06425.</p>
<p>Patches:</p>
<ul class="simple">
<li><p>8f808e8317 proto/parameters: reduce cost_per_byte to 0.000250tz</p></li>
<li><p>ffaba729db proto/migration: set cost_per_byte to 0.000250tz</p></li>
</ul>
</section>
<section id="bug-fixes">
<h2>Bug fixes<a class="headerlink" href="#bug-fixes" title="Link to this heading">#</a></h2>
<section id="compatibility-with-32-bit-platforms">
<h3>Compatibility with 32-bit platforms<a class="headerlink" href="#compatibility-with-32-bit-platforms" title="Link to this heading">#</a></h3>
<p>Carthage has some parts that assume a 64-bit runtime. These
modifications restore the compatibility with 32-bit systems, and in
general make the code clearer and less dependent on the underlying word
size.</p>
<p>Patches:</p>
<ul class="simple">
<li><p>da91297c0d Protocol/Michelson: avoid overflowing [Int32.to_int
Int32.max_int]</p></li>
<li><p>377af3acb0 Proto/Michelson: Simplify parse_uint30</p></li>
<li><p>06c2f6f97b Protocol: Safer Int64.to_int</p></li>
<li><p>40f9a2c9a3 Storage: rename Int -&gt; UInt16</p></li>
<li><p>ceb4ef33ba Storage: rename Int_index -&gt; Int31_index</p></li>
<li><p>70c0aa4641 Proto/Gas: Zarith-ify some cost functions</p></li>
</ul>
</section>
<section id="breaking-change-michelson-annotations">
<h3>BREAKING CHANGE: Michelson annotations<a class="headerlink" href="#breaking-change-michelson-annotations" title="Link to this heading">#</a></h3>
<p>Field annotations in Michelson types were not properly checked and could
contain invalid characters. In particular, it was possible to use a
digit as the first meaningful character of a field annotation but only
if it appeared in a type; a few contracts on Mainnet contain such
numerals as first meaningful character. We have added the missing check
and extended the syntax of Michelson annotations to allow digits. At the
time of writing, all Mainnet and Carthagenet contracts successfully
typecheck.</p>
<p>BREAKING CHANGE: If a smart contract containing a non-numeral invalid
character in a field annotation inside a type were to be originated
before the activation of Delphi, such a contract would be locked by the
activation.</p>
<p>Patches:</p>
<ul class="simple">
<li><p>ec1d992e5c Use plain algebraic types for the Michelson annotations</p></li>
<li><p>642bab2f97 Proto/Michelson: ensures all annotations are checked</p></li>
<li><p>0f12f628e9 Proto/Michelson: extend the set of allowed Michelson
annotations</p></li>
<li><p>1b179aeb0b Proto/Michleson: make annotations on <code class="docutils literal notranslate"><span class="pre">Right</span></code> and <code class="docutils literal notranslate"><span class="pre">Elt</span></code>
consistent</p></li>
</ul>
</section>
<section id="miscellanous-bug-fixes">
<h3>Miscellanous bug fixes<a class="headerlink" href="#miscellanous-bug-fixes" title="Link to this heading">#</a></h3>
<p>Patches:</p>
<ul class="simple">
<li><p>8c1dd8e53b Proto/Michelson: fix the arity check for chain_id</p></li>
<li><p>dde9e19d55 Proto/RPC: return all delegates if no flags were used</p></li>
<li><p>28b8181a8c Proto/Michelson: fix registration of error
Invalid_syntactic_constant</p></li>
<li><p>7f329a1700 Proto/Michelson: add missing cases in typechecking error
reporting</p></li>
<li><p>083e9c6f9b Proto: Add missing case for keyword namespace encoding</p></li>
<li><p>b1af688dfd Proto: for transfers with 0 tz, check if target exists</p></li>
<li><p>982dd6ec77 Proto: Update <code class="docutils literal notranslate"><span class="pre">max_revelations_per_block</span></code> to include
anon ops</p></li>
<li><p>508b3ae5f4 Proto/Michelson: readable unparsing of chain ids</p></li>
<li><p>b03b8b0883 Proto: Fix double encoding of big_map_diff</p></li>
<li><p>ae0626d708 Proto: make signature check of operation packs more
efficient</p></li>
</ul>
</section>
</section>
<section id="general-code-cleanup-and-refactoring">
<h2>General code cleanup and refactoring<a class="headerlink" href="#general-code-cleanup-and-refactoring" title="Link to this heading">#</a></h2>
<section id="removal-of-lwt-when-possible">
<h3>Removal of <code class="docutils literal notranslate"><span class="pre">Lwt</span></code> when possible<a class="headerlink" href="#removal-of-lwt-when-possible" title="Link to this heading">#</a></h3>
<p>A large batch of changes consists in mostly trivial modifications that
drop parts of the code that don’t perform IOs out of the IO monad. This
makes the code a bit less uniform, but helps with safety and future
refactoring, and in some cases increases performance (in particular in
the interpreter).</p>
<p>Patches:</p>
<ul class="simple">
<li><p>9e38b8fece Proto/Michelson: remove some Lwt wrappers</p></li>
<li><p>eda54e8ba3 Proto/Michelson: avoid Lwt.bind when logging</p></li>
<li><p>187d9d7cab Proto: bind -&gt; to</p></li>
<li><p>b2f8aac20c List.map -&gt; fold_left_s</p></li>
<li><p>85592c26e9 Proto: filter_map_s -&gt; filter_s</p></li>
<li><p>14eda1e7a9 List.fold_left -&gt; Error_monad.map</p></li>
<li><p>43306a4b89 Script: force_decode/bytes, get rid of Lwt.t</p></li>
<li><p>7b1199d76d Baking: minimal_(valid_)time, get rid of Lwt</p></li>
<li><p>c5a0f66bb0 Baking.earlier_predecessor_timestamp: get rid of Lwt</p></li>
<li><p>e112d592b2 Baking: baking/endorsing_reward, get rid of Lwt</p></li>
<li><p>622ac83eaf Baking/tests: baking/endorsing_reward, get rid of Lwt</p></li>
<li><p>287985b4c7 Baking.check_fitness_gap: get rid of Lwt</p></li>
<li><p>a9cdf7e3bc Contract_storage.fresh_contract_from_current_nonce: get
rid of Lwt</p></li>
<li><p>aef7541f69
Delegate_services.required_endorsements/minimal_valid_time: get rid
of Lwt</p></li>
<li><p>3854c15614 Fees_storage.origination_burn: get rid of Lwt</p></li>
<li><p>d71fe7c127 Operation.check_signature: get rid of Lwt</p></li>
<li><p>419d29b41b Proto: Lwt.return &gt;&gt;=? -&gt; &gt;&gt;?=</p></li>
<li><p>36172136a2 Raw_context.add_fees/rewards/deposit: get rid of Lwt</p></li>
<li><p>f19e52bd86 Script_ir_annot: get rid of fail_unexpected_annot</p></li>
<li><p>b55bfc4673 Script_ir_translator: remove lots of Lwt in parse_instr</p></li>
<li><p>4381c2b266 Script_ir_translator.parse_data: remove lots of Lwt</p></li>
<li><p>509decd748 Script_ir_translator.parse_data: traced</p></li>
<li><p>8da99eff1a Script_ir_translator: less Lwt</p></li>
<li><p>407e460bce Script_ir_translator.collect_big_maps: get rid of Lwt</p></li>
<li><p>1c94741b2b Storage: less Lwt</p></li>
<li><p>30fad4cb40 Proto: fail_unless/when -&gt; error_unless/when</p></li>
<li><p>01aeae86a3 Proto: use predefined ok constants</p></li>
<li><p>0b8964ad8f Proto: lift some Lwt.return</p></li>
</ul>
</section>
<section id="miscellanous-code-improvements-refactors">
<h3>Miscellanous code improvements &amp; refactors<a class="headerlink" href="#miscellanous-code-improvements-refactors" title="Link to this heading">#</a></h3>
<p>A long series of patches consists in minor improvements to the code
style and contents of comments or error messages. Part of this work is
thanks to the automated transcription of the code of the protocol into
Coq (as part of our formal verification effort).</p>
<p>Patches:</p>
<ul class="simple">
<li><p>88bc601fe9 Proto: Uniform variable names for context + comments
clean-up</p></li>
<li><p>6d59b3f32a Michelson: exposes parsing without specifying storage</p></li>
<li><p>bef609828f Proto: expose parse_storage</p></li>
<li><p>abb3a3a48c Include ty_eq in merge_types</p></li>
<li><p>b1519b85e2 Express (comparable_)ty_eq in terms of
merge_(comparable_)ty</p></li>
<li><p>d96d1cc2d1 Migration: remove leftovers Alpha_previous and Babylon_005</p></li>
<li><p>cd4bcec080 Proto/Michelson: remove dead code in parse_instr</p></li>
<li><p>74db352afd Remove mutual dependency between numeric types</p></li>
<li><p>60b8998900 Proto: remove unused exported vals</p></li>
<li><p>83aa3f49a5 Rewrite some when clauses for Coq</p></li>
<li><p>4b5307d995 Remove useless recursion</p></li>
<li><p>f34ec2a28d Proto: Fix formatting</p></li>
<li><p>99d7b81533 Proto: Move and export Michelson prim namespace function</p></li>
<li><p>29153f27ff Proto/Michelson: simplify the interpreter</p></li>
<li><p>36cbee348b Michelson: rename Left/Right as Cons_left/right</p></li>
<li><p>c6cba0db30 Michelson: simplify GADT matchings in script_ir_translator
1/4</p></li>
<li><p>e828029fb3 Michelson: simplify GADT matchings in script_ir_translator
2/4</p></li>
<li><p>0bff45c7f2 Michelson: simplify GADT matchings in script_ir_translator
3/4</p></li>
<li><p>edfae2bcf8 Michelson: simplify GADT matchings in script_ir_translator
4/4</p></li>
<li><p>cff2ab3b69 Proto/Michelson: extract_big_map_updates: aux</p></li>
<li><p>425f3eaaa1 Proto/Michelson: compute has_big_map only when needed</p></li>
<li><p>3b59480b92 Proto/Michelson: get rid of has_big_map flag and old
function</p></li>
<li><p>dd34270a63 Proto/Michelson: factorize parse_storage_ty</p></li>
<li><p>8d17e58cc4 Proto/RPCs: use parse_packable/parameter_ty instead of
parse_ty in services</p></li>
<li><p>09013da929 Proto/Contracts: big_map_diff/Copy: use inline record</p></li>
<li><p>084037dc9c Proto/Michelson: remove dead code</p></li>
<li><p>5e83fe9126 Proto/Michelson: simplify Big_map.fresh</p></li>
<li><p>0172dec928 Proto/Michelson: expose parse_ty for convenience to
external tools</p></li>
<li><p>6c8e8a7f46 Proto/Michelson: expose unparse_code in
Script_ir_translator</p></li>
<li><p>d793d30003 Proto_alpha: spell check</p></li>
<li><p>5807a28c44 Proto/coq-of-ocaml: Remove a polymorphic variant in
raw_context</p></li>
<li><p>5da72db33f Proto: update the old operator to regular naming scheme</p></li>
<li><p>03ab590364 Protocol/coq-of-ocaml: name the signatures of the protocol</p></li>
<li><p>a06caece9f Protocol/coq-of-ocaml: avoid a name collision on encoding
in the generated Coq</p></li>
<li><p>a25feb04f5 Use Option.value</p></li>
<li><p>12c7cf2f81 Protocol/coq-of-ocaml: rename of_seconds to prevent a
collision of name</p></li>
<li><p>b8dd4fc1f9 Protocol/coq-of-ocaml: renaming of force_decode /
force_bytes to prevent collision</p></li>
<li><p>c42b58c8c3 Protocol/coq-of-ocaml: rename consume and check_enough to
prevent collisions</p></li>
<li><p>c4ac279d65 Protocol/coq-of-ocaml: renaming to compile alpha_context</p></li>
<li><p>d6ec7dd8c7 Protocol/coq-of-ocaml: lint the interpreter</p></li>
<li><p>da7d945551 Protocol/coq-of-ocaml: changes to compile storage.ml</p></li>
<li><p>75dad446a4 Protocol/coq-of-ocaml: add signature annotations</p></li>
<li><p>036c287157 Script_ir_translator.parse_data: rename error</p></li>
<li><p>b25d542877 Proto: fix typo in docstring</p></li>
<li><p>fe988f439c Proto: remove dead code</p></li>
</ul>
</section>
</section>
<section id="safety-of-michelson">
<h2>Safety of Michelson<a class="headerlink" href="#safety-of-michelson" title="Link to this heading">#</a></h2>
<section id="explicit-limitations-in-the-michelson-typechecker-and-interpreter">
<h3>Explicit limitations in the Michelson typechecker and interpreter<a class="headerlink" href="#explicit-limitations-in-the-michelson-typechecker-and-interpreter" title="Link to this heading">#</a></h3>
<p>Up until now, some features of Michelson were implicitly limited by gas.
This series of changes add explicit limits that will help with safety,
future refactoring, and debugging (more precise errors).</p>
<ul class="simple">
<li><p>Deep stack instructions <code class="docutils literal notranslate"><span class="pre">DIG</span></code>, <code class="docutils literal notranslate"><span class="pre">DUG</span></code>, <code class="docutils literal notranslate"><span class="pre">DROP</span></code>, and <code class="docutils literal notranslate"><span class="pre">DIP</span></code> are
now bounded to stacks of less than 1024 elements</p></li>
<li><p>The interpreter (resp. typechecker) now have explicit recursion
limits, setting a maximum depths for terms that can be interpreted
(resp. typechecked).</p></li>
</ul>
<p>Both changes set limits to high enough values, and should thus be
invisible to almost all contract authors. Reaching the limits is only
likely to happen when debugging erroneous (such as non-terminating)
code.</p>
<p>Patches:</p>
<ul class="simple">
<li><p>4c019e1004 Proto/Michelson: fix error message for DIP with wrong
constant</p></li>
<li><p>7d0211b648 Michelson: fix number_of_generated_growing_types</p></li>
<li><p>6a7bbf17a4 Proto: add max stack depth</p></li>
<li><p>040abed403 Proto: normalize stackoverflows in typechecking and
unparsing</p></li>
<li><p>95c31f963c Michelson: restrict deep stack instructions to 1023</p></li>
</ul>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="008_edo.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Protocol Edo</p>
      </div>
    </a>
    <a class="right-next"
       href="006_carthage.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Protocol Carthage</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-improvements">Performance Improvements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gas-changes">Gas Changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#change-in-format-of-receipts-related-to-gas">Change in format of receipts related to gas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lowered-storage-costs">Lowered storage costs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-fixes">Bug fixes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compatibility-with-32-bit-platforms">Compatibility with 32-bit platforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-change-michelson-annotations">BREAKING CHANGE: Michelson annotations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellanous-bug-fixes">Miscellanous bug fixes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-code-cleanup-and-refactoring">General code cleanup and refactoring</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removal-of-lwt-when-possible">Removal of <code class="docutils literal notranslate"><span class="pre">Lwt</span></code> when possible</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellanous-code-improvements-refactors">Miscellanous code improvements &amp; refactors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#safety-of-michelson">Safety of Michelson</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explicit-limitations-in-the-michelson-typechecker-and-interpreter">Explicit limitations in the Michelson typechecker and interpreter</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nomadic Labs <contact@nomadic-labs.com>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2023, Nomadic Labs &lt;contact@nomadic-labs.com&gt;.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>