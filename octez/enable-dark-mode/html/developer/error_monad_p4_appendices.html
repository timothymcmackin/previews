
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Part 4: Appendices &#8212; Octez &amp; Protocol products documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=e44384e2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=c1386fac"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KT3Z3X4Y82"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developer/error_monad_p4_appendices';</script>
    <script src="../_static/js/custom.js?v=e7f469e6"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The clic library" href="clic.html" />
    <link rel="prev" title="Part 3: Advanced topics" href="error_monad_p3_advanced.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Octez & Protocol products documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Octez & Protocol products documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/tezos.html">Octez &amp; Protocol overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/howtoget.html">Installing Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/cosign-verify.html">Verifying Octez Docker Images with Cosign</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/get_troubleshooting.html">Installation troubleshooting</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtouse.html">Getting started with Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtorun.html">Running Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/services.html">Setting up Octez Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/versioning.html">Octez &amp; Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/breaking_changes.html">BREAKING CHANGES</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez User manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-client.html">Setting up the client</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/client-configuration.html">Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/key-management.html">Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sandbox.html">Sandboxed mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/mockup.html">Mockup mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy.html">Proxy mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/light.html">Light mode</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-node.html">Setting up the node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/node-configuration.html">Node Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/multinetwork.html">Connecting to a Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/history_modes.html">History modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/snapshots.html">Snapshots</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user/node-monitoring.html">Monitoring an Octez Node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="openmetrics.html">Supported Open Metrics</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../user/teztale.html">Monitoring the consensus protocol</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../user/multisig.html">Built-in multisig contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/fa12.html">FA1.2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/logging.html">Logging features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/exits.html">Exit codes and signals</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez Reference manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../shell/the_big_picture.html">Octez Software Architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/shell.html">The Octez Shell</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/validation.html">The validation subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/prevalidation.html">The Prevalidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/storage.html">The storage layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/sync.html">Synchronisation heuristic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/p2p.html">The peer-to-peer layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/protocol_environment.html">Protocol Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/micheline.html">Micheline</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/data_availability_committees.html">Data Availability Committees</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/dal.html">Data Availability Layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_overview.html">DAL overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_node.html">The DAL node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_run.html">Running a DAL attester node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_bakers.html">Bakers &amp; the DAL</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/smart_rollup_node.html">Smart rollup node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/p2p_api.html">P2P message format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/rpc.html">Shell RPCs - Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Protocol Reference Manuals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../active/index.html">Paris Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../active/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../active/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_issuance.html">Adaptive Issuance and Staking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../active/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/rpc.html">Paris RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../qena/index.html">Qena Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../qena/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../qena/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qena/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../qena/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qena/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qena/rpc.html">Qena RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alpha/index.html">Alpha Dev Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../alpha/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../alpha/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/mempool.html">Mempool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/rpc.html">Alpha RPCs - Reference</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tezos developer Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="rpc.html">JSON/RPC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/openapi.html">RPCs - OpenAPI reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in Octez releases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../releases/releases.html">Release System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/version-20.html">Version 20.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/version-21.html">Version 21.0~rc3</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../releases/history.html">Older Versions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-19.html">Version 19.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-18.html">Version 18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-17.html">Version 17.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-16.html">Version 16.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-15.html">Version 15.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-14.html">Version 14.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-13.html">Version 13.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-12.html">Version 12.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-11.html">Version 11.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-10.html">Version 10.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-9.html">Version 9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-8.html">Version 8.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-7.html">Version 7.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/january-2020.html">Mainnet January 2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/december-2019.html">Mainnet December 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/october-2019.html">Mainnet-Staging October 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/september-2019.html">Mainnet September 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/may-2019.html">Mainnet May 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/april-2019.html">Mainnet April 2019</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in protocol versions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../protocols/naming.html">Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/020_paris.html">Protocol Paris</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/021_qena.html">Protocol Qena</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/alpha.html">Protocol Alpha</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../protocols/history.html">Older Protocols</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../protocols/018_oxford.html">Protocol Oxford</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/017_nairobi.html">Protocol Nairobi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/016_mumbai.html">Protocol Mumbai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/015_lima.html">Protocol Lima</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/014_kathmandu.html">Protocol Kathmandu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/013_jakarta.html">Protocol Jakarta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/012_ithaca.html">Protocol Ithaca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/011_hangzhou.html">Protocol Hangzhou</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/010_granada.html">Protocol Granada</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/009_florence.html">Protocol Florence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/008_edo.html">Protocol Edo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/007_delphi.html">Protocol Delphi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/006_carthage.html">Protocol Carthage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/005_babylon.html">Protocol Babylon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/004_Pt24m4xi.html">Protocol Athens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/003_PsddFKi3.html">Protocol 003_PsddFKi3</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="contributing_index.html">How to contribute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="contributing.html">How to contribute to Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing-adding-a-new-opam-dependency.html">How to add or update opam dependencies</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="merge_team.html">Octez Merge Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="guidelines.html">Documentation and coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="repository_scope.html">Scope of the Octez repository</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="programming.html">Programming tutorials</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gadt.html">Generalized Algebraic Data Types (GADTs)</a></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="error_monad.html">The Error Monad</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="error_monad_p1_result.html">Part 1: <code class="docutils literal notranslate"><span class="pre">result</span></code>, Lwt, and Lwt-<code class="docutils literal notranslate"><span class="pre">result</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="error_monad_p2_tzresult.html">Part 2: <code class="docutils literal notranslate"><span class="pre">tzresult</span></code> and Lwt-<code class="docutils literal notranslate"><span class="pre">tzresult</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="error_monad_p3_advanced.html">Part 3: Advanced topics</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Part 4: Appendices</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="clic.html">The <code class="docutils literal notranslate"><span class="pre">clic</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_encoding.html">The <code class="docutils literal notranslate"><span class="pre">data_encoding</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_logging_framework.html">Using The Event Logging Framework</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="octez_architecture.html">Octez Architecture Details</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="baker.html">Baker application’s architecture</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="testing_index.html">Testing in Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Overview of Testing in Octez</a></li>
<li class="toctree-l2"><a class="reference internal" href="ppx_expect.html">Ppx_expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="tezt.html">Tezt: OCaml Tezos Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="long-tezts.html">Tezt: Long Tests and Performance Regression Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="alcotezt.html">Alcotezt: An Alcotest Compatibility Wrapper for Tezt</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit_testing_legacy_code.html">Making legacy code unit-testable</a></li>
<li class="toctree-l2"><a class="reference internal" href="proposal_testing.html">How to Test a Protocol Proposal</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="maintaining.html">Maintaining</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="entering_alpha.html">How to start reading protocol Alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="michelson_instructions.html">Adding a new instruction to Michelson language</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol_release_checklist.html">Protocol Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto-freeze-protocols.html">How to Freeze Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol_environment_upgrade.html">Adding a new protocol environment</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Documenting</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tools.html">Platform Development tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="profiling.html">Profiling the Octez node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="profiler_heap.html">Memory profiling the OCaml heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="profiler_valgrind.html">Memory profiling the C heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="profiler_perf.html">Performance profiling</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="profiler_module.html">The Profiler module</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="ppx_profiler.html">Profiler PPX</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="snoop.html">Benchmarking with Snoop</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="snoop_arch.html">Architecture of <code class="docutils literal notranslate"><span class="pre">octez-snoop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="snoop_tutorial.html">Snoop usage tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="snoop_example.html">In-depth usage example: more control over your benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="tezos_micheline_rewriting.html">Rewriting Micheline with <code class="docutils literal notranslate"><span class="pre">tezos-micheline-rewriting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="snoop_interpreter.html">Snoop and the Michelson Interpreter</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="time_measurement_ppx.html">Time measurement PPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_environment.html">Python Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="pre_commit_hook.html">Pre-Commit Hook</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="encodings.html">Encodings</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="merkle-proof-encoding-formats.html">Merkle Proof Encoding Formats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v1-tree32.html">V1 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v1-tree2.html">V1 for Tree2</a></li>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v2-tree32.html">V2 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v2-tree2.html">V2 for Tree2</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api-inline.html">OCaml APIs - Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-gitlab"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-gitlab"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos/-/issues/new?issue[title]=Issue%20on%20page%20%2Fdeveloper/error_monad_p4_appendices.html&issue[description]=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Part 4: Appendices</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-what-even-is-a-monad">In depth discussion: what even is a monad?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-error-monad-src-lib-error-monad-tezos-base-tzpervasives-etc">In depth discussion: <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code>, <code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/</span></code>, <code class="docutils literal notranslate"><span class="pre">Tezos_base__TzPervasives</span></code>, etc.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-result-as-data-and-result-as-control-flow">In depth discussion: <code class="docutils literal notranslate"><span class="pre">result</span></code> as data and <code class="docutils literal notranslate"><span class="pre">result</span></code> as control-flow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-pros-and-cons-of-result-compared-to-other-error-management-techniques">In depth discussion: pros and cons of <code class="docutils literal notranslate"><span class="pre">result</span></code> compared to other error management techniques</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#legacy-code">Legacy code</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="part-4-appendices">
<h1>Part 4: Appendices<a class="headerlink" href="#part-4-appendices" title="Link to this heading">#</a></h1>
<p>These appendices are Part 4 of 4 of the <a class="reference internal" href="error_monad.html"><span class="doc">The Error Monad</span></a> tutorial.</p>
<section id="in-depth-discussion-what-even-is-a-monad">
<h2>In depth discussion: what even is a monad?<a class="headerlink" href="#in-depth-discussion-what-even-is-a-monad" title="Link to this heading">#</a></h2>
<p>This tutorial has been pretty loose with the word monad. It has focused
on usage with very little explanations of fundamental concepts. It is
focused on the surface syntax instead of the underlying mathematical
model. This section goes into a bit more details about the general
principles of monads and such. It does not claim to even attempt to
give a complete description of monads, it simply gives more details than
the previous sections.</p>
<p>For coding purposes, a monad is a parametric type equipped with a set of
specific operators.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type &#39;a t
val bind : &#39;a t -&gt; (&#39;a -&gt; &#39;b t) -&gt; &#39;b t
val return : &#39;a -&gt; &#39;a t
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">return</span></code> operator injects a value into the monad and the <code class="docutils literal notranslate"><span class="pre">bind</span></code>
operator continues within the monad.</p>
<p>The set of operators must also follow the monad laws. For example
<code class="docutils literal notranslate"><span class="pre">bind</span> <span class="pre">(return</span> <span class="pre">x)</span> <span class="pre">f</span></code> must be equivalent to <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">x</span></code>.</p>
<p>Monads are used as a generic way to encode different abstractions within
a programming language: I/O, errors, collections, etc. For example, the
<code class="docutils literal notranslate"><span class="pre">option</span></code> monad is defined as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>module OptionMonad = struct
  type &#39;a t = &#39;a option
  let bind x f = match x with | None -&gt; None | Some x -&gt; f x
  let return x = Some x
end
</pre></div>
</div>
<p>And it is useful when dealing with queries that may have no answer. This
can be used as a lighter form of error management than the <code class="docutils literal notranslate"><span class="pre">result</span></code>
monad.</p>
<p>Some programming languages also offer syntactic sugar for monads. This
is to avoid having to write <code class="docutils literal notranslate"><span class="pre">bind</span></code> within <code class="docutils literal notranslate"><span class="pre">bind</span></code> within <code class="docutils literal notranslate"><span class="pre">bind</span></code>.
E.g., Haskell relies heavily on monads and has the dedicated
<code class="docutils literal notranslate"><span class="pre">do</span></code>-notation. In OCaml, you can use one of the following methods:</p>
<ul>
<li><p><a class="reference external" href="https://ocaml.org/manual/bindingops.html">binding operators</a>
(since OCaml 4.08.0)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let add x y =
  let ( let* ) = OptionMonad.bind in
  let* x = int_of_string_opt x in
  let* y = int_of_string_opt y in
  Some (string_of_int (x + y))
</pre></div>
</div>
</li>
<li><p><a class="reference external" href="https://ocaml.org/manual/lex.html#sss:lex-ops-symbols">infix
operators</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let add x y =
  let ( &gt;&gt;= ) = OptionMonad.bind in
  int_of_string_opt x &gt;&gt;= fun x -&gt;
  int_of_string_opt y &gt;&gt;= fun y -&gt;
  Some (string_of_int (x + y))
</pre></div>
</div>
<p>Note that mixing multiple infix operators is not always easy because
of precedence and associativity.</p>
</li>
<li><p>partial application and infix <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let add x y =
  OptionMonad.bind (int_of_string_opt x) @@ fun x -&gt;
  OptionMonad.bind (int_of_string_opt y) @@ fun y -&gt;
  Some (string_of_int (x + y))
</pre></div>
</div>
<p>This is useful for the occasional application: you do not need to
declare a dedicated operator nor open a dedicated syntax module.</p>
</li>
</ul>
<p>Monads can have additional operators beside the required core. E.g., you
can add <code class="docutils literal notranslate"><span class="pre">OptionMonad.join</span> <span class="pre">:</span> <span class="pre">'a</span> <span class="pre">option</span> <span class="pre">option</span> <span class="pre">-&gt;</span> <span class="pre">'a</span> <span class="pre">option</span></code>.</p>
</section>
<section id="in-depth-discussion-error-monad-src-lib-error-monad-tezos-base-tzpervasives-etc">
<h2>In depth discussion: <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code>, <code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/</span></code>, <code class="docutils literal notranslate"><span class="pre">Tezos_base__TzPervasives</span></code>, etc.<a class="headerlink" href="#in-depth-discussion-error-monad-src-lib-error-monad-tezos-base-tzpervasives-etc" title="Link to this heading">#</a></h2>
<p>The different parts of the error monad (syntax modules, extended stdlib,
tracing primitives, etc.) are defined in separate files. Yet, they are
all available to you directly. This section explains where each part is
defined and how it reaches the scope of your code.</p>
<p><strong>From your code, working back to the definitions.</strong></p>
<p>In most of Octez, the <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code> module is available. Specifically, it is
available in all the packages that depend on <code class="docutils literal notranslate"><span class="pre">tezos-base</span></code>. This covers
everything except the protocols and a handful of low-level libraries.</p>
<p>In those part of Octez, the build files include
<code class="docutils literal notranslate"><span class="pre">-open</span> <span class="pre">Tezos_base__TzPervasives</span></code>.</p>
<p>The module <code class="docutils literal notranslate"><span class="pre">Tezos_base__TzPervasives</span></code> is defined by the compilation
unit <code class="docutils literal notranslate"><span class="pre">src/lib_base/TzPervasives.ml</span></code>.</p>
<p>This compilation unit gathers multiple low-level modules together. Of
interest to us is <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">Tezos_error_monad.Error_monad</span></code> (left
untouched in the <code class="docutils literal notranslate"><span class="pre">mli</span></code>) and <code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">Tezos_error_monad.TzLwtreslib</span></code>
(not present in the <code class="docutils literal notranslate"><span class="pre">mli</span></code>, used to shadow the Stdlib modules <code class="docutils literal notranslate"><span class="pre">List</span></code>,
<code class="docutils literal notranslate"><span class="pre">Option</span></code>, <code class="docutils literal notranslate"><span class="pre">Result</span></code>, etc.).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code> module exports:</p>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">error</span></code> type along with the <code class="docutils literal notranslate"><span class="pre">register_error_kind</span></code> function,</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">tzresult</span></code> type,</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">TzTrace</span></code> module,</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">Result_syntax</span></code> and <code class="docutils literal notranslate"><span class="pre">Lwt_result_syntax</span></code> modules
(from a different, more generic name),</p></li>
<li><p>and exports a few more functions.</p></li>
</ul>
<p>The rest of the <code class="docutils literal notranslate"><span class="pre">tezos-error-monad</span></code> package:</p>
<ul class="simple">
<li><p>defines the <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">trace</span></code> type (in <code class="docutils literal notranslate"><span class="pre">TzTrace.ml</span></code>), and</p></li>
<li><p>instantiates <code class="docutils literal notranslate"><span class="pre">TzLwtreslib</span></code> by applying <code class="docutils literal notranslate"><span class="pre">Lwtreslib</span></code>’s <code class="docutils literal notranslate"><span class="pre">Traced</span></code>
functor to <code class="docutils literal notranslate"><span class="pre">TzTrace</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">Lwtreslib</span></code> module exports a <code class="docutils literal notranslate"><span class="pre">Traced</span> <span class="pre">(T:</span> <span class="pre">TRACE)</span></code> functor. This
functor takes a definition of traces and returns a group of modules
intended to shadow the Stdlib.</p>
<p><strong>From the underlying definitions, working all the way up to your
code.</strong></p>
<p>At the low-level is Lwtreslib.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_lwt_result_stdlib/bare/sigs</span></code>: defines interfaces for
basic, non-traced syntax modules and Stdlib-replacement modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_lwt_result_stdlib/bare/structs</span></code>: defines implementations
basic, non-traced syntax modules and Stdlib-replacement modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_lwt_result_stdlib/traced/sigs</span></code>: defines interfaces for
traced syntax modules and Stdlib-replacement modules. These
interfaces are built on top of the non-traced interfaces, mostly by
addition and occasionally by shadowing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_lwt_result_stdlib/traced/structs</span></code>: defines implementations
for traced syntax modules and Stdlib-replacement modules. These
implementations are built on top of the non-traced implementations,
mostly by addition and occasionally by shadowing. These are defined
as functors over some abstract tracing primitives.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_lwt_result_stdlib/lwtreslib.mli</span></code>: puts together the traced
implementations into a single functor <code class="docutils literal notranslate"><span class="pre">Traced</span></code> that takes a trace
definition and returns fully instantiated modules to shadow the
Stdlib.</p></li>
</ul>
<p>Above Lwtreslib is the Error monad.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/TzTrace.ml</span></code>: defines the <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">trace</span></code> type
along with the low-level trace-construction primitives.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/TzLwtreslib.ml</span></code>: instantiates
<code class="docutils literal notranslate"><span class="pre">Lwtreslib.Traced</span></code> with <code class="docutils literal notranslate"><span class="pre">TzTrace</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/monad_extension_maker.ml</span></code>: provides a functor
which, given a tracing module, provides some higher level functions
for tracing as well as a few other functions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/core_maker.ml</span></code>: provides a functor which,
given a name, provides an <code class="docutils literal notranslate"><span class="pre">error</span></code> type, a <code class="docutils literal notranslate"><span class="pre">register_error_kind</span></code>
function, and a few other related functions. This is a functor so we
can instantiate it separately for the shell and for each of the
protocols.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/TzCore.ml</span></code>: instantiates the <code class="docutils literal notranslate"><span class="pre">core_maker</span></code>
functor for the shell.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/error_monad.ml</span></code>: puts together all of the
above into a single module.</p></li>
</ul>
<p>Above the Error monad is lib-base:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src/lib_base/TzPervasives.ml</span></code>: exports the <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code> module,
includes the <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code> module, exports each of the
<code class="docutils literal notranslate"><span class="pre">TzLwtreslib</span></code> module.</p></li>
</ul>
</section>
<section id="in-depth-discussion-result-as-data-and-result-as-control-flow">
<h2>In depth discussion: <code class="docutils literal notranslate"><span class="pre">result</span></code> as data and <code class="docutils literal notranslate"><span class="pre">result</span></code> as control-flow<a class="headerlink" href="#in-depth-discussion-result-as-data-and-result-as-control-flow" title="Link to this heading">#</a></h2>
<p>Note that <code class="docutils literal notranslate"><span class="pre">result</span></code> (and similarly, <code class="docutils literal notranslate"><span class="pre">tzresult</span></code>) is a data type.
Specifically</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type (&#39;a, &#39;b) result =
| Ok of &#39;a
| Error of &#39;b
</pre></div>
</div>
<p>You can treat values of type <code class="docutils literal notranslate"><span class="pre">result</span></code> as data of that data-type. In
this case, you construct and match the values, you pass them around,
etc.</p>
<p>Note however that, in Octez, we also use the <code class="docutils literal notranslate"><span class="pre">result</span></code> type as a
control-flow mechanism. Specifically, in conjunction with the <code class="docutils literal notranslate"><span class="pre">let*</span></code>
binding operator, the <code class="docutils literal notranslate"><span class="pre">result</span></code> type has a continue/abort meaning.</p>
<p>Within your code, you can go from one use to the other. E.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let xs =
  List.rev_map
    (fun x -&gt;
      (* [result] as control-flow *)
      let open Result_syntax in
      let* .. = .. in
      let* .. = .. in
      return ..)
    ys
in
let successes xs =
  (* [result] as data *)
  List.length (List.rev_filter_ok xs)
in
..
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">result</span></code> as sometimes data and sometimes control-flow is the
main reason to bend the guidelines about which syntax module to
open. E.g., if your function returns <code class="docutils literal notranslate"><span class="pre">(_,</span> <span class="pre">_)</span> <span class="pre">result</span> <span class="pre">Lwt.t</span></code> but the
<code class="docutils literal notranslate"><span class="pre">result</span></code> is data returned by the function rather than control-flow
used within the function, then you should open <code class="docutils literal notranslate"><span class="pre">Lwt_syntax</span></code> (rather
then <code class="docutils literal notranslate"><span class="pre">Lwt_result_syntax</span></code>).</p>
<p>As a significant aside, note that in OCaml you can also use exceptions
for control-flow (with <code class="docutils literal notranslate"><span class="pre">raise</span></code> and <code class="docutils literal notranslate"><span class="pre">try</span></code>-<code class="docutils literal notranslate"><span class="pre">with</span></code> and
<code class="docutils literal notranslate"><span class="pre">match</span></code>-<code class="docutils literal notranslate"><span class="pre">with</span></code>-<code class="docutils literal notranslate"><span class="pre">exception</span></code>) and as data (the type <code class="docutils literal notranslate"><span class="pre">exn</span></code> is an
extensible variant data-type).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(** [iter_no_raise f xs] applies [f] to all the elements of [xs]. If [f] raises
    an exception, the iteration continues and [f] is still applies to other
    elements. The function returns pairs of the exceptions raised by [f] along
    the elements of [xs] that triggered these exceptions. *)
let iter_no_raise f xs =
  List.fold_left
    (fun excs x -&gt;
      match f x with
      | exception exc -&gt; exc :: excs
      | () -&gt; excs)
    []
    xs
</pre></div>
</div>
<p>You can find uses of exception as data within the error monad itself.
First, the generic failure functions (<code class="docutils literal notranslate"><span class="pre">error_with</span></code>,
<code class="docutils literal notranslate"><span class="pre">error_with_exn</span></code>, <code class="docutils literal notranslate"><span class="pre">failwith</span></code>, and <code class="docutils literal notranslate"><span class="pre">fail_with_exn</span></code>) are just
wrapper around an <code class="docutils literal notranslate"><span class="pre">error</span></code> which carries an exception (as data).</p>
<p>Second, Lwtreslib provides helpers to catch exceptions. E.g.,
<code class="docutils literal notranslate"><span class="pre">Result.catch</span> <span class="pre">:</span> <span class="pre">(unit</span> <span class="pre">-&gt;</span> <span class="pre">'a)</span> <span class="pre">-&gt;</span> <span class="pre">('a,</span> <span class="pre">exn)</span> <span class="pre">result</span></code> calls a function and
wraps any raised exception inside an <code class="docutils literal notranslate"><span class="pre">Error</span></code> constructor.</p>
</section>
<section id="in-depth-discussion-pros-and-cons-of-result-compared-to-other-error-management-techniques">
<h2>In depth discussion: pros and cons of <code class="docutils literal notranslate"><span class="pre">result</span></code> compared to other error management techniques<a class="headerlink" href="#in-depth-discussion-pros-and-cons-of-result-compared-to-other-error-management-techniques" title="Link to this heading">#</a></h2>
<p>In Octez, we use <code class="docutils literal notranslate"><span class="pre">result</span></code> and the specialised <code class="docutils literal notranslate"><span class="pre">tzresult</span></code>. For this
reason, this tutorial is focused on <code class="docutils literal notranslate"><span class="pre">result</span></code>/<code class="docutils literal notranslate"><span class="pre">tzresult</span></code>. However,
there are other techniques for handling errors. This section compares
them briefly.</p>
<p>In general you should use <code class="docutils literal notranslate"><span class="pre">result</span></code> and <code class="docutils literal notranslate"><span class="pre">tzresult</span></code> but in some
specific cases you can deviate from that. The comparisons below may help
you decide.</p>
<p><strong>Exceptions</strong></p>
<p>In exception-based error handling, you raise an exception (via
<code class="docutils literal notranslate"><span class="pre">raise</span></code>) when an error occurs and you catch it (via <code class="docutils literal notranslate"><span class="pre">try</span></code>-<code class="docutils literal notranslate"><span class="pre">with</span></code>)
to recover. Exceptions are fast because the OCaml compiler and runtime
provide the necessary mechanisms directly.</p>
<p>Whether a function can raise an exception or not cannot be determined by
its type. This means that it is easy to forget to recover from an
exception. An external library may change the set of exceptions that a
function raises and you need to update calls to this function, but the
type-checker cannot warn you about it. This places a heavy burden on the
developer who is responsible for checking the documentation of all the
functions they call.</p>
<p>Exception-raising functions should be documented as such using the
<code class="docutils literal notranslate"><span class="pre">&#64;raise</span></code> documentation keyword.</p>
<div class="line-block">
<div class="line">Pros: performance is good, used widely in the larger ecosystem.</div>
<div class="line">Cons: you cannot rely on the type-checker to help you at all, you
depend on the quality of the documentation of your external and
internal dependencies.</div>
</div>
<p>Note that within the protocol, you should not use exceptions at all.</p>
<p><strong>tzresult</strong></p>
<p>With <code class="docutils literal notranslate"><span class="pre">tzresult</span></code>, errors are carried by the <code class="docutils literal notranslate"><span class="pre">Error</span></code> constructor of a
<code class="docutils literal notranslate"><span class="pre">result</span></code>. In this way an <code class="docutils literal notranslate"><span class="pre">'a</span> <span class="pre">tzresult</span></code> represents the result of a
computation that normally returns an <code class="docutils literal notranslate"><span class="pre">'a</span></code> but may fail.</p>
<p>Because the type of errors is an abstract wrapper (<code class="docutils literal notranslate"><span class="pre">trace</span></code>) around an
extensible variant (<code class="docutils literal notranslate"><span class="pre">error</span></code>), you can only recover from these errors
in a generic way.</p>
<div class="line-block">
<div class="line">Pros: the type of a function indicates if it can fail or not, you
cannot forget to check for success/failure.</div>
<div class="line">Cons: you cannot check which error was raised, registration is heavy
and complicated.</div>
</div>
<p><strong>result</strong></p>
<p>With <code class="docutils literal notranslate"><span class="pre">result</span></code>, errors are carried by the <code class="docutils literal notranslate"><span class="pre">Error</span></code> constructor. Each
function defines its own type of errors.</p>
<div class="line-block">
<div class="line">Pros: the type of a function indicates if and how it can fail, you
cannot forget to check for success/failure, you can check the payload
of failures.</div>
<div class="line">Cons: different errors from different functions cannot be used
together (need conversions), <code class="docutils literal notranslate"><span class="pre">and*</span></code> is unusable.</div>
</div>
<p><strong>option</strong></p>
<p>With <code class="docutils literal notranslate"><span class="pre">option</span></code>, errors are represented by the <code class="docutils literal notranslate"><span class="pre">None</span></code> constructor.
Errors are completely void of payload.</p>
<p>Because there are no payloads attached to an error, you should generally
treat the error directly at the call site. Otherwise you might lose
track of the origin of the failure. E.g., what was not found in the
following code fragment?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>match
  let open Option_syntax in
  let* z = find &quot;zero&quot; in
  let* o = find &quot;one&quot; in
  Some (z, o)
with
| None -&gt; ..
| Some (z, o) -&gt; ..
</pre></div>
</div>
<div class="line-block">
<div class="line">Pros: the type of a function indicates if it can fail, you cannot
forget to check for success/failure.</div>
<div class="line">Cons: a single kind of errors means it cannot be very informative.</div>
</div>
<p>Option is a common enough strategy that the <code class="docutils literal notranslate"><span class="pre">Option_syntax</span></code> and
<code class="docutils literal notranslate"><span class="pre">Lwt_option_syntax</span></code> modules are available in the Octez source.</p>
<p><strong>fallback</strong></p>
<p>Another approach to errors is to have a default or fallback value. In
that case, the function returns a default sensible value when it would
raise and exception or return an error. Alternatively, it can take this
fallback value as parameter.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(** @raise Not_found if argument is [None] *)
val get : &#39;a option -&gt; &#39;a

(** returns [default] if argument is [None] *)
val value : default:&#39;a -&gt; &#39;a option -&gt; &#39;a
</pre></div>
</div>
<div class="line-block">
<div class="line">Pros: there is no error.</div>
<div class="line">Cons: doesn’t work for every function, works differently on different
functions.</div>
</div>
</section>
<section id="legacy-code">
<h2>Legacy code<a class="headerlink" href="#legacy-code" title="Link to this heading">#</a></h2>
<p>The codebase contains only <code class="docutils literal notranslate"><span class="pre">let</span></code>-style binding operators. However,
you might encounter infix bindings in older protocols. If you do and
you are unsure about what the many infix operators do, read on.</p>
<p>The legacy code is written with infix bindings instead of <code class="docutils literal notranslate"><span class="pre">let</span></code>-style
binding operators. The binding <code class="docutils literal notranslate"><span class="pre">&gt;&gt;?</span></code> for <code class="docutils literal notranslate"><span class="pre">result</span></code> and <code class="docutils literal notranslate"><span class="pre">tzresult</span></code>,
<code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> for Lwt, and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=?</span></code> for Lwt-<code class="docutils literal notranslate"><span class="pre">result</span></code> and Lwt-<code class="docutils literal notranslate"><span class="pre">tzresult</span></code>. A
full equivalence table follows.</p>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Modern</p></td>
<td><p>Legacy</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Result_syntax in
let* x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;&gt;? fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Result_syntax in
let+ x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;|? fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_syntax in
let* x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;&gt;= fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_syntax in
let+ x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;|= fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
let* x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;&gt;=? fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
let+ x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;|=? fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">and*</span></code>, <code class="docutils literal notranslate"><span class="pre">and+</span></code> (any syntax
module)</p></td>
<td><p>No equivalent, uses
<code class="docutils literal notranslate"><span class="pre">both_e</span></code>, <code class="docutils literal notranslate"><span class="pre">both_p</span></code>, or
<code class="docutils literal notranslate"><span class="pre">both_ep</span></code></p></td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
let*! x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(e &gt;&gt;= ok) &gt;&gt;=? fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
let*? x = e in
e&#39;
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e &gt;&gt;?= fun x -&gt;
e&#39;
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<p>In addition, instead of dedicated <code class="docutils literal notranslate"><span class="pre">return</span></code> and <code class="docutils literal notranslate"><span class="pre">fail</span></code> functions from
a given syntax module, the legacy code relied on global values.</p>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p>Modern</p></td>
<td><p>Legacy</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Result_syntax in
return x
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ok x
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Result_syntax in
fail e
</pre></div>
</div>
</td>
<td><p>No equivalent, uses
<code class="docutils literal notranslate"><span class="pre">Error</span> <span class="pre">e</span></code></p></td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_syntax in
return x
</pre></div>
</div>
</td>
<td><p>No equivalent, uses
<code class="docutils literal notranslate"><span class="pre">Lwt.return</span> <span class="pre">x</span></code></p></td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
return x
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>return x
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
fail e
</pre></div>
</div>
</td>
<td><p>No equivalent, uses
<code class="docutils literal notranslate"><span class="pre">Lwt.return_error</span> <span class="pre">e</span></code></p></td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Result_syntax in
return x
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ok x
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Result_syntax in
tzfail e
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>error e
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
return x
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>return x
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let open Lwt_result_syntax in
tzfail e
</pre></div>
</div>
</td>
<td><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fail e
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<p>In addition to these syntactic differences, there are also usage
differences. You might encounter the following patterns which you should
not repeat:</p>
<ul>
<li><p>Matching against a trace:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>match f () with
| Ok .. -&gt; ..
| Error (Timeout :: _) -&gt; ..
| Error trace -&gt; ..
</pre></div>
</div>
<p>This is discouraged because the compiler is unable to warn you if the
matching is affected by a change in the code. E.g., if you add
context to an error in one place in the code, you may change the
result of the matching somewhere else in the code.</p>
</li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="error_monad_p3_advanced.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Part 3: Advanced topics</p>
      </div>
    </a>
    <a class="right-next"
       href="clic.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The <code class="docutils literal notranslate"><span class="pre">clic</span></code> library</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-what-even-is-a-monad">In depth discussion: what even is a monad?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-error-monad-src-lib-error-monad-tezos-base-tzpervasives-etc">In depth discussion: <code class="docutils literal notranslate"><span class="pre">Error_monad</span></code>, <code class="docutils literal notranslate"><span class="pre">src/lib_error_monad/</span></code>, <code class="docutils literal notranslate"><span class="pre">Tezos_base__TzPervasives</span></code>, etc.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-result-as-data-and-result-as-control-flow">In depth discussion: <code class="docutils literal notranslate"><span class="pre">result</span></code> as data and <code class="docutils literal notranslate"><span class="pre">result</span></code> as control-flow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-depth-discussion-pros-and-cons-of-result-compared-to-other-error-management-techniques">In depth discussion: pros and cons of <code class="docutils literal notranslate"><span class="pre">result</span></code> compared to other error management techniques</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#legacy-code">Legacy code</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nomadic Labs <contact@nomadic-labs.com>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2023, Nomadic Labs &lt;contact@nomadic-labs.com&gt;.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>