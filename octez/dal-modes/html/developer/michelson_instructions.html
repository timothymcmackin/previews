
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Adding a new instruction to Michelson language &#8212; Octez &amp; Protocol products documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=af8f7b00" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=d85e297f"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KT3Z3X4Y82"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developer/michelson_instructions';</script>
    <script src="../_static/js/custom.js?v=e7f469e6"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Protocol Release Checklist" href="protocol_release_checklist.html" />
    <link rel="prev" title="How to start reading protocol Alpha" href="entering_alpha.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Octez & Protocol products documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Octez & Protocol products documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/tezos.html">Octez &amp; Protocol overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/howtoget.html">Installing Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/get_troubleshooting.html">Installation troubleshooting</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtouse.html">Getting started with Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtorun.html">Running Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/versioning.html">Octez &amp; Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/breaking_changes.html">BREAKING CHANGES</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez User manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-client.html">Setting up the client</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/client-configuration.html">Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/key-management.html">Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sandbox.html">Sandboxed mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/mockup.html">Mockup mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy.html">Proxy mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/light.html">Light mode</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-node.html">Setting up the node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/node-configuration.html">Node Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/multinetwork.html">Connecting to a Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/history_modes.html">History modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/snapshots.html">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy-server.html">Proxy server</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user/node-monitoring.html">Monitoring an Octez Node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="openmetrics.html">Supported Open Metrics</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../user/multisig.html">Built-in multisig contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/fa12.html">FA1.2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/logging.html">Logging features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/exits.html">Exit codes and signals</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez Reference manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../shell/the_big_picture.html">Octez Software Architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/shell.html">The Octez Shell</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/validation.html">The validation subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/prevalidation.html">The Prevalidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/storage.html">The storage layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/sync.html">Synchronisation heuristic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/p2p.html">The peer-to-peer layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/protocol_environment.html">Protocol Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/micheline.html">Micheline</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/data_availability_committees.html">Data Availability Committees</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/dal.html">Data Availability Layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_overview.html">DAL overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_node.html">The DAL node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_bakers.html">Bakers &amp; the DAL</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/smart_rollup_node.html">Smart rollup node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/p2p_api.html">P2P message format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/rpc.html">Shell RPCs - Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Protocol Reference Manuals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../active/index.html">Paris Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../active/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../active/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_issuance.html">Adaptive Issuance and Staking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../active/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/rpc.html">Paris RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../beta/index.html">Beta Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../beta/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../beta/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../beta/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beta/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beta/rpc.html">Beta RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alpha/index.html">Alpha Dev Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../alpha/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../alpha/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/rpc.html">Alpha RPCs - Reference</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tezos developer Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="rpc.html">JSON/RPC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/openapi.html">RPCs - OpenAPI reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in Octez releases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../releases/releases.html">Release System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/version-20.html">Version 20.2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../releases/history.html">Older Versions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-19.html">Version 19.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-18.html">Version 18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-17.html">Version 17.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-16.html">Version 16.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-15.html">Version 15.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-14.html">Version 14.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-13.html">Version 13.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-12.html">Version 12.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-11.html">Version 11.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-10.html">Version 10.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-9.html">Version 9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-8.html">Version 8.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-7.html">Version 7.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/january-2020.html">Mainnet January 2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/december-2019.html">Mainnet December 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/october-2019.html">Mainnet-Staging October 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/september-2019.html">Mainnet September 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/may-2019.html">Mainnet May 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/april-2019.html">Mainnet April 2019</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in protocol versions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../protocols/naming.html">Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/019_paris.html">Protocol Paris</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/beta.html">Protocol Beta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/alpha.html">Protocol Alpha</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../protocols/history.html">Older Protocols</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../protocols/018_oxford.html">Protocol Oxford</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/017_nairobi.html">Protocol Nairobi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/016_mumbai.html">Protocol Mumbai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/015_lima.html">Protocol Lima</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/014_kathmandu.html">Protocol Kathmandu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/013_jakarta.html">Protocol Jakarta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/012_ithaca.html">Protocol Ithaca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/011_hangzhou.html">Protocol Hangzhou</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/010_granada.html">Protocol Granada</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/009_florence.html">Protocol Florence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/008_edo.html">Protocol Edo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/007_delphi.html">Protocol Delphi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/006_carthage.html">Protocol Carthage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/005_babylon.html">Protocol Babylon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/004_Pt24m4xi.html">Protocol Athens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/003_PsddFKi3.html">Protocol 003_PsddFKi3</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="contributing_index.html">How to contribute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="contributing.html">How to contribute to Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="contributing-adding-a-new-opam-dependency.html">How to add or update opam dependencies</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="merge_team.html">Octez Merge Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="guidelines.html">Documentation and coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="repository_scope.html">Scope of the Octez repository</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="programming.html">Programming tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="gadt.html">Generalized Algebraic Data Types (GADTs)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="error_monad.html">The Error Monad</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="error_monad_p1_result.html">Part 1: <code class="docutils literal notranslate"><span class="pre">result</span></code>, Lwt, and Lwt-<code class="docutils literal notranslate"><span class="pre">result</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="error_monad_p2_tzresult.html">Part 2: <code class="docutils literal notranslate"><span class="pre">tzresult</span></code> and Lwt-<code class="docutils literal notranslate"><span class="pre">tzresult</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="error_monad_p3_advanced.html">Part 3: Advanced topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="error_monad_p4_appendices.html">Part 4: Appendices</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="clic.html">The <code class="docutils literal notranslate"><span class="pre">clic</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_encoding.html">The <code class="docutils literal notranslate"><span class="pre">data_encoding</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_logging_framework.html">Using The Event Logging Framework</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="testing_index.html">Testing in Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Overview of Testing in Octez</a></li>
<li class="toctree-l2"><a class="reference internal" href="ppx_expect.html">Ppx_expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="tezt.html">Tezt: OCaml Tezos Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="long-tezts.html">Tezt: Long Tests and Performance Regression Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="alcotezt.html">Alcotezt: An Alcotest Compatibility Wrapper for Tezt</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit_testing_legacy_code.html">Making legacy code unit-testable</a></li>
<li class="toctree-l2"><a class="reference internal" href="proposal_testing.html">How to Test a Protocol Proposal</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="maintaining.html">Maintaining</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="entering_alpha.html">How to start reading protocol Alpha</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Adding a new instruction to Michelson language</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol_release_checklist.html">Protocol Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto-freeze-protocols.html">How to Freeze Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol_environment_upgrade.html">Adding a new protocol environment</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Documenting</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tools.html">Platform Development tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="profiling.html">Profiling the Octez node</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="snoop.html">Benchmarking with Snoop</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="snoop_arch.html">Architecture of <code class="docutils literal notranslate"><span class="pre">octez-snoop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="snoop_tutorial.html">Snoop usage tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="snoop_example.html">In-depth usage example: more control over your benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="tezos_micheline_rewriting.html">Rewriting Micheline with <code class="docutils literal notranslate"><span class="pre">tezos-micheline-rewriting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="snoop_interpreter.html">Snoop and the Michelson Interpreter</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="time_measurement_ppx.html">Time measurement PPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_environment.html">Python Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="pre_commit_hook.html">Pre-Commit Hook</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="encodings.html">Encodings</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="merkle-proof-encoding-formats.html">Merkle Proof Encoding Formats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v1-tree32.html">V1 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v1-tree2.html">V1 for Tree2</a></li>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v2-tree32.html">V2 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="merkle-proof-formats/v2-tree2.html">V2 for Tree2</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api-inline.html">OCaml APIs - Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-gitlab"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-gitlab"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos/-/issues/new?issue[title]=Issue%20on%20page%20%2Fdeveloper/michelson_instructions.html&issue[description]=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Adding a new instruction to Michelson language</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#michelson-primitives">Michelson primitives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#michelson-types">Michelson types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#internal-representation-ir">Internal representation (IR)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-translator">The translator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-interpreter">The interpreter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gas-model">The Gas model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="adding-a-new-instruction-to-michelson-language">
<h1>Adding a new instruction to Michelson language<a class="headerlink" href="#adding-a-new-instruction-to-michelson-language" title="Link to this heading">#</a></h1>
<p>From time to time a need arises to enrich Michelson language with an additional
instruction. It might be an intimidating task, especially to someone who is not
very familiar with the interpreter code. Thus, here is a quick tutorial
outlining the most important steps required to add a new Michelson instruction.
outlining the most important steps required to add a new Michelson instruction.</p>
<p>Adding a new instruction requires providing the following elements (detailed in the rest of this document):</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#add-mich-primitive"><span class="std std-ref">a primitive</span></a></p></li>
<li><p><a class="reference internal" href="#add-mich-ir"><span class="std std-ref">an internal representation</span></a> (or IR for short)</p></li>
<li><p><a class="reference internal" href="#script-translator"><span class="std std-ref">a translation rule</span></a></p></li>
<li><p><a class="reference internal" href="#add-mich-execution-rule"><span class="std std-ref">an execution rule</span></a></p></li>
<li><p><a class="reference internal" href="#add-mich-gas-model"><span class="std std-ref">a gas cost model</span></a></p></li>
<li><p><a class="reference internal" href="#add-mich-documentation"><span class="std std-ref">some documentation</span></a></p></li>
</ol>
<p>Once all of the above are provided, we may try compiling the protocol. We will
most likely encounter some non-exhaustive pattern matching errors, but after the
following steps are complete, these will usually be trivial to fix.</p>
<p>There are a lot of comments in the code base explaining further details about
the functions and data types described here. They are attached either to their
definitions in <code class="docutils literal notranslate"><span class="pre">.ml</span></code> files or in corresponding <code class="docutils literal notranslate"><span class="pre">.mli</span></code> files if definitions
are public.</p>
<p>For each function and data type mentioned on this page there is a pointer to the source
code file where it can be found.</p>
<section id="michelson-primitives">
<span id="add-mich-primitive"></span><h2>Michelson primitives<a class="headerlink" href="#michelson-primitives" title="Link to this heading">#</a></h2>
<p>The first thing we need to provide for creating a new instruction is a Michelson
primitive. A primitive is a textual representation of our instruction in the
Michelson code. Michelson primitives are organized into 5 namespaces:</p>
<ol class="arabic simple">
<li><p>keywords (lowercase words such as <code class="docutils literal notranslate"><span class="pre">parameter</span></code>, <code class="docutils literal notranslate"><span class="pre">storage</span></code>, <code class="docutils literal notranslate"><span class="pre">code</span></code>)</p></li>
<li><p>types (lowercase words)</p></li>
<li><p>constructors (capitalised words)</p></li>
<li><p>constants (lowercase word <code class="docutils literal notranslate"><span class="pre">constant</span></code> followed by a string)</p></li>
<li><p>instructions (all uppercase words)</p></li>
</ol>
<p>Of these only the last group is of interest to us here. <code class="docutils literal notranslate"><span class="pre">DUP</span></code>, <code class="docutils literal notranslate"><span class="pre">CONS</span></code> and
<code class="docutils literal notranslate"><span class="pre">ADD</span></code> are some examples of primitives representing instructions. By convention
constructor names for primitives representing instructions in the interpreter
implementation (as opposed to: in Michelson code) should start with capital
letter <code class="docutils literal notranslate"><span class="pre">I</span></code>, for instance <code class="docutils literal notranslate"><span class="pre">I_ADD</span></code> for <code class="docutils literal notranslate"><span class="pre">ADD</span></code> instruction.</p>
<p>Primitives should be added with great care, though, as in binary representation
they are currently encoded as single bytes, so there can be no more than 256 of
them. Exceeding that number will force us to reserve more bytes for some
primitives, which will incur some space and performance overheads for storing
and executing contracts. Therefore, whenever possible we should prefer reusing
existing primitives to adding new ones. Fortunately, we can take advantage of
the fact that Michelson has a strong type system, ensuring that a same
primitives can be used differently in several contexts. Thus, by allowing an
existing primitive in a new context we can effectively add instructions without
adding new primitives.</p>
<p>For instance suppose we have a <code class="docutils literal notranslate"><span class="pre">MAP</span></code> instruction and primitive, which expects
a list at the top of the stack, and which recursively applies some given code
block to elements of the list, thus creating a new list, which is then put back
at the top of the stack. Suppose we now want a similar instruction for options,
instead of lists of elements. So far <code class="docutils literal notranslate"><span class="pre">MAP</span></code> is only considered valid in a very
particular state of the stack. By adding a new translation rule (see
<a class="reference internal" href="#script-translator"><span class="std std-ref">Script translator</span></a>), we can allow the same primitive
to be used when there is an option instead of the list at the top of the stack,
thus effectively creating a new instruction. This may be seen as “overloading”
the primitive for different argument types.</p>
<p>When adding a new primitive, it should be mapped to the appropriate namespace in
<code class="docutils literal notranslate"><span class="pre">namespace</span></code> function (in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/michelson_v1_primitives.ml">src/proto_alpha/lib_protocol/michelson_v1_primitives.ml</a>). In case of an
instruction, the appropriate namespace is <code class="docutils literal notranslate"><span class="pre">Instr_namespace</span></code>. It is also necessary to map the primitive
constructor to the string representing it in Michelson code in
<code class="docutils literal notranslate"><span class="pre">prim_of_string</span></code> and <code class="docutils literal notranslate"><span class="pre">string_of_prim</span></code> in the same module.</p>
<p>See <a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/michelson_v1_primitives.ml">src/proto_alpha/lib_protocol/michelson_v1_primitives.ml</a> for a
complete list of primitives known to Michelson and their respective textual
representations.</p>
<p>See also <a class="reference internal" href="../shell/micheline.html"><span class="doc">Micheline</span></a> to learn more about the concrete syntax of
Michelson language.</p>
</section>
<section id="michelson-types">
<h2>Michelson types<a class="headerlink" href="#michelson-types" title="Link to this heading">#</a></h2>
<p>Before we talk about internal representations, we need to have a brief look at
how the interpreter handles types of Michelson expressions internally. Types
<code class="docutils literal notranslate"><span class="pre">ty</span></code> and <code class="docutils literal notranslate"><span class="pre">stack_ty</span></code> are both defined in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_typed_ir.ml">src/proto_alpha/lib_protocol/script_typed_ir.ml</a>. Type <code class="docutils literal notranslate"><span class="pre">ty</span></code> enumerates
all types known to the Michelson interpreter and is parametrised by the
underlying OCaml type in which Michelson values are actually stored in memory.
Thus, when values of the ty type are pattern-matched on, their type parameters
help convince the OCaml compiler that the underlying Michelson expressions or
instructions are compatible (i.e. may be unified), and so that the execution
model for Michelson is type-safe.</p>
<p><code class="docutils literal notranslate"><span class="pre">stack_ty</span></code> is a collection of <code class="docutils literal notranslate"><span class="pre">ty</span></code> values occurring in a particular order,
which represents the type of the whole stack. The outermost value corresponds to
the top of the stack, while the innermost one is always <code class="docutils literal notranslate"><span class="pre">Bot_t</span></code>, which
corresponds to the bottom of the stack. Note that <code class="docutils literal notranslate"><span class="pre">stack_ty</span></code> is parametrised
by two type parameters. The first one is the OCaml counterpart of the type of
the value at the top of the stack; the other combines the OCaml counterparts of
types of the remainder of the stack in the form of a <em>cons list</em>, i.e. a pair,
whose first element is a type and the other – another pair containing the
remainder of the list.</p>
<p>This is a recurring pattern within the interpreter: type parameters
corresponding to types of Michelson stacks usually come in pairs. As we will
shortly see, the first parameter in these pairs always corresponds to the type
of element at the top of the stack; the other – to the remainder of the stack.</p>
</section>
<section id="internal-representation-ir">
<span id="add-mich-ir"></span><h2>Internal representation (IR)<a class="headerlink" href="#internal-representation-ir" title="Link to this heading">#</a></h2>
<p>A primitive is what represents our instruction in the Michelson script. Now we
need an IR, which is a piece of data containing all the information necessary to
actually execute the instruction. It should belong to the type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type (&#39;before_top, &#39;before, &#39;result_top, &#39;result) kinstr = (* ... *)
</pre></div>
</div>
<p>which is defined in <code class="docutils literal notranslate"><span class="pre">lib_protocol/script_typed_ir.ml</span></code>. As the module’s name
suggests, this representation is already guaranteed to be well-typed. The type
<code class="docutils literal notranslate"><span class="pre">kinstr</span></code> is the type of well-typed instruction sequences. Adding a new
instruction consists in defining a new constructor of the <code class="docutils literal notranslate"><span class="pre">kinstr</span></code> type
representing sequences starting with the new instruction, providing a rule which
constructs them from the primitive corresponding to the new instruction and a
rule which interprets them when the script in executed.</p>
<p>Instructions are parametrised by 4 type parameters:</p>
<ol class="arabic simple">
<li><p>The type of the top element of the stack prior to execution</p></li>
<li><p>The type of the remainder of the stack prior to execution</p></li>
<li><p>The type of the top element of the stack following execution</p></li>
<li><p>The type of the remainder of the stack following execution</p></li>
</ol>
<p>For instance <code class="docutils literal notranslate"><span class="pre">ICar</span></code> instruction is defined as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>| ICar :
    (&#39;a * &#39;b, &#39;s) kinfo * (&#39;a, &#39;s, &#39;r, &#39;f) kinstr
    -&gt; (&#39;a * &#39;b, &#39;s, &#39;r, &#39;f) kinstr
</pre></div>
</div>
<p>The reason why the third parameter of the resulting <code class="docutils literal notranslate"><span class="pre">kinstr</span></code> is <code class="docutils literal notranslate"><span class="pre">'r</span></code> and not
simply <code class="docutils literal notranslate"><span class="pre">'a</span></code> (which is the type of the first element of the pair at the top of the
initial stack) is because this constructor also contains the next instruction,
which produces a value of some arbitrary type <code class="docutils literal notranslate"><span class="pre">'r</span></code>. However, note
that this next instruction should expect <code class="docutils literal notranslate"><span class="pre">'a</span></code> at the top of its initial stack.</p>
<p>New instructions are added by extending the <code class="docutils literal notranslate"><span class="pre">kinstr</span></code> type with additional
variants. The variant should contain all the information necessary to execute
the instruction and its type parameters must ensure that the shape of the stack
prior to execution will provide arguments for the instruction and that the stack
following the execution will contain its result.</p>
<p>Each IR should also contain an instance of type <code class="docutils literal notranslate"><span class="pre">kinfo</span></code>, which holds the
information about the type of the stack prior to the instruction’s execution.
This information is mostly used for error reporting and logging. Another thing
each instruction’s IR should contain is a continuation, i.e., another instruction
that is going to be executed next. This way the whole script can be represented
as a single instruction constructed by sequencing many instructions together.
See the next section to learn how such a sequence is constructed in the process
of translation.</p>
<p>Instructions taking all their arguments from the stack will require nothing more
than the above data, as the constructor itself will inform the interpreter, what
to do. In more complex cases, especially when some control transfer is involved,
some additional information may be needed. For example a <code class="docutils literal notranslate"><span class="pre">MAP</span></code> instruction
(regardless of the type it operates on) requires some more instructions (a
sub-program) to be executed to map one value into another. A <code class="docutils literal notranslate"><span class="pre">PUSH</span></code>
instruction needs to know the type and the value it should push on the stack,
and so on.</p>
</section>
<section id="the-translator">
<span id="script-translator"></span><h2>The translator<a class="headerlink" href="#the-translator" title="Link to this heading">#</a></h2>
<p>Now that we have chosen a primitive to represent our instruction in the code and
an internal representation (IR), we need to provide a rule that translates the
former into the latter. <code class="docutils literal notranslate"><span class="pre">parse_instr</span></code> function in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_ir_translator.ml">src/proto_alpha/lib_protocol/script_ir_translator.ml</a> is responsible for
this. Notice that the function <code class="docutils literal notranslate"><span class="pre">parse_instr</span></code>, despite what its name suggests,
matches on pre-parsed Micheline AST. Micheline parser is not a part of the
protocol and therefore must be run by the client before the script is submitted
to the node in binary-encoded form.</p>
<p>The translator iterates over the AST instruction after instruction, maintaining
the type of the stack after each operation. This way it can also type check the
script in a single run. Additionally this makes information about the “current”
type of the stack available when parsing each consecutive instruction. Notice
that this function not only matches on Michelson primitives themselves, but also
on the type of the stack implied by translating previous instructions. This is
what lets us distinguish between different contexts in which the same primitive
may have different meaning. For instance the <code class="docutils literal notranslate"><span class="pre">MAP</span></code> instruction that we
mentioned before may perform mapping either on lists or on options, depending on
what the current type of the stack might be. Of course, the internal
representation will be different in each case. If the primitive and the current
stack type does not match any possibility, it’s a typing error and the whole
script is considered ill-typed.</p>
<p>Because the IR is well-typed by construction, it is necessary for
<code class="docutils literal notranslate"><span class="pre">parse_instr</span></code> translates the script and also type check it at the same time.
Motivations for this are twofold. For one thing type checking gives us strong
static guarantees about the behaviour of the interpreter. In particular it’s
guaranteed to only produce well-typed Michelson values, which means each
instruction receives input that it expects. Secondly, the interpreter does not
have to check for types of data it finds on the stack (they’re guaranteed to be
correct), which makes for faster execution. For this reason it is essential that
each IR contains a value of type <code class="docutils literal notranslate"><span class="pre">kinfo</span></code> (or an equivalent thereof), from
which the translator can obtain the type the stack should have after this
instruction is executed. Function <code class="docutils literal notranslate"><span class="pre">kinfo_of_kinstr</span></code> in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_typed_ir.ml">src/proto_alpha/lib_protocol/script_typed_ir.ml</a> is responsible for this
extraction.</p>
<p>An interesting situation occurs with instructions regulating control flow. These
usually receive one or more pieces of code (sub-programs) to execute depending
on some runtime conditions. <code class="docutils literal notranslate"><span class="pre">MAP</span></code>, <code class="docutils literal notranslate"><span class="pre">IF_LEFT</span></code>, <code class="docutils literal notranslate"><span class="pre">IF_NONE</span></code> are all examples
of such instructions. These sub-programs must also be well-typed. Moreover, if
there’s more than one like in case of <code class="docutils literal notranslate"><span class="pre">IF_LEFT</span></code> or <code class="docutils literal notranslate"><span class="pre">IF_NONE</span></code> instructions, a
certain relationship between types of these sub-programs must hold. In
particular, they must ensure, that the entire instruction will always render a
resulting stack of the same type.</p>
<p>To ensure this, these sub-programs must be type-checked (and translated)
recursively. The aforementioned relationships between sub-programs’ types should
be guaranteed by the constructor of the <code class="docutils literal notranslate"><span class="pre">kinstr</span></code> variant. However, in case of
multiple execution branches (sub-programs) their types must be unified before
proceeding. This is what <code class="docutils literal notranslate"><span class="pre">merge_stacks</span></code> function is for. It accepts two stack
types and verifies if they’re equal. If so, the unified stack type is returned,
otherwise it results in a type error.</p>
<p>The precise return type of <code class="docutils literal notranslate"><span class="pre">parse_instr</span></code> is <code class="docutils literal notranslate"><span class="pre">judgement</span></code> defined in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_ir_translator.ml">src/proto_alpha/lib_protocol/script_ir_translator.ml</a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type (&#39;a, &#39;s, &#39;b, &#39;u) cinstr = {
  apply :
    &#39;r &#39;f. (&#39;a, &#39;s) kinfo -&gt; (&#39;b, &#39;u, &#39;r, &#39;f) kinstr -&gt; (&#39;a, &#39;s, &#39;r, &#39;f) kinstr;
}

type (&#39;a, &#39;s, &#39;b, &#39;u) descr = {
  loc : Script.location;
  bef : (&#39;a, &#39;s) stack_ty;
  aft : (&#39;b, &#39;u) stack_ty;
  instr : (&#39;a, &#39;s, &#39;b, &#39;u) cinstr;
}

(* ... *)

type (&#39;a, &#39;s) judgement =
  | Typed : (&#39;a, &#39;s, &#39;b, &#39;u) descr -&gt; (&#39;a, &#39;s) judgement
  | Failed : {
    descr : &#39;b &#39;u. (&#39;b, &#39;u) stack_ty -&gt; (&#39;a, &#39;s, &#39;b, &#39;u) descr;
  }
    -&gt; (&#39;a, &#39;s) judgement
</pre></div>
</div>
<p>This is quite a bit involved, so we’ll explain these types and their role one at
a time. <code class="docutils literal notranslate"><span class="pre">cinstr</span></code> is an intermediate representation of an instruction whose
continuation is not yet known. As we can see, it’s a function actually, which
given another instruction (the <code class="docutils literal notranslate"><span class="pre">kinstr</span></code> argument), sequences it after the
current one, which is held in the function’s closure. A precise stack
description (a <code class="docutils literal notranslate"><span class="pre">kinfo</span></code>) is also required, but note the initial type of the
stack is already predetermined by the type of <code class="docutils literal notranslate"><span class="pre">cinstr</span></code>. The resulting type of
the instruction passed into the function, on the other hand, can be anything, as
witnessed by the <strong>forall</strong> annotation <code class="docutils literal notranslate"><span class="pre">'r</span> <span class="pre">'f.</span></code>. The construction of
<code class="docutils literal notranslate"><span class="pre">cinstr</span></code> is such that we can already create it without knowing what the next
instruction will be (as opposed to a <code class="docutils literal notranslate"><span class="pre">kinstr</span></code>, which should already contain
instruction’s continuation).</p>
<p>A <code class="docutils literal notranslate"><span class="pre">descr</span></code> is a complete description of an instruction. It combines a
<code class="docutils literal notranslate"><span class="pre">cinstr</span></code> with precise descriptions of the stack type before and after the
operation. These stack types are typically assembled by inspecting the initial
stack type passed to <code class="docutils literal notranslate"><span class="pre">parse_instr</span></code> (which we pattern match on in the said
function). Location is typically copied from the Micheline pattern as is and it
only serves the error-reporting purposes in case type-checking failed at a later
step.</p>
<p>Finally a successful typing judgement contains a full description of an
instruction, but is only parametrised by its input type. The return type is
existential and can only be retrieved by inspecting the <code class="docutils literal notranslate"><span class="pre">aft</span></code> field of the
contained description. This is vital, because when calling the type-checking
procedure, we don’t yet know the return type of the program. In fact the whole
point of it is (in a sense) to learn that type. Typically when adding typing
rules for new instructions, we only need to be concerned with the successful
result (<code class="docutils literal notranslate"><span class="pre">Typed</span></code> constructor). <code class="docutils literal notranslate"><span class="pre">Failed</span></code> is returned when the instruction does
not produce an output stack. This is true for instance of <code class="docutils literal notranslate"><span class="pre">FAILWITH</span></code>
instruction, which immediately terminates the execution. Hence, it cannot be
given any sound type and therefore must be treated specially.</p>
<p>As already mentioned above, some instructions also receive pieces of code
(sub-programs) as their arguments. As these sub-programs must themselves be
well-typed, typically we will recursively call <code class="docutils literal notranslate"><span class="pre">non_terminal_recursion</span></code>
function on them. If it succeeds in type-checking the sub-program, we use its
description to convert it into the type of the whole instruction (which will
usually be slightly different than the type of the sub-program). If it fails,
however, the error will be transparently propagated up the call stack.</p>
<p><code class="docutils literal notranslate"><span class="pre">Failed</span></code> judgements are treated differently by different instructions. Some,
like <code class="docutils literal notranslate"><span class="pre">MAP</span></code> convert them to typing errors, other unify them with any type the
other program branch might have, effectively treating them as if they had type
<code class="docutils literal notranslate"><span class="pre">forall</span> <span class="pre">'a.</span> <span class="pre">'a</span></code>. In fact, this is precisely the type that Michelson
specification assigns to the <code class="docutils literal notranslate"><span class="pre">FAILWITH</span></code> instruction.</p>
</section>
<section id="the-interpreter">
<span id="add-mich-execution-rule"></span><h2>The interpreter<a class="headerlink" href="#the-interpreter" title="Link to this heading">#</a></h2>
<p>The interpreter is the heart of the Michelson implementation. This specific implementation
follows the small-step approach: at each execution step, the interpreter rewrites a machine
configuration made of a value stack and a continuation stack. Therefore, the interpreter takes a
script’s IR, a storage and an input to the script as arguments, generates the
initial stack containing the storage content and the input, and then executes
the script, returning the final content of the stack. It’s defined in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_interpreter.ml">src/proto_alpha/lib_protocol/script_interpreter.ml</a> by the <code class="docutils literal notranslate"><span class="pre">execute</span></code>
function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">execute</span></code> function does some preliminary preparations and then passes control to
the <code class="docutils literal notranslate"><span class="pre">step</span></code> function, which encodes the interpretation loop and where execution
rules for all instructions are given. The <code class="docutils literal notranslate"><span class="pre">step</span></code> function accepts:</p>
<ol class="arabic simple">
<li><p>Context and step constants (see below)</p></li>
<li><p>Remaining gas</p></li>
<li><p>Instruction</p></li>
<li><p>Continuation</p></li>
<li><p>The top value on the stack (called <em>accu</em>)</p></li>
<li><p>The remainder of the stack</p></li>
</ol>
<p>Typically this function computes the new value of the stack and then calls
itself recursively with a new instruction (already available in the <code class="docutils literal notranslate"><span class="pre">kinstr</span></code>
value). In some cases, however, some additional action may be required either
before or after the instruction is processed. These additional actions are
usually related to the control flow.</p>
<p>For instance, in the case of our <code class="docutils literal notranslate"><span class="pre">MAP</span></code> instruction for options, if it finds
<code class="docutils literal notranslate"><span class="pre">None</span></code> at the top of the stack, will leave it without a change and simply
proceed to the next instruction. If, however, it finds <code class="docutils literal notranslate"><span class="pre">Some</span> <span class="pre">x</span></code>, it should
pass control over to the sub-program given as parameter. This sub-program does
not expect an option, though, it expects our <code class="docutils literal notranslate"><span class="pre">x</span></code> unwrapped. Similarly it does
not return an option, but an arbitrary result which should be wrapped in a
<code class="docutils literal notranslate"><span class="pre">Some</span></code> constructor after control returns to the main program. Without this
additional action, the types of stacks produced by the two branches would differ
and the program would be ill-typed. To remedy this and similar problems, the
interpreter also defines the <code class="docutils literal notranslate"><span class="pre">continuation</span></code> type (defined in
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_typed_ir.ml">src/proto_alpha/lib_protocol/script_typed_ir.ml</a>). Whenever the control is
passed over to a sub-program, the <code class="docutils literal notranslate"><span class="pre">next</span></code> function can be called to manage the
flow of control around the sub-program (for instance executing it multiple times
in case of a loop). Also, each Michelson program ends with a special instruction
<code class="docutils literal notranslate"><span class="pre">IHalt</span></code>, which calls the same <code class="docutils literal notranslate"><span class="pre">next</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">next</span></code> function occupies itself with continuations stack (argument no. 4
on the list above). Typically before transferring control to a sub-program, an
appropriate continuation is pushed on the continuation stack to manage its
outcome and resume execution of the main program. Only if there’s no
continuation to perform, the program is actually terminated. In the <code class="docutils literal notranslate"><span class="pre">MAP</span></code>
instruction example it would be wrapping the value at the top of the stack in
the <code class="docutils literal notranslate"><span class="pre">Some</span></code> constructor to match the type of the other branch. We simply put an
appropriate continuation in the continuation stack before executing the
sub-program with the rest of the main program appended as continuation.</p>
<p>Sometimes adding an instruction may involve adding a new continuation as well.
However, continuations are completely internal to the interpreter. They neither
have a representation in the Michelson code nor are they ever involved in
translation. A continuation is a value of type <code class="docutils literal notranslate"><span class="pre">('a,</span> <span class="pre">'b,</span> <span class="pre">'c,</span> <span class="pre">'d)</span> <span class="pre">continuation</span></code>
defined in <a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_typed_ir.ml">src/proto_alpha/lib_protocol/script_typed_ir.ml</a>. Similarly to
an instruction, a new constructor of this type should contain all the
information required to execute the continuation. For instance <code class="docutils literal notranslate"><span class="pre">KCons</span></code>
continuation contains an instruction and a continuation which should be executed
after it. The special <code class="docutils literal notranslate"><span class="pre">KNil</span></code> continuation marks the end of execution. After
the continuation is defined, it can be used freely in the interpreter.</p>
<p>The step constants passed to the function along with the context contain some
important information about the transaction itself, like the sender and the
target, the amount transferred and so on. See <code class="docutils literal notranslate"><span class="pre">step_constants</span></code> type definition
in <a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_alpha/lib_protocol/script_interpreter.ml">src/proto_alpha/lib_protocol/script_interpreter.ml</a> for more details.</p>
</section>
<section id="the-gas-model">
<span id="add-mich-gas-model"></span><h2>The Gas model<a class="headerlink" href="#the-gas-model" title="Link to this heading">#</a></h2>
<p>Each Michelson instruction also has a corresponding <em>gas model</em>, which estimates
how much gas should be consumed by the interpreter when executing the
instruction. The main goal of this is to prevent scripts from falling into
infinite loops and to protect bakers from abuse of their computing power. Of
course, it’s impossible to make sure statically that a Michelson program always
terminates, but its computing time can be checked dynamically and that’s the
main purpose of gas.</p>
<p>The gas model is a function approximating the time and computational resources
consumed by executing an instruction depending on the size of its argument.
Typically the role of the programmer adding an instruction is to define the
function for the instruction, but leaving any constant values in it abstract.
Additionally, a benchmark needs to be defined in order to find the appropriate
values for these constants. At a later point benchmarks are run on a dedicated
machine and constant values are filled in based on the results. It is essential
that these benchmarks are always run on the same hardware so that they return
comparable results.</p>
<p>More information on the gas model and on benchmarking the interpreter can be
found on the pages dedicated to the <code class="docutils literal notranslate"><span class="pre">snoop</span></code> library: <a class="reference internal" href="snoop_interpreter.html"><span class="doc">Snoop and the Michelson Interpreter</span></a>.</p>
</section>
<section id="documentation">
<span id="add-mich-documentation"></span><h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">#</a></h2>
<p>Last but not least, the new instruction needs to be documented.
After all, nobody will ever use it otherwise!</p>
<p>Documenting the instruction may involve:</p>
<ul class="simple">
<li><p>Editing the <a class="reference internal" href="../alpha/michelson.html"><span class="doc">Michelson language page</span></a> (only the page corresponding to the Alpha protocol needs be changed, because injected protocols cannot be extended with new instructions). The source for this page is <a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/docs/alpha/michelson.rst">docs/alpha/michelson.rst</a>.</p></li>
<li><p>Updating the <a class="reference external" href="https://tezos.gitlab.io/michelson-reference/">Michelson reference website</a>, by modifying the associated <a class="reference external" href="https://gitlab.com/tezos/michelson-reference">repository</a>.</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="entering_alpha.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How to start reading protocol Alpha</p>
      </div>
    </a>
    <a class="right-next"
       href="protocol_release_checklist.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Protocol Release Checklist</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#michelson-primitives">Michelson primitives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#michelson-types">Michelson types</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#internal-representation-ir">Internal representation (IR)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-translator">The translator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-interpreter">The interpreter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gas-model">The Gas model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nomadic Labs <contact@nomadic-labs.com>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2023, Nomadic Labs &lt;contact@nomadic-labs.com&gt;.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>