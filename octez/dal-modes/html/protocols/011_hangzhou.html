
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Protocol Hangzhou &#8212; Octez &amp; Protocol products documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=af8f7b00" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=d85e297f"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KT3Z3X4Y82"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'protocols/011_hangzhou';</script>
    <script src="../_static/js/custom.js?v=e7f469e6"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Protocol Granada" href="010_granada.html" />
    <link rel="prev" title="Protocol Ithaca" href="012_ithaca.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Octez & Protocol products documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Octez & Protocol products documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/tezos.html">Octez &amp; Protocol overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/howtoget.html">Installing Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/get_troubleshooting.html">Installation troubleshooting</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtouse.html">Getting started with Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtorun.html">Running Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/versioning.html">Octez &amp; Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/breaking_changes.html">BREAKING CHANGES</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez User manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-client.html">Setting up the client</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/client-configuration.html">Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/key-management.html">Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sandbox.html">Sandboxed mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/mockup.html">Mockup mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy.html">Proxy mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/light.html">Light mode</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-node.html">Setting up the node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/node-configuration.html">Node Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/multinetwork.html">Connecting to a Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/history_modes.html">History modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/snapshots.html">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy-server.html">Proxy server</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user/node-monitoring.html">Monitoring an Octez Node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/openmetrics.html">Supported Open Metrics</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../user/multisig.html">Built-in multisig contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/fa12.html">FA1.2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/logging.html">Logging features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/exits.html">Exit codes and signals</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez Reference manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../shell/the_big_picture.html">Octez Software Architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/shell.html">The Octez Shell</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/validation.html">The validation subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/prevalidation.html">The Prevalidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/storage.html">The storage layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/sync.html">Synchronisation heuristic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/p2p.html">The peer-to-peer layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/protocol_environment.html">Protocol Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/micheline.html">Micheline</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/data_availability_committees.html">Data Availability Committees</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/dal.html">Data Availability Layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_overview.html">DAL overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_node.html">The DAL node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_bakers.html">Bakers &amp; the DAL</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/smart_rollup_node.html">Smart rollup node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/p2p_api.html">P2P message format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/rpc.html">Shell RPCs - Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Protocol Reference Manuals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../active/index.html">Paris Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../active/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../active/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_issuance.html">Adaptive Issuance and Staking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../active/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../active/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../active/rpc.html">Paris RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../beta/index.html">Beta Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../beta/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../beta/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../beta/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../beta/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beta/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beta/rpc.html">Beta RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alpha/index.html">Alpha Dev Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../alpha/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../alpha/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/rpc.html">Alpha RPCs - Reference</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tezos developer Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developer/rpc.html">JSON/RPC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/openapi.html">RPCs - OpenAPI reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in Octez releases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../releases/releases.html">Release System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/version-20.html">Version 20.2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../releases/history.html">Older Versions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-19.html">Version 19.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-18.html">Version 18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-17.html">Version 17.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-16.html">Version 16.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-15.html">Version 15.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-14.html">Version 14.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-13.html">Version 13.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-12.html">Version 12.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-11.html">Version 11.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-10.html">Version 10.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-9.html">Version 9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-8.html">Version 8.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-7.html">Version 7.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/january-2020.html">Mainnet January 2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/december-2019.html">Mainnet December 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/october-2019.html">Mainnet-Staging October 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/september-2019.html">Mainnet September 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/may-2019.html">Mainnet May 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/april-2019.html">Mainnet April 2019</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in protocol versions</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="naming.html">Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="019_paris.html">Protocol Paris</a></li>
<li class="toctree-l1"><a class="reference internal" href="beta.html">Protocol Beta</a></li>
<li class="toctree-l1"><a class="reference internal" href="alpha.html">Protocol Alpha</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="history.html">Older Protocols</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="018_oxford.html">Protocol Oxford</a></li>
<li class="toctree-l2"><a class="reference internal" href="017_nairobi.html">Protocol Nairobi</a></li>
<li class="toctree-l2"><a class="reference internal" href="016_mumbai.html">Protocol Mumbai</a></li>
<li class="toctree-l2"><a class="reference internal" href="015_lima.html">Protocol Lima</a></li>
<li class="toctree-l2"><a class="reference internal" href="014_kathmandu.html">Protocol Kathmandu</a></li>
<li class="toctree-l2"><a class="reference internal" href="013_jakarta.html">Protocol Jakarta</a></li>
<li class="toctree-l2"><a class="reference internal" href="012_ithaca.html">Protocol Ithaca</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Protocol Hangzhou</a></li>
<li class="toctree-l2"><a class="reference internal" href="010_granada.html">Protocol Granada</a></li>
<li class="toctree-l2"><a class="reference internal" href="009_florence.html">Protocol Florence</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_edo.html">Protocol Edo</a></li>
<li class="toctree-l2"><a class="reference internal" href="007_delphi.html">Protocol Delphi</a></li>
<li class="toctree-l2"><a class="reference internal" href="006_carthage.html">Protocol Carthage</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_babylon.html">Protocol Babylon</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_Pt24m4xi.html">Protocol Athens</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_PsddFKi3.html">Protocol 003_PsddFKi3</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/contributing_index.html">How to contribute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/contributing.html">How to contribute to Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/contributing-adding-a-new-opam-dependency.html">How to add or update opam dependencies</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merge_team.html">Octez Merge Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/guidelines.html">Documentation and coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/repository_scope.html">Scope of the Octez repository</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/programming.html">Programming tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/gadt.html">Generalized Algebraic Data Types (GADTs)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/error_monad.html">The Error Monad</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p1_result.html">Part 1: <code class="docutils literal notranslate"><span class="pre">result</span></code>, Lwt, and Lwt-<code class="docutils literal notranslate"><span class="pre">result</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p2_tzresult.html">Part 2: <code class="docutils literal notranslate"><span class="pre">tzresult</span></code> and Lwt-<code class="docutils literal notranslate"><span class="pre">tzresult</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p3_advanced.html">Part 3: Advanced topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p4_appendices.html">Part 4: Appendices</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/clic.html">The <code class="docutils literal notranslate"><span class="pre">clic</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/data_encoding.html">The <code class="docutils literal notranslate"><span class="pre">data_encoding</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/event_logging_framework.html">Using The Event Logging Framework</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/testing_index.html">Testing in Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/testing.html">Overview of Testing in Octez</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/ppx_expect.html">Ppx_expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/tezt.html">Tezt: OCaml Tezos Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/long-tezts.html">Tezt: Long Tests and Performance Regression Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/alcotezt.html">Alcotezt: An Alcotest Compatibility Wrapper for Tezt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/unit_testing_legacy_code.html">Making legacy code unit-testable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/proposal_testing.html">How to Test a Protocol Proposal</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/maintaining.html">Maintaining</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/entering_alpha.html">How to start reading protocol Alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/michelson_instructions.html">Adding a new instruction to Michelson language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/protocol_release_checklist.html">Protocol Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/howto-freeze-protocols.html">How to Freeze Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/protocol_environment_upgrade.html">Adding a new protocol environment</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Documenting</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/tools.html">Platform Development tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/profiling.html">Profiling the Octez node</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/snoop.html">Benchmarking with Snoop</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_arch.html">Architecture of <code class="docutils literal notranslate"><span class="pre">octez-snoop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_tutorial.html">Snoop usage tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_example.html">In-depth usage example: more control over your benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/tezos_micheline_rewriting.html">Rewriting Micheline with <code class="docutils literal notranslate"><span class="pre">tezos-micheline-rewriting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_interpreter.html">Snoop and the Michelson Interpreter</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/time_measurement_ppx.html">Time measurement PPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/python_environment.html">Python Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/pre_commit_hook.html">Pre-Commit Hook</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/encodings.html">Encodings</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/merkle-proof-encoding-formats.html">Merkle Proof Encoding Formats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v1-tree32.html">V1 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v1-tree2.html">V1 for Tree2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v2-tree32.html">V2 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v2-tree2.html">V2 for Tree2</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api-inline.html">OCaml APIs - Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-gitlab"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-gitlab"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos/-/issues/new?issue[title]=Issue%20on%20page%20%2Fprotocols/011_hangzhou.html&issue[description]=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Protocol Hangzhou</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-environment-version-v3">New Environment Version (V3)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#receipts-balance-updates">Receipts, Balance Updates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rpc-changes">RPC Changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timelock">Timelock</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#michelson-on-chain-views">Michelson On-Chain Views</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-constants">Global Constants</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cache">Cache</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context-storage-flattening">Context Storage Flattening</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-fixes">Bug Fixes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minor-changes">Minor Changes</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="protocol-hangzhou">
<h1>Protocol Hangzhou<a class="headerlink" href="#protocol-hangzhou" title="Link to this heading">#</a></h1>
<p><strong>Important: revision 011_PtHangzH of protocol Hangzhou contains a bug that
is corrected in the latest version 011_PtHangz2</strong></p>
<p>This page contains all the relevant information for protocol Hangzhou
(see <a class="reference internal" href="naming.html#naming-convention"><span class="std std-ref">Protocol naming</span></a>).</p>
<p>The code can be found in the <a class="reference external" href="https://gitlab.com/tezos/tezos/-/tree/master/src/proto_011_PtHangz2">src/proto_011_PtHangz2</a> directory of the
<code class="docutils literal notranslate"><span class="pre">master</span></code> branch of Tezos.</p>
<p>This page documents the changes brought by protocol Hangzhou with respect
to Granada.</p>
<section id="new-environment-version-v3">
<h2>New Environment Version (V3)<a class="headerlink" href="#new-environment-version-v3" title="Link to this heading">#</a></h2>
<p>This protocol requires a different protocol environment than Granada.
It requires protocol environment V3, compared to V2 for Granada.
(MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3040">!3040</a>)</p>
<ul class="simple">
<li><p>Removed legacy logging interface. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2876">!2876</a>)</p></li>
<li><p>Removed data-encoding backwards compatibility layer. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2686">!2686</a>)</p></li>
<li><p>Reintroduced <code class="docutils literal notranslate"><span class="pre">tag_size</span></code>. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2948">!2948</a>)</p></li>
<li><p>Exposed <code class="docutils literal notranslate"><span class="pre">Lwtreslib.List</span></code>. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3116">!3116</a>)</p></li>
<li><p>Environment now uses <code class="docutils literal notranslate"><span class="pre">Map</span></code> and <code class="docutils literal notranslate"><span class="pre">Set</span></code> from <code class="docutils literal notranslate"><span class="pre">Lwtreslib</span></code>. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3124">!3124</a>)</p></li>
<li><p>Updated to data-encoding version 0.4. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3149">!3149</a>)</p></li>
<li><p>Documented and renamed operation ordering in <code class="docutils literal notranslate"><span class="pre">Updater</span></code>. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3179">!3179</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Lwtreslib</span></code>: now provides exception-catching functions. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2886">!2886</a>)</p></li>
<li><p>Added context hash version. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3163">!3163</a>)</p></li>
<li><p>Removed the <code class="docutils literal notranslate"><span class="pre">fork_test_chain</span></code> function. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3213">!3213</a>)</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">Result</span></code> and catching helpers. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3154">!3154</a>)</p></li>
<li><p>Added support for chunking in RPCs. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3189">!3189</a>)</p></li>
<li><p>Source of the Alpha protocol can mostly be compiled into Coq with <code class="docutils literal notranslate"><span class="pre">coq-of-ocaml</span></code>. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3152">!3152</a>)</p></li>
<li><p>Encapsulated script caching. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3352">!3352</a>)</p></li>
<li><p>Updated Zarith to version 1.12. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2970">!2970</a>)</p></li>
</ul>
</section>
<section id="receipts-balance-updates">
<h2>Receipts, Balance Updates<a class="headerlink" href="#receipts-balance-updates" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Breaking change:</strong> Rewards balance updates for nonce revelations
or endorsements now mention the cycle at which the rewards were
granted instead of the cycle of the level carried by the operation.
Likewise for deposits balance updates related to endorsement
operations, they now mention the cycle at which the funds have been
deposited. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3270">!3270</a>)</p></li>
</ul>
</section>
<section id="rpc-changes">
<h2>RPC Changes<a class="headerlink" href="#rpc-changes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Deprecated RPC <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">../endorsing_power</span></code> has been removed. Clients
already used <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">../helpers/endorsing_rights</span></code> which is clearer, as
powerful and equally costly in terms of computation for the
node. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3395">!3395</a>)</p></li>
<li><p>The RPCs <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">../context/delegates/[PUBLIC_KEY_HASH]/..</span></code> now fail
gracefully with a specific error <code class="docutils literal notranslate"><span class="pre">delegate.not_registered</span></code> when
<code class="docutils literal notranslate"><span class="pre">PUBLIC_KEY_HASH</span></code> is not a delegate instead of the generic
<code class="docutils literal notranslate"><span class="pre">context.storage_error</span></code>. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3258">!3258</a>, issues <a class="reference external" href="https://gitlab.com/tezos/tezos/-/issues/450">#450</a>,
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/issues/451">#451</a>, and <a class="reference external" href="https://gitlab.com/tezos/tezos/-/issues/1276">#1276</a>)</p></li>
<li><p>RPC <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">../context/constants</span></code> exposes the “fixed” constants
<code class="docutils literal notranslate"><span class="pre">cache_layout</span></code> and <code class="docutils literal notranslate"><span class="pre">michelson_maximum_type_size</span></code> (MR
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3454">!3454</a>)</p></li>
</ul>
</section>
<section id="timelock">
<h2>Timelock<a class="headerlink" href="#timelock" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Added timelock-related types and opcodes to Michelson.
They allow a smart contract to include a countermeasure against
Block Producer Extractable Value.
More info in <a class="reference internal" href="../alpha/timelock.html"><span class="doc">Timelock</span></a>.
(MRs <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3160">!3160</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2940">!2940</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2950">!2950</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3304">!3304</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3384">!3384</a>)</p></li>
</ul>
</section>
<section id="michelson-on-chain-views">
<h2>Michelson On-Chain Views<a class="headerlink" href="#michelson-on-chain-views" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="../active/views.html"><span class="doc">Views</span></a> are a new mechanism for contract calls that:</p>
<ul class="simple">
<li><p>are read-only: they may depend on the contract storage but cannot
modify it nor emit operations (but they can call other views);</p></li>
<li><p>take arguments as input in addition to the contract storage;</p></li>
<li><p>return results as output;</p></li>
<li><p>are synchronous: the result is immediately available on the stack of
the caller contract.</p></li>
</ul>
<p>There are two added Michelson primitives: <code class="docutils literal notranslate"><span class="pre">VIEW</span></code> (instruction) and
<code class="docutils literal notranslate"><span class="pre">view</span></code> (top-level keyword).</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gitlab.com/tezos/tzip/-/merge_requests/169">TZIP</a></p></li>
<li><p>MRs <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2359">!2359</a>, <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3431">!3431</a> and <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3654">!3654</a></p></li>
</ul>
</section>
<section id="global-constants">
<h2>Global Constants<a class="headerlink" href="#global-constants" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>A new manager operation and corresponding CLI command have been added
allowing users to register Micheline expressions in a global table of
constants, returning an index to the expression. A new primitive
<code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">&lt;string&gt;</span></code> has been added that allows contracts to reference
these constants by their index. When a contract is called, any
constants are expanded into their registered values. The result is
that users can use constants to originate larger contracts, as well as
share code between contracts.</p></li>
<li><p><a class="reference external" href="https://gitlab.com/tezos/tzip/-/merge_requests/117">TZIP</a></p></li>
<li><p>MRs: <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2962">!2962</a>, <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3467">!3467</a>, <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3473">!3473</a>, <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3492">!3492</a>, <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3731">!3731</a></p></li>
</ul>
</section>
<section id="cache">
<h2>Cache<a class="headerlink" href="#cache" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>A chain-sensitive cache is now available to the protocol developers.
This cache can be seen as an in-memory context providing fast access
to the most recently used values.</p></li>
<li><p>The protocol now keeps contracts’ source code and storage in the
cache. This reduces the gas consumption for the most recently used
contracts.</p></li>
<li><p>The new RPC <code class="docutils literal notranslate"><span class="pre">context/cache/contracts/all</span></code> returns the list of contracts
in the cache.</p></li>
<li><p>The new RPC <code class="docutils literal notranslate"><span class="pre">context/cache/contracts/size</span></code> returns an overapproximation
of the cache size (in bytes).</p></li>
<li><p>The new RPC <code class="docutils literal notranslate"><span class="pre">context/cache/contracts/size_limit</span></code> returns the maximal
cache size (in bytes). When this size is reached, the cache removes
the least recently used entries.</p></li>
<li><p>The new RPC <code class="docutils literal notranslate"><span class="pre">context/cache/contracts/rank</span></code> gives the number of contracts
that are less recently used than the one provided as argument.</p></li>
<li><p>The new RPC <code class="docutils literal notranslate"><span class="pre">scripts/script_size</span></code> gives the size of the script
and its storage when stored in the cache.</p></li>
<li><p>MRs: <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3234">!3234</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3419">!3419</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3717">!3717</a></p></li>
<li><p>Gas instrumentation implemented in MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3430">!3430</a></p></li>
</ul>
</section>
<section id="context-storage-flattening">
<h2>Context Storage Flattening<a class="headerlink" href="#context-storage-flattening" title="Link to this heading">#</a></h2>
<p>Hex-nested directories like <code class="docutils literal notranslate"><span class="pre">/12/af/83/3d/</span></code> are removed from the
context. This results in better context access performance. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2771">!2771</a>)</p>
<p>Gas computation has been adapted to this new flattened context layout. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2771">!2771</a>)</p>
</section>
<section id="bug-fixes">
<h2>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>A bug in Michelson comparison function has been fixed (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3237">!3237</a>)</p></li>
<li><p>Fix balance updates that indicate inaccurate burned amounts in some
scenarios (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3407">!3407</a>)</p></li>
</ul>
</section>
<section id="minor-changes">
<h2>Minor Changes<a class="headerlink" href="#minor-changes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Gas improvements for typechecking instruction <code class="docutils literal notranslate"><span class="pre">CONTRACT</span></code> (MR
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3241">!3241</a>) and general gas cost adjustments (MRs <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3441">!3441</a>
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3724">!3724</a>)</p></li>
<li><p>Other internal refactorings or documentation. (MRs <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2021">!2021</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/2984">!2984</a>
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3042">!3042</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3049">!3049</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3088">!3088</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3075">!3075</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3266">!3266</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3270">!3270</a>
<a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3285">!3285</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3375">!3375</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3247">!3247</a>)</p></li>
<li><p>Set the predecessor version of the protocol to Granada (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3347">!3347</a>)</p></li>
<li><p>Check order in the validation of endorsements has changed to not
compute all endorsement slots of a level if the endorsement is
invalid. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3395">!3395</a>)</p></li>
<li><p>Fix handling of potential negative integer in <code class="docutils literal notranslate"><span class="pre">Raw_level_repr</span></code>
encoding. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3273">!3273</a>)</p></li>
<li><p>RPCs <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">../helpers/endorsing_rights</span></code> and <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">../helpers/baking_rewards</span></code>
have been moved into the RPC plugin. Nothing has changed from the
end-user perspective for now but further improvements to their
performance will become easier now that they are decoupled from the
protocol development cycle. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3368">!3368</a>)</p></li>
<li><p>Gives an increase to the liquidity baking sunset level of
211,681 blocks, or five voting periods plus 6,881 blocks to
sync with the following voting period, roughly an additional two
months and a half. Without this, the subsidy would halt during the lifespan of
this protocol. With this change the subsidy can continue until the
protocol after this one is activated, even accounting for some
delays in proposal injection and/or a restarted voting process,
while still making sure it won’t extend to two protocols after this
one without a more significant increase. This follows the spirit of
<a class="reference external" href="https://gitlab.com/tezos/tzip/-/blob/367628e1a576c3926bedc1d6107b2945607c2605/drafts/current/draft-liquidity_baking.md">the liquidity baking TZIP</a> in that it is still roughly six months
from Granada activation and requires a referendum on the subsidy in
the protocol after this one. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3425">!3425</a> <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3464">!3464</a>)</p></li>
<li><p>Reimplemented <code class="docutils literal notranslate"><span class="pre">Logging</span></code>.  It now has Lwt-less APIs and the messages are handled
by the shell. (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3225">!3225</a>)</p></li>
<li><p>The size limit on Michelson types has been roughly doubled (from 1000 to 2001). (MR <a class="reference external" href="https://gitlab.com/tezos/tezos/-/merge_requests/3434">!3434</a>)</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="012_ithaca.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Protocol Ithaca</p>
      </div>
    </a>
    <a class="right-next"
       href="010_granada.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Protocol Granada</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-environment-version-v3">New Environment Version (V3)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#receipts-balance-updates">Receipts, Balance Updates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rpc-changes">RPC Changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timelock">Timelock</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#michelson-on-chain-views">Michelson On-Chain Views</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-constants">Global Constants</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cache">Cache</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context-storage-flattening">Context Storage Flattening</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-fixes">Bug Fixes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minor-changes">Minor Changes</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nomadic Labs <contact@nomadic-labs.com>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2023, Nomadic Labs &lt;contact@nomadic-labs.com&gt;.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>