
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The consensus algorithm &#8212; Octez &amp; Protocol products documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=c488f85a" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=aa02af3f"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KT3Z3X4Y82"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KT3Z3X4Y82');
            </script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'active/consensus';</script>
    <script src="../_static/js/custom.js?v=e7f469e6"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Amendment (and Voting) Process" href="voting.html" />
    <link rel="prev" title="Randomness generation" href="randomness_generation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Octez & Protocol products documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Octez & Protocol products documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/tezos.html">Octez &amp; Protocol overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/howtoget.html">Installing Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/get_troubleshooting.html">Installation troubleshooting</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtouse.html">Getting started with Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/howtorun.html">Running Octez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/versioning.html">Octez &amp; Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/breaking_changes.html">BREAKING CHANGES</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez User manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-client.html">Setting up the client</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/client-configuration.html">Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/key-management.html">Key Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/sandbox.html">Sandboxed mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/mockup.html">Mockup mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy.html">Proxy mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/light.html">Light mode</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../user/setup-node.html">Setting up the node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/node-configuration.html">Node Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/multinetwork.html">Connecting to a Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/history_modes.html">History modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/snapshots.html">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/proxy-server.html">Proxy server</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../user/node-monitoring.html">Monitoring an Octez Node</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/openmetrics.html">Supported Open Metrics</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../user/multisig.html">Built-in multisig contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/fa12.html">FA1.2 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/logging.html">Logging features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/exits.html">Exit codes and signals</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Octez Reference manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../shell/the_big_picture.html">Octez Software Architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/shell.html">The Octez Shell</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/validation.html">The validation subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/prevalidation.html">The Prevalidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/storage.html">The storage layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/sync.html">Synchronisation heuristic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/p2p.html">The peer-to-peer layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/protocol_environment.html">Protocol Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/micheline.html">Micheline</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/data_availability_committees.html">Data Availability Committees</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shell/dal.html">Data Availability Layer</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_overview.html">DAL overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_node.html">The DAL node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_run.html">Running a DAL node</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell/dal_bakers.html">Bakers &amp; the DAL</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/smart_rollup_node.html">Smart rollup node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/p2p_api.html">P2P message format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell/rpc.html">Shell RPCs - Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Protocol Reference Manuals</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Paris Protocol Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="protocol.html">Economic protocol features</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="adaptive_issuance.html">Adaptive Issuance and Staking</a></li>
<li class="toctree-l3"><a class="reference internal" href="adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpc.html">Paris RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../quebec/index.html">Quebec Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../quebec/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../quebec/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quebec/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../quebec/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quebec/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quebec/rpc.html">Quebec RPCs - Reference</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alpha/index.html">Alpha Dev Protocol Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../alpha/protocol.html">Economic protocol features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../alpha/protocol_overview.html">Overview of the economic protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/proof_of_stake.html">Proof-of-stake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/randomness_generation.html">Randomness generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/baking_power.html">Baking Power</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/consensus.html">The consensus algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/voting.html">The Amendment (and Voting) Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/accounts.html">Accounts and addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson.html">Michelson: the language of Smart Contracts in Tezos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/views.html">On-chain Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/timelock.html">Time-lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/sapling.html">Sapling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/liquidity_baking.html">Liquidity Baking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/global_constants.html">Global Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/michelson_anti_patterns.html">Michelson Anti-Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/token_management.html">Token transfers and balance updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/precheck.html">Prechecking of manager operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/smart_rollups.html">Smart Optimistic Rollups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/plugins.html">Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/event.html">Contract events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/blocks_ops.html">Blocks and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/validation.html">Validation and Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/tickets.html">Tickets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_issuance.html">Adaptive Issuance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/staking.html">Staking mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/adaptive_slashing.html">Adaptive Slashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alpha/dal_support.html">DAL support</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/cli-commands.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alpha/rpc.html">Alpha RPCs - Reference</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tezos developer Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developer/rpc.html">JSON/RPC interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/errors.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/openapi.html">RPCs - OpenAPI reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in Octez releases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../releases/releases.html">Release System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/version-20.html">Version 20.2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../releases/history.html">Older Versions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-19.html">Version 19.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-18.html">Version 18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-17.html">Version 17.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-16.html">Version 16.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-15.html">Version 15.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-14.html">Version 14.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-13.html">Version 13.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-12.html">Version 12.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-11.html">Version 11.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-10.html">Version 10.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-9.html">Version 9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-8.html">Version 8.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/version-7.html">Version 7.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/january-2020.html">Mainnet January 2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/december-2019.html">Mainnet December 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/october-2019.html">Mainnet-Staging October 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/september-2019.html">Mainnet September 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/may-2019.html">Mainnet May 2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/april-2019.html">Mainnet April 2019</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Changes in protocol versions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../protocols/naming.html">Protocol versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/019_paris.html">Protocol Paris</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/021_quebec.html">Protocol Quebec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/alpha.html">Protocol Alpha</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../protocols/history.html">Older Protocols</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../protocols/018_oxford.html">Protocol Oxford</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/017_nairobi.html">Protocol Nairobi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/016_mumbai.html">Protocol Mumbai</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/015_lima.html">Protocol Lima</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/014_kathmandu.html">Protocol Kathmandu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/013_jakarta.html">Protocol Jakarta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/012_ithaca.html">Protocol Ithaca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/011_hangzhou.html">Protocol Hangzhou</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/010_granada.html">Protocol Granada</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/009_florence.html">Protocol Florence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/008_edo.html">Protocol Edo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/007_delphi.html">Protocol Delphi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/006_carthage.html">Protocol Carthage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/005_babylon.html">Protocol Babylon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/004_Pt24m4xi.html">Protocol Athens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/003_PsddFKi3.html">Protocol 003_PsddFKi3</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/contributing_index.html">How to contribute</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/contributing.html">How to contribute to Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/contributing-adding-a-new-opam-dependency.html">How to add or update opam dependencies</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merge_team.html">Octez Merge Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/guidelines.html">Documentation and coding guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/repository_scope.html">Scope of the Octez repository</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/programming.html">Programming tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/gadt.html">Generalized Algebraic Data Types (GADTs)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/error_monad.html">The Error Monad</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p1_result.html">Part 1: <code class="docutils literal notranslate"><span class="pre">result</span></code>, Lwt, and Lwt-<code class="docutils literal notranslate"><span class="pre">result</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p2_tzresult.html">Part 2: <code class="docutils literal notranslate"><span class="pre">tzresult</span></code> and Lwt-<code class="docutils literal notranslate"><span class="pre">tzresult</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p3_advanced.html">Part 3: Advanced topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/error_monad_p4_appendices.html">Part 4: Appendices</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/clic.html">The <code class="docutils literal notranslate"><span class="pre">clic</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/data_encoding.html">The <code class="docutils literal notranslate"><span class="pre">data_encoding</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/event_logging_framework.html">Using The Event Logging Framework</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/testing_index.html">Testing in Octez</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/testing.html">Overview of Testing in Octez</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/ppx_expect.html">Ppx_expect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/tezt.html">Tezt: OCaml Tezos Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/long-tezts.html">Tezt: Long Tests and Performance Regression Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/alcotezt.html">Alcotezt: An Alcotest Compatibility Wrapper for Tezt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/unit_testing_legacy_code.html">Making legacy code unit-testable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/proposal_testing.html">How to Test a Protocol Proposal</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/maintaining.html">Maintaining</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/entering_alpha.html">How to start reading protocol Alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/michelson_instructions.html">Adding a new instruction to Michelson language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/protocol_release_checklist.html">Protocol Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/howto-freeze-protocols.html">How to Freeze Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/protocol_environment_upgrade.html">Adding a new protocol environment</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Documenting</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/tools.html">Platform Development tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/profiling.html">Profiling the Octez node</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../developer/snoop.html">Benchmarking with Snoop</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_arch.html">Architecture of <code class="docutils literal notranslate"><span class="pre">octez-snoop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_tutorial.html">Snoop usage tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_example.html">In-depth usage example: more control over your benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/tezos_micheline_rewriting.html">Rewriting Micheline with <code class="docutils literal notranslate"><span class="pre">tezos-micheline-rewriting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer/snoop_interpreter.html">Snoop and the Michelson Interpreter</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/time_measurement_ppx.html">Time measurement PPX</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/python_environment.html">Python Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/pre_commit_hook.html">Pre-Commit Hook</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/encodings.html">Encodings</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developer/merkle-proof-encoding-formats.html">Merkle Proof Encoding Formats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v1-tree32.html">V1 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v1-tree2.html">V1 for Tree2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v2-tree32.html">V2 for Tree32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/merkle-proof-formats/v2-tree2.html">V2 for Tree2</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api-inline.html">OCaml APIs - Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-gitlab"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-gitlab"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://gitlab.com/tezos/tezos/-/issues/new?issue[title]=Issue%20on%20page%20%2Factive/consensus.html&issue[description]=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The consensus algorithm</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#history">History</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transaction-and-block-finality">Transaction and block finality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-between-blocks">Time between blocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validator-selection-staked-balance-and-active-stake">Validator selection: staked balance and active stake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#economic-incentives">Economic Incentives</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fees">Fees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rewards">Rewards</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#slashing-paris">Slashing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consensus-related-protocol-parameters">Consensus related protocol parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shell-protocol-interaction-revisited">Shell-protocol interaction revisited</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-external-resources">Further External Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="the-consensus-algorithm">
<h1>The consensus algorithm<a class="headerlink" href="#the-consensus-algorithm" title="Link to this heading">#</a></h1>
<p>This document provides a high-level description of Tenderbake, the Tezos
<a class="reference internal" href="proof_of_stake.html"><span class="doc">proof-of-stake</span></a> consensus algorithm.</p>
<section id="history">
<h2>History<a class="headerlink" href="#history" title="Link to this heading">#</a></h2>
<p>Before Tenderbake, there was
<a class="reference external" href="https://gitlab.com/tezos/tzip/-/blob/1728fcfe0ac90463ef15e6a994b6d6a15357e373/drafts/current/draft_emmy-star.md">Emmy*</a>,
a Nakamoto-style consensus consisting of a series of improvements of the one in
the <a class="reference external" href="https://tezos.com/whitepaper.pdf">Tezos whitepaper</a>.</p>
<p>Emmy*, like any Nakamoto-style consensus algorithm (such as <a class="reference external" href="https://bitcoin.org/bitcoin.pdf">Bitcoin</a> or <a class="reference external" href="https://eprint.iacr.org/2016/889">Ouroboros</a>), offers <em>probabilistic</em>
finality: forks of arbitrary length are possible but they collapse
with a probability that increases rapidly with fork length.</p>
<p><a class="reference external" href="https://arxiv.org/abs/2001.11965">Tenderbake</a> instead, like any classic
BFT-style consensus algorithm (such as
<a class="reference external" href="https://pmg.csail.mit.edu/papers/osdi99.pdf">PBFT</a> or
<a class="reference external" href="https://arxiv.org/abs/1807.04938">Tendermint</a>), offers <em>deterministic</em>
finality: a block that has just been appended to the chain of some node is known
to be final once it has two additional blocks on top of it, regardless of
network latency.</p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The starting point for Tenderbake is
<a class="reference external" href="https://arxiv.org/abs/1807.04938">Tendermint</a>, the first classic-style algorithm
for blockchains.</p>
<p>Tenderbake adapts Tendermint to the Tezos blockchain, but the adjustments
required are
<a class="reference external" href="https://research-development.nomadic-labs.com/a-look-ahead-to-tenderbake.html#the-tezos-architecture">substantive</a>:</p>
<ul class="simple">
<li><p>Tenderbake is tailored to match the Tezos architecture by using only
communication primitives and network assumptions which Tezos supports.</p></li>
<li><p>Tenderbake makes weaker network assumptions than Tendermint, at the price of
adding the extra assumption that participants have loosely synchronized clocks
— which is fine, because Tezos already uses them.</p></li>
</ul>
<p>The design of Tenderbake and its rationale are described at
length in the <a class="reference external" href="https://arxiv.org/abs/2001.11965">technical report</a> and in a
<a class="reference external" href="https://research-development.nomadic-labs.com/a-look-ahead-to-tenderbake.html">Nomadic Labs’s blog
post</a>. Here we
only provide a user/developer perspective.</p>
<p id="tb-validator-paris"><span id="tb-validator"></span>Tenderbake is executed for each new block level by a “committee” whose members
are called <em>validators</em>, which are delegates selected at random based on their
stake, in the same way as endorsers were selected in Emmy*. We let
<code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span></code> be the number of validator <a class="reference internal" href="proof_of_stake.html#rights-paris"><span class="std std-ref">slots</span></a> per level.
Furthermore, we use <code class="docutils literal notranslate"><span class="pre">CONSENSUS_THRESHOLD</span></code> to denote two thirds of <code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span></code>.</p>
<p>For each level, Tenderbake proceeds in rounds. Each <em>round</em> represents an
attempt by the validators to agree on the content of the block for the current
level, that is, on the sequence of non-consensus operations the block contains.
We call this sequence the block’s <em>payload</em>.</p>
<p>Each round has an associated duration. Round durations are set to increase so
that for any possible message delay, there is a round that is sufficiently long
for all required messages to be exchanged.
Round durations depend on protocol parameters <code class="docutils literal notranslate"><span class="pre">MINIMAL_BLOCK_DELAY</span></code> and <code class="docutils literal notranslate"><span class="pre">DELAY_INCREMENT_PER_ROUND</span></code>.
These parameters specify round durations as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}round\_duration(0) &amp;= minimal\_block\_delay \\
round\_duration(r+1) &amp;= round\_duration(r) + delay\_increment\_per\_round \\
&amp; = minimal\_block\_delay + (r + 1) * delay\_increment\_per\_round\end{split}\]</div>
<p>Round durations thus increase linearly with <code class="docutils literal notranslate"><span class="pre">DELAY_INCREMENT_PER_ROUND</span></code>.</p>
<p>Schematically, a round consists in the following steps:</p>
<span id="candidate-block"></span><ul class="simple" id="candidate-block-paris">
<li><p>a validator designated for that round injects a <em>candidate block</em> (representing a proposal) and consensus operations (representing votes) into the node to which it is attached, which then</p></li>
<li><p>diffuses those blocks and consensus operations to other nodes of the network, and thus</p></li>
<li><p>communicates them to the validators attached to those nodes, to carry out voting on which block to accept.</p></li>
</ul>
<p id="quorum-paris"><span id="quorum"></span>Unlike Emmy*, Tenderbake has <a class="reference external" href="https://research-development.nomadic-labs.com/a-look-ahead-to-tenderbake.html#why-do-we-need-preendorsements">two types of
votes</a>:
before attesting a block <code class="docutils literal notranslate"><span class="pre">b</span></code>, a validator preattests <code class="docutils literal notranslate"><span class="pre">b</span></code>. Furthermore,
to be able to attest, a validator must have observed a preattestation <em>quorum</em>, that is a
set of preattestations from validators having at least <code class="docutils literal notranslate"><span class="pre">CONSENSUS_THRESHOLD</span></code> validator slots. Similarly, to be able to decide, a validator must have observed an attestation quorum, that is, a set of attestations from validators having at least <code class="docutils literal notranslate"><span class="pre">CONSENSUS_THRESHOLD</span></code> validator slots. The
attestation quorum for a block <code class="docutils literal notranslate"><span class="pre">b</span></code> is included in a block <code class="docutils literal notranslate"><span class="pre">b'</span></code> on top of <code class="docutils literal notranslate"><span class="pre">b</span></code>,
serving as a certification that <code class="docutils literal notranslate"><span class="pre">b</span></code> has been agreed upon.
We also say that block <code class="docutils literal notranslate"><span class="pre">b'</span></code> confirms block <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>The validator’s whose turn is to inject a candidate block at a given round is
called the <em>proposer</em> at that round. Proposers in Tenderbake are selected
similarly to bakers in Emmy*: the proposer at round <code class="docutils literal notranslate"><span class="pre">r</span></code> is the
validator who has the validator slot <code class="docutils literal notranslate"><span class="pre">r</span></code>. A proposer who has observed a
preattestation quorum for a candidate block in a previous round, is required to propose a block with
the same <em>payload</em> as
the initial block. We talk about a <em>re-proposal</em> in this case.</p>
<section id="transaction-and-block-finality">
<span id="finality-paris"></span><span id="finality"></span><h3>Transaction and block finality<a class="headerlink" href="#transaction-and-block-finality" title="Link to this heading">#</a></h3>
<p>A transaction is final as soon as the block including it has a confirmation (that is, a block on top of it).
Indeed, as hinted above, a block contains the certification (that is, the attestation quorum) for the previous
payload. Thanks to the attestation quorum, Tenderbake guarantees <strong>transaction finality
after 1 confirmation</strong>.</p>
<p>It may be possible that different validators decide at different rounds, though on the same payload. The blocks at these different rounds differ precisely because they contain, in the header, as part of the block fitness,
the round at which they were proposed.
Among these “candidate” blocks, the block with the smallest round has the highest fitness and so it will be the one decided.
Consequently, to agree on a block, that is, on both the payload and the header, Tenderbake needs one more
confirmation, and thus guarantees
<strong>block finality after 2 confirmations</strong>.</p>
</section>
<section id="time-between-blocks">
<span id="id2"></span><h3>Time between blocks<a class="headerlink" href="#time-between-blocks" title="Link to this heading">#</a></h3>
<p>The time between blocks represents the difference between the timestamps of the blocks. The timestamp of a block is given by the beginning of the round at which the block has been agreed upon. Thus, the time between blocks depends on the round at which decisions are taken. For
example, if the decision at the previous level was taken at round 4 and at the current level at round 2, then the current block’s delay relative to
its predecessor, is <span class="math notranslate nohighlight">\(round\_duration(4) + round\_duration(0) + round\_duration(1)\)</span>.
The general case is as follows, say that the decision at the previous
level is taken at round <code class="docutils literal notranslate"><span class="pre">m</span></code> and the decision at the current level is
taken at round <code class="docutils literal notranslate"><span class="pre">n</span></code>, then the current block’s delay relative to its
predecessor is <span class="math notranslate nohighlight">\(round\_duration(m) + \sum_{i=0}^{n-1} round\_duration(i)\)</span>.
We note that, under
normal network conditions, and with active and compliant validators, decisions
should be taken at round 0, meaning that the time between blocks would be
<span class="math notranslate nohighlight">\(round\_duration(0)\)</span> seconds i.e., parameter <code class="docutils literal notranslate"><span class="pre">MINIMAL_BLOCK_DELAY</span></code>.</p>
</section>
<section id="validator-selection-staked-balance-and-active-stake">
<span id="active-stake-paris"></span><span id="active-stake"></span><h3>Validator selection: staked balance and active stake<a class="headerlink" href="#validator-selection-staked-balance-and-active-stake" title="Link to this heading">#</a></h3>
<p>Validator selection is based on the staked balance of a delegate, as in Emmy*.
Let us first (re)define these and related concepts.</p>
<ul class="simple">
<li><p>The <em>overall balance</em> of a delegate is its full balance (i.e. all the tokens owned by the delegate) plus the
balances of all accounts that have delegated to it.
It must be at least <code class="docutils literal notranslate"><span class="pre">MINIMAL_STAKE</span></code> tez, otherwise the delegate cannot be selected as a validator.</p></li>
<li><p>The <em>active stake</em> of a delegate is the amount of tez with which
it participates in consensus. It is at most its maximal
staked balance. We explain below how it is computed.</p></li>
<li><p>The <em>staked balance</em> represents the delegate’s skin in the game: in
the case that the delegate behaves badly, its staked balance is
partly <a class="reference internal" href="#slashing-paris"><span class="std std-ref">slashed</span></a>. This staked balance must be
at least <code class="docutils literal notranslate"><span class="pre">MINIMAL_FROZEN_STAKE</span></code> tez, otherwise the delegate cannot
be selected as a validator. Note that until the <a class="reference internal" href="adaptive_issuance.html#feature-activation-paris"><span class="std std-ref">activation of
Adaptive Issuance and Staking</span></a>, the
staked balance is automatically updated at the end of each cycle to
maximize the active stake.</p></li>
<li><p>The <em>spendable balance</em> of a delegate is its full balance
minus its staked balance and unstaked frozen balance.</p></li>
</ul>
<p>We state next the RPCs which allow to retrieve these types of balances, and also some invariants about them
(Note that these are just invariants, not definitions; for
instance, the frozen deposits are computed in terms of the full balance,
not the other way around.):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">delegated</span> <span class="pre">balance</span></code> represents the total amount of tokens delegated or staked by others to a
given delegate; it excludes the delegate’s full balance; it is obtained
with <code class="docutils literal notranslate"><span class="pre">../context/delegates/&lt;pkh&gt;/delegated_balance</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">overall</span> <span class="pre">balance</span> <span class="pre">=</span> <span class="pre">full</span> <span class="pre">balance</span> <span class="pre">+</span> <span class="pre">delegated</span> <span class="pre">balance</span></code>; it is obtained with
<code class="docutils literal notranslate"><span class="pre">../context/delegates/&lt;pkh&gt;/staking_balance</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">full</span> <span class="pre">balance</span> <span class="pre">=</span> <span class="pre">spendable</span> <span class="pre">balance</span> <span class="pre">+</span> <span class="pre">staked</span> <span class="pre">balance</span> <span class="pre">+</span> <span class="pre">unstaked</span> <span class="pre">frozen</span> <span class="pre">balance</span></code>; it is obtained with
<code class="docutils literal notranslate"><span class="pre">../context/delegates/&lt;pkh&gt;/full_balance</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">staked</span> <span class="pre">balance</span></code> is obtained with <code class="docutils literal notranslate"><span class="pre">../context/delegates/&lt;pkh&gt;/frozen_deposits</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spendable</span> <span class="pre">balance</span></code> is obtained with <code class="docutils literal notranslate"><span class="pre">../context/contracts/&lt;pkh&gt;/balance</span></code></p></li>
</ul>
<p>Until Adaptive Issuance, delegates can set an upper limit to their staked balance with the
command <code class="docutils literal notranslate"><span class="pre">octez-client</span> <span class="pre">set</span> <span class="pre">deposits</span> <span class="pre">limit</span> <span class="pre">for</span> <span class="pre">&lt;delegate&gt;</span> <span class="pre">to</span>
<span class="pre">&lt;deposit_limit&gt;</span></code>, and unset this limit with the command <code class="docutils literal notranslate"><span class="pre">octez-client</span>
<span class="pre">unset</span> <span class="pre">deposits</span> <span class="pre">limit</span> <span class="pre">for</span> <span class="pre">&lt;delegate&gt;</span></code>. These commands are implemented
using the manager operation <code class="docutils literal notranslate"><span class="pre">Set_deposits_limit</span></code>.
When emitting such a command in cycle <code class="docutils literal notranslate"><span class="pre">c</span></code>, it affects the automatic deposit at
the end of this cycle, and thus the consensus rights set for cycle <code class="docutils literal notranslate"><span class="pre">(c</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">+</span>
<span class="pre">CONSENSUS_RIGHTS_DELAY</span> <span class="pre">+</span> <span class="pre">1</span></code>.
Since the deposit will be adjusted at the end of cycle <code class="docutils literal notranslate"><span class="pre">c</span></code>, unstaked tokens
will be available at cycle  <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">CONSENSUS_RIGHTS_DELAY</span> <span class="pre">+</span> <span class="pre">MAX_SLASHING_PERIOD</span></code>.</p>
<p>The active stake is computed <code class="docutils literal notranslate"><span class="pre">CONSENSUS_RIGHTS_DELAY</span></code> in advance: at
the end of cycle <code class="docutils literal notranslate"><span class="pre">c</span></code> for cycle <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">CONSENSUS_RIGHTS_DELAY</span></code> (as in Emmy*),
before updating the delegates’ <a class="reference internal" href="proof_of_stake.html#active-delegate-paris"><span class="std std-ref">activity status</span></a>.</p>
<p>Intuitively, the active stake is set to 10 times the delegate’s staked balance,
without going beyond its overall balance.
More precisely, the active stake is:</p>
<ul class="simple">
<li><p>the delegate’s staked balance,</p></li>
<li><p>its stakers’ staked balance (up to a limit, see
<a class="reference internal" href="adaptive_issuance.html#staking-policy-configuration-paris"><span class="std std-ref">limit_of_staking_over_baking</span></a>),</p></li>
<li><p>and the liquid delegated balance + the spendable balance, up to 9 times the delegate’s staked balance.</p></li>
</ul>
<p>Before Adaptive Issuance, each part weighs equally when computing the baking and voting rights. After Adaptive Issuance, the frozen balances (non-liquid, non-spendable) are weighed for twice as much per tez as the liquid part.</p>
<p>Let’s take some examples. Say that the full balance of a delegate is <code class="docutils literal notranslate"><span class="pre">1000</span></code> tez.
Then, without external staking, its theoretical maximum active stake is
<code class="docutils literal notranslate"><span class="pre">10000</span></code> tez. The following table lists some scenarios before Adaptive Issuance (assuming for
simplicity no changes in the delegate’s full and staked balances
during the last 5 cycles).</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Overall balance</p></th>
<th class="head"><p>Frozen deposit limit</p></th>
<th class="head"><p>Active stake</p></th>
<th class="head"><p>Staked balance</p></th>
<th class="head"><p>Spendable balance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>9000</p></td>
<td><p>–</p></td>
<td><p>9000</p></td>
<td><p>900</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>12000</p></td>
<td><p>–</p></td>
<td><p>10000</p></td>
<td><p>1000</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>9000</p></td>
<td><p>400</p></td>
<td><p>4000</p></td>
<td><p>400</p></td>
<td><p>600</p></td>
</tr>
<tr class="row-odd"><td><p>12000</p></td>
<td><p>400</p></td>
<td><p>4000</p></td>
<td><p>400</p></td>
<td><p>600</p></td>
</tr>
</tbody>
</table>
</div>
<p>We note in passing that this new schema basically solves the main
problem of over-delegation: a delegate will not fail anymore to bake
and attest because of an insufficient balance to pay the
deposit. However, a delegate can still be over-delegated, and it will be
rewarded based on its active stake, not on its overall balance.</p>
</section>
<section id="economic-incentives">
<h3>Economic Incentives<a class="headerlink" href="#economic-incentives" title="Link to this heading">#</a></h3>
<p>As Emmy*, Tenderbake rewards participation in consensus and punishes bad
behavior. Notable changes however are as follows:</p>
<ul class="simple">
<li><p>Fees and baking rewards go to the payload producer, the one who selected the
transactions to be included in the block (and was the first to propose a
block with that payload). In case of re-proposal, the payload producer might
be different from the block proposer, the baker who injects the block.</p></li>
<li><p>Including extra attestations, that is, more than the minimal required to
obtain a quorum, is rewarded with a bonus.</p></li>
<li><p>Attesting rewards are shared equally among all validators. Participation above
a minimal threshold per cycle is however required.</p></li>
<li><p>Validators are rewarded instantaneously for baking blocks and including extra attestations, and not at the end of the cycle like in Emmy*.</p></li>
<li><p>At the end of a cycle <code class="docutils literal notranslate"><span class="pre">c</span></code>, the following actions happen:</p>
<ul>
<li><p>the distribution of attesting rewards,</p></li>
<li><p>the selection of the consensus committee cycle <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">+</span> <span class="pre">CONSENSUS_RIGHTS_DELAY</span></code>, based on the current active stake distribution.</p></li>
</ul>
</li>
</ul>
<section id="fees">
<h4>Fees<a class="headerlink" href="#fees" title="Link to this heading">#</a></h4>
<p>The fees associated to the transactions included in a block go to the payload
producer. This is only natural given that this is the validator that selects the
transactions to be included; see <a class="reference external" href="https://ex.rs/protocol-level-fees/">an in-depth blog
post</a> for further motivation.</p>
<p>The payload producer is usually the same delegate as the block
proposer (that is, the one that signs and injects the block): that’s
always true for blocks at round 0; however, in case of re-proposals
this is not necessarily the case (see the algorithm description above).</p>
<p>Fees are given to the payload producer immediately, that is, they are
already reflected in the blockchain state obtained after applying the injected
block.</p>
</section>
<section id="rewards">
<h4>Rewards<a class="headerlink" href="#rewards" title="Link to this heading">#</a></h4>
<p>There are three kinds of rewards: baking rewards, attesting rewards, and a bonus for including extra attestations.</p>
<p>The baking rewards are treated in the same way as fees: they go to the <em>payload</em>
producer and are distributed immediately.</p>
<p>To encourage fairness and participation, the <em>block</em> proposer receives
a bonus for the extra attestations it includes in the block.
The bonus is proportional to the number of
validator slots above the threshold of <code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">/</span> <span class="pre">3</span></code> that
the included attestations represent. The bonus is also distributed
immediately.</p>
<p>The attesting rewards are distributed at the end of the cycle.
The attesting reward may be received even if not all of the validator’s attestations are included in a block and is proportional to the validator’s active stake (in other words, to its <em>expected</em> number of validator slots, and not its actual number of slots).
However, two conditions must be met:</p>
<blockquote>
<div><ul class="simple">
<li><p>the validator has revealed its nonce, and</p></li>
<li><p>the validator has been present during the cycle.</p></li>
</ul>
</div></blockquote>
<p>Not giving rewards in case of missing revelations is not new as it is <a class="reference internal" href="proof_of_stake.html#random-seed-paris"><span class="std std-ref">adapted</span></a>
from Emmy*.
The second condition is new. We say that a delegate is <em>present</em> during a cycle
if the attesting power (that is, the number of validator slots at the
corresponding level) of all the attestations included by the delegate during the
cycle represents at least <code class="docutils literal notranslate"><span class="pre">MINIMAL_PARTICIPATION_RATIO</span></code> of the delegate’s expected number of
validator slots for the current cycle (which is <code class="docutils literal notranslate"><span class="pre">BLOCKS_PER_CYCLE</span> <span class="pre">*</span>
<span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">*</span> <span class="pre">active_stake</span> <span class="pre">/</span> <span class="pre">total_active_stake</span></code>).</p>
<p>Regarding the concrete values for rewards, before Adaptive Issuance, we first fix the total reward per
level, call it <code class="docutils literal notranslate"><span class="pre">total_rewards</span></code>, to <code class="docutils literal notranslate"><span class="pre">80</span> <span class="pre">/</span> <span class="pre">blocks_per_minute</span></code> tez.
Assuming <code class="docutils literal notranslate"><span class="pre">blocks_per_minute</span> <span class="pre">=</span> <span class="pre">6</span></code>, <code class="docutils literal notranslate"><span class="pre">total_rewards</span></code> is 13.33 tez. With Adaptive Issuance, this value changes dynamically over time but for the sake of example, we will assume that the reward value stays the same as above.
We define:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BAKING_REWARD_FIXED_PORTION</span> <span class="pre">:=</span> <span class="pre">baking_reward_ratio</span> <span class="pre">*</span> <span class="pre">total_rewards</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bonus</span> <span class="pre">:=</span> <span class="pre">(1</span> <span class="pre">-</span> <span class="pre">baking_reward_ratio)</span> <span class="pre">*</span> <span class="pre">bonus_ratio</span> <span class="pre">*</span> <span class="pre">total_rewards</span></code> is the max bonus</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attesting_reward</span> <span class="pre">:=</span> <span class="pre">(1</span> <span class="pre">-</span> <span class="pre">baking_reward_ratio)</span> <span class="pre">*</span> <span class="pre">(1</span> <span class="pre">-</span> <span class="pre">bonus_ratio)</span> <span class="pre">*</span> <span class="pre">total_rewards</span></code></p></li>
</ul>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">baking_reward_ratio</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">/</span> <span class="pre">4</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bonus_ratio</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">/</span> <span class="pre">3</span></code>.</p></li>
</ul>
<p>Thus, we obtain <code class="docutils literal notranslate"><span class="pre">BAKING_REWARD_FIXED_PORTION</span> <span class="pre">=</span> <span class="pre">3.33</span></code> tez,
(maximum) <code class="docutils literal notranslate"><span class="pre">bonus</span> <span class="pre">=</span> <span class="pre">3.33</span></code> tez, and <code class="docutils literal notranslate"><span class="pre">attesting_reward</span> <span class="pre">=</span> <span class="pre">6.66</span></code> tez.
The bonus per additional attestation slot is in turn <code class="docutils literal notranslate"><span class="pre">bonus</span> <span class="pre">/</span>
<span class="pre">(CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">/</span> <span class="pre">3)</span></code> (because there are at most
<code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">/</span> <span class="pre">3</span></code> validator slots corresponding to the
additional attestations included in a block). The rewards per
attestation slot are <code class="docutils literal notranslate"><span class="pre">attesting_reward</span> <span class="pre">/</span> <span class="pre">CONSENSUS_COMMITTEE_SIZE</span></code>.
Assuming <code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">=</span> <span class="pre">7000</span></code>, we obtain a bonus per slot of
<code class="docutils literal notranslate"><span class="pre">3.33</span> <span class="pre">/</span> <span class="pre">(7000</span> <span class="pre">/</span> <span class="pre">3)</span> <span class="pre">=</span> <span class="pre">0.001427</span></code> tez and an attesting
rewards per slot of <code class="docutils literal notranslate"><span class="pre">6.66</span> <span class="pre">/</span> <span class="pre">7000</span> <span class="pre">=</span> <span class="pre">0.000951</span></code> tez.</p>
<p>Let’s take an example. Say a block has round 1, is proposed by
delegate B, and contains the payload from round 0 produced by delegate
A. Also, B includes attestations with attesting power <code class="docutils literal notranslate"><span class="pre">5251</span></code>. Then A receives
the fees and 10 tez (the <code class="docutils literal notranslate"><span class="pre">BAKING_REWARD_FIXED_PORTION</span></code>) as a reward for
producing the block’s payload. Concerning the bonus, given that
<code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">=</span> <span class="pre">7000</span></code>, the minimum required validator slots is <code class="docutils literal notranslate"><span class="pre">4667</span></code>, and there are <code class="docutils literal notranslate"><span class="pre">2333</span> <span class="pre">=</span> <span class="pre">7000</span> <span class="pre">-</span> <span class="pre">4667</span></code> additional validator slots.
Therefore B receives the bonus <code class="docutils literal notranslate"><span class="pre">(5251</span> <span class="pre">-</span> <span class="pre">4667)</span> <span class="pre">*</span> <span class="pre">0.001427</span> <span class="pre">=</span> <span class="pre">0.833368</span></code> tez. (Note
that B only included attestations corresponding to <code class="docutils literal notranslate"><span class="pre">584</span> <span class="pre">=</span> <span class="pre">5251</span> <span class="pre">-</span> <span class="pre">4667</span></code> additional validator slots, about a quarter of the
maximum <code class="docutils literal notranslate"><span class="pre">2333</span></code> extra attestations it could have theoretically included.) Finally, consider some
delegate C, whose active stake at some cycle is 1% of the total stake. Note that
his expected number of validator slots for that cycle is
<code class="docutils literal notranslate"><span class="pre">1/100</span> <span class="pre">*</span> <span class="pre">BLOCKS_PER_CYCLE</span> <span class="pre">*</span> <span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">=</span> <span class="pre">1/100</span> <span class="pre">*</span> <span class="pre">24576</span> <span class="pre">*</span> <span class="pre">7000</span> <span class="pre">=</span> <span class="pre">1,720,320</span></code>
slots. Assume also that the attesting power of C’s attestations
included during that cycle has been <code class="docutils literal notranslate"><span class="pre">1,321,456</span></code> slots. Given that this number is
bigger than the minimum required (<code class="docutils literal notranslate"><span class="pre">1,720,320</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">/</span> <span class="pre">3</span></code>), it receives an attesting
reward of <code class="docutils literal notranslate"><span class="pre">1,720,320</span> <span class="pre">*</span> <span class="pre">0.000951</span> <span class="pre">=</span> <span class="pre">1636.0243</span></code> tez for that cycle.</p>
</section>
<section id="slashing-paris">
<span id="slashing"></span><span id="id3"></span><h4>Slashing<a class="headerlink" href="#slashing-paris" title="Link to this heading">#</a></h4>
<p>Like in Emmy*, not revealing nonces and double signing are punishable. If a
validator does not reveal its nonce by the end of the cycle, it does not receive
its attesting rewards. If a validator double signs, that is, it double bakes
(which means signing different blocks at the same level and same round) or it
double (pre)attests (which means voting on two different proposals at the same
level and round), a part of the frozen deposit is slashed. The slashed amount
for double baking is a fixed percentage of the frozen deposit
<code class="docutils literal notranslate"><span class="pre">PERCENTAGE_OF_FROZEN_DEPOSITS_SLASHED_PER_DOUBLE_BAKING</span></code>. For
double (pre)attestations, the formula is more complex, as it depends
on the number of attestation slots that participated in the
misbehavior; see <a class="reference internal" href="adaptive_slashing.html"><span class="doc">Adaptive Slashing</span></a> for more details.
The payload producer that includes the misbehavior evidence will be rewarded a
seventh of the slashed amount, which corresponds to <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">/</span>
<span class="pre">(GLOBAL_LIMIT_OF_STAKING_OVER_BAKING</span> <span class="pre">+</span> <span class="pre">2)</span></code>.</p>
<p>If a delegate’s deposit is smaller than the slashed amount, the deposit is
simply emptied.</p>
<p>The evidence for double signing at a given level can be collected by any
<a class="reference internal" href="glossary.html#def-accuser-paris"><span class="std std-ref">accuser</span></a> and included as an <em>accusation</em> operation in a block
for a period of <code class="docutils literal notranslate"><span class="pre">MAX_SLASHING_PERIOD</span></code>.</p>
<p>As soon as a delegate is denounced for any double signing, it is
immediately <a class="reference internal" href="adaptive_slashing.html#new-forbidden-period-paris"><span class="std std-ref">forbidden</span></a> from both baking
and attesting for at least 2 cycles.</p>
<p>The actual slashing and denunciation rewarding happen at the end of
the last cycle of the slashing period of the misbehavior.</p>
<p>Note that selfish baking is not an issue in Tenderbake: say we are at round
<code class="docutils literal notranslate"><span class="pre">r</span></code> and the validator which is proposer at round <code class="docutils literal notranslate"><span class="pre">r+1</span></code> does not (pre)attest
at round <code class="docutils literal notranslate"><span class="pre">r</span></code> in the hope that the block at round <code class="docutils literal notranslate"><span class="pre">r</span></code> is not agreed upon and
its turn comes to propose at round <code class="docutils literal notranslate"><span class="pre">r+1</span></code>. Under the assumption that the
correct validators have more than two thirds of the total stake, these correct
validators have sufficient power for agreement to be reached, thus the lack of
participation of a selfish baker does not have an impact.</p>
</section>
</section>
</section>
<section id="consensus-related-protocol-parameters">
<span id="cs-constants-paris"></span><span id="cs-constants"></span><h2>Consensus related protocol parameters<a class="headerlink" href="#consensus-related-protocol-parameters" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 68.8%" />
<col style="width: 31.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter name</p></th>
<th class="head"><p>Parameter value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CONSENSUS_COMMITTEE_SIZE</span></code></p></td>
<td><p>7000</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CONSENSUS_THRESHOLD</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ceil(2</span> <span class="pre">*</span> <span class="pre">CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">/</span> <span class="pre">3)</span></code> = 4667</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MINIMAL_BLOCK_DELAY</span></code></p></td>
<td><p>10s</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">BLOCKS_PER_CYCLE</span></code></p></td>
<td><p>24576</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DELAY_INCREMENT_PER_ROUND</span></code></p></td>
<td><p>5s</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MINIMAL_PARTICIPATION_RATIO</span></code></p></td>
<td><p>2/3</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MAX_SLASHING_PERIOD</span></code></p></td>
<td><p>2 cycles</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PERCENTAGE_OF_FROZEN_DEPOSITS_SLASHED_PER_DOUBLE_BAKING</span></code></p></td>
<td><p>5%</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BAKING_REWARD_FIXED_PORTION</span></code></p></td>
<td><p>3.33 tez</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">BAKING_REWARD_BONUS_PER_SLOT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bonus</span> <span class="pre">/</span> <span class="pre">(CONSENSUS_COMMITTEE_SIZE</span> <span class="pre">/</span> <span class="pre">3)</span></code> = 0.001427 tez</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ATTESTING_REWARD_PER_SLOT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">attesting_reward</span> <span class="pre">/</span> <span class="pre">CONSENSUS_COMMITTEE_SIZE</span></code> = 0.000951 tez</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GLOBAL_LIMIT_OF_STAKING_OVER_BAKING</span></code></p></td>
<td><p>5</p></td>
</tr>
</tbody>
</table>
</div>
<p>These are a subset of the <a class="reference internal" href="protocol_overview.html#protocol-constants-paris"><span class="std std-ref">protocol constants</span></a>.</p>
</section>
<section id="shell-protocol-interaction-revisited">
<span id="shell-proto-revisit-paris"></span><span id="shell-proto-revisit"></span><h2>Shell-protocol interaction revisited<a class="headerlink" href="#shell-protocol-interaction-revisited" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="protocol_overview.html#shell-proto-interact-paris"><span class="std std-ref">Recall</span></a> that, for the shell to interact with the economic protocol, two notions are defined abstractly at the level of the shell and made concrete at the level of the consensus protocol.
Namely, these two notions are the protocol-specific header and the fitness.
As in Emmy*, the protocol-specific header contains the fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">signature</span></code>: a digital signature of the shell and protocol headers (excluding the signature itself)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seed_nonce_hash</span></code>: a commitment to <a class="reference internal" href="proof_of_stake.html#random-seed-paris"><span class="std std-ref">a random number</span></a>, used to generate entropy on the chain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proof_of_work_nonce</span></code>: a nonce used to pass a low-difficulty proof-of-work for the block, as a spam prevention measure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">liquidity_baking_toggle_vote</span></code>: <a class="reference internal" href="liquidity_baking.html#toggle-paris"><span class="std std-ref">a vote</span></a> to continue the Liquidity Baking Subsidy, stop it, or abstain.</p></li>
</ul>
<p>There are two additional fields: <code class="docutils literal notranslate"><span class="pre">payload_hash</span></code> and <code class="docutils literal notranslate"><span class="pre">payload_round</span></code> which are needed for establishing if a block is <a class="reference internal" href="#finality-paris"><span class="std std-ref">final</span></a>.</p>
<p id="fitness-paris"><span id="fitness"></span>The fitness is given by the tuple <code class="docutils literal notranslate"><span class="pre">(version,</span> <span class="pre">level,</span> <span class="pre">locked_round,</span> <span class="pre">-</span> <span class="pre">predecessor_round</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">round)</span></code>.
The current version of the fitness is 2 (version 0 was used by Emmy, and version 1 by Emmy+ and Emmy*).
The fitness encapsulates more information than in Emmy* because Tenderbake is more complex: recall that blocks at the last level only represent <a class="reference internal" href="#finality-paris"><span class="std std-ref">candidate blocks</span></a>.
In Emmy*, only the level mattered.
But in Tenderbake, we need to, for instance, allow for new blocks at the same level to be accepted by nodes.
Therefore the fitness also includes the block’s round (as the fifth component).
Furthermore, we also allow to change the predecessor block when it has a <a class="reference internal" href="#finality-paris"><span class="std std-ref">smaller round</span></a>.
Therefore the fitness also includes the opposite of predecessor block’s round as the forth component (the predecessor is taken for technical reasons).
Finally, to (partially) enforce <a class="reference internal" href="#quorum-paris"><span class="std std-ref">the rule on
re-proposals</span></a>, the fitness also includes, as the third
component, the round at which a preattestation quorum was observed by
the baker, if any (this component can therefore be empty). By the way,
preattestations are present in a block if and only if the locked round
component is non-empty and if so, the locked round has to match the
round of the included preattestations.</p>
<p>Next, we provide two examples of fitness values:
<code class="docutils literal notranslate"><span class="pre">02::00001000::::ffffffff::00000000</span></code> and
<code class="docutils literal notranslate"><span class="pre">02::00001000::00000000::fffffffe::00000001</span></code> (in the hexadecimal
format that one may observe in the node’s logs). These two values have
the following components:</p>
<ul class="simple">
<li><p>the 1st component, <code class="docutils literal notranslate"><span class="pre">02</span></code>, is the fitness version;</p></li>
<li><p>the 2nd component, <code class="docutils literal notranslate"><span class="pre">00001000</span></code>, is the block’s level (level 4096);</p></li>
<li><p>the 3rd component is the block’s locked round: empty in the first case, 0 in the second;</p></li>
<li><p>the 4th component is the round of the predecessor block, here 0 in the first case and 1 in the second case;</p></li>
<li><p>the 5th component is the block’s round: 0 in the first case, 1 in the second case.</p></li>
</ul>
<p>We recall (see <a class="reference internal" href="../shell/validation.html#shell-header"><span class="std std-ref">Shell header</span></a>) that the fitness is, from the
shell’s perspective, a sequence of sequences of unsigned bytes and
comparison is done first by the length of the sequence and then
lexicographically (both for the outer sequence, and for each of the
inner sequences). So the first fitness is smaller than the second one,
because of the third component, the empty bitstring being smaller than
any other bitstring.</p>
</section>
<section id="further-external-resources">
<h2>Further External Resources<a class="headerlink" href="#further-external-resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Tenderbake <a class="reference external" href="https://arxiv.org/abs/2001.11965">report</a></p></li>
<li><p>Tenderbake <a class="reference external" href="https://research-development.nomadic-labs.com/a-look-ahead-to-tenderbake.html">blog post</a>.</p></li>
<li><p>Tenderbake <a class="reference external" href="https://gitlab.com/tezos/tzip/-/blob/081c7691c24722ff15d2d0dfca9457f6f4d76fa2/drafts/current/draft_tenderbake.md">tzip</a>.</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="randomness_generation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Randomness generation</p>
      </div>
    </a>
    <a class="right-next"
       href="voting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Amendment (and Voting) Process</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#history">History</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transaction-and-block-finality">Transaction and block finality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-between-blocks">Time between blocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validator-selection-staked-balance-and-active-stake">Validator selection: staked balance and active stake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#economic-incentives">Economic Incentives</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fees">Fees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rewards">Rewards</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#slashing-paris">Slashing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consensus-related-protocol-parameters">Consensus related protocol parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shell-protocol-interaction-revisited">Shell-protocol interaction revisited</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-external-resources">Further External Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nomadic Labs <contact@nomadic-labs.com>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2023, Nomadic Labs &lt;contact@nomadic-labs.com&gt;.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>