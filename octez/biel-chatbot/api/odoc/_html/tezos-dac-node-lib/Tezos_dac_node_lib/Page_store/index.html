<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Page_store (tezos-dac-node-lib.Tezos_dac_node_lib.Page_store)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-dac-node-lib</a> &#x00BB; <a href="../index.html">Tezos_dac_node_lib</a> &#x00BB; Page_store</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_dac_node_lib.Page_store</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Reveal_data_path_not_a_directory"><a href="#extension-decl-Reveal_data_path_not_a_directory" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> += </span></code><ol><li id="extension-Reveal_data_path_not_a_directory" class="def variant extension anchored"><a href="#extension-Reveal_data_path_not_a_directory" class="anchor"></a><code><span>| </span><span><span class="extension">Reveal_data_path_not_a_directory</span> <span class="keyword">of</span> string</span></code></li><li id="extension-Cannot_create_reveal_data_dir" class="def variant extension anchored"><a href="#extension-Cannot_create_reveal_data_dir" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_create_reveal_data_dir</span> <span class="keyword">of</span> string</span></code></li><li id="extension-Cannot_write_page_to_page_storage" class="def variant extension anchored"><a href="#extension-Cannot_write_page_to_page_storage" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_write_page_to_page_storage</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Page_store.hash" class="def record field anchored"><a href="#module-Page_store.hash" class="anchor"></a><code><span>hash : string;</span></code></li><li id="module-Page_store.content" class="def record field anchored"><a href="#module-Page_store.content" class="anchor"></a><code><span>content : bytes;</span></code></li></ol><code><span>}</span></code></li><li id="extension-Cannot_read_page_from_page_storage" class="def variant extension anchored"><a href="#extension-Cannot_read_page_from_page_storage" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_read_page_from_page_storage</span> <span class="keyword">of</span> string</span></code></li><li id="extension-Incorrect_page_hash" class="def variant extension anchored"><a href="#extension-Incorrect_page_hash" class="anchor"></a><code><span>| </span><span><span class="extension">Incorrect_page_hash</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Page_store.expected" class="def record field anchored"><a href="#module-Page_store.expected" class="anchor"></a><code><span>expected : <a href="../../../tezos-dac-lib/Tezos_dac_lib/Dac_plugin/index.html#type-raw_hash">Tezos_dac_lib.Dac_plugin.raw_hash</a>;</span></code></li><li id="module-Page_store.actual" class="def record field anchored"><a href="#module-Page_store.actual" class="anchor"></a><code><span>actual : <a href="../../../tezos-dac-lib/Tezos_dac_lib/Dac_plugin/index.html#type-raw_hash">Tezos_dac_lib.Dac_plugin.raw_hash</a>;</span></code></li></ol><code><span>}</span></code></li><li id="extension-Cannot_fetch_remote_page_with_flooding_strategy" class="def variant extension anchored"><a href="#extension-Cannot_fetch_remote_page_with_flooding_strategy" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_fetch_remote_page_with_flooding_strategy</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Page_store.hash" class="def record field anchored"><a href="#module-Page_store.hash" class="anchor"></a><code><span>hash : <a href="../../../tezos-dac-lib/Tezos_dac_lib/Dac_plugin/index.html#type-raw_hash">Tezos_dac_lib.Dac_plugin.raw_hash</a>;</span></code></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>S</code> is the module type defining the backend required for persisting DAC pages data onto the page storage.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Filesystem"><a href="#module-Filesystem" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Filesystem/index.html">Filesystem</a></span><span> : <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-configuration">configuration</a> = string</span></span></code></div><div class="spec-doc"><p><code>Filesystem</code> is an implementation of the page store backed up by the local filesystem. The configuration is a string denoting the path where files will be saved. A page is saved as a file whose name is the hex encoded hash of its content.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-remote_configuration"><a href="#type-remote_configuration" class="anchor"></a><code><span><span class="keyword">type</span> remote_configuration</span><span> = </span><span>{</span></code><ol><li id="type-remote_configuration.cctxt" class="def record field anchored"><a href="#type-remote_configuration.cctxt" class="anchor"></a><code><span>cctxt : <a href="../../../tezos-dac-client-lib/Tezos_dac_client_lib/Dac_node_client/class-type-cctxt/index.html">Tezos_dac_client_lib.Dac_node_client.cctxt</a>;</span></code></li><li id="type-remote_configuration.page_store" class="def record field anchored"><a href="#type-remote_configuration.page_store" class="anchor"></a><code><span>page_store : <a href="Filesystem/index.html#type-t">Filesystem.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The configuration type for page stores that fetch pages remotely, when they are not available on the local page store. The parameter <code>cctxt</code> corresponds to the client context used to connect to the remote host for fetching pages.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Remote"><a href="#module-Remote" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Remote/index.html">Remote</a></span><span> : <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-configuration">configuration</a> = <a href="#type-remote_configuration">remote_configuration</a></span></span></code></div><div class="spec-doc"><p>A <code>Page_store</code> implementation backed by the local filesystem, which uses a connection to a Dac node to retrieve pages that are not saved locally.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-remote_with_flooding_configuration"><a href="#type-remote_with_flooding_configuration" class="anchor"></a><code><span><span class="keyword">type</span> remote_with_flooding_configuration</span><span> = </span><span>{</span></code><ol><li id="type-remote_with_flooding_configuration.timeout" class="def record field anchored"><a href="#type-remote_with_flooding_configuration.timeout" class="anchor"></a><code><span>timeout : float;</span></code></li><li id="type-remote_with_flooding_configuration.cctxts" class="def record field anchored"><a href="#type-remote_with_flooding_configuration.cctxts" class="anchor"></a><code><span>cctxts : <span><a href="../../../tezos-dac-client-lib/Tezos_dac_client_lib/Dac_node_client/class-type-cctxt/index.html">Tezos_dac_client_lib.Dac_node_client.cctxt</a> list</span>;</span></code></li><li id="type-remote_with_flooding_configuration.page_store" class="def record field anchored"><a href="#type-remote_with_flooding_configuration.page_store" class="anchor"></a><code><span>page_store : <a href="Filesystem/index.html#type-t">Filesystem.t</a>;</span></code></li></ol><code><span>}</span></code></div></div><p>A <code>Page_store</code> implementation backed by the local filesystem, which uses connections to a collection of Dac nodes to retrieve pages that are not saved locally. It retrieves pages by sending the same page request to each remote node and saves only 1 copy of the page locally.</p><p>It is typically used by the Observer node to retrieve missing pages from the DAC committee members.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Remote_with_flooding"><a href="#module-Remote_with_flooding" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Remote_with_flooding/index.html">Remote_with_flooding</a></span><span> : 
  <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-configuration">configuration</a> = <a href="#type-remote_with_flooding_configuration">remote_with_flooding_configuration</a></span></span></code></div><div class="spec-doc"><p>TODO: https://gitlab.com/tezos/tezos/-/issues/5672 Merge Remote_with_flooding into Remote</p></div></div></div></body></html>
