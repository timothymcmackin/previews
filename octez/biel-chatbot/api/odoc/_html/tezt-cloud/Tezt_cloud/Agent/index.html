<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Agent (tezt-cloud.Tezt_cloud.Agent)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-cloud</a> &#x00BB; <a href="../index.html">Tezt_cloud</a> &#x00BB; Agent</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_cloud.Agent</span></code></h1><p>An agent is a middleware to communicate with a remote host.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Datatype for an agent</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="optlabel">?zone</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ssh_id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?point</span>:<span>(string * int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">configuration</span>:<a href="../Configuration/index.html#type-t">Configuration.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">next_available_port</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make ?zone ?ssh_id ?point ~configuration ~next_available_port ~name ()</code> creates an <code>agent</code> from the given parameters. <code>~next_available_port</code> should always provide an available port or raise <code>Not_found</code> otherwise. <code>~name</code> is the name of the agent. <code>?ssh_id</code> and <code>?point</code> are used to potentially create a <code>runner</code> for the <code>agent</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-t">t</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encode an agent configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>name agent</code> returns the name of the agent. This is the same as the name provided in the agent configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-point"><a href="#val-point" class="anchor"></a><code><span><span class="keyword">val</span> point : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(string * int)</span> option</span></span></code></div><div class="spec-doc"><p><code>point agent</code> returns the point asociated with the agent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_available_port"><a href="#val-next_available_port" class="anchor"></a><code><span><span class="keyword">val</span> next_available_port : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>next_available_port agent</code> returns the next available port for this agent. Raises <code>Not_found</code> if no port is available.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-runner"><a href="#val-runner" class="anchor"></a><code><span><span class="keyword">val</span> runner : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Tezt</span>.Runner.t option</span></span></code></div><div class="spec-doc"><p><code>runner agent</code> returns the runner associated with the agent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-configuration"><a href="#val-configuration" class="anchor"></a><code><span><span class="keyword">val</span> configuration : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Configuration/index.html#type-t">Configuration.t</a></span></code></div><div class="spec-doc"><p><code>configuration t</code> the configuration of the agent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cmd_wrapper"><a href="#val-cmd_wrapper" class="anchor"></a><code><span><span class="keyword">val</span> cmd_wrapper : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Tezt_cloud__.Gcloud.cmd_wrapper</span> option</span></span></code></div><div class="spec-doc"><p>A wrapper to run a command on the VM of the agent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-host_run_command"><a href="#val-host_run_command" class="anchor"></a><code><span><span class="keyword">val</span> host_run_command : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Tezt</span>.Process.t</span></code></div><div class="spec-doc"><p>Run a command on the host machine of the VM.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-docker_run_command"><a href="#val-docker_run_command" class="anchor"></a><code><span><span class="keyword">val</span> docker_run_command : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Tezt</span>.Process.t</span></code></div><div class="spec-doc"><p>Run a command on the docker image run by the agent.</p><p>This command should not be used outside of the <code>tezt-cloud</code> library. It does not behave well when the scenario is interrupted and the process is still running. Instead, <code>Process.spawn
    ~runner:(Agent.runner agent)</code> should be used.</p><p>The library uses it to ensure there won't be any check of the host when issuing for the first time an ssh connection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy"><a href="#val-copy" class="anchor"></a><code><span><span class="keyword">val</span> copy : 
  <span><span class="optlabel">?consistency_check</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?refresh</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?is_directory</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?destination</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">source</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>copy ?refresh ?is_directory ?destination agent ~source</code> copies the file into the <code>agent</code> directory and returns the directory where the file can be found if <code>?refresh</code> is set to <code>true</code>. It is assumed the <code>~source</code> file does not exist on the agent machine. If the parent directory does not exist, it will be created.</p><p>If <code>?refresh</code> is <code>false</code>, then the function returns the promise associated to the scenario given by <code>agent</code> and <code>?destination</code> and does not copy anything.</p><p>It returns the destination the files was copied at. If <code>?destination</code> is not set, the destination is given by <code>configuration.default_binaries_path</code> concatenated to the <code>~source</code>. Otherwise, <code>?destination</code> is returned.</p><p>If <code>configuration.docker_image</code> is an <code>Octez_release</code>, binary files won't be copied and the destination will be the same as if <code>?destination</code> was not provided.</p><p>If <code>?is_directory</code> is set, then the whole source is copied, including subdirectories.</p></div></div></div></body></html>
