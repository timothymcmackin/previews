<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Alert_manager (tezt-cloud.Tezt_cloud.Alert_manager)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-cloud</a> &#x00BB; <a href="../index.html">Tezt_cloud</a> &#x00BB; Alert_manager</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_cloud.Alert_manager</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-alert"><a href="#type-alert" class="anchor"></a><code><span><span class="keyword">type</span> alert</span></code></div><div class="spec-doc"><p>Prometheus alert.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alert"><a href="#val-alert" class="anchor"></a><code><span><span class="keyword">val</span> alert : 
  <span><span class="label">expr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">severity</span>:<span>[ `Critical <span>| `Info</span> <span>| `None</span> <span>| `Warning</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?for_</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?description</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?summary</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-alert">alert</a></span></code></div><div class="spec-doc"><p><code>alert name ~expr ~severity ?for_ ?description ?summary</code> creates an alert with:</p><ul><li><code>name</code>: alert identifier.</li><li><code>expr</code>: promQL expression that triggers the alert.</li><li><code>severity</code>: alert level (either <code>`Critical</code>, <code>`Warning</code>, <code>`Info</code> or <code>`None</code>).</li><li><code>for_</code>: optional duration before firing.</li><li><code>description</code>: optional detailed explanation.</li><li><code>summary</code>: optional brief overview.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name_of_alert"><a href="#val-name_of_alert" class="anchor"></a><code><span><span class="keyword">val</span> name_of_alert : <span><a href="#type-alert">alert</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>name_of_alert alert</code> returns the name associated with the <code>alert</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alert_template"><a href="#val-alert_template" class="anchor"></a><code><span><span class="keyword">val</span> alert_template : <span><a href="#type-alert">alert</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Jingoo</span>.Jg_types.tvalue</span></code></div><div class="spec-doc"><p>Jingoo alert template.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-config"><a href="#type-config" class="anchor"></a><code><span><span class="keyword">type</span> config</span></code></div><div class="spec-doc"><p>Configuration type for Alert manager.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_global"><a href="#val-add_global" class="anchor"></a><code><span><span class="keyword">val</span> add_global : <span><span class="label">k</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">v</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>add_global k v config</code> binds key <code>k</code> to value <code>v</code> in the configuration globals of <code>config</code>. Globals is a map of key-value pairs that defines global settings like webhook URLs and authentication tokens that apply across all alerts and receivers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_globals"><a href="#val-add_globals" class="anchor"></a><code><span><span class="keyword">val</span> add_globals : <span><span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>add_globals kvs config</code> is <code>add_global</code> for a list of key-value pairs.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-receiver"><a href="#type-receiver" class="anchor"></a><code><span><span class="keyword">type</span> receiver</span></code></div><div class="spec-doc"><p>A <code>receiver</code> defines how to send notifications (like to Slack, email, etc.) when an alert is triggered, including the destination and message format.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_receiver"><a href="#val-add_receiver" class="anchor"></a><code><span><span class="keyword">val</span> add_receiver : <span><a href="#type-receiver">receiver</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>add_receiver receiver config</code> extends the <code>config</code> with the provided <code>receiver</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slack_receiver"><a href="#val-slack_receiver" class="anchor"></a><code><span><span class="keyword">val</span> slack_receiver : 
  <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">channel</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">title</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">text</span>:string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-receiver">receiver</a></span></code></div><div class="spec-doc"><p><code>slack_receiver ~name ~channel ~text config</code> creates a <code>receiver</code> named <code>name</code>, sending notifications on the slack <code>channel</code>, with the given <code>title</code> and <code>text</code> metadata.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slack_webhook_receiver"><a href="#val-slack_webhook_receiver" class="anchor"></a><code><span><span class="keyword">val</span> slack_webhook_receiver : <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span> <a href="#type-receiver">receiver</a></span></code></div><div class="spec-doc"><p><code>slack_webhook_receiver ~name</code> creates a <code>receiver</code> named <code>name</code>, sending notifications on the channel configured on the slack side. This is a hack implemented in order to use slack receivers with modern slack webhooks in alert manager. More precisely the channel field of the payload received by slack will be the description of the alert such that it can be bound in the slack message sent by the webhook.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-group"><a href="#type-group" class="anchor"></a><code><span><span class="keyword">type</span> group</span></code></div><div class="spec-doc"><p>A group defines when and how alerts are processed, including timing parameters (group_wait, group_interval, repeat_interval), which alerts to match (alert_names), and where to send them (receiver_name).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-group"><a href="#val-group" class="anchor"></a><code><span><span class="keyword">val</span> group : 
  <span><span class="optlabel">?group_wait</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?group_interval</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?repeat_interval</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-receiver">receiver</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-group">group</a></span></code></div><div class="spec-doc"><p><code>group name receiver ?group_wait ?group_interval
    ?repeat_interval</code> creates a fresh group named <code>named</code> whose receiver is <code>receiver</code> and where:</p><ul><li><code>group_wait</code> defines how long to wait before sending a notification about new alerts. If omitted, child routes inherit the <code>group_wait</code> of the parent route.</li><li><code>group_interval</code> defines how long to wait before sending notification about new alerts for a group. If omitted, child routes inherit the <code>group_interval</code> of the parent route.</li><li><code>repeat_interval</code> defines the minimum time interval between sending two notifications about the same alert. If omitted, child routes inherit the <code>repeat_interval</code> of the parent route. The <code>repeat_interval</code> value should be a multiple of <code>group_interval</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_group"><a href="#val-add_group" class="anchor"></a><code><span><span class="keyword">val</span> add_group : <span><a href="#type-group">group</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>add_group group config</code> extends the configuration <code>config</code> with the provided <code>group</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_group"><a href="#val-with_group" class="anchor"></a><code><span><span class="keyword">val</span> with_group : <span><a href="#type-group">group</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-group">group</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-group">group</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>with_group group f config</code> updates the <code>group</code> in <code>config</code> by applying <code>f</code>. The group must be part of the config.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_group_alert"><a href="#val-add_group_alert" class="anchor"></a><code><span><span class="keyword">val</span> add_group_alert : <span><a href="#type-alert">alert</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-group">group</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-group">group</a></span></code></div><div class="spec-doc"><p><code>add_group_alert alert group</code> updates the given <code>group</code> to match against <code>alert</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_group_alerts"><a href="#val-add_group_alerts" class="anchor"></a><code><span><span class="keyword">val</span> add_group_alerts : <span><span><a href="#type-alert">alert</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-group">group</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-group">group</a></span></code></div><div class="spec-doc"><p><code>add_group_alerts alerts group</code> is <code>add_group_alert</code> for a list of alerts.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Handler"><a href="#module-Handler" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Handler/index.html">Handler</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Alert handler.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Collection"><a href="#module-Collection" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Collection/index.html">Collection</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A collection is a registery of alerts and handlers.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The alert manager service.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><a href="Collection/index.html#type-t">Collection.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>run collection alert_handlers</code> starts a new docker container in the background, using the latest Prometheus Alert Manager image. Activates the given <code>alert_handlers</code>. Note that each alert handler name must be registered in <code>collection</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span><span class="keyword">val</span> shutdown : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>shutdown t</code> shutdowns the alert manager service.</p></div></div></div></body></html>
