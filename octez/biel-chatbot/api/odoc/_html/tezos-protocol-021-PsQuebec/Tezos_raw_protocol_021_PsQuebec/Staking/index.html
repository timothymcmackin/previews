<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Staking (tezos-protocol-021-PsQuebec.Tezos_raw_protocol_021_PsQuebec.Staking)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-021-PsQuebec</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_021_PsQuebec</a> &#x00BB; Staking</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_021_PsQuebec.Staking</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Cannot_stake_with_unfinalizable_unstake_requests_to_another_delegate"><a href="#extension-decl-Cannot_stake_with_unfinalizable_unstake_requests_to_another_delegate" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Cannot_stake_with_unfinalizable_unstake_requests_to_another_delegate" class="def variant extension anchored"><a href="#extension-Cannot_stake_with_unfinalizable_unstake_requests_to_another_delegate" class="anchor"></a><code><span>| </span><span><span class="extension">Cannot_stake_with_unfinalizable_unstake_requests_to_another_delegate</span></span></code></li><li id="extension-Manual_staking_forbidden" class="def variant extension anchored"><a href="#extension-Manual_staking_forbidden" class="anchor"></a><code><span>| </span><span><span class="extension">Manual_staking_forbidden</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stake"><a href="#val-stake" class="anchor"></a><code><span><span class="keyword">val</span> stake : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">for_next_cycle_use_only_after_slashing</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">amount</span>:<span>[ <span>`At_most of <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a></span> <span><span>| `Exactly</span> of <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a></span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">sender</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delegate</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_021_PsQuebec.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>stake ctxt ~sender ~for_next_cycle_use_only_after_slashing ~delegate amount</code> add <code>amount</code> as <code>sender</code>'s stake to <code>delegate</code>.</p><p>If <code>for_next_cycle_use_only_after_slashing</code> is true, the implicit finalisation is done for the next cycle. It is meant to be used only at cycle end after the application of the slashing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-request_unstake"><a href="#val-request_unstake" class="anchor"></a><code><span><span class="keyword">val</span> request_unstake : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">for_next_cycle_use_only_after_slashing</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">sender_contract</span>:<a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delegate</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_021_PsQuebec.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>request_unstake ctxt ~for_next_cycle_use_only_after_slashing ~sender_contract ~delegate amount</code> records a request from <code>sender_contract</code> to unstake <code>amount</code> from <code>delegate</code>.</p><p>If <code>for_next_cycle_use_only_after_slashing</code> is true, the unstake request and the implicit finalisation is done for the next cycle. It is meant to be used only at cycle end after the application of the slashing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_unstake"><a href="#val-finalize_unstake" class="anchor"></a><code><span><span class="keyword">val</span> finalize_unstake : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">for_next_cycle_use_only_after_slashing</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>finalize_unstake ctxt ~for_next_cycle_use_only_after_slashing contract</code> performs the finalization of all unstake requests from <code>contract</code> that can be finalized. An unstake request can be finalized if it is old enough, specifically the requested amount must not be at stake anymore and must not be slashable anymore, i.e. after <code>consensus_rights_delay + max_slashing_period</code> after the request. Amounts are transferred from the <code>contract</code>'s delegate (at request time) unstaked frozen deposits to <code>contract</code>'s spendable balance, minus slashing the requested stake undergone in between.</p><p>If <code>for_next_cycle_use_only_after_slashing</code> is true, the finalization is done for the next cycle. It is meant to be used only at cycle end after the application of the slashing.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-staking_automation"><a href="#type-staking_automation" class="anchor"></a><code><span><span class="keyword">type</span> staking_automation</span><span> = </span></code><ol><li id="type-staking_automation.Auto_staking" class="def variant constructor anchored"><a href="#type-staking_automation.Auto_staking" class="anchor"></a><code><span>| </span><span><span class="constructor">Auto_staking</span></span></code></li><li id="type-staking_automation.Manual_staking" class="def variant constructor anchored"><a href="#type-staking_automation.Manual_staking" class="anchor"></a><code><span>| </span><span><span class="constructor">Manual_staking</span></span></code></li></ol></div><div class="spec-doc"><p>Staking can be either automated or manual. If Adaptive Issuance is enabled, staking must be manual.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-staking_automation"><a href="#val-staking_automation" class="anchor"></a><code><span><span class="keyword">val</span> staking_automation : <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-staking_automation">staking_automation</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_manual_staking_allowed"><a href="#val-check_manual_staking_allowed" class="anchor"></a><code><span><span class="keyword">val</span> check_manual_staking_allowed : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div></div></div></body></html>
