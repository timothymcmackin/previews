<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Script_ir_translator_config (tezos-protocol-021-PsQuebec.Tezos_raw_protocol_021_PsQuebec.Script_ir_translator_config)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-021-PsQuebec</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_021_PsQuebec</a> &#x00BB; Script_ir_translator_config</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_021_PsQuebec.Script_ir_translator_config</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-type_logger"><a href="#type-type_logger" class="anchor"></a><code><span><span class="keyword">type</span> type_logger</span><span> =
  <span><a href="../Alpha_context/Script/index.html#type-location">Alpha_context.Script.location</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">stack_ty_before</span>:<span><a href="../Alpha_context/Script/index.html#type-expr">Alpha_context.Script.expr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">stack_ty_after</span>:<span><a href="../Alpha_context/Script/index.html#type-expr">Alpha_context.Script.expr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>type_logger</code> is a function, whose task is to log how a stack's type is altered by some operation being logged.</p></div></div><p>LEGACY MODE is the feature of the Translator and Interpreter which allows us to distinguish between scripts already originated on chain and new ones.</p><p>The reason to treat those types of scripts differently is the evolving nature of Michelson, which sometimes requires disabling features available in previous versions. These features must be supported at all times for already originated contracts, but we still want to disable them at least for new contracts.</p><p>This distinction gives us a handy deprecation mechanism, which allows us to make sure that from a certain point on no more contract will be originated using these deprecated features. When that point time is reached, it becomes possible to patch existing contracts so that they no longer use the feature and remove it entirely.</p><p>As a side effect, legacy mode can also be used to skip checks that have already been performed and hence are guaranteed to pass.</p><div class="odoc-spec"><div class="spec type anchored" id="type-elab_config"><a href="#type-elab_config" class="anchor"></a><code><span><span class="keyword">type</span> elab_config</span><span> = </span><span>{</span></code><ol><li id="type-elab_config.type_logger" class="def record field anchored"><a href="#type-elab_config.type_logger" class="anchor"></a><code><span>type_logger : <span><a href="#type-type_logger">type_logger</a> option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A function responsible for logging stack types during typechecking. Used especially in plugins for editors and IDEs.</p><span class="comment-delim">*)</span></div></li><li id="type-elab_config.keep_extra_types_for_interpreter_logging" class="def record field anchored"><a href="#type-elab_config.keep_extra_types_for_interpreter_logging" class="anchor"></a><code><span>keep_extra_types_for_interpreter_logging : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>If set to <code>true</code>, it instructs the elaborator to retain some additional type information necessary for logging. This should never be enabled during validation to save memory occupied by cached contracts.</p><p>NOTE: if this option wasn't passed to the elaborator and the interpreter was still called with logging enabled, it might result in a crash. This cannot be helped at the moment, but since logging is never enabled during validation, we should be safe.</p><span class="comment-delim">*)</span></div></li><li id="type-elab_config.legacy" class="def record field anchored"><a href="#type-elab_config.legacy" class="anchor"></a><code><span>legacy : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>If set to true, it enables the legacy mode (see above).</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p><code>elab_config</code> is a record grouping together some flags and options shared by many of the functions in <code>Script_ir_translator</code>. It's convenient to group them together, because they're of similar types (<code>bool</code> or <code>'a option</code>), so they're easier not to mix together. It also makes for shorter and more readable function calls.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="optlabel">?type_logger</span>:<a href="#type-type_logger">type_logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?keep_extra_types_for_interpreter_logging</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">legacy</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-elab_config">elab_config</a></span></code></div><div class="spec-doc"><p><code>make ?type_logger ?logging_enabled ~legacy ()</code> creates an <code>elab_config</code> record to be passed to parsing functions in <code>Script_ir_translator</code>.</p><p>Note: <code>?logging_enabled</code> defaults to <code>false</code>, because it only ever should be set to <code>true</code> if the Translator is called from outside the protocol (i.e. from the Plugin).</p></div></div></div></body></html>
