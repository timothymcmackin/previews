<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Raw_context (tezos-protocol-021-PsQuebec.Tezos_raw_protocol_021_PsQuebec.Raw_context)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tezos-protocol-021-PsQuebec</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_021_PsQuebec</a> &#x00BB; Raw_context</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_021_PsQuebec.Raw_context</span></code></h1><p>State of the validation.</p><p>Two parts:</p><p>1. Context.t: what is stored between blocks, this includes an Irmin tree typically stored on disk and the cache (stored in RAM).</p><p>2. Additional information needed during the validation of a block but not persisted across blocks, always stored in RAM. The gas counter is here.</p><p><code>Alpha_context.t</code> is actually implemented as <code>Raw_context.t</code>. The difference is that Alpha_context.mli does not expose this so functions manipulating an Alpha_context.t are guaranteed to only access the context through the storage modules exposed in Alpha_context.mli. These modules are in charge of maintaining invariants over the structure of the context.</p></header><nav class="odoc-toc"><ul><li><a href="#errors">Errors</a></li><li><a href="#abstract-context">Abstract Context</a></li><li><a href="#generic-accessors">Generic accessors</a></li></ul></nav><div class="odoc-content"><h2 id="errors"><a href="#errors" class="anchor"></a>Errors</h2><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Too_many_internal_operations"><a href="#extension-decl-Too_many_internal_operations" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Too_many_internal_operations" class="def variant extension anchored"><a href="#extension-Too_many_internal_operations" class="anchor"></a><code><span>| </span><span><span class="extension">Too_many_internal_operations</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-missing_key_kind"><a href="#type-missing_key_kind" class="anchor"></a><code><span><span class="keyword">type</span> missing_key_kind</span><span> = </span></code><ol><li id="type-missing_key_kind.Get" class="def variant constructor anchored"><a href="#type-missing_key_kind.Get" class="anchor"></a><code><span>| </span><span><span class="constructor">Get</span></span></code></li><li id="type-missing_key_kind.Set" class="def variant constructor anchored"><a href="#type-missing_key_kind.Set" class="anchor"></a><code><span>| </span><span><span class="constructor">Set</span></span></code></li><li id="type-missing_key_kind.Del" class="def variant constructor anchored"><a href="#type-missing_key_kind.Del" class="anchor"></a><code><span>| </span><span><span class="constructor">Del</span></span></code></li><li id="type-missing_key_kind.Copy" class="def variant constructor anchored"><a href="#type-missing_key_kind.Copy" class="anchor"></a><code><span>| </span><span><span class="constructor">Copy</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-storage_error"><a href="#type-storage_error" class="anchor"></a><code><span><span class="keyword">type</span> storage_error</span><span> = </span></code><ol><li id="type-storage_error.Incompatible_protocol_version" class="def variant constructor anchored"><a href="#type-storage_error.Incompatible_protocol_version" class="anchor"></a><code><span>| </span><span><span class="constructor">Incompatible_protocol_version</span> <span class="keyword">of</span> string</span></code></li><li id="type-storage_error.Missing_key" class="def variant constructor anchored"><a href="#type-storage_error.Missing_key" class="anchor"></a><code><span>| </span><span><span class="constructor">Missing_key</span> <span class="keyword">of</span> <span>string list</span> * <a href="#type-missing_key_kind">missing_key_kind</a></span></code></li><li id="type-storage_error.Existing_key" class="def variant constructor anchored"><a href="#type-storage_error.Existing_key" class="anchor"></a><code><span>| </span><span><span class="constructor">Existing_key</span> <span class="keyword">of</span> <span>string list</span></span></code></li><li id="type-storage_error.Corrupted_data" class="def variant constructor anchored"><a href="#type-storage_error.Corrupted_data" class="anchor"></a><code><span>| </span><span><span class="constructor">Corrupted_data</span> <span class="keyword">of</span> <span>string list</span></span></code></li></ol></div><div class="spec-doc"><p>An internal storage error that should not happen</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Storage_error"><a href="#extension-decl-Storage_error" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Storage_error" class="def variant extension anchored"><a href="#extension-Storage_error" class="anchor"></a><code><span>| </span><span><span class="extension">Storage_error</span> <span class="keyword">of</span> <a href="#type-storage_error">storage_error</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Failed_to_parse_parameter"><a href="#extension-decl-Failed_to_parse_parameter" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Failed_to_parse_parameter" class="def variant extension anchored"><a href="#extension-Failed_to_parse_parameter" class="anchor"></a><code><span>| </span><span><span class="extension">Failed_to_parse_parameter</span> <span class="keyword">of</span> bytes</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Failed_to_decode_parameter"><a href="#extension-decl-Failed_to_decode_parameter" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Failed_to_decode_parameter" class="def variant extension anchored"><a href="#extension-Failed_to_decode_parameter" class="anchor"></a><code><span>| </span><span><span class="extension">Failed_to_decode_parameter</span> <span class="keyword">of</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Data_encoding/index.html#type-json">Tezos_protocol_environment_021_PsQuebec.Data_encoding.json</a>
  * string</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-storage_error"><a href="#val-storage_error" class="anchor"></a><code><span><span class="keyword">val</span> storage_error : 
  <span><a href="#type-storage_error">storage_error</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div></div><h2 id="abstract-context"><a href="#abstract-context" class="anchor"></a>Abstract Context</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Abstract view of the context. Includes a handle to the functional key-value database (<code>Context.t</code>) along with some in-memory values (gas, etc.).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-root"><a href="#type-root" class="anchor"></a><code><span><span class="keyword">type</span> root</span><span> = <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-protocol_migration_internal_message"><a href="#val-protocol_migration_internal_message" class="anchor"></a><code><span><span class="keyword">val</span> protocol_migration_internal_message : 
  <a href="../Sc_rollup_inbox_message_repr/index.html#type-internal_inbox_message">Sc_rollup_inbox_message_repr.internal_inbox_message</a></span></code></div><div class="spec-doc"><p>The internal message to be injected into the smart rollups’ shared inbox when validating the very first block of this protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-protocol_migration_serialized_message"><a href="#val-protocol_migration_serialized_message" class="anchor"></a><code><span><span class="keyword">val</span> protocol_migration_serialized_message : 
  <a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a></span></code></div><div class="spec-doc"><p>Serialized version of <a href="#val-protocol_migration_internal_message"><code>protocol_migration_internal_message</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-prepare"><a href="#val-prepare" class="anchor"></a><code><span><span class="keyword">val</span> prepare : 
  <span><span class="label">level</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Int32/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Int32.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_timestamp</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Time/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Time.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">timestamp</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Time/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Time.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">adaptive_issuance_enable</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Context/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Retrieves the state of the database and gives its abstract view. It also returns wether this is the first block validated with this version of the protocol.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-previous_protocol"><a href="#type-previous_protocol" class="anchor"></a><code><span><span class="keyword">type</span> previous_protocol</span><span> = </span></code><ol><li id="type-previous_protocol.Genesis" class="def variant constructor anchored"><a href="#type-previous_protocol.Genesis" class="anchor"></a><code><span>| </span><span><span class="constructor">Genesis</span> <span class="keyword">of</span> <a href="../Parameters_repr/index.html#type-t">Parameters_repr.t</a></span></code></li><li id="type-previous_protocol.Quebec" class="def variant constructor anchored"><a href="#type-previous_protocol.Quebec" class="anchor"></a><code><span>| </span><span><span class="constructor">Quebec</span></span></code></li><li id="type-previous_protocol.ParisC_020" class="def variant constructor anchored"><a href="#type-previous_protocol.ParisC_020" class="anchor"></a><code><span>| </span><span><span class="constructor">ParisC_020</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-prepare_first_block"><a href="#val-prepare_first_block" class="anchor"></a><code><span><span class="keyword">val</span> prepare_first_block : 
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">timestamp</span>:<a href="../../Tezos_protocol_environment_021_PsQuebec/Time/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Time.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Chain_id/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Context/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-previous_protocol">previous_protocol</a> * <span><a href="../Constants_parametric_previous_repr/index.html#type-t">Constants_parametric_previous_repr.t</a> option</span> * <a href="#type-t">t</a>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-activate"><a href="#val-activate" class="anchor"></a><code><span><span class="keyword">val</span> activate : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Protocol_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recover"><a href="#val-recover" class="anchor"></a><code><span><span class="keyword">val</span> recover : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Context/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Context.t</a></span></code></div><div class="spec-doc"><p>Returns the state of the database resulting of operations on its abstract view</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_level"><a href="#val-current_level" class="anchor"></a><code><span><span class="keyword">val</span> current_level : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Level_repr/index.html#type-t">Level_repr.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-predecessor_timestamp"><a href="#val-predecessor_timestamp" class="anchor"></a><code><span><span class="keyword">val</span> predecessor_timestamp : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Time/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Time.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_timestamp"><a href="#val-current_timestamp" class="anchor"></a><code><span><span class="keyword">val</span> current_timestamp : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Time/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Time.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-constants"><a href="#val-constants" class="anchor"></a><code><span><span class="keyword">val</span> constants : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Constants_parametric_repr/index.html#type-t">Constants_parametric_repr.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sc_rollup"><a href="#val-sc_rollup" class="anchor"></a><code><span><span class="keyword">val</span> sc_rollup : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Constants_parametric_repr/index.html#type-sc_rollup">Constants_parametric_repr.sc_rollup</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-zk_rollup"><a href="#val-zk_rollup" class="anchor"></a><code><span><span class="keyword">val</span> zk_rollup : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Constants_parametric_repr/index.html#type-zk_rollup">Constants_parametric_repr.zk_rollup</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch_constants"><a href="#val-patch_constants" class="anchor"></a><code><span><span class="keyword">val</span> patch_constants : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Constants_parametric_repr/index.html#type-t">Constants_parametric_repr.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Constants_parametric_repr/index.html#type-t">Constants_parametric_repr.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-round_durations"><a href="#val-round_durations" class="anchor"></a><code><span><span class="keyword">val</span> round_durations : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Round_repr/Durations/index.html#type-t">Round_repr.Durations.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cycle_eras"><a href="#val-cycle_eras" class="anchor"></a><code><span><span class="keyword">val</span> cycle_eras : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Level_repr/index.html#type-cycle_eras">Level_repr.cycle_eras</a></span></code></div><div class="spec-doc"><p>Retrieve the cycle eras.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-credit_collected_fees_only_call_from_token"><a href="#val-credit_collected_fees_only_call_from_token" class="anchor"></a><code><span><span class="keyword">val</span> credit_collected_fees_only_call_from_token : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Increment the current block fee stash that will be credited to the payload producer's account at finalize_application</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-spend_collected_fees_only_call_from_token"><a href="#val-spend_collected_fees_only_call_from_token" class="anchor"></a><code><span><span class="keyword">val</span> spend_collected_fees_only_call_from_token : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Decrement the current block fee stash that will be credited to the payload producer's account at finalize_application</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_collected_fees"><a href="#val-get_collected_fees" class="anchor"></a><code><span><span class="keyword">val</span> get_collected_fees : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a></span></code></div><div class="spec-doc"><p>Returns the current block fee stash that will be credited to the payload producer's account at finalize_application</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consume_gas_limit_in_block"><a href="#val-consume_gas_limit_in_block" class="anchor"></a><code><span><span class="keyword">val</span> consume_gas_limit_in_block : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Gas_limit_repr/Arith/index.html#type-t">Gas_limit_repr.Arith.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>consume_gas_limit_in_block ctxt gas_limit</code> checks that <code>gas_limit</code> is well-formed (i.e. it does not exceed the hard gas limit per operation as defined in <code>ctxt</code>, and it is positive), then consumes <code>gas_limit</code> in the current block gas level of <code>ctxt</code>.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Gas_limit_repr.Gas_limit_too_high</code> if <code>gas_limit</code> is greater than the allowed limit for operation gas level or negative.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Block_quota_exceeded</code> if not enough gas remains in the block.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_gas_limit"><a href="#val-set_gas_limit" class="anchor"></a><code><span><span class="keyword">val</span> set_gas_limit : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Gas_limit_repr/Arith/index.html#type-t">Gas_limit_repr.Arith.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_gas_unlimited"><a href="#val-set_gas_unlimited" class="anchor"></a><code><span><span class="keyword">val</span> set_gas_unlimited : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gas_level"><a href="#val-gas_level" class="anchor"></a><code><span><span class="keyword">val</span> gas_level : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Gas_limit_repr/index.html#type-t">Gas_limit_repr.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gas_consumed"><a href="#val-gas_consumed" class="anchor"></a><code><span><span class="keyword">val</span> gas_consumed : <span><span class="label">since</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">until</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Gas_limit_repr/Arith/index.html#type-fp">Gas_limit_repr.Arith.fp</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remaining_operation_gas"><a href="#val-remaining_operation_gas" class="anchor"></a><code><span><span class="keyword">val</span> remaining_operation_gas : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Gas_limit_repr/Arith/index.html#type-fp">Gas_limit_repr.Arith.fp</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_remaining_operation_gas"><a href="#val-update_remaining_operation_gas" class="anchor"></a><code><span><span class="keyword">val</span> update_remaining_operation_gas : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Gas_limit_repr/Arith/index.html#type-fp">Gas_limit_repr.Arith.fp</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-block_gas_level"><a href="#val-block_gas_level" class="anchor"></a><code><span><span class="keyword">val</span> block_gas_level : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Gas_limit_repr/Arith/index.html#type-fp">Gas_limit_repr.Arith.fp</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_remaining_block_gas"><a href="#val-update_remaining_block_gas" class="anchor"></a><code><span><span class="keyword">val</span> update_remaining_block_gas : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Gas_limit_repr/Arith/index.html#type-fp">Gas_limit_repr.Arith.fp</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Undefined_operation_nonce"><a href="#extension-decl-Undefined_operation_nonce" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Undefined_operation_nonce" class="def variant extension anchored"><a href="#extension-Undefined_operation_nonce" class="anchor"></a><code><span>| </span><span><span class="extension">Undefined_operation_nonce</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_origination_nonce"><a href="#val-init_origination_nonce" class="anchor"></a><code><span><span class="keyword">val</span> init_origination_nonce : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Operation_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Operation_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>init_origination_nonce ctxt hash</code> initialise the origination nonce in memory from <code>hash</code>. See <code>Origination_nonce.t</code> for more information.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_origination_nonce"><a href="#val-get_origination_nonce" class="anchor"></a><code><span><span class="keyword">val</span> get_origination_nonce : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Origination_nonce/index.html#type-t">Origination_nonce.t</a>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-increment_origination_nonce"><a href="#val-increment_origination_nonce" class="anchor"></a><code><span><span class="keyword">val</span> increment_origination_nonce : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a> * <a href="../Origination_nonce/index.html#type-t">Origination_nonce.t</a>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unset_origination_nonce"><a href="#val-unset_origination_nonce" class="anchor"></a><code><span><span class="keyword">val</span> unset_origination_nonce : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>unset_origination_nonce ctxt</code> unset the origination nonce in memory. To be used only when no more origination can be done in that operation. See <code>Origination_nonce.t</code> for more information.</p></div></div><h2 id="generic-accessors"><a href="#generic-accessors" class="anchor"></a>Generic accessors</h2><div class="odoc-spec"><div class="spec type anchored" id="type-key"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> key</span><span> = <span>string list</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-value"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> value</span><span> = bytes</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span><span class="keyword">type</span> tree</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-local_context"><a href="#type-local_context" class="anchor"></a><code><span><span class="keyword">type</span> local_context</span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-T"><a href="#module-type-T" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-T/index.html">T</a></span><span> =
  <a href="../Raw_context_intf/module-type-T/index.html">Raw_context_intf.T</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-T/index.html#type-root">root</a> := <a href="#type-root">root</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-T/index.html#type-key">key</a> := <a href="#type-key">key</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-T/index.html#type-value">value</a> := <a href="#type-value">value</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-T/index.html#type-tree">tree</a> := <a href="#type-tree">tree</a></span></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="module-type-T/index.html">T</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-T/index.html#type-t">t</a> := <a href="#type-t">t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-T/index.html#type-local_context">local_context</a> := <a href="#type-local_context">local_context</a></span></span></code></summary><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Raw_context_intf/module-type-VIEW/index.html">Raw_context_intf.VIEW</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-VIEW/index.html#type-key">key</a> := <a href="#type-key">key</a></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-VIEW/index.html#type-value">value</a> := <a href="#type-value">value</a></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-VIEW/index.html#type-tree">tree</a> := <a href="#type-tree">tree</a></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-VIEW/index.html#type-t">t</a> := <a href="#type-t">t</a></span></span></code></summary><h3 id="getters"><a href="#getters" class="anchor"></a>Getters</h3><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>mem t k</code> is an Lwt promise that resolves to <code>true</code> iff <code>k</code> is bound to a value in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem_tree"><a href="#val-mem_tree" class="anchor"></a><code><span><span class="keyword">val</span> mem_tree : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>mem_tree t k</code> is like <a href="#val-mem"><code>mem</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-value">value</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get t k</code> is an Lwt promise that resolves to <code>Ok v</code> if <code>k</code> is bound to the value <code>v</code> in <code>t</code> and <code>Storage_ErrorMissing_key</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_tree"><a href="#val-get_tree" class="anchor"></a><code><span><span class="keyword">val</span> get_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tree">tree</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_tree</code> is like <a href="#val-get"><code>get</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-value">value</a> option</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find t k</code> is an Lwt promise that resolves to <code>Some v</code> if <code>k</code> is bound to the value <code>v</code> in <code>t</code> and <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_tree"><a href="#val-find_tree" class="anchor"></a><code><span><span class="keyword">val</span> find_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tree">tree</a> option</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_tree t k</code> is like <a href="#val-find"><code>find</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?offset</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?length</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <a href="#type-tree">tree</a>)</span> list</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>list t key</code> is the list of files and sub-nodes stored under <code>k</code> in <code>t</code>. The result order is not specified but is stable.</p><p><code>offset</code> and <code>length</code> are used for pagination.</p></div></div><h3 id="setters"><a href="#setters" class="anchor"></a>Setters</h3><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>init t k v</code> is an Lwt promise that resolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is unbound in <code>t</code>;</li><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>It is <code>Storage_errorExisting_key</code> if <code>k</code> is already bound in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_tree"><a href="#val-init_tree" class="anchor"></a><code><span><span class="keyword">val</span> init_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>init_tree</code> is like <a href="#val-init"><code>init</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>update t k v</code> is an Lwt promise that resolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is bound in <code>t</code>;</li><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>It is <code>Storage_errorMissing_key</code> if <code>k</code> is not already bound in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_tree"><a href="#val-update_tree" class="anchor"></a><code><span><span class="keyword">val</span> update_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>update_tree</code> is like <a href="#val-update"><code>update</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-value">value</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>If <code>k</code> was already bound in <code>t</code> to a value that is physically equal to <code>v</code>, the result of the function is a promise that resolves to <code>t</code>. Otherwise, the previous binding of <code>k</code> in <code>t</code> disappears.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_tree"><a href="#val-add_tree" class="anchor"></a><code><span><span class="keyword">val</span> add_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add_tree</code> is like <a href="#val-add"><code>add</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_existing"><a href="#val-remove_existing" class="anchor"></a><code><span><span class="keyword">val</span> remove_existing : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove_existing t k v</code> is an Lwt promise that resolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is bound in <code>t</code> to a value;</li><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_existing_tree"><a href="#val-remove_existing_tree" class="anchor"></a><code><span><span class="keyword">val</span> remove_existing_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove_existing_tree t k v</code> is an Lwt promise that reolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is bound in <code>t</code> to a tree;</li><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_or_remove"><a href="#val-add_or_remove" class="anchor"></a><code><span><span class="keyword">val</span> add_or_remove : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-value">value</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add_or_remove t k v</code> is:</p><ul><li><code>add t k x</code> if <code>v</code> is <code>Some x</code>;</li><li><code>remove t k</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_or_remove_tree"><a href="#val-add_or_remove_tree" class="anchor"></a><code><span><span class="keyword">val</span> add_or_remove_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-tree">tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add_or_remove_tree t k v</code> is:</p><ul><li><code>add_tree t k x</code> if <code>v</code> is <code>Some x</code>;</li><li><code>remove t k</code> otherwise.</li></ul></div></div><h3 id="folds"><a href="#folds" class="anchor"></a>Folds</h3><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span class="optlabel">?depth</span>:<a href="../Raw_context_intf/index.html#type-depth">Raw_context_intf.depth</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">order</span>:<span>[ `Sorted <span>| `Undefined</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">init</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>fold ?depth t root ~order ~init ~f</code> recursively folds over the trees and values of <code>t</code>. The <code>f</code> callbacks are called with a key relative to <code>root</code>. <code>f</code> is never called with an empty key for values; i.e., folding over a value is a no-op.</p><p>The depth is 0-indexed. If <code>depth</code> is set (by default it is not), then <code>f</code> is only called when the conditions described by the parameter is true:</p><ul><li><code>Eq d</code> folds over nodes and values of depth exactly <code>d</code>.</li><li><code>Lt d</code> folds over nodes and values of depth strictly less than <code>d</code>.</li><li><code>Le d</code> folds over nodes and values of depth less than or equal to <code>d</code>.</li><li><code>Gt d</code> folds over nodes and values of depth strictly more than <code>d</code>.</li><li><code>Ge d</code> folds over nodes and values of depth more than or equal to <code>d</code>.</li></ul><p>If <code>order</code> is <code>`Sorted</code> (the default), the elements are traversed in lexicographic order of their keys. For large nodes, it is memory-consuming, use <code>`Undefined</code> for a more memory efficient <code>fold</code>.</p></div></div><h3 id="hash-configurations"><a href="#hash-configurations" class="anchor"></a>Hash configurations</h3><div class="odoc-spec"><div class="spec value anchored" id="val-config"><a href="#val-config" class="anchor"></a><code><span><span class="keyword">val</span> config : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Raw_context_intf/index.html#type-config">Raw_context_intf.config</a></span></code></div><div class="spec-doc"><p><code>config t</code> is <code>t</code>'s hash configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-length"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>length t key</code> is an Lwt promise that resolves to the number of files and sub-nodes stored under <code>k</code> in <code>t</code>.</p><p>It is equivalent to <code>let+ l = list t k in List.length l</code> but has a constant-time complexity.</p><p>Most of the time, this function does not perform any I/O as the length is cached in the tree. It may perform one read to load the root node of the tree in case it has not been loaded already. The initial constant is the same between <code>list</code> and <code>length</code>. They both perform the same kind of I/O reads. While <code>list</code> usually performs a linear number of reads, <code>length</code> does at most one.</p></div></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-Tree"><a href="#module-Tree" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tree/index.html">Tree</a></span><span> : 
  <a href="../Raw_context_intf/module-type-TREE/index.html">Raw_context_intf.TREE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-TREE/index.html#type-t">t</a> := <a href="#type-t">t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-TREE/index.html#type-key">key</a> := <a href="#type-key">key</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-TREE/index.html#type-value">value</a> := <a href="#type-value">value</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Raw_context_intf/module-type-TREE/index.html#type-tree">tree</a> := <a href="#type-tree">tree</a></span></span></code></div><div class="spec-doc"><p><code>Tree</code> provides immutable, in-memory partial mirror of the context, with lazy reads and delayed writes. The trees are Merkle trees that carry the same hash as the part of the context they mirror.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Proof"><a href="#module-Proof" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Proof/index.html">Proof</a></span><span> : <a href="../Raw_context_intf/module-type-PROOF/index.html">Raw_context_intf.PROOF</a></span></code></div><div class="spec-doc"><p>Proofs are compact representations of trees which can be shared between peers.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-verifier"><a href="#type-verifier" class="anchor"></a><code><span><span class="keyword">type</span> <span>('proof, 'result) verifier</span></span><span> :=
  <span><span class="type-var">'proof</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-tree">tree</a> * <span class="type-var">'result</span>)</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-tree">tree</a> * <span class="type-var">'result</span>,
    <span>[ <span>`Proof_mismatch of string</span>
    <span><span>| `Stream_too_long</span> of string</span>
    <span><span>| `Stream_too_short</span> of string</span> ]</span>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Pervasives/index.html#type-result">Tezos_protocol_environment_021_PsQuebec.Pervasives.result</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>verify p f</code> runs <code>f</code> in checking mode. <code>f</code> is a function that takes a tree as input and returns a new version of the tree and a result. <code>p</code> is a proof, that is a minimal representation of the tree that contains what <code>f</code> should be expecting.</p><p>Therefore, contrary to trees found in a storage, the contents of the trees passed to <code>f</code> may not be available. For this reason, looking up a value at some <code>path</code> can now produce three distinct outcomes:</p><ul><li>A value <code>v</code> is present in the proof <code>p</code> and returned : <code>find tree path</code> is a promise returning <code>Some v</code>;</li><li><code>path</code> is known to have no value in <code>tree</code> : <code>find tree path</code> is a promise returning <code>None</code>; and</li><li><code>path</code> is known to have a value in <code>tree</code> but <code>p</code> does not provide it because <code>f</code> should not need it: <code>verify</code> returns an error classifying <code>path</code> as an invalid path (see below).</li></ul><p>The same semantics apply to all operations on the tree <code>t</code> passed to <code>f</code> and on all operations on the trees built from <code>f</code>.</p><p>The generated tree is the tree after <code>f</code> has completed. That tree is disconnected from any storage (i.e. <code>index</code>). It is possible to run operations on it as long as they don't require loading shallowed subtrees.</p><p>The result is <code>Error (`Msg _)</code> if the proof is rejected:</p><ul><li>For tree proofs: when <code>p.before</code> is different from the hash of <code>p.state</code>;</li><li>For tree and stream proofs: when <code>p.after</code> is different from the hash of <code>f p.state</code>;</li><li>For tree proofs: when <code>f p.state</code> tries to access invalid paths in <code>p.state</code>;</li><li>For stream proofs: when the proof is not consumed in the exact same order it was produced;</li><li>For stream proofs: when the proof is too short or not empty once <code>f</code> is done.</li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if the proof version is invalid or incompatible with the verifier.</p></li></ul></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-tree_proof"><a href="#type-tree_proof" class="anchor"></a><code><span><span class="keyword">type</span> tree_proof</span><span> := <span><a href="Proof/index.html#type-tree">Proof.tree</a> <a href="Proof/index.html#type-t">Proof.t</a></span></span></code></div><div class="spec-doc"><p>The type for tree proofs.</p><p>Guarantee that the given computation performs exactly the same state operations as the generating computation, *in some order*.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_tree_proof"><a href="#val-verify_tree_proof" class="anchor"></a><code><span><span class="keyword">val</span> verify_tree_proof : <span><span>(<a href="#type-tree_proof">tree_proof</a>, <span class="type-var">'a</span>)</span> <a href="#type-verifier">verifier</a></span></span></code></div><div class="spec-doc"><p><code>verify_tree_proof</code> is the verifier of tree proofs.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-stream_proof"><a href="#type-stream_proof" class="anchor"></a><code><span><span class="keyword">type</span> stream_proof</span><span> := <span><a href="Proof/index.html#type-stream">Proof.stream</a> <a href="Proof/index.html#type-t">Proof.t</a></span></span></code></div><div class="spec-doc"><p>The type for stream proofs.</p><p>Guarantee that the given computation performs exactly the same state operations as the generating computation, in the exact same order.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_stream_proof"><a href="#val-verify_stream_proof" class="anchor"></a><code><span><span class="keyword">val</span> verify_stream_proof : <span><span>(<a href="#type-stream_proof">stream_proof</a>, <span class="type-var">'a</span>)</span> <a href="#type-verifier">verifier</a></span></span></code></div><div class="spec-doc"><p><code>verify_stream</code> is the verifier of stream proofs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal_config"><a href="#val-equal_config" class="anchor"></a><code><span><span class="keyword">val</span> equal_config : <span><a href="../Raw_context_intf/index.html#type-config">Raw_context_intf.config</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Raw_context_intf/index.html#type-config">Raw_context_intf.config</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>The equality function for context configurations. If two context have the same configuration, they will generate the same context hashes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-project"><a href="#val-project" class="anchor"></a><code><span><span class="keyword">val</span> project : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-root">root</a></span></code></div><div class="spec-doc"><p>Internally used in <a href="../Storage_functors/index.html"><code>Storage_functors</code></a> to escape from a view.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-absolute_key"><a href="#val-absolute_key" class="anchor"></a><code><span><span class="keyword">val</span> absolute_key : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-key">key</a></span></code></div><div class="spec-doc"><p>Internally used in <a href="../Storage_functors/index.html"><code>Storage_functors</code></a> to retrieve a full key from partial key relative a view.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Block_quota_exceeded"><a href="#extension-decl-Block_quota_exceeded" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Block_quota_exceeded" class="def variant extension anchored"><a href="#extension-Block_quota_exceeded" class="anchor"></a><code><span>| </span><span><span class="extension">Block_quota_exceeded</span></span></code></li></ol></div><div class="spec-doc"><p>Raised if block gas quota is exhausted during gas consumption.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Operation_quota_exceeded"><a href="#extension-decl-Operation_quota_exceeded" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-error">Tezos_protocol_environment_021_PsQuebec.Error_monad.error</a> += </span></code><ol><li id="extension-Operation_quota_exceeded" class="def variant extension anchored"><a href="#extension-Operation_quota_exceeded" class="anchor"></a><code><span>| </span><span><span class="extension">Operation_quota_exceeded</span></span></code></li></ol></div><div class="spec-doc"><p>Raised if operation gas quota is exhausted during gas consumption.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consume_gas"><a href="#val-consume_gas" class="anchor"></a><code><span><span class="keyword">val</span> consume_gas : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Gas_limit_repr/index.html#type-cost">Gas_limit_repr.cost</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Internally used in <a href="../Storage_functors/index.html"><code>Storage_functors</code></a> to consume gas from within a view. May raise <a href="#extension-Block_quota_exceeded"><code>Block_quota_exceeded</code></a> or <a href="#extension-Operation_quota_exceeded"><code>Operation_quota_exceeded</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_enough_gas"><a href="#val-check_enough_gas" class="anchor"></a><code><span><span class="keyword">val</span> check_enough_gas : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Gas_limit_repr/index.html#type-cost">Gas_limit_repr.cost</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Check if consume_gas will fail</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-description"><a href="#val-description" class="anchor"></a><code><span><span class="keyword">val</span> description : <span><a href="#type-t">t</a> <a href="../Storage_description/index.html#type-t">Storage_description.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_local_context"><a href="#val-with_local_context" class="anchor"></a><code><span><span class="keyword">val</span> with_local_context : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key">key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-local_context">local_context</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>(<a href="#type-local_context">local_context</a> * <span class="type-var">'a</span>)</span>
      <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
      <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-t">t</a> * <span class="type-var">'a</span>)</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>with_local_context ctxt key f</code> runs function <code>f</code> over the local context at path <code>key</code> of the global <code>ctxt</code>. Using the local context <code>f</code> can perform faster context accesses under <code>key</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Local_context"><a href="#module-Local_context" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Local_context/index.html">Local_context</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Local_context</code> provides functions for local access from a specific directory.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-reset_internal_nonce"><a href="#val-reset_internal_nonce" class="anchor"></a><code><span><span class="keyword">val</span> reset_internal_nonce : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Initialize the local nonce used for preventing a script to duplicate an internal operation to replay it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fresh_internal_nonce"><a href="#val-fresh_internal_nonce" class="anchor"></a><code><span><span class="keyword">val</span> fresh_internal_nonce : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a> * int)</span> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Increments the internal operation nonce.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_internal_nonce"><a href="#val-record_internal_nonce" class="anchor"></a><code><span><span class="keyword">val</span> record_internal_nonce : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Mark an internal operation nonce as taken.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-internal_nonce_already_recorded"><a href="#val-internal_nonce_already_recorded" class="anchor"></a><code><span><span class="keyword">val</span> internal_nonce_already_recorded : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Check is the internal operation nonce has been taken.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_map_temporary_lazy_storage_ids"><a href="#val-fold_map_temporary_lazy_storage_ids" class="anchor"></a><code><span><span class="keyword">val</span> fold_map_temporary_lazy_storage_ids : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Lazy_storage_kind/Temp_ids/index.html#type-t">Lazy_storage_kind.Temp_ids.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Lazy_storage_kind/Temp_ids/index.html#type-t">Lazy_storage_kind.Temp_ids.t</a> * <span class="type-var">'res</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a> * <span class="type-var">'res</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_temporary_lazy_storage_ids_s"><a href="#val-map_temporary_lazy_storage_ids_s" class="anchor"></a><code><span><span class="keyword">val</span> map_temporary_lazy_storage_ids_s : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Lazy_storage_kind/Temp_ids/index.html#type-t">Lazy_storage_kind.Temp_ids.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>(<a href="#type-t">t</a> * <a href="../Lazy_storage_kind/Temp_ids/index.html#type-t">Lazy_storage_kind.Temp_ids.t</a>)</span>
      <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Cache"><a href="#module-Cache" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Cache/index.html">Cache</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_non_consensus_operation_hash"><a href="#val-record_non_consensus_operation_hash" class="anchor"></a><code><span><span class="keyword">val</span> record_non_consensus_operation_hash : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Operation_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Operation_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-non_consensus_operations"><a href="#val-non_consensus_operations" class="anchor"></a><code><span><span class="keyword">val</span> non_consensus_operations : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Operation_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Operation_hash.t</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-consensus_pk"><a href="#type-consensus_pk" class="anchor"></a><code><span><span class="keyword">type</span> consensus_pk</span><span> = </span><span>{</span></code><ol><li id="type-consensus_pk.delegate" class="def record field anchored"><a href="#type-consensus_pk.delegate" class="anchor"></a><code><span>delegate : <a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key_hash.t</a>;</span></code></li><li id="type-consensus_pk.consensus_pk" class="def record field anchored"><a href="#type-consensus_pk.consensus_pk" class="anchor"></a><code><span>consensus_pk : <a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key.t</a>;</span></code></li><li id="type-consensus_pk.consensus_pkh" class="def record field anchored"><a href="#type-consensus_pk.consensus_pkh" class="anchor"></a><code><span>consensus_pkh : <a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key_hash.t</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consensus_pk_encoding"><a href="#val-consensus_pk_encoding" class="anchor"></a><code><span><span class="keyword">val</span> consensus_pk_encoding : 
  <span><a href="#type-consensus_pk">consensus_pk</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Data_encoding/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_dictator_proposal_seen"><a href="#val-record_dictator_proposal_seen" class="anchor"></a><code><span><span class="keyword">val</span> record_dictator_proposal_seen : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Record that the dictator already voted in this block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dictator_proposal_seen"><a href="#val-dictator_proposal_seen" class="anchor"></a><code><span><span class="keyword">val</span> dictator_proposal_seen : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Checks whether the dictator voted in this block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_sampler_for_cycle"><a href="#val-init_sampler_for_cycle" class="anchor"></a><code><span><span class="keyword">val</span> init_sampler_for_cycle : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Cycle_repr/index.html#type-t">Cycle_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Seed_repr/index.html#type-seed">Seed_repr.seed</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-consensus_pk">consensus_pk</a> <a href="../Sampler/index.html#type-t">Sampler.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>init_sampler_for_cycle ctxt cycle seed state</code> caches the seeded stake sampler (a.k.a. <code>seed, state</code>) for <code>cycle</code> in memory for quick access.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Sampler_already_set</code> if the sampler was already cached.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sampler_for_cycle"><a href="#val-sampler_for_cycle" class="anchor"></a><code><span><span class="keyword">val</span> sampler_for_cycle : 
  <span><span class="label">read</span>:
    <span>(<span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(<a href="../Seed_repr/index.html#type-seed">Seed_repr.seed</a> * <span><a href="#type-consensus_pk">consensus_pk</a> <a href="../Sampler/index.html#type-t">Sampler.t</a></span>)</span>
        <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
        <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Cycle_repr/index.html#type-t">Cycle_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-t">t</a> * <a href="../Seed_repr/index.html#type-seed">Seed_repr.seed</a> * <span><a href="#type-consensus_pk">consensus_pk</a> <a href="../Sampler/index.html#type-t">Sampler.t</a></span>)</span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Lwt/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>sampler_for_cycle ~read ctxt cycle</code> returns the seeded stake sampler for <code>cycle</code>. The sampler is read in memory if <code>init_sampler_for_cycle</code> or <code>sampler_for_cycle</code> was previously called for the same <code>cycle</code>. Otherwise, it is read &quot;on-disk&quot; with the <code>read</code> function and then cached in <code>ctxt</code> like <code>init_sampler_for_cycle</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stake_distribution_for_current_cycle"><a href="#val-stake_distribution_for_current_cycle" class="anchor"></a><code><span><span class="keyword">val</span> stake_distribution_for_current_cycle : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Stake_repr/index.html#type-t">Stake_repr.t</a>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key_hash/Map/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key_hash.Map.t</a></span>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_021_PsQuebec.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_stake_distribution_for_current_cycle"><a href="#val-find_stake_distribution_for_current_cycle" class="anchor"></a><code><span><span class="keyword">val</span> find_stake_distribution_for_current_cycle : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Stake_repr/index.html#type-t">Stake_repr.t</a>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key_hash/Map/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key_hash.Map.t</a></span>
    option</span></span></code></div><div class="spec-doc"><p>Like <code>stake_distribution_for_current_cycle</code> but returns <code>None</code> rather than an error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_stake_distribution_for_current_cycle"><a href="#val-init_stake_distribution_for_current_cycle" class="anchor"></a><code><span><span class="keyword">val</span> init_stake_distribution_for_current_cycle : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Stake_repr/index.html#type-t">Stake_repr.t</a>
    <a href="../../Tezos_protocol_environment_021_PsQuebec/Signature/Public_key_hash/Map/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Signature.Public_key_hash.Map.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reward_coeff_for_current_cycle"><a href="#val-reward_coeff_for_current_cycle" class="anchor"></a><code><span><span class="keyword">val</span> reward_coeff_for_current_cycle : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Tezos_protocol_environment_021_PsQuebec/Q/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Q.t</a></span></code></div><div class="spec-doc"><p>Returns the reward coefficient for the current cycle This value is equal to the value in <a href="../Storage/Issuance_coeff/index.html"><code>Storage.Issuance_coeff</code></a> if it exists, or equal to <code>Q.one</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_reward_coeff_for_current_cycle"><a href="#val-update_reward_coeff_for_current_cycle" class="anchor"></a><code><span><span class="keyword">val</span> update_reward_coeff_for_current_cycle : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_021_PsQuebec/Q/index.html#type-t">Tezos_protocol_environment_021_PsQuebec.Q.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Updates the reward coefficient for the current cycle. This update should only be called once per cycle. It is done in <code>Adaptive_issuance_storage</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-adaptive_issuance_enable"><a href="#val-adaptive_issuance_enable" class="anchor"></a><code><span><span class="keyword">val</span> adaptive_issuance_enable : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Returns true if adaptive issuance has launched.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_adaptive_issuance_enable"><a href="#val-set_adaptive_issuance_enable" class="anchor"></a><code><span><span class="keyword">val</span> set_adaptive_issuance_enable : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Set the feature flag of adaptive issuance.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-CONSENSUS"><a href="#module-type-CONSENSUS" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-CONSENSUS/index.html">CONSENSUS</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Consensus"><a href="#module-Consensus" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Consensus/index.html">Consensus</a></span><span> : 
  <a href="module-type-CONSENSUS/index.html">CONSENSUS</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-CONSENSUS/index.html#type-t">t</a> := <a href="#type-t">t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-CONSENSUS/index.html#type-slot">slot</a> := <a href="../Slot_repr/index.html#type-t">Slot_repr.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <span>'a <a href="module-type-CONSENSUS/index.html#type-slot_map">slot_map</a></span> := <span><span class="type-var">'a</span> <a href="../Slot_repr/Map/index.html#type-t">Slot_repr.Map.t</a></span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-CONSENSUS/index.html#type-slot_set">slot_set</a> := <a href="../Slot_repr/Set/index.html#type-t">Slot_repr.Set.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-CONSENSUS/index.html#type-round">round</a> := <a href="../Round_repr/index.html#type-t">Round_repr.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-CONSENSUS/index.html#type-consensus_pk">consensus_pk</a> := <a href="#type-consensus_pk">consensus_pk</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Sc_rollup_in_memory_inbox"><a href="#module-Sc_rollup_in_memory_inbox" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sc_rollup_in_memory_inbox/index.html">Sc_rollup_in_memory_inbox</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal"><a href="#module-Dal" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Dal/index.html">Dal</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
