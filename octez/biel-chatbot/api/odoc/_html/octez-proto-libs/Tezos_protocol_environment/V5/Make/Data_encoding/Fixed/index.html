<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fixed (octez-proto-libs.Tezos_protocol_environment.V5.Make.Data_encoding.Fixed)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">octez-proto-libs</a> &#x00BB; <a href="../../../../index.html">Tezos_protocol_environment</a> &#x00BB; <a href="../../../index.html">V5</a> &#x00BB; <a href="../../index.html">Make</a> &#x00BB; <a href="../index.html">Data_encoding</a> &#x00BB; Fixed</nav><header class="odoc-preamble"><h1>Module <code><span>Data_encoding.Fixed</span></code></h1><p>Create encodings that produce data of a fixed length when binary encoded. See the preamble for an explanation.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <a href="../index.html#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the argument is less or equal to zero.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bytes"><a href="#val-bytes" class="anchor"></a><code><span><span class="keyword">val</span> bytes : <span>int <span class="arrow">&#45;&gt;</span></span> <span>bytes <a href="../index.html#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the argument is less or equal to zero.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_padding"><a href="#val-add_padding" class="anchor"></a><code><span><span class="keyword">val</span> add_padding : <span><span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p><code>add_padding e n</code> is a padded version of the encoding <code>e</code>. In Binary, there are <code>n</code> null bytes (<code>\000</code>) added after the value encoded by <code>e</code>. In JSON, padding is ignored.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if <code>n &lt;= 0</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="../index.html#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p><code>list n e</code> is an encoding for lists of exactly <code>n</code> elements. If a list of more or fewer elements is provided, then the encoding fails with the <code>write_error List_invalid_length</code>. For decoding, it can fail with <code>read_error Not_enough_data</code> or <code>read_error Extra_bytes</code>, or it may cause other failures further down the line when the AST traversal becomes out-of-sync with the underlying byte-stream traversal.</p><p>The difference of the errors being used when encoding and decoding is because when encoding we have access to the list and we can check the actual length, whereas when decoding we only see bytes, sometimes too many, sometimes not enough.</p><p>This encoding has a narrow set of possible applications because it is very restrictive. Still, it can to:</p><ul><li>mirror static guarantees about the length of some lists,</li><li>special-case some common lengths of typical input in a union (see example below),</li><li>other ends.</li></ul><pre class="language-ocaml"><code>type expr =
  | Op of string * expr list (* most commonly 1 or 2 operands *)
  | Literal of string
let expr_encoding =
  mu &quot;expr&quot; (fun e -&gt;
    union [
      case ~title:&quot;op-nonary&quot; (Tag 0)
        string
        (function Op (op, []) -&gt; Some op | _ -&gt; None)
        (fun op -&gt; Op (op, []));
      case ~title:&quot;op-unary&quot; (Tag 1)
        (tup2 string (Fixed.list 1 e))
        (function Op (op, ([_]) as operand) -&gt; Some (op, operand) | _ -&gt; None)
        (fun (op, operand) -&gt; Op (op, operand));
      case ~title:&quot;op-binary&quot; (Tag 2)
        (tup2 string (Fixed.list 2 e))
        (function Op (op, ([_;_]) as operand) -&gt; Some (op, operand) | _ -&gt; None)
        (fun (op, operand) -&gt; Op (op, operand));
      case ~title:&quot;op-moreary&quot; (Tag 3)
        (tup2 string (list e))
        (function Op (op, operand) -&gt; Some (op, operand) | _ -&gt; None)
        (fun (op, operand) -&gt; Op (op, operand));
      case ~title:&quot;literal&quot; (Tag 4)
        string
        (function Literal l -&gt; Some l | _ -&gt; None)
        (fun l -&gt; Literal l);
        ]
  )</code></pre><p>Interestingly, the cases for known lengths can be generated programmatically.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the argument <code>n</code> is less or equal to zero.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the argument <code>e</code> is a <code>`Variable</code>-size encoding or a zero-byte encoding.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-array"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> array</span> <a href="../index.html#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>See <code>list</code> above.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the argument <code>n</code> is less or equal to zero.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the argument <code>e</code> is a <code>`Variable</code>-size encoding or a zero-byte encoding.</p></li></ul></div></div></div></body></html>
