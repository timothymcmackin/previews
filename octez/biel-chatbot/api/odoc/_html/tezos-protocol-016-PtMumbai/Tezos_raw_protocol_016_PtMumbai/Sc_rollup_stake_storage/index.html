<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sc_rollup_stake_storage (tezos-protocol-016-PtMumbai.Tezos_raw_protocol_016_PtMumbai.Sc_rollup_stake_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-016-PtMumbai</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_016_PtMumbai</a> &#x00BB; Sc_rollup_stake_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_016_PtMumbai.Sc_rollup_stake_storage</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-remove_staker"><a href="#val-remove_staker" class="anchor"></a><code><span><span class="keyword">val</span> remove_staker : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/Staker/index.html#type-t">Sc_rollup_repr.Staker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove_staker context rollup staker</code> forcibly removes the given <code>staker</code> and confiscates their frozen deposits.</p><p>Removes <code>staker</code> from the list of active stakers on the <code>rollup</code> and clean its metadata.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-publish_commitment"><a href="#val-publish_commitment" class="anchor"></a><code><span><span class="keyword">val</span> publish_commitment : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/Staker/index.html#type-t">Sc_rollup_repr.Staker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_commitment_repr/index.html#type-t">Sc_rollup_commitment_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a>
   * <a href="../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a>
   * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>
   * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>publish_commitment context rollup staker commitment</code> published <code>commitment</code>.</p><p>Starts by depositing a stake for <code>staker</code> if <code>staker</code> is not a known staker of <code>rollup</code>. Then, <code>staker</code> will use its stake to stake on <code>commitment</code>.</p><p>For publishing to succeed, the following must hold:</p><ol><li>A deposit exists (or can be deposited) for <code>staker</code>.</li><li>The commitment respects the commitment period and is not published in advance.</li><li>The commitment is not past the curfew, i.e., stakers has a limit on the available time to publish, if a staker already published for this inbox level.</li><li>The <code>commitment.predecessor</code> exists.</li><li>The <code>commitment</code> contains at least one tick.</li></ol><p>Returns the hash of the given commitment, the level when the commitment was first published by some staker, the modified context and the balance updates if a stake was deposited.</p><p>This function does not authenticate the staker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cement_commitment"><a href="#val-cement_commitment" class="anchor"></a><code><span><span class="keyword">val</span> cement_commitment : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Sc_rollup_commitment_repr/index.html#type-t">Sc_rollup_commitment_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>cement_commitment context rollup commitment</code> cements the given commitment whose hash is given (and returns the corresponding commitment).</p><p>For cementing to succeed, the following must hold:</p><ol><li>The deadline for <code>commitment</code> must have passed.</li><li>The predecessor of <code>commitment</code> must be the Last Cemented Commitment.</li><li>There must be at least one staker.</li><li>All stakers must be indirectly staked on <code>commitment</code>.</li></ol><p>If successful, Last Cemented commitment is set to the given <code>commitment</code>, and deallocate the old cemented commitment accordingly to the number of stored cemented commitments.</p><p>Clean the storage for the metadata added for this inbox level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_staker"><a href="#val-find_staker" class="anchor"></a><code><span><span class="keyword">val</span> find_staker : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/Staker/index.html#type-t">Sc_rollup_repr.Staker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_staker context rollup staker</code> returns the most recent commitment <code>staker</code> staked on, or <code>None</code> if its last staked commitment is older or equal than the last cemented commitment.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_staked_on"><a href="#val-is_staked_on" class="anchor"></a><code><span><span class="keyword">val</span> is_staked_on : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/Staker/index.html#type-t">Sc_rollup_repr.Staker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * bool)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>is_staked_on context rollup staker commitment_hash</code> returns true iff <code>staker</code> is an active staker and has staked on <code>commitment_hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commitments_uncarbonated"><a href="#val-commitments_uncarbonated" class="anchor"></a><code><span><span class="keyword">val</span> commitments_uncarbonated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rollup</span>:<a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">inbox_level</span>:<a href="../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> list</span> option</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>commitments_uncarbonated ctxt ~rollup ~inbox_level</code> returns the list of commitments associated to <code>rollup</code> at <code>inbox_level</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stakers_ids_uncarbonated"><a href="#val-stakers_ids_uncarbonated" class="anchor"></a><code><span><span class="keyword">val</span> stakers_ids_uncarbonated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rollup</span>:<a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">commitment</span>:<a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Sc_rollup_staker_index_repr/index.html#type-t">Sc_rollup_staker_index_repr.t</a> list</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>stakers_ids_uncarbonated ctxt ~rollup ~commitment</code> returns the list of stakers' indexes associated to <code>rollup</code> for a specific <code>commitment</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-staker_id_uncarbonated"><a href="#val-staker_id_uncarbonated" class="anchor"></a><code><span><span class="keyword">val</span> staker_id_uncarbonated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rollup</span>:<a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">pkh</span>:<a href="../../Tezos_protocol_environment_016_PtMumbai/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_016_PtMumbai.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Sc_rollup_staker_index_repr/index.html#type-t">Sc_rollup_staker_index_repr.t</a>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>staker_id_uncarbonated ctxt ~rollup ~pkh</code> returns the staker's index associated to the public key hash <code>pkh</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stakers_pkhs_uncarbonated"><a href="#val-stakers_pkhs_uncarbonated" class="anchor"></a><code><span><span class="keyword">val</span> stakers_pkhs_uncarbonated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rollup</span>:<a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Tezos_protocol_environment_016_PtMumbai/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_016_PtMumbai.Signature.public_key_hash</a> list</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>stakers_pkhs_uncarbonated ctxt ~rollup</code> returns the public key hashes of stakers that are currently actively staking on <code>rollup</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-withdraw_stake"><a href="#val-withdraw_stake" class="anchor"></a><code><span><span class="keyword">val</span> withdraw_stake : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/Staker/index.html#type-t">Sc_rollup_repr.Staker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>withdraw_stake context rollup staker</code> removes <code>staker</code> and cleans its metadata. <code>staker</code> is allowed to withdraw if it latest staked commitment is older than the last cemented commitment.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commitments_of_inbox_level"><a href="#val-commitments_of_inbox_level" class="anchor"></a><code><span><span class="keyword">val</span> commitments_of_inbox_level : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> list</span>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>commitments_of_inbox_level ctxt rollup inbox_level</code> returns the list of commitments for <code>inbox_level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stakers_of_commitment"><a href="#val-stakers_of_commitment" class="anchor"></a><code><span><span class="keyword">val</span> stakers_of_commitment : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Sc_rollup_staker_index_repr/index.html#type-t">Sc_rollup_staker_index_repr.t</a> list</span>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>stakers_of_commitment ctxt rollup commitment_hash</code> returns the list of stakers staking on <code>commitment_hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_commitment_of_staker_in_commitments"><a href="#val-find_commitment_of_staker_in_commitments" class="anchor"></a><code><span><span class="keyword">val</span> find_commitment_of_staker_in_commitments : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_staker_index_repr/index.html#type-t">Sc_rollup_staker_index_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_commitment_of_staker_in_commitments ctxt rollup staker_index commitments</code> selects in <code>commitments</code> the hash of the commitment staked by <code>staker_index</code>, if any.</p></div></div></div></body></html>
