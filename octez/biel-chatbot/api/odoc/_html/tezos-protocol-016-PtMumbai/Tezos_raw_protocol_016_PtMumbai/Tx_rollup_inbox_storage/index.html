<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tx_rollup_inbox_storage (tezos-protocol-016-PtMumbai.Tezos_raw_protocol_016_PtMumbai.Tx_rollup_inbox_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tezos-protocol-016-PtMumbai</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_016_PtMumbai</a> &#x00BB; Tx_rollup_inbox_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_016_PtMumbai.Tx_rollup_inbox_storage</span></code></h1><p>Functions to manipulate transaction rollup’s inboxes.</p><p>Except explicit mention of the contrary, all the functions of this module are carbonated.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-append_message"><a href="#val-append_message" class="anchor"></a><code><span><span class="keyword">val</span> append_message : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_repr/index.html#type-t">Tx_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_state_repr/index.html#type-t">Tx_rollup_state_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_message_repr/index.html#type-t">Tx_rollup_message_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a>
   * <a href="../Tx_rollup_state_repr/index.html#type-t">Tx_rollup_state_repr.t</a>
   * <a href="../../Tezos_protocol_environment_016_PtMumbai/Z/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Z.t</a>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>append_message ctxt tx_rollup state message</code> tries to append <code>message</code> to the inbox of <code>tx_rollup</code> at the current level, creating it in the process if need be. This function returns the size of the appended message (in bytes), in order for the appropriate burn to be taken from the message author, the new state, as well as the storage size diff. It is the caller's responsibility to store the returned state.</p><p><b>Note:</b> <code>tx_rollup</code> needs to be a valid transaction address. It is the responsibility of the caller to assert it.</p><p>Returns the error</p><ul><li><code>Inbox_size_would_exceed_limit</code> if appending <code>message</code> to the inbox would make it exceed the maximum size specified by the <code>tx_rollup_hard_size_limit_per_inbox</code> protocol parameter.</li><li><code>Message_size_exceeds_limit</code> if the size of <code>message</code> is greater than the <code>tx_rollup_hard_size_limit_per_message</code> protocol parameter.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_level_repr/index.html#type-t">Tx_rollup_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_repr/index.html#type-t">Tx_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Tx_rollup_inbox_repr/index.html#type-t">Tx_rollup_inbox_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get ctxt level tx_rollup</code> returns the inbox of <code>tx_rollup</code> at level <code>level</code>.</p><p>Returns the errors</p><ul><li><code>Inbox_does_not_exist</code> iff <code>tx_rollup</code> does not have an inbox at level <code>level</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_level_repr/index.html#type-t">Tx_rollup_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_repr/index.html#type-t">Tx_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Tx_rollup_inbox_repr/index.html#type-t">Tx_rollup_inbox_repr.t</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find ctxt level tx_rollup</code> returns the inbox of <code>tx_rollup</code> at level <code>level</code>.</p><p>Returns <code>None</code> when the similar function <code>get</code> returns an error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_level_repr/index.html#type-t">Tx_rollup_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_repr/index.html#type-t">Tx_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove ctxt level tx_rollup</code> removes from the context the inbox of <code>level</code>.</p><p>It is expected that this function is only called for inboxes that has been “adopted” by a commitment. As a consequence, the storage accounting is not performed by this function.</p><p>This function will returns the error <code>Inbox_does_not_exist</code> if there is no inbox for <code>level</code> in the storage. It is the reponsibility of the caller to ensure the <code>tx_rollup</code> actually exists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_message_hash"><a href="#val-check_message_hash" class="anchor"></a><code><span><span class="keyword">val</span> check_message_hash : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_level_repr/index.html#type-t">Tx_rollup_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_repr/index.html#type-t">Tx_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">position</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_message_repr/index.html#type-t">Tx_rollup_message_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tx_rollup_inbox_repr/Merkle/index.html#type-path">Tx_rollup_inbox_repr.Merkle.path</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_016_PtMumbai/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_016_PtMumbai.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_016_PtMumbai/Lwt/index.html#type-t">Tezos_protocol_environment_016_PtMumbai.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>check_message_hash ctxt level tx_rollup position message path</code> checks that <code>message</code> is part of the <code>tx_rollup</code> inbox for <code>level</code> by checking the merkelised proof given by <code>path</code>.</p><p>If the proof failed, returns <code>Wrong_message_path</code>.</p></div></div></div></body></html>
