<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Token (tezos-protocol-013-PtJakart.Tezos_raw_protocol_013_PtJakart.Token)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-013-PtJakart</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_013_PtJakart</a> &#x00BB; Token</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_013_PtJakart.Token</span></code></h1><p>The aim of this module is to manage operations involving tokens such as minting, transferring, and burning. Every constructor of the types <code>source</code>, <code>container</code>, or <code>sink</code> represents a kind of account that holds a given (or possibly infinite) amount of tokens.</p><p>Tokens can be transferred from a <code>source</code> to a <code>sink</code>. To uniformly handle all cases, special constructors of sources and sinks may be used. For example, the source <code>`Minted</code> is used to express a transfer of minted tokens to a destination, and the sink <code>`Burned</code> is used to express the action of burning a given amount of tokens taken from a source. Thanks to uniformity, it is easier to track transfers of tokens throughout the protocol by running <code>grep -R &quot;Token.transfer&quot; src/proto_alpha</code>.</p></header><div class="odoc-content"><p><code>container</code> is the type of token holders with finite capacity, and whose assets are contained in the context. Let <code>d</code> be a delegate. Be aware that transferring to/from <code>`Delegate_balance d</code> will not update <code>d</code>'s stake, while transferring to/from <code>`Contract (Contract_repr.implicit_contract d)</code> will update <code>d</code>'s stake.</p><div class="odoc-spec"><div class="spec type anchored" id="type-container"><a href="#type-container" class="anchor"></a><code><span><span class="keyword">type</span> container</span><span> = </span><span>[ </span></code><ol><li id="type-container.Contract" class="def variant constructor anchored"><a href="#type-container.Contract" class="anchor"></a><code><span>| </span><span>`Contract <span class="keyword">of</span> <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a></span></code></li><li id="type-container.Collected_commitments" class="def variant constructor anchored"><a href="#type-container.Collected_commitments" class="anchor"></a><code><span>| </span><span>`Collected_commitments <span class="keyword">of</span> <a href="../Blinded_public_key_hash/index.html#type-t">Blinded_public_key_hash.t</a></span></code></li><li id="type-container.Delegate_balance" class="def variant constructor anchored"><a href="#type-container.Delegate_balance" class="anchor"></a><code><span>| </span><span>`Delegate_balance <span class="keyword">of</span>
  <a href="../../Tezos_protocol_environment_013_PtJakart/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Signature.Public_key_hash.t</a></span></code></li><li id="type-container.Frozen_deposits" class="def variant constructor anchored"><a href="#type-container.Frozen_deposits" class="anchor"></a><code><span>| </span><span>`Frozen_deposits <span class="keyword">of</span>
  <a href="../../Tezos_protocol_environment_013_PtJakart/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Signature.Public_key_hash.t</a></span></code></li><li id="type-container.Block_fees" class="def variant constructor anchored"><a href="#type-container.Block_fees" class="anchor"></a><code><span>| </span><span>`Block_fees</span></code></li><li id="type-container.Frozen_bonds" class="def variant constructor anchored"><a href="#type-container.Frozen_bonds" class="anchor"></a><code><span>| </span><span>`Frozen_bonds <span class="keyword">of</span> <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> * <a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a></span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-infinite_source"><a href="#type-infinite_source" class="anchor"></a><code><span><span class="keyword">type</span> infinite_source</span><span> = </span><span>[ </span></code><ol><li id="type-infinite_source.Invoice" class="def variant constructor anchored"><a href="#type-infinite_source.Invoice" class="anchor"></a><code><span>| </span><span>`Invoice</span></code></li><li id="type-infinite_source.Bootstrap" class="def variant constructor anchored"><a href="#type-infinite_source.Bootstrap" class="anchor"></a><code><span>| </span><span>`Bootstrap</span></code></li><li id="type-infinite_source.Initial_commitments" class="def variant constructor anchored"><a href="#type-infinite_source.Initial_commitments" class="anchor"></a><code><span>| </span><span>`Initial_commitments</span></code></li><li id="type-infinite_source.Revelation_rewards" class="def variant constructor anchored"><a href="#type-infinite_source.Revelation_rewards" class="anchor"></a><code><span>| </span><span>`Revelation_rewards</span></code></li><li id="type-infinite_source.Double_signing_evidence_rewards" class="def variant constructor anchored"><a href="#type-infinite_source.Double_signing_evidence_rewards" class="anchor"></a><code><span>| </span><span>`Double_signing_evidence_rewards</span></code></li><li id="type-infinite_source.Endorsing_rewards" class="def variant constructor anchored"><a href="#type-infinite_source.Endorsing_rewards" class="anchor"></a><code><span>| </span><span>`Endorsing_rewards</span></code></li><li id="type-infinite_source.Baking_rewards" class="def variant constructor anchored"><a href="#type-infinite_source.Baking_rewards" class="anchor"></a><code><span>| </span><span>`Baking_rewards</span></code></li><li id="type-infinite_source.Baking_bonuses" class="def variant constructor anchored"><a href="#type-infinite_source.Baking_bonuses" class="anchor"></a><code><span>| </span><span>`Baking_bonuses</span></code></li><li id="type-infinite_source.Minted" class="def variant constructor anchored"><a href="#type-infinite_source.Minted" class="anchor"></a><code><span>| </span><span>`Minted</span></code></li><li id="type-infinite_source.Liquidity_baking_subsidies" class="def variant constructor anchored"><a href="#type-infinite_source.Liquidity_baking_subsidies" class="anchor"></a><code><span>| </span><span>`Liquidity_baking_subsidies</span></code></li><li id="type-infinite_source.Tx_rollup_rejection_rewards" class="def variant constructor anchored"><a href="#type-infinite_source.Tx_rollup_rejection_rewards" class="anchor"></a><code><span>| </span><span>`Tx_rollup_rejection_rewards</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p><code>infinite_source</code> defines types of tokens provides which are considered to be ** of infinite capacity.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-source"><a href="#type-source" class="anchor"></a><code><span><span class="keyword">type</span> source</span><span> = </span><span>[ </span></code><ol><li id="type-source.infinite_source" class="def variant type anchored"><a href="#type-source.infinite_source" class="anchor"></a><code><span>| </span><span><a href="#type-infinite_source">infinite_source</a></span></code></li><li id="type-source.container" class="def variant type anchored"><a href="#type-source.container" class="anchor"></a><code><span>| </span><span><a href="#type-container">container</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p><code>source</code> is the type of token providers. Token providers that are not containers are considered to have infinite capacity.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-infinite_sink"><a href="#type-infinite_sink" class="anchor"></a><code><span><span class="keyword">type</span> infinite_sink</span><span> = </span><span>[ </span></code><ol><li id="type-infinite_sink.Storage_fees" class="def variant constructor anchored"><a href="#type-infinite_sink.Storage_fees" class="anchor"></a><code><span>| </span><span>`Storage_fees</span></code></li><li id="type-infinite_sink.Double_signing_punishments" class="def variant constructor anchored"><a href="#type-infinite_sink.Double_signing_punishments" class="anchor"></a><code><span>| </span><span>`Double_signing_punishments</span></code></li><li id="type-infinite_sink.Lost_endorsing_rewards" class="def variant constructor anchored"><a href="#type-infinite_sink.Lost_endorsing_rewards" class="anchor"></a><code><span>| </span><span>`Lost_endorsing_rewards <span class="keyword">of</span>
  <a href="../../Tezos_protocol_environment_013_PtJakart/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Signature.Public_key_hash.t</a>
  * bool
  * bool</span></code></li><li id="type-infinite_sink.Tx_rollup_rejection_punishments" class="def variant constructor anchored"><a href="#type-infinite_sink.Tx_rollup_rejection_punishments" class="anchor"></a><code><span>| </span><span>`Tx_rollup_rejection_punishments</span></code></li><li id="type-infinite_sink.Burned" class="def variant constructor anchored"><a href="#type-infinite_sink.Burned" class="anchor"></a><code><span>| </span><span>`Burned</span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sink"><a href="#type-sink" class="anchor"></a><code><span><span class="keyword">type</span> sink</span><span> = </span><span>[ </span></code><ol><li id="type-sink.infinite_sink" class="def variant type anchored"><a href="#type-sink.infinite_sink" class="anchor"></a><code><span>| </span><span><a href="#type-infinite_sink">infinite_sink</a></span></code></li><li id="type-sink.container" class="def variant type anchored"><a href="#type-sink.container" class="anchor"></a><code><span>| </span><span><a href="#type-container">container</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p><code>sink</code> is the type of token receivers. Token receivers that are not containers are considered to have infinite capacity.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allocated"><a href="#val-allocated" class="anchor"></a><code><span><span class="keyword">val</span> allocated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-container">container</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * bool)</span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_013_PtJakart.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Lwt/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>allocated ctxt container</code> returns a new context because of possible access to carbonated data, and a boolean that is <code>true</code> when <code>balance ctxt container</code> is guaranteed not to fail, and <code>false</code> when <code>balance ctxt container</code> may fail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-balance"><a href="#val-balance" class="anchor"></a><code><span><span class="keyword">val</span> balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-container">container</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_013_PtJakart.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Lwt/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>balance ctxt container</code> returns a new context because of an access to carbonated data, and the balance associated to the token holder. This function may fail if <code>allocated ctxt container</code> returns <code>false</code>. Returns an error with the message &quot;get_balance&quot; if <code>container</code> refers to an originated contract that is not allocated. Returns a <code>Storage_ErrorMissing_key</code> error if <code>container</code> is of the form <code>`Delegate_balance pkh</code>, where <code>pkh</code> refers to an implicit contract that is not allocated.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-transfer_n"><a href="#val-transfer_n" class="anchor"></a><code><span><span class="keyword">val</span> transfer_n : 
  <span><span class="optlabel">?origin</span>:<a href="../Receipt_repr/index.html#type-update_origin">Receipt_repr.update_origin</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span>[&lt; <a href="#type-source">source</a> ]</span> * <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; <a href="#type-sink">sink</a> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_013_PtJakart.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Lwt/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>transfer_n ?origin ctxt sources dest</code> transfers <code>amount</code> Tez from <code>src</code> to <code>dest</code> for each <code>(src, amount)</code> pair in <code>sources</code>, and returns a new context, and the list of corresponding balance updates. The function behaves as though <code>transfer src dest amount</code> was invoked for each pair <code>(src, amount)</code> in <code>sources</code>, however a single balance update is generated for the total amount transferred to <code>dest</code>. When <code>sources</code> is an empty list, the function does nothing to the context, and returns an empty list of balance updates.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-transfer"><a href="#val-transfer" class="anchor"></a><code><span><span class="keyword">val</span> transfer : 
  <span><span class="optlabel">?origin</span>:<a href="../Receipt_repr/index.html#type-update_origin">Receipt_repr.update_origin</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; <a href="#type-source">source</a> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; <a href="#type-sink">sink</a> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_013_PtJakart.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_013_PtJakart/Lwt/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>transfer ?origin ctxt src dest amount</code> transfers <code>amount</code> Tez from source <code>src</code> to destination <code>dest</code>, and returns a new context, and the list of corresponding balance updates tagged with <code>origin</code>. By default, <code>~origin</code> is set to <code>Receipt_repr.Block_application</code>. Returns <code>Storage_ErrorMissing_key</code> if <code>src</code> refers to a contract that is not allocated. Returns a <code>Balance_too_low</code> error if <code>src</code> refers to a contract whose balance is less than <code>amount</code>. Returns a <code>Subtraction_underflow</code> error if <code>src</code> refers to a source that is not a contract and whose balance is less than <code>amount</code>. Returns a <code>Empty_implicit_delegated_contract</code> error if <code>src</code> is an implicit contract that delegates to a different contract, and whose balance is equal to <code>amount</code>. Returns a <code>Non_existing_contract</code> error if <code>dest</code> refers to an originated contract that is not allocated. Returns a <code>Non_existing_contract</code> error if <code>amount &lt;&gt; Tez_repr.zero</code>, and <code>dest</code> refers to an originated contract that is not allocated. Returns a <code>Addition_overflow</code> error if <code>dest</code> refers to a sink whose balance is greater than <code>Int64.max - amount</code>. Returns a <code>Wrong_level</code> error if <code>src</code> or <code>dest</code> refer to a level that is not the current level.</p></div></div></div></body></html>
