<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (tezos-protocol-013-PtJakart.Tezos_raw_protocol_013_PtJakart.Sc_rollup_game.Make)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-protocol-013-PtJakart</a> &#x00BB; <a href="../../index.html">Tezos_raw_protocol_013_PtJakart</a> &#x00BB; <a href="../index.html">Sc_rollup_game</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Sc_rollup_game.Make</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-PVM"><a href="#argument-1-PVM" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-PVM/index.html">PVM</a></span><span> : <a href="../../Sc_rollup_PVM_sem/module-type-S/index.html">Sc_rollup_PVM_sem.S</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec module anchored" id="module-PVM"><a href="#module-PVM" class="anchor"></a><code><span><span class="keyword">module</span> <a href="PVM/index.html">PVM</a></span><span> : 
  <a href="../../Sc_rollup_PVM_sem/module-type-S/index.html">Sc_rollup_PVM_sem.S</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Sc_rollup_PVM_sem/module-type-S/index.html#type-state">state</a> = <a href="argument-1-PVM/index.html#type-state">PVM.state</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Sc_rollup_PVM_sem/module-type-S/index.html#type-proof">proof</a> = <a href="argument-1-PVM/index.html#type-proof">PVM.proof</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Sc_rollup_PVM_sem/module-type-S/index.html#type-context">context</a> = <a href="argument-1-PVM/index.html#type-context">PVM.context</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-tick"><a href="#type-tick" class="anchor"></a><code><span><span class="keyword">type</span> tick</span><span> = <a href="../../Sc_rollup_tick_repr/index.html#type-t">Sc_rollup_tick_repr.t</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Section"><a href="#module-Section" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Section/index.html">Section</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-player"><a href="#type-player" class="anchor"></a><code><span><span class="keyword">type</span> player</span><span> = </span></code><ol><li id="type-player.Committer" class="def variant constructor anchored"><a href="#type-player.Committer" class="anchor"></a><code><span>| </span><span><span class="constructor">Committer</span></span></code></li><li id="type-player.Refuter" class="def variant constructor anchored"><a href="#type-player.Refuter" class="anchor"></a><code><span>| </span><span><span class="constructor">Refuter</span></span></code></li></ol></div><div class="spec-doc"><p>The game has two players. The refuter starts.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-player_encoding"><a href="#val-player_encoding" class="anchor"></a><code><span><span class="keyword">val</span> player_encoding : 
  <span><a href="#type-player">player</a> <a href="../../../Tezos_protocol_environment_013_PtJakart/Data_encoding/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_player"><a href="#val-pp_player" class="anchor"></a><code><span><span class="keyword">val</span> pp_player : 
  <span><a href="../../../Tezos_protocol_environment_013_PtJakart/Format/index.html#type-formatter">Tezos_protocol_environment_013_PtJakart.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-player">player</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-opponent"><a href="#val-opponent" class="anchor"></a><code><span><span class="keyword">val</span> opponent : <span><a href="#type-player">player</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-player">player</a></span></code></div><div class="spec-doc"><p><code>opponent player</code> is the other player.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.turn" class="def record field anchored"><a href="#type-t.turn" class="anchor"></a><code><span>turn : <a href="#type-player">player</a>;</span></code></li><li id="type-t.start_state" class="def record field anchored"><a href="#type-t.start_state" class="anchor"></a><code><span>start_state : <a href="PVM/index.html#type-hash">PVM.hash</a>;</span></code></li><li id="type-t.start_at" class="def record field anchored"><a href="#type-t.start_at" class="anchor"></a><code><span>start_at : <a href="#type-tick">tick</a>;</span></code></li><li id="type-t.player_stop_state" class="def record field anchored"><a href="#type-t.player_stop_state" class="anchor"></a><code><span>player_stop_state : <a href="PVM/index.html#type-hash">PVM.hash</a>;</span></code></li><li id="type-t.opponent_stop_state" class="def record field anchored"><a href="#type-t.opponent_stop_state" class="anchor"></a><code><span>opponent_stop_state : <a href="PVM/index.html#type-hash">PVM.hash</a>;</span></code></li><li id="type-t.stop_at" class="def record field anchored"><a href="#type-t.stop_at" class="anchor"></a><code><span>stop_at : <a href="#type-tick">tick</a>;</span></code></li><li id="type-t.current_dissection" class="def record field anchored"><a href="#type-t.current_dissection" class="anchor"></a><code><span>current_dissection : <span><a href="Section/index.html#type-dissection">Section.dissection</a> option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A game state is characterized by:</p><ul><li><code>turn</code>, the player that must provide the next move.</li></ul><ul><li><code>start_state/start_at</code>, the state the two players agree on.</li></ul><ul><li><code>player_stop_state</code> and <code>opponent_stop_state</code> are distinct as the two players disagree on the final state.</li></ul><ul><li><code>stop_at</code> is the position of the final state.</li></ul><ul><li>If the cardinal of <code>current_dissection</code> is strictly greater than 1, the current player must choose one of its section and produce a dissection of this section.</li></ul><ul><li>If the cardinal of <code>current_dissection</code> is equal to 1, the game has reached its second phase and the current player must provide a proof of the execution step at <code>start_at</code>.</li></ul><p>Invariants: -----------</p><ul><li><code>current_dissection</code> cannot be empty.</li><li><code>start_at</code> is strictly less than <code>stop_at</code>.</li><li><code>player_stop_state</code> is distinct from <code>opponent_stop_state</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-t">t</a> <a href="../../../Tezos_protocol_environment_013_PtJakart/Data_encoding/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../../Tezos_protocol_environment_013_PtJakart/Format/index.html#type-formatter">Tezos_protocol_environment_013_PtJakart.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-conflict_resolution_step"><a href="#type-conflict_resolution_step" class="anchor"></a><code><span><span class="keyword">type</span> conflict_resolution_step</span><span> = </span></code><ol><li id="type-conflict_resolution_step.Refine" class="def variant constructor anchored"><a href="#type-conflict_resolution_step.Refine" class="anchor"></a><code><span>| </span><span><span class="constructor">Refine</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-conflict_resolution_step.stop_state" class="def record field anchored"><a href="#type-conflict_resolution_step.stop_state" class="anchor"></a><code><span>stop_state : <a href="PVM/index.html#type-hash">PVM.hash</a>;</span></code></li><li id="type-conflict_resolution_step.next_dissection" class="def record field anchored"><a href="#type-conflict_resolution_step.next_dissection" class="anchor"></a><code><span>next_dissection : <a href="Section/index.html#type-dissection">Section.dissection</a>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Assuming a current <code>dissection</code>, a <code>section</code> has been chosen and <code>next_dissection</code> is a dissection of this section. <code>stop_state</code> is a state which is different from the one exposed in for the <code>section</code> in the current <code>dissection</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-conflict_resolution_step.Conclude" class="def variant constructor anchored"><a href="#type-conflict_resolution_step.Conclude" class="anchor"></a><code><span>| </span><span><span class="constructor">Conclude</span> <span class="keyword">of</span> <span><a href="../../Sc_rollup_PVM_sem/index.html#type-input">Sc_rollup_PVM_sem.input</a> option</span> * <a href="PVM/index.html#type-proof">PVM.proof</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>When the current <code>dissection</code> contains a single section of length 1, the conflict tick has been found. The player provides a <code>PVM.proof</code> to demonstrate that her final state is the correct one.</p><p>If the current state is an input state (see <a href="../../Sc_rollup_PVM_sem/index.html"><code>Sc_rollup_PVM_sem</code></a>), the player must provide the <code>input</code> received by the PVM. Notice that the validity of this <code>input</code> is externally verified using the <code>Sc_rollup_inbox</code> proofs.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The conflict resolution is done in two phases: the refinement phase composed of refinement steps and a final step, the conclusion.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-move"><a href="#type-move" class="anchor"></a><code><span><span class="keyword">type</span> move</span><span> = </span></code><ol><li id="type-move.ConflictInside" class="def variant constructor anchored"><a href="#type-move.ConflictInside" class="anchor"></a><code><span>| </span><span><span class="constructor">ConflictInside</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-move.choice" class="def record field anchored"><a href="#type-move.choice" class="anchor"></a><code><span>choice : <a href="Section/index.html#type-section">Section.section</a>;</span></code></li><li id="type-move.conflict_resolution_step" class="def record field anchored"><a href="#type-move.conflict_resolution_step" class="anchor"></a><code><span>conflict_resolution_step : <a href="#type-conflict_resolution_step">conflict_resolution_step</a>;</span></code></li></ol><code><span>}</span></code></li></ol></div><div class="spec-doc"><p>A game move is a conflict resolution step performed in a given section of the PVM execution trace.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-commit"><a href="#type-commit" class="anchor"></a><code><span><span class="keyword">type</span> commit</span><span> = </span></code><ol><li id="type-commit.Commit" class="def variant constructor anchored"><a href="#type-commit.Commit" class="anchor"></a><code><span>| </span><span><span class="constructor">Commit</span> <span class="keyword">of</span> <a href="Section/index.html#type-section">Section.section</a></span></code></li></ol></div><div class="spec-doc"><p>To start the game, the committer must have made a section public...</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-refutation"><a href="#type-refutation" class="anchor"></a><code><span><span class="keyword">type</span> refutation</span><span> = </span></code><ol><li id="type-refutation.RefuteByConflict" class="def variant constructor anchored"><a href="#type-refutation.RefuteByConflict" class="anchor"></a><code><span>| </span><span><span class="constructor">RefuteByConflict</span> <span class="keyword">of</span> <a href="#type-conflict_resolution_step">conflict_resolution_step</a></span></code></li></ol></div><div class="spec-doc"><p>... and the refuter must have started a dispute.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-reason"><a href="#type-reason" class="anchor"></a><code><span><span class="keyword">type</span> reason</span><span> = </span></code><ol><li id="type-reason.InvalidMove" class="def variant constructor anchored"><a href="#type-reason.InvalidMove" class="anchor"></a><code><span>| </span><span><span class="constructor">InvalidMove</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>One of the player did not respect the game rules, typically by providing a refinement step which is inconsistent with the current dissection.</p><span class="comment-delim">*)</span></div></li><li id="type-reason.ConflictResolved" class="def variant constructor anchored"><a href="#type-reason.ConflictResolved" class="anchor"></a><code><span>| </span><span><span class="constructor">ConflictResolved</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The game reached the conclusion and the arbiter was able to determine how the conflict must be resolved in conformance with the PVM semantics.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The game can stop for two reasons:</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_reason"><a href="#val-pp_reason" class="anchor"></a><code><span><span class="keyword">val</span> pp_reason : 
  <span><a href="../../../Tezos_protocol_environment_013_PtJakart/Format/index.html#type-formatter">Tezos_protocol_environment_013_PtJakart.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-reason">reason</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-outcome"><a href="#type-outcome" class="anchor"></a><code><span><span class="keyword">type</span> outcome</span><span> = </span><span>{</span></code><ol><li id="type-outcome.winner" class="def record field anchored"><a href="#type-outcome.winner" class="anchor"></a><code><span>winner : <span><a href="#type-player">player</a> option</span>;</span></code></li><li id="type-outcome.reason" class="def record field anchored"><a href="#type-outcome.reason" class="anchor"></a><code><span>reason : <a href="#type-reason">reason</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The game can end with no winner if both players have wrong final states at the conflicting step.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_outcome"><a href="#val-pp_outcome" class="anchor"></a><code><span><span class="keyword">val</span> pp_outcome : 
  <span><a href="../../../Tezos_protocol_environment_013_PtJakart/Format/index.html#type-formatter">Tezos_protocol_environment_013_PtJakart.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-outcome">outcome</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-move_result"><a href="#type-move_result" class="anchor"></a><code><span><span class="keyword">type</span> move_result</span><span> = </span></code><ol><li id="type-move_result.Over" class="def variant constructor anchored"><a href="#type-move_result.Over" class="anchor"></a><code><span>| </span><span><span class="constructor">Over</span> <span class="keyword">of</span> <a href="#type-outcome">outcome</a></span></code></li><li id="type-move_result.Ongoing" class="def variant constructor anchored"><a href="#type-move_result.Ongoing" class="anchor"></a><code><span>| </span><span><span class="constructor">Ongoing</span> <span class="keyword">of</span> <a href="#type-t">t</a></span></code></li></ol></div><div class="spec-doc"><p>After one game move, the game can be over or ongoing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_move"><a href="#val-pp_move" class="anchor"></a><code><span><span class="keyword">val</span> pp_move : 
  <span><a href="../../../Tezos_protocol_environment_013_PtJakart/Format/index.html#type-formatter">Tezos_protocol_environment_013_PtJakart.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-move">move</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initial"><a href="#val-initial" class="anchor"></a><code><span><span class="keyword">val</span> initial : <span><a href="#type-commit">commit</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-conflict_resolution_step">conflict_resolution_step</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <a href="#type-move">move</a></span></code></div><div class="spec-doc"><p><code>initial</code> is the initial game state from the commit and the refutation. The first player to play is the refuter, this function also returns refuter's first move.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-play"><a href="#val-play" class="anchor"></a><code><span><span class="keyword">val</span> play : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-move">move</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-move_result">move_result</a> <a href="../../../Tezos_protocol_environment_013_PtJakart/Lwt/index.html#type-t">Tezos_protocol_environment_013_PtJakart.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>play game move</code> returns the result of the given <code>move</code> applied on <code>game</code>.</p></div></div></div></body></html>
