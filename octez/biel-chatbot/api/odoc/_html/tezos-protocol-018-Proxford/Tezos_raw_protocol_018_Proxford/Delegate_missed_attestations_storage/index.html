<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Delegate_missed_attestations_storage (tezos-protocol-018-Proxford.Tezos_raw_protocol_018_Proxford.Delegate_missed_attestations_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-018-Proxford</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_018_Proxford</a> &#x00BB; Delegate_missed_attestations_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_018_Proxford.Delegate_missed_attestations_storage</span></code></h1><p>This modules deals with delegates' participation in consensus.</p><p>This module is responsible for maintaining the <code>Storage.Contract.Missed_attestations</code> table.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-expected_slots_for_given_active_stake"><a href="#val-expected_slots_for_given_active_stake" class="anchor"></a><code><span><span class="keyword">val</span> expected_slots_for_given_active_stake : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">total_active_stake_weight</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">active_stake_weight</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  int</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-level_participation"><a href="#type-level_participation" class="anchor"></a><code><span><span class="keyword">type</span> level_participation</span><span> = </span></code><ol><li id="type-level_participation.Participated" class="def variant constructor anchored"><a href="#type-level_participation.Participated" class="anchor"></a><code><span>| </span><span><span class="constructor">Participated</span></span></code></li><li id="type-level_participation.Didn't_participate" class="def variant constructor anchored"><a href="#type-level_participation.Didn't_participate" class="anchor"></a><code><span>| </span><span><span class="constructor">Didn't_participate</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_attesting_participation"><a href="#val-record_attesting_participation" class="anchor"></a><code><span><span class="keyword">val</span> record_attesting_participation : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delegate</span>:<a href="../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">participation</span>:<a href="#type-level_participation">level_participation</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">attesting_power</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Record the participation of a delegate as a validator.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_baking_activity_and_pay_rewards_and_fees"><a href="#val-record_baking_activity_and_pay_rewards_and_fees" class="anchor"></a><code><span><span class="keyword">val</span> record_baking_activity_and_pay_rewards_and_fees : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">payload_producer</span>:
    <a href="../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_producer</span>:
    <a href="../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">baking_reward</span>:<a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">reward_bonus</span>:<span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Sets the payload and block producer as active. Pays the baking reward and the fees to the payload producer and the reward bonus to the payload producer (if the reward_bonus is not None).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_and_reset_delegate_participation"><a href="#val-check_and_reset_delegate_participation" class="anchor"></a><code><span><span class="keyword">val</span> check_and_reset_delegate_participation : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * bool)</span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Check that a delegate participated enough in the last cycle (returns <code>true</code> if it did), and then reset the participation for preparing the next cycle.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-participation_info"><a href="#type-participation_info" class="anchor"></a><code><span><span class="keyword">type</span> participation_info</span><span> = </span><span>{</span></code><ol><li id="type-participation_info.expected_cycle_activity" class="def record field anchored"><a href="#type-participation_info.expected_cycle_activity" class="anchor"></a><code><span>expected_cycle_activity : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The total expected slots to be attested in the cycle. (static)</p><span class="comment-delim">*)</span></div></li><li id="type-participation_info.minimal_cycle_activity" class="def record field anchored"><a href="#type-participation_info.minimal_cycle_activity" class="anchor"></a><code><span>minimal_cycle_activity : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The minimal attesting slots in the cycle to get attesting rewards. (static)</p><span class="comment-delim">*)</span></div></li><li id="type-participation_info.missed_slots" class="def record field anchored"><a href="#type-participation_info.missed_slots" class="anchor"></a><code><span>missed_slots : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of missed attesting slots in the cycle. (dynamic)</p><span class="comment-delim">*)</span></div></li><li id="type-participation_info.missed_levels" class="def record field anchored"><a href="#type-participation_info.missed_levels" class="anchor"></a><code><span>missed_levels : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of missed attesting levels in the cycle. (dynamic)</p><span class="comment-delim">*)</span></div></li><li id="type-participation_info.remaining_allowed_missed_slots" class="def record field anchored"><a href="#type-participation_info.remaining_allowed_missed_slots" class="anchor"></a><code><span>remaining_allowed_missed_slots : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Remaining amount of attesting slots that can be missed in the cycle before forfeiting the rewards. (dynamic)</p><span class="comment-delim">*)</span></div></li><li id="type-participation_info.expected_attesting_rewards" class="def record field anchored"><a href="#type-participation_info.expected_attesting_rewards" class="anchor"></a><code><span>expected_attesting_rewards : <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Attesting rewards that will be distributed at the end of the cycle if activity at that point will be greater than the minimal required. If the activity is already known to be below the required minimum, then the rewards are zero. (dynamic)</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Participation information. We denote by:</p><ul><li>&quot;static&quot; information that does not change during the cycle</li><li>&quot;dynamic&quot; information that may change during the cycle</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-participation_info"><a href="#val-participation_info" class="anchor"></a><code><span><span class="keyword">val</span> participation_info : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-participation_info">participation_info</a>
    <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Only use this function for RPC: this is expensive.</p><p><code>delegate_participation_info</code> and <code>!val:check_delegate</code> forms the implementation of RPC call &quot;/context/delegates/&lt;pkh&gt;/participation&quot;.</p></div></div></div></body></html>
