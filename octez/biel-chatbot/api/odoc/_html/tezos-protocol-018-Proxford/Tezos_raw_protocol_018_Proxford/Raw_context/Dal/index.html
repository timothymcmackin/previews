<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dal (tezos-protocol-018-Proxford.Tezos_raw_protocol_018_Proxford.Raw_context.Dal)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-protocol-018-Proxford</a> &#x00BB; <a href="../../index.html">Tezos_raw_protocol_018_Proxford</a> &#x00BB; <a href="../index.html">Raw_context</a> &#x00BB; Dal</nav><header class="odoc-preamble"><h1>Module <code><span>Raw_context.Dal</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-cryptobox"><a href="#type-cryptobox" class="anchor"></a><code><span><span class="keyword">type</span> cryptobox</span><span> = <a href="../../../Tezos_protocol_environment_018_Proxford/Dal/index.html#type-t">Tezos_protocol_environment_018_Proxford.Dal.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-cryptobox">cryptobox</a> <a href="../../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-number_of_slots"><a href="#val-number_of_slots" class="anchor"></a><code><span><span class="keyword">val</span> number_of_slots : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_attested_shards"><a href="#val-record_attested_shards" class="anchor"></a><code><span><span class="keyword">val</span> record_attested_shards : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Dal_attestation_repr/index.html#type-t">Dal_attestation_repr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int list</span> <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-t">t</a></span></code></div><div class="spec-doc"><p><code>record_attested_shards ctxt attestation shards</code> records that the list of shards <code>shards</code> were attested (declared available by some attester). The function assumes that a shard belongs to the interval <code>0; number_of_shards - 1</code>. Otherwise, for each shard outside this interval, it is a no-op.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_slot_header"><a href="#val-register_slot_header" class="anchor"></a><code><span><span class="keyword">val</span> register_slot_header : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Dal_slot_repr/Header/index.html#type-t">Dal_slot_repr.Header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-t">t</a> <a href="../../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>register_slot_header ctxt slot_header</code> returns a new context where the new candidate <code>slot</code> have been taken into account. Returns <code>Some (ctxt,updated)</code> where <code>updated=true</code> if the candidate is registered. <code>Some (ctxt,false)</code> if another candidate was already registered previously. Returns an error if the slot is invalid.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-candidates"><a href="#val-candidates" class="anchor"></a><code><span><span class="keyword">val</span> candidates : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Dal_slot_repr/Header/index.html#type-t">Dal_slot_repr.Header.t</a> list</span></span></code></div><div class="spec-doc"><p><code>candidates ctxt</code> returns the current list of slot for which there is at least one candidate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_slot_index_attested"><a href="#val-is_slot_index_attested" class="anchor"></a><code><span><span class="keyword">val</span> is_slot_index_attested : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Dal_slot_index_repr/index.html#type-t">Dal_slot_index_repr.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_slot_index_attested ctxt slot_index</code> returns <code>true</code> if the <code>slot_index</code> is declared available by the protocol. <code>false</code> otherwise. If the <code>index</code> is out of the interval <code>0;number_of_slots - 1</code>, returns <code>false</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shards_of_attester"><a href="#val-shards_of_attester" class="anchor"></a><code><span><span class="keyword">val</span> shards_of_attester : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">attester</span>:<a href="../../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>int list</span> option</span></span></code></div><div class="spec-doc"><p><code>shards_of_attester ctxt ~attester</code> returns the shard assignment of the DAL committee of the current level for <code>attester</code>. This function never returns an empty list.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-committee"><a href="#type-committee" class="anchor"></a><code><span><span class="keyword">type</span> committee</span><span> = </span><span>{</span></code><ol><li id="type-committee.pkh_to_shards" class="def record field anchored"><a href="#type-committee.pkh_to_shards" class="anchor"></a><code><span>pkh_to_shards : <span><span>(<a href="../../Dal_attestation_repr/index.html#type-shard_index">Dal_attestation_repr.shard_index</a> * int)</span>
                  <a href="../../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/Map/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.Map.t</a></span>;</span></code></li><li id="type-committee.shard_to_pkh" class="def record field anchored"><a href="#type-committee.shard_to_pkh" class="anchor"></a><code><span>shard_to_pkh : <span><a href="../../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a>
                 <a href="../../Dal_attestation_repr/Shard_map/index.html#type-t">Dal_attestation_repr.Shard_map.t</a></span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The DAL committee is a subset of the Tenderbake committee. A shard from <code>0;number_of_shards</code> is associated to a public key hash. For efficiency reasons, the committee is both: a mapping from public key hashes to shards and a mapping from shards to public key hashes. The DAL committee ensures the shards associated to the same public key hash are contiguous. The list of shards is represented as two natural numbers <code>(initial, power)</code> which encodes the list of shards: <code>initial; initial + 1; ... ; initial + power - 1</code>.</p><p>This data-type ensures the following invariants:</p><ul><li>\forall pkh shard, find pkh_to_shards pkh = Some (start,n) -&gt; \forall i, i \in <code>start; start + n - 1</code> -&gt; find shard_to_pkh i = Some pkh</li></ul><ul><li>forall pkh shard, find shard_to_pkh shard = Some pkh -&gt; \exists (start,n), find pkh_to_shards pkh = Some (start,n) /\ start &lt;= shard &lt;= start + n - 1</li></ul><ul><li>Given an attester, all its shard assignments are contiguous</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_committee"><a href="#val-compute_committee" class="anchor"></a><code><span><span class="keyword">val</span> compute_committee : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../Slot_repr/index.html#type-t">Slot_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>(<a href="../index.html#type-t">t</a> * <a href="../../../Tezos_protocol_environment_018_Proxford/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Signature.Public_key_hash.t</a>)</span>
      <a href="../../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
      <a href="../../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-committee">committee</a> <a href="../../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>compute_committee ctxt pkh_from_tenderbake_slot</code> computes the DAL committee using the <code>pkh_from_tenderbake_slot</code> function. This functions takes into account the fact that the DAL committee and the Tenderbake committee may have different sizes. If the DAL committee is smaller, then we simply take a projection of the Tenderbake committee for the first <code>n</code> slots. If the DAL committee is larger, shards are computed modulo the Tenderbake committee. Slots assignments are reordered for a given a public key hash to ensure all the slots (or shards in the context of DAL) shards are contiguous (see <a href="#type-committee"><code>committee</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_committee"><a href="#val-init_committee" class="anchor"></a><code><span><span class="keyword">val</span> init_committee : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-committee">committee</a> <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-t">t</a></span></code></div><div class="spec-doc"><p><code>init_committee ctxt committee</code> returns a context where the <code>committee</code> is cached. The committee is expected to be the one for the current level.</p></div></div></div></body></html>
