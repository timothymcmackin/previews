<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Script_tc_context (tezos-protocol-018-Proxford.Tezos_raw_protocol_018_Proxford.Script_tc_context)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-018-Proxford</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_018_Proxford</a> &#x00BB; Script_tc_context</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_018_Proxford.Script_tc_context</span></code></h1><p>This module defines the typechecking context used during the translation from Michelson untyped nodes to typed nodes (<code>Script_ir_translator</code>). The context keeps track of the origin of the code (top-level from a contract, in a view, etc.), plus some information to allow or forbid instructions given the context (no `SELF` in a lambda for example).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-in_lambda"><a href="#type-in_lambda" class="anchor"></a><code><span><span class="keyword">type</span> in_lambda</span><span> = bool</span></code></div><div class="spec-doc"><p>Lambdas are a bit special when considering stateful instructions such as <code>TRANSFER_TOKENS</code>. For instance, a view containing a <code>TRANSFER_TOKENS</code> is not OK, because calling the view would transfer tokens from the view's owner. However, a view returning a lambda containing a <code>TRANSFER_TOKENS</code> could be considered OK, as the decision whether to execute it or not falls on the view's caller, whose tokens would be transfered. This type is used to keep track of whether we are inside a lambda: it is <code>true</code> when inside a lambda, and <code>false</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-callsite"><a href="#type-callsite" class="anchor"></a><code><span><span class="keyword">type</span> callsite</span><span> = </span></code><ol><li id="type-callsite.Toplevel" class="def variant constructor anchored"><a href="#type-callsite.Toplevel" class="anchor"></a><code><span>| </span><span><span class="constructor">Toplevel</span> : </span><span>{</span></code><ol><li id="type-callsite.storage_type" class="def record field anchored"><a href="#type-callsite.storage_type" class="anchor"></a><code><span>storage_type : <span><span>(<span class="type-var">'sto</span>, <span class="type-var">_</span>)</span> <a href="../Script_typed_ir/index.html#type-ty">Script_typed_ir.ty</a></span>;</span></code></li><li id="type-callsite.param_type" class="def record field anchored"><a href="#type-callsite.param_type" class="anchor"></a><code><span>param_type : <span><span>(<span class="type-var">'param</span>, <span class="type-var">_</span>)</span> <a href="../Script_typed_ir/index.html#type-ty">Script_typed_ir.ty</a></span>;</span></code></li><li id="type-callsite.entrypoints" class="def record field anchored"><a href="#type-callsite.entrypoints" class="anchor"></a><code><span>entrypoints : <span><span class="type-var">'param</span> <a href="../Script_typed_ir/index.html#type-entrypoints">Script_typed_ir.entrypoints</a></span>;</span></code></li></ol><code><span>}</span><span> <span class="arrow">&#45;&gt;</span> <a href="#type-callsite">callsite</a></span></code></li><li id="type-callsite.View" class="def variant constructor anchored"><a href="#type-callsite.View" class="anchor"></a><code><span>| </span><span><span class="constructor">View</span> : <a href="#type-callsite">callsite</a></span></code></li><li id="type-callsite.Data" class="def variant constructor anchored"><a href="#type-callsite.Data" class="anchor"></a><code><span>| </span><span><span class="constructor">Data</span> : <a href="#type-callsite">callsite</a></span></code></li></ol></div><div class="spec-doc"><p>The calling context when parsing Michelson code: either a top-level contract code, the code of a view, or code in data (when pushing a block of instructions for example).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.callsite" class="def record field anchored"><a href="#type-t.callsite" class="anchor"></a><code><span>callsite : <a href="#type-callsite">callsite</a>;</span></code></li><li id="type-t.in_lambda" class="def record field anchored"><a href="#type-t.in_lambda" class="anchor"></a><code><span>in_lambda : <a href="#type-in_lambda">in_lambda</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span><a href="#type-callsite">callsite</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-toplevel"><a href="#val-toplevel" class="anchor"></a><code><span><span class="keyword">val</span> toplevel : 
  <span><span class="label">storage_type</span>:<span><span>(<span class="type-var">'sto</span>, <span class="type-var">_</span>)</span> <a href="../Script_typed_ir/index.html#type-ty">Script_typed_ir.ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">param_type</span>:<span><span>(<span class="type-var">'param</span>, <span class="type-var">_</span>)</span> <a href="../Script_typed_ir/index.html#type-ty">Script_typed_ir.ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">entrypoints</span>:<span><span class="type-var">'param</span> <a href="../Script_typed_ir/index.html#type-entrypoints">Script_typed_ir.entrypoints</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-view"><a href="#val-view" class="anchor"></a><code><span><span class="keyword">val</span> view : <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-data"><a href="#val-data" class="anchor"></a><code><span><span class="keyword">val</span> data : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>This value can be used outside the translation module as a simple context when testing code, for example.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_lambda"><a href="#val-add_lambda" class="anchor"></a><code><span><span class="keyword">val</span> add_lambda : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_in_lambda"><a href="#val-is_in_lambda" class="anchor"></a><code><span><span class="keyword">val</span> is_in_lambda : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_not_in_view"><a href="#val-check_not_in_view" class="anchor"></a><code><span><span class="keyword">val</span> check_not_in_view : 
  <span><a href="../Alpha_context/Script/index.html#type-location">Alpha_context.Script.location</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">legacy</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Alpha_context/Script/index.html#type-prim">Alpha_context.Script.prim</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div></div></div></body></html>
