<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dal_slot_storage (tezos-protocol-018-Proxford.Tezos_raw_protocol_018_Proxford.Dal_slot_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-018-Proxford</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_018_Proxford</a> &#x00BB; Dal_slot_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_018_Proxford.Dal_slot_storage</span></code></h1><p>Storage management of slots for the data-availability layer.</p></header><nav class="odoc-toc"><ul><li><a href="#overview">Overview</a></li></ul></nav><div class="odoc-content"><h2 id="overview"><a href="#overview" class="anchor"></a>Overview</h2><p>This module is an interface for the slot storage for the layer 1.</p><p>Depending on the current level of the context and the <code>attestation_lag</code> (a constant given by the context), the status of the slot may differ:</p><ul><li>For every level in the interval <code>current_level; current_level +
    attestation_lag - 1</code> the slot is <code>Pending</code>. This means a slot header was proposed but was not declared available yet.</li></ul><ul><li>For every level above <code>current_level + attestation_lag</code>, the slot may be <code>attested</code>. For any slot attested by the protocol (i.e. indices returned by <code>finalize_pending_slots</code>), subscribers of the DAL should take into account the corresponding slots.</li></ul><ul><li>For every level below <code>current_level - attestation_lag</code>, there should not be any slot in the storage.</li></ul><div class="odoc-spec"><div class="spec value anchored" id="val-find_slot_headers"><a href="#val-find_slot_headers" class="anchor"></a><code><span><span class="keyword">val</span> find_slot_headers : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span><a href="../Dal_slot_repr/Header/index.html#type-t">Dal_slot_repr.Header.t</a> list</span> option</span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_slot_headers ctxt level</code> returns <code>Some slot_headers</code> where <code>slot_headers</code> are pending slots at level <code>level</code>. <code>None</code> is returned if no <code>slot_header</code> was registered at this level. The function fails if the reading into the context fails.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_current_slot_headers"><a href="#val-finalize_current_slot_headers" class="anchor"></a><code><span><span class="keyword">val</span> finalize_current_slot_headers : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>finalize_current_slot_headers ctxt</code> finalizes the current slot headers posted on this block and marks them as pending into the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_pending_slot_headers"><a href="#val-finalize_pending_slot_headers" class="anchor"></a><code><span><span class="keyword">val</span> finalize_pending_slot_headers : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Dal_attestation_repr/index.html#type-t">Dal_attestation_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>finalize_pending_slot_headers ctxt</code> finalizes pending slot headers which are old enough (i.e. registered at level <code>current_level -
    attestation_lag</code>). All slots marked as available are returned. All the pending slots at <code>current_level - attestation_lag</code> level are removed from the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_slot_headers_history"><a href="#val-get_slot_headers_history" class="anchor"></a><code><span><span class="keyword">val</span> get_slot_headers_history : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Dal_slot_repr/History/index.html#type-t">Dal_slot_repr.History.t</a>
    <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Lwt/index.html#type-t">Tezos_protocol_environment_018_Proxford.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_slot_headers_history ctxt</code> returns the current value of slots_history stored in <code>ctxt</code>, or Slots_history.genesis if no value is stored yet.</p></div></div></div></body></html>
