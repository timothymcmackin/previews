<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sc_rollup_inbox_merkelized_payload_hashes_repr (tezos-protocol-018-Proxford.Tezos_raw_protocol_018_Proxford.Sc_rollup_inbox_merkelized_payload_hashes_repr)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-018-Proxford</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_018_Proxford</a> &#x00BB; Sc_rollup_inbox_merkelized_payload_hashes_repr</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_018_Proxford.Sc_rollup_inbox_merkelized_payload_hashes_repr</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Merkelized_payload_hashes_proof_error"><a href="#extension-decl-Merkelized_payload_hashes_proof_error" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-error">Tezos_protocol_environment_018_Proxford.Error_monad.error</a> += </span></code><ol><li id="extension-Merkelized_payload_hashes_proof_error" class="def variant extension anchored"><a href="#extension-Merkelized_payload_hashes_proof_error" class="anchor"></a><code><span>| </span><span><span class="extension">Merkelized_payload_hashes_proof_error</span> <span class="keyword">of</span> string</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Hash"><a href="#module-Hash" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Hash/index.html">Hash</a></span><span> : 
  <a href="../../Tezos_protocol_environment_018_Proxford/S/module-type-HASH/index.html">Tezos_protocol_environment_018_Proxford.S.HASH</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_018_Proxford/S/module-type-HASH/index.html#type-t">t</a> =
           <a href="../../Tezos_protocol_environment_018_Proxford/Smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Tezos_protocol_environment_018_Proxford.Smart_rollup.Merkelized_payload_hashes_hash.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A type representing the head of a merkelized list of <a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized"><code>Sc_rollup_inbox_message_repr.serialized</code></a> message. It contains the hash of the payload and the index on the list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_018_Proxford/Data_encoding/index.html#type-t">Tezos_protocol_environment_018_Proxford.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-merkelized_and_payload"><a href="#type-merkelized_and_payload" class="anchor"></a><code><span><span class="keyword">type</span> merkelized_and_payload</span><span> = </span><span>{</span></code><ol><li id="type-merkelized_and_payload.merkelized" class="def record field anchored"><a href="#type-merkelized_and_payload.merkelized" class="anchor"></a><code><span>merkelized : <a href="#type-t">t</a>;</span></code></li><li id="type-merkelized_and_payload.payload" class="def record field anchored"><a href="#type-merkelized_and_payload.payload" class="anchor"></a><code><span>payload : <a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-History"><a href="#module-History" class="anchor"></a><code><span><span class="keyword">module</span> <a href="History/index.html">History</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A <code>History.t</code> is a lookup table of <a href="#type-merkelized_and_payload"><code>merkelized_and_payload</code></a>s. Payloads are indexed by their hash <a href="Hash/index.html#type-t"><code>Hash.t</code></a>. This history is needed in order to produce <a href="#type-proof"><code>proof</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Hash/index.html#type-t">Hash.t</a></span></code></div><div class="spec-doc"><p><code>hash merkelized</code> is the hash of <code>merkelized</code>. It is used as key to remember a merkelized payload hash in an <a href="History/index.html#type-t"><code>History.t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remember"><a href="#val-remember" class="anchor"></a><code><span><span class="keyword">val</span> remember : 
  <span><a href="History/index.html#type-t">History.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="History/index.html#type-t">History.t</a> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>remember history merkelized payload</code> remembers the <code>{merkelized; payload}</code> in <code>history</code> with key <code>hash merkelized</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-genesis_no_history"><a href="#val-genesis_no_history" class="anchor"></a><code><span><span class="keyword">val</span> genesis_no_history : <span><a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>genesis_no_history payload</code> is the initial merkelized payload hashes with index 0.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-genesis"><a href="#val-genesis" class="anchor"></a><code><span><span class="keyword">val</span> genesis : 
  <span><a href="History/index.html#type-t">History.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="History/index.html#type-t">History.t</a> * <a href="#type-t">t</a>)</span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>genesis history payload</code> is the initial merkelized payload hashes with index 0. It is remembered in <code>history</code> using <code>remember</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_payload_no_history"><a href="#val-add_payload_no_history" class="anchor"></a><code><span><span class="keyword">val</span> add_payload_no_history : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>add_payload_no_history merkelized payload</code> creates a new <a href="#type-t"><code>t</code></a> with <code>payload</code> and <code>merkelized</code> as ancestor (i.e. <code>index = succ (get_index
    merkelized)</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_payload"><a href="#val-add_payload" class="anchor"></a><code><span><span class="keyword">val</span> add_payload : 
  <span><a href="History/index.html#type-t">History.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized">Sc_rollup_inbox_message_repr.serialized</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="History/index.html#type-t">History.t</a> * <a href="#type-t">t</a>)</span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>add_payload</code> is identical to <a href="#val-add_payload_no_history"><code>add_payload_no_history</code></a> but the resulting <code>merkelized</code> is remembered in <code>history</code> with <code>remember</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../Tezos_protocol_environment_018_Proxford/Format/index.html#type-formatter">Tezos_protocol_environment_018_Proxford.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_payload_hash"><a href="#val-get_payload_hash" class="anchor"></a><code><span><span class="keyword">val</span> get_payload_hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Sc_rollup_inbox_message_repr/Hash/index.html#type-t">Sc_rollup_inbox_message_repr.Hash.t</a></span></code></div><div class="spec-doc"><p><code>get_payload_hash merkelized</code> returns the <a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized"><code>Sc_rollup_inbox_message_repr.serialized</code></a> payload's hash of <code>merkelized</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_index"><a href="#val-get_index" class="anchor"></a><code><span><span class="keyword">val</span> get_index : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Tezos_protocol_environment_018_Proxford/Z/index.html#type-t">Tezos_protocol_environment_018_Proxford.Z.t</a></span></code></div><div class="spec-doc"><p><code>get_index merkelized</code> returns the index of <code>merkelized</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-proof"><a href="#type-proof" class="anchor"></a><code><span><span class="keyword">type</span> proof</span><span> = <span class="keyword">private</span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Given two t <code>(a, b)</code> and a <a href="../Sc_rollup_inbox_message_repr/index.html#type-serialized"><code>Sc_rollup_inbox_message_repr.serialized</code></a> <code>payload</code>, a <code>proof</code> guarantees that <code>payload</code> hash is equal to <code>a</code> and that <code>a</code> is an ancestor of <code>b</code>; i.e. <code>get_index a &lt; get_index b</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_proof"><a href="#val-pp_proof" class="anchor"></a><code><span><span class="keyword">val</span> pp_proof : 
  <span><a href="../../Tezos_protocol_environment_018_Proxford/Format/index.html#type-formatter">Tezos_protocol_environment_018_Proxford.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-proof">proof</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-proof_encoding"><a href="#val-proof_encoding" class="anchor"></a><code><span><span class="keyword">val</span> proof_encoding : 
  <span><a href="#type-proof">proof</a> <a href="../../Tezos_protocol_environment_018_Proxford/Data_encoding/index.html#type-t">Tezos_protocol_environment_018_Proxford.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-produce_proof"><a href="#val-produce_proof" class="anchor"></a><code><span><span class="keyword">val</span> produce_proof : 
  <span><a href="History/index.html#type-t">History.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">index</span>:<a href="../../Tezos_protocol_environment_018_Proxford/Z/index.html#type-t">Tezos_protocol_environment_018_Proxford.Z.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-merkelized_and_payload">merkelized_and_payload</a> * <a href="#type-proof">proof</a>)</span> option</span></span></code></div><div class="spec-doc"><p><code>produce_proof history ~index into_</code> returns a <a href="#type-merkelized_and_payload"><code>merkelized_and_payload</code></a> with index <code>index</code> and a proof that it is an ancestor of <code>into_</code>. Returns <code>None</code> if no merkelized payload with <code>index</code> is found (either in the <code>history</code> or <code>index</code> is not inferior to <code>get_index into_</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_proof"><a href="#val-verify_proof" class="anchor"></a><code><span><span class="keyword">val</span> verify_proof : 
  <span><a href="#type-proof">proof</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a> * <a href="#type-t">t</a>)</span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>verify_proof proof</code> returns <code>(a, b)</code> where <code>proof</code> validates that <code>a</code> is an ancestor of <code>b</code>. Fails when <code>proof</code> is not a valid inclusion proof.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
