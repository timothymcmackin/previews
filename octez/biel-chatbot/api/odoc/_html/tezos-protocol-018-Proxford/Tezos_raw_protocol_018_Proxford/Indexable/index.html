<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Indexable (tezos-protocol-018-Proxford.Tezos_raw_protocol_018_Proxford.Indexable)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-018-Proxford</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_018_Proxford</a> &#x00BB; Indexable</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_018_Proxford.Indexable</span></code></h1><p>In transaction rollups, some values can be replaced by indexes in the messages sent from the layer-1 to the layer-2.</p><p>This module provides various type-safe helpers to manipulate these particular values.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-value_only"><a href="#type-value_only" class="anchor"></a><code><span><span class="keyword">type</span> value_only</span><span> = </span></code><ol><li id="type-value_only.Value_only" class="def variant constructor anchored"><a href="#type-value_only.Value_only" class="anchor"></a><code><span>| </span><span><span class="constructor">Value_only</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-index_only"><a href="#type-index_only" class="anchor"></a><code><span><span class="keyword">type</span> index_only</span><span> = </span></code><ol><li id="type-index_only.Index_only" class="def variant constructor anchored"><a href="#type-index_only.Index_only" class="anchor"></a><code><span>| </span><span><span class="constructor">Index_only</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unknown"><a href="#type-unknown" class="anchor"></a><code><span><span class="keyword">type</span> unknown</span><span> = </span></code><ol><li id="type-unknown.Unknown" class="def variant constructor anchored"><a href="#type-unknown.Unknown" class="anchor"></a><code><span>| </span><span><span class="constructor">Unknown</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, 'a) t</span></span><span> = <span class="keyword">private</span> </span></code><ol><li id="type-t.Value" class="def variant constructor anchored"><a href="#type-t.Value" class="anchor"></a><code><span>| </span><span><span class="constructor">Value</span> : <span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span> <span><span>(<a href="#type-value_only">value_only</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Hidden_value" class="def variant constructor anchored"><a href="#type-t.Hidden_value" class="anchor"></a><code><span>| </span><span><span class="constructor">Hidden_value</span> : <span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span> <span><span>(<a href="#type-unknown">unknown</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Index" class="def variant constructor anchored"><a href="#type-t.Index" class="anchor"></a><code><span>| </span><span><span class="constructor">Index</span> : int32 <span class="arrow">&#45;&gt;</span> <span><span>(<a href="#type-index_only">index_only</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></li><li id="type-t.Hidden_index" class="def variant constructor anchored"><a href="#type-t.Hidden_index" class="anchor"></a><code><span>| </span><span><span class="constructor">Hidden_index</span> : int32 <span class="arrow">&#45;&gt;</span> <span><span>(<a href="#type-unknown">unknown</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></li></ol></div><div class="spec-doc"><p>An indexable value is a value which can be replaced by an integer. The first type parameter determines whether or not this replacement has happened already.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-value"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a value</span></span><span> = <span><span>(<a href="#type-value_only">value_only</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>The type of indexable values identified as not being indexes.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-index"><a href="#type-index" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a index</span></span><span> = <span><span>(<a href="#type-index_only">index_only</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>The type of indexable values identified as being indexes.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-either"><a href="#type-either" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a either</span></span><span> = <span><span>(<a href="#type-unknown">unknown</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>The type of indexable values whose content is still unknown.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-value"><a href="#val-value" class="anchor"></a><code><span><span class="keyword">val</span> value : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-value">value</a></span></span></code></div><div class="spec-doc"><p><code>value v</code> wraps <code>v</code> into an indexable value identified as not being an index.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-from_value"><a href="#val-from_value" class="anchor"></a><code><span><span class="keyword">val</span> from_value : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-either">either</a></span></span></code></div><div class="spec-doc"><p><code>from_value v</code> wraps <code>v</code> into an indexable value, but forget about the nature of the content of the result.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-index"><a href="#val-index" class="anchor"></a><code><span><span class="keyword">val</span> index : 
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-index">index</a></span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>index i</code> wraps <code>i</code> into an indexable value identified as being an index.</p><p>Returns the error <code>Index_cannot_be_negative</code> iff <code>i &lt;= 0l</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-from_index"><a href="#val-from_index" class="anchor"></a><code><span><span class="keyword">val</span> from_index : 
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-either">either</a></span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_018_Proxford.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>from_index i</code> wraps <code>i</code> into an indexable value, but forget about the nature of the content of the result.</p><p>Returns the error <code>Index_cannot_be_negative</code> iff <code>i &lt;= 0l</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-index_exn"><a href="#val-index_exn" class="anchor"></a><code><span><span class="keyword">val</span> index_exn : <span>int32 <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-index">index</a></span></span></code></div><div class="spec-doc"><p><code>index_exn i</code> wraps <code>i</code> into an indexable value identified as being an index.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>iff <code>i &lt;= 0l</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-from_index_exn"><a href="#val-from_index_exn" class="anchor"></a><code><span><span class="keyword">val</span> from_index_exn : <span>int32 <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-either">either</a></span></span></code></div><div class="spec-doc"><p><code>from_index_exn i</code> wraps <code>i</code> into an indexable value, but forget about the nature of the content of the result.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>iff <code>i &lt;= 0l</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compact"><a href="#val-compact" class="anchor"></a><code><span><span class="keyword">val</span> compact : 
  <span><span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_018_Proxford/Data_encoding/index.html#type-t">Tezos_protocol_environment_018_Proxford.Data_encoding.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-unknown">unknown</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span>
    <a href="../../Tezos_protocol_environment_018_Proxford/Data_encoding/Compact/index.html#type-t">Tezos_protocol_environment_018_Proxford.Data_encoding.Compact.t</a></span></span></code></div><div class="spec-doc"><p><code>compact val_encoding</code> is a combinator to derive a compact encoding for an indexable value of type <code>'a</code> from an encoding for <code>'a</code>. It uses two bits in the shared tag. <code>00</code> is used for indexes fitting in one byte, <code>01</code> for indexes fitting in two bytes, <code>10</code> for indexes fitting in four bytes, and <code>11</code> for the values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : 
  <span><span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_018_Proxford/Data_encoding/index.html#type-t">Tezos_protocol_environment_018_Proxford.Data_encoding.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-unknown">unknown</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <a href="../../Tezos_protocol_environment_018_Proxford/Data_encoding/index.html#type-t">Tezos_protocol_environment_018_Proxford.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : 
  <span><span>(<span><a href="../../Tezos_protocol_environment_018_Proxford/Format/index.html#type-formatter">Tezos_protocol_environment_018_Proxford.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_018_Proxford/Format/index.html#type-formatter">Tezos_protocol_environment_018_Proxford.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-destruct"><a href="#val-destruct" class="anchor"></a><code><span><span class="keyword">val</span> destruct : 
  <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <a href="#type-index">index</a></span>, <span class="type-var">'a</span>)</span> <a href="../../Tezos_protocol_environment_018_Proxford/Either/index.html#type-t">Tezos_protocol_environment_018_Proxford.Either.t</a></span></span></code></div><div class="spec-doc"><p><code>destruct x</code> returns either the index or the (unwrapped) value contained in <code>x</code>.</p><p><b>Note:</b> If you want to manipulate a value of type <a href="#type-value"><code>value</code></a>, you can use <a href="#val-value"><code>value</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-forget"><a href="#val-forget" class="anchor"></a><code><span><span class="keyword">val</span> forget : <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-unknown">unknown</a>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>forget x</code> returns an indexable value whose kind of contents has been forgotten.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_int32"><a href="#val-to_int32" class="anchor"></a><code><span><span class="keyword">val</span> to_int32 : <span><span><span class="type-var">'a</span> <a href="#type-index">index</a></span> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p><code>to_int32 x</code> unwraps and returns the integer behind <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_value"><a href="#val-to_value" class="anchor"></a><code><span><span class="keyword">val</span> to_value : <span><span><span class="type-var">'a</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>to_value x</code> unwraps and returns the value behind <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_value_e"><a href="#val-is_value_e" class="anchor"></a><code><span><span class="keyword">val</span> is_value_e : 
  <span><span class="label">error</span>:<span class="type-var">'trace</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="../../Tezos_protocol_environment_018_Proxford/Pervasives/index.html#type-result">Tezos_protocol_environment_018_Proxford.Pervasives.result</a></span></span></code></div><div class="spec-doc"><p><code>is_value_e err x</code> unwraps and returns the value behind <code>x</code>, and throws an <code>err</code> if <code>x</code> is an index.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-in_memory_size"><a href="#val-in_memory_size" class="anchor"></a><code><span><span class="keyword">val</span> in_memory_size : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="../Cache_memory_helpers/index.html#type-sint">Cache_memory_helpers.sint</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Cache_memory_helpers/index.html#type-sint">Cache_memory_helpers.sint</a></span></code></div><div class="spec-doc"><p><code>in_memory_size a</code> returns the number of bytes allocated in RAM for <code>a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-size"><a href="#val-size" class="anchor"></a><code><span><span class="keyword">val</span> size : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>size a</code> returns the number of bytes allocated in an inbox to store <code>a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">val</span> compare : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'state</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'state'</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare f x y</code> is a total order on indexable values, which proceeds as follows.</p><ul><li>If both <code>x</code> and <code>y</code> are a value, then use <code>f</code> to compare them.</li><li>If both <code>x</code> and <code>y</code> are indexes, then uses the <code>Int32.compare</code> function to compare them.</li><li>Finally, if <code>x</code> and <code>y</code> have not the same kind, the logic is that indexes are smaller than values.</li></ul><p><b>Note:</b> This can be dangerous, as you may end up comparing two things that are equivalent (a value and its index) but declare they are not equal.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare_values"><a href="#val-compare_values" class="anchor"></a><code><span><span class="keyword">val</span> compare_values : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-value">value</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare_values f x y</code> compares the value <code>x</code> and <code>y</code> using <code>f</code>, and relies on the type system of OCaml to ensure that <code>x</code> and <code>y</code> are indeed both values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare_indexes"><a href="#val-compare_indexes" class="anchor"></a><code><span><span class="keyword">val</span> compare_indexes : <span><span><span class="type-var">'a</span> <a href="#type-index">index</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-index">index</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare_indexes x y</code> compares the indexes <code>x</code> and <code>y</code>, and relies on the type system of OCaml to ensure that <code>x</code> and <code>y</code> are indeed both indexes.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-VALUE"><a href="#module-type-VALUE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-VALUE/index.html">VALUE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make/index.html">Make</a></span><span> (<a href="Make/argument-1-V/index.html">V</a> : <a href="module-type-VALUE/index.html">VALUE</a>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Index_cannot_be_negative"><a href="#extension-decl-Index_cannot_be_negative" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_018_Proxford/Error_monad/index.html#type-error">Tezos_protocol_environment_018_Proxford.Error_monad.error</a> += </span></code><ol><li id="extension-Index_cannot_be_negative" class="def variant extension anchored"><a href="#extension-Index_cannot_be_negative" class="anchor"></a><code><span>| </span><span><span class="extension">Index_cannot_be_negative</span> <span class="keyword">of</span> int32</span></code></li></ol></div></div></div></body></html>
