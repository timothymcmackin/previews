<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Rollup_node_services (octez-l2-libs.Octez_smart_rollup.Rollup_node_services)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-l2-libs</a> &#x00BB; <a href="../index.html">Octez_smart_rollup</a> &#x00BB; Rollup_node_services</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup.Rollup_node_services</span></code></h1><p>This file defines the services of the rollup node that do not depend on the protocol. A top-level directory is built for them in the rollup node library.</p><p>Protocol specific services are for RPCs under <code>/global/block/</code> and are defined in the protocol specific libraries in <code>src/proto_*/lib_sc_rollup_layer2/sc_rollup_services.ml</code>.</p></header><div class="odoc-content"><p>We distinguish RPC endpoints served by the rollup node into <code>global</code> and <code>local</code>. The difference between the two lies in whether the responses given by different rollup nodes in the same state (see below for an exact definition) must be the same (in the case of global endpoints) or can differ (in the case of local endpoints).</p><p>More formally, two rollup nodes are in the same quiescent state if they are subscribed to the same rollup address, and have processed the same set of heads from the layer1. We only consider quiescent states, that is those where rollup nodes are not actively processing a head received from layer1.</p><p>Examples of global endpoints are <code>current_tezos_head</code> and <code>last_stored_commitment</code>, as the responses returned by these endpoints is expected to be consistent across rollup nodes in the same state.</p><p>An example of local endpoint is <code>last_published_commitment</code>, as two rollup nodes in the same state may either publish or not publish a commitment, according to whether its inbox level is below the inbox level of the last cemented commitment at the time they tried to publish the commitment. See below for a more detailed explanation.</p><div class="odoc-spec"><div class="spec type anchored" id="type-message_status"><a href="#type-message_status" class="anchor"></a><code><span><span class="keyword">type</span> message_status</span><span> = </span></code><ol><li id="type-message_status.Unknown" class="def variant constructor anchored"><a href="#type-message_status.Unknown" class="anchor"></a><code><span>| </span><span><span class="constructor">Unknown</span></span></code></li><li id="type-message_status.Pending_batch" class="def variant constructor anchored"><a href="#type-message_status.Pending_batch" class="anchor"></a><code><span>| </span><span><span class="constructor">Pending_batch</span></span></code></li><li id="type-message_status.Pending_injection" class="def variant constructor anchored"><a href="#type-message_status.Pending_injection" class="anchor"></a><code><span>| </span><span><span class="constructor">Pending_injection</span> <span class="keyword">of</span> <a href="../L1_operation/index.html#type-t">L1_operation.t</a></span></code></li><li id="type-message_status.Injected" class="def variant constructor anchored"><a href="#type-message_status.Injected" class="anchor"></a><code><span>| </span><span><span class="constructor">Injected</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-message_status.op" class="def record field anchored"><a href="#type-message_status.op" class="anchor"></a><code><span>op : <a href="../L1_operation/index.html#type-t">L1_operation.t</a>;</span></code></li><li id="type-message_status.oph" class="def record field anchored"><a href="#type-message_status.oph" class="anchor"></a><code><span>oph : <a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>;</span></code></li><li id="type-message_status.op_index" class="def record field anchored"><a href="#type-message_status.op_index" class="anchor"></a><code><span>op_index : int;</span></code></li></ol><code><span>}</span></code></li><li id="type-message_status.Included" class="def variant constructor anchored"><a href="#type-message_status.Included" class="anchor"></a><code><span>| </span><span><span class="constructor">Included</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-message_status.op" class="def record field anchored"><a href="#type-message_status.op" class="anchor"></a><code><span>op : <a href="../L1_operation/index.html#type-t">L1_operation.t</a>;</span></code></li><li id="type-message_status.oph" class="def record field anchored"><a href="#type-message_status.oph" class="anchor"></a><code><span>oph : <a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>;</span></code></li><li id="type-message_status.op_index" class="def record field anchored"><a href="#type-message_status.op_index" class="anchor"></a><code><span>op_index : int;</span></code></li><li id="type-message_status.l1_block" class="def record field anchored"><a href="#type-message_status.l1_block" class="anchor"></a><code><span>l1_block : <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>;</span></code></li><li id="type-message_status.l1_level" class="def record field anchored"><a href="#type-message_status.l1_level" class="anchor"></a><code><span>l1_level : int32;</span></code></li><li id="type-message_status.finalized" class="def record field anchored"><a href="#type-message_status.finalized" class="anchor"></a><code><span>finalized : bool;</span></code></li><li id="type-message_status.cemented" class="def record field anchored"><a href="#type-message_status.cemented" class="anchor"></a><code><span>cemented : bool;</span></code></li></ol><code><span>}</span></code></li><li id="type-message_status.Committed" class="def variant constructor anchored"><a href="#type-message_status.Committed" class="anchor"></a><code><span>| </span><span><span class="constructor">Committed</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-message_status.op" class="def record field anchored"><a href="#type-message_status.op" class="anchor"></a><code><span>op : <a href="../L1_operation/index.html#type-t">L1_operation.t</a>;</span></code></li><li id="type-message_status.oph" class="def record field anchored"><a href="#type-message_status.oph" class="anchor"></a><code><span>oph : <a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>;</span></code></li><li id="type-message_status.op_index" class="def record field anchored"><a href="#type-message_status.op_index" class="anchor"></a><code><span>op_index : int;</span></code></li><li id="type-message_status.l1_block" class="def record field anchored"><a href="#type-message_status.l1_block" class="anchor"></a><code><span>l1_block : <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>;</span></code></li><li id="type-message_status.l1_level" class="def record field anchored"><a href="#type-message_status.l1_level" class="anchor"></a><code><span>l1_level : int32;</span></code></li><li id="type-message_status.finalized" class="def record field anchored"><a href="#type-message_status.finalized" class="anchor"></a><code><span>finalized : bool;</span></code></li><li id="type-message_status.cemented" class="def record field anchored"><a href="#type-message_status.cemented" class="anchor"></a><code><span>cemented : bool;</span></code></li><li id="type-message_status.commitment" class="def record field anchored"><a href="#type-message_status.commitment" class="anchor"></a><code><span>commitment : <a href="../Commitment/index.html#type-t">Commitment.t</a>;</span></code></li><li id="type-message_status.commitment_hash" class="def record field anchored"><a href="#type-message_status.commitment_hash" class="anchor"></a><code><span>commitment_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a>;</span></code></li><li id="type-message_status.first_published_at_level" class="def record field anchored"><a href="#type-message_status.first_published_at_level" class="anchor"></a><code><span>first_published_at_level : int32;</span></code></li><li id="type-message_status.published_at_level" class="def record field anchored"><a href="#type-message_status.published_at_level" class="anchor"></a><code><span>published_at_level : int32;</span></code></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-gc_info"><a href="#type-gc_info" class="anchor"></a><code><span><span class="keyword">type</span> gc_info</span><span> = </span><span>{</span></code><ol><li id="type-gc_info.first_available_level" class="def record field anchored"><a href="#type-gc_info.first_available_level" class="anchor"></a><code><span>first_available_level : int32;</span></code></li><li id="type-gc_info.last_gc_started_at" class="def record field anchored"><a href="#type-gc_info.last_gc_started_at" class="anchor"></a><code><span>last_gc_started_at : <span>int32 option</span>;</span></code></li><li id="type-gc_info.last_context_split_level" class="def record field anchored"><a href="#type-gc_info.last_context_split_level" class="anchor"></a><code><span>last_context_split_level : <span>int32 option</span>;</span></code></li><li id="type-gc_info.last_successful_gc_target" class="def record field anchored"><a href="#type-gc_info.last_successful_gc_target" class="anchor"></a><code><span>last_successful_gc_target : <span>int32 option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sync_result"><a href="#type-sync_result" class="anchor"></a><code><span><span class="keyword">type</span> sync_result</span><span> = </span></code><ol><li id="type-sync_result.Synchronized" class="def variant constructor anchored"><a href="#type-sync_result.Synchronized" class="anchor"></a><code><span>| </span><span><span class="constructor">Synchronized</span></span></code></li><li id="type-sync_result.Synchronizing" class="def variant constructor anchored"><a href="#type-sync_result.Synchronizing" class="anchor"></a><code><span>| </span><span><span class="constructor">Synchronizing</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-sync_result.processed_level" class="def record field anchored"><a href="#type-sync_result.processed_level" class="anchor"></a><code><span>processed_level : int32;</span></code></li><li id="type-sync_result.l1_head_level" class="def record field anchored"><a href="#type-sync_result.l1_head_level" class="anchor"></a><code><span>l1_head_level : int32;</span></code></li><li id="type-sync_result.percentage_done" class="def record field anchored"><a href="#type-sync_result.percentage_done" class="anchor"></a><code><span>percentage_done : float;</span></code></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-l1_health"><a href="#type-l1_health" class="anchor"></a><code><span><span class="keyword">type</span> l1_health</span><span> = </span><span>{</span></code><ol><li id="type-l1_health.connection" class="def record field anchored"><a href="#type-l1_health.connection" class="anchor"></a><code><span>connection : <span>[ `Connected <span>| `Disconnected</span> <span>| `Reconnecting</span> ]</span>;</span></code></li><li id="type-l1_health.blocks_late" class="def record field anchored"><a href="#type-l1_health.blocks_late" class="anchor"></a><code><span>blocks_late : int32;</span></code></li><li id="type-l1_health.last_seen_head" class="def record field anchored"><a href="#type-l1_health.last_seen_head" class="anchor"></a><code><span>last_seen_head : <span><span>(<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>
                  * int32
                  * <a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.Time.Protocol.t</a>)</span>
                   option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-health"><a href="#type-health" class="anchor"></a><code><span><span class="keyword">type</span> health</span><span> = </span><span>{</span></code><ol><li id="type-health.healthy" class="def record field anchored"><a href="#type-health.healthy" class="anchor"></a><code><span>healthy : bool;</span></code></li><li id="type-health.degraded" class="def record field anchored"><a href="#type-health.degraded" class="anchor"></a><code><span>degraded : bool;</span></code></li><li id="type-health.l1" class="def record field anchored"><a href="#type-health.l1" class="anchor"></a><code><span>l1 : <a href="#type-l1_health">l1_health</a>;</span></code></li><li id="type-health.active_workers" class="def record field anchored"><a href="#type-health.active_workers" class="anchor"></a><code><span>active_workers : <span><span>(string * <span>[ `Running <span><span>| `Crashed</span> of exn</span> ]</span>)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-version"><a href="#type-version" class="anchor"></a><code><span><span class="keyword">type</span> version</span><span> = </span><span>{</span></code><ol><li id="type-version.version" class="def record field anchored"><a href="#type-version.version" class="anchor"></a><code><span>version : string;</span></code></li><li id="type-version.store_version" class="def record field anchored"><a href="#type-version.store_version" class="anchor"></a><code><span>store_version : string;</span></code></li><li id="type-version.context_version" class="def record field anchored"><a href="#type-version.context_version" class="anchor"></a><code><span>context_version : string;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-injector_operation"><a href="#type-injector_operation" class="anchor"></a><code><span><span class="keyword">type</span> injector_operation</span><span> = </span><span>{</span></code><ol><li id="type-injector_operation.op" class="def record field anchored"><a href="#type-injector_operation.op" class="anchor"></a><code><span>op : <a href="../L1_operation/index.html#type-t">L1_operation.t</a>;</span></code></li><li id="type-injector_operation.errors" class="def record field anchored"><a href="#type-injector_operation.errors" class="anchor"></a><code><span>errors : int;</span></code></li><li id="type-injector_operation.last_error" class="def record field anchored"><a href="#type-injector_operation.last_error" class="anchor"></a><code><span>last_error : <span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-committed_status"><a href="#type-committed_status" class="anchor"></a><code><span><span class="keyword">type</span> committed_status</span><span> = </span></code><ol><li id="type-committed_status.Uncommitted" class="def variant constructor anchored"><a href="#type-committed_status.Uncommitted" class="anchor"></a><code><span>| </span><span><span class="constructor">Uncommitted</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-committed_status.commitment_level" class="def record field anchored"><a href="#type-committed_status.commitment_level" class="anchor"></a><code><span>commitment_level : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level at which the following commitment will be produced.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.estimated_commitment_time" class="def record field anchored"><a href="#type-committed_status.estimated_commitment_time" class="anchor"></a><code><span>estimated_commitment_time : <a href="../../../octez-libs/Tezos_base/Time/System/index.html#type-t">Tezos_base.Time.System.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Estimated time at which the commitment will be published.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.estimated_cementation_time" class="def record field anchored"><a href="#type-committed_status.estimated_cementation_time" class="anchor"></a><code><span>estimated_cementation_time : <a href="../../../octez-libs/Tezos_base/Time/System/index.html#type-t">Tezos_base.Time.System.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Estimated time at which the commitment will be cemented.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></li><li id="type-committed_status.Committed_" class="def variant constructor anchored"><a href="#type-committed_status.Committed_" class="anchor"></a><code><span>| </span><span><span class="constructor">Committed_</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-committed_status.commitment_hash" class="def record field anchored"><a href="#type-committed_status.commitment_hash" class="anchor"></a><code><span>commitment_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Hash of following commitment.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.commitment_level" class="def record field anchored"><a href="#type-committed_status.commitment_level" class="anchor"></a><code><span>commitment_level : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level of following commitment.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.first_published_level" class="def record field anchored"><a href="#type-committed_status.first_published_level" class="anchor"></a><code><span>first_published_level : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level at which commitment was first published.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.published_level" class="def record field anchored"><a href="#type-committed_status.published_level" class="anchor"></a><code><span>published_level : <span>int32 option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level at which commitment was published by operator (may be None if e.g. rollup node does not publish).</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.estimated_cementation_time" class="def record field anchored"><a href="#type-committed_status.estimated_cementation_time" class="anchor"></a><code><span>estimated_cementation_time : <a href="../../../octez-libs/Tezos_base/Time/System/index.html#type-t">Tezos_base.Time.System.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Estimated time at which the commitment will be cemented.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></li><li id="type-committed_status.Cemented" class="def variant constructor anchored"><a href="#type-committed_status.Cemented" class="anchor"></a><code><span>| </span><span><span class="constructor">Cemented</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-committed_status.commitment_hash" class="def record field anchored"><a href="#type-committed_status.commitment_hash" class="anchor"></a><code><span>commitment_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Hash of following commitment.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.commitment_level" class="def record field anchored"><a href="#type-committed_status.commitment_level" class="anchor"></a><code><span>commitment_level : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level of following commitment.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.first_published_level" class="def record field anchored"><a href="#type-committed_status.first_published_level" class="anchor"></a><code><span>first_published_level : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level at which commitment was first published.</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.published_level" class="def record field anchored"><a href="#type-committed_status.published_level" class="anchor"></a><code><span>published_level : <span>int32 option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Level at which commitment was published by operator (may be None if e.g. rollup node does not publish).</p><span class="comment-delim">*)</span></div></li><li id="type-committed_status.blocks_since_cemented" class="def record field anchored"><a href="#type-committed_status.blocks_since_cemented" class="anchor"></a><code><span>blocks_since_cemented : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Number of blocks since commitment was cemented</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Encodings"><a href="#module-Encodings" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Encodings/index.html">Encodings</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Arg"><a href="#module-Arg" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Arg/index.html">Arg</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Query"><a href="#module-Query" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Query/index.html">Query</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-PREFIX"><a href="#module-type-PREFIX" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-PREFIX/index.html">PREFIX</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_services"><a href="#module-Make_services" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_services/index.html">Make_services</a></span><span> (<a href="Make_services/argument-1-P/index.html">P</a> : <a href="module-type-PREFIX/index.html">PREFIX</a>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Global"><a href="#module-Global" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Global/index.html">Global</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Local"><a href="#module-Local" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Local/index.html">Local</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Root"><a href="#module-Root" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Root/index.html">Root</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Admin"><a href="#module-Admin" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Admin/index.html">Admin</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
