<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Inbox (octez-l2-libs.Octez_smart_rollup.Inbox)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-l2-libs</a> &#x00BB; <a href="../index.html">Octez_smart_rollup</a> &#x00BB; Inbox</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup.Inbox</span></code></h1><p>Smart rollup shared inbox representation, adapted from a subset of <code>src/proto_alpha/lib_protocol/sc_rollup_inbox_repr.mli</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Hash"><a href="#module-Hash" class="anchor"></a><code><span><span class="keyword">module</span> Hash</span><span> = <a href="../Inbox_hash/index.html">Inbox_hash</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Skip_list"><a href="#module-Skip_list" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Skip_list/index.html">Skip_list</a></span><span> : <a href="../../../octez-libs/Tezos_base/Skip_list/module-type-S/index.html">Tezos_base.Skip_list.S</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-V1"><a href="#module-V1" class="anchor"></a><code><span><span class="keyword">module</span> <a href="V1/index.html">V1</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Versioned_data/module-type-S/index.html">Versioned_data.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Versioned_data/module-type-S/index.html#type-t">t</a> = <a href="V1/index.html#type-t">V1.t</a></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-versioned"><a href="#type-versioned" class="anchor"></a><code><span><span class="keyword">type</span> versioned</span></code></div><div class="spec-doc"><p>The type of <em>versioned</em> values, including the one that is currently used and the previous ones.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-versioned_encoding"><a href="#val-versioned_encoding" class="anchor"></a><code><span><span class="keyword">val</span> versioned_encoding : <span><a href="#type-versioned">versioned</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encoding for versioned values, corresponds to the one defined by the protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_versioned"><a href="#val-of_versioned" class="anchor"></a><code><span><span class="keyword">val</span> of_versioned : <span><a href="#type-versioned">versioned</a> <span class="arrow">&#45;&gt;</span></span> <a href="V1/index.html#type-t">V1.t</a></span></code></div><div class="spec-doc"><p>Conversion to the currently used representation. In practice this function must provide ways to translate values of older versions to the latest one.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_versioned"><a href="#val-to_versioned" class="anchor"></a><code><span><span class="keyword">val</span> to_versioned : <span><a href="V1/index.html#type-t">V1.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-versioned">versioned</a></span></code></div><div class="spec-doc"><p>Wrapping a current value as a versioned one.</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="V1/index.html">V1</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="V1/index.html#type-level_proof">level_proof</a> = <a href="V1/index.html#type-level_proof">V1.level_proof</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="V1/index.html#type-history_proof">history_proof</a> = <a href="V1/index.html#type-history_proof">V1.history_proof</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="V1/index.html#type-t">t</a> = <a href="V1/index.html#type-t">V1.t</a></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-level_proof"><a href="#type-level_proof" class="anchor"></a><code><span><span class="keyword">type</span> level_proof</span><span> = <a href="V1/index.html#type-level_proof">V1.level_proof</a></span><span> = </span><span>{</span></code><ol><li id="type-level_proof.hash" class="def record field anchored"><a href="#type-level_proof.hash" class="anchor"></a><code><span>hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_merkelized_payload_hashes_hash/index.html#type-t">Tezos_crypto.Hashed.Smart_rollup_merkelized_payload_hashes_hash.t</a>;</span></code></li><li id="type-level_proof.level" class="def record field anchored"><a href="#type-level_proof.level" class="anchor"></a><code><span>level : int32;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-history_proof"><a href="#type-history_proof" class="anchor"></a><code><span><span class="keyword">type</span> history_proof</span><span> = <a href="V1/index.html#type-history_proof">V1.history_proof</a></span></code></div><div class="spec-doc"><p>A <code>history_proof</code> is a <code>Skip_list.cell</code> that stores multiple hashes. <code>Skip_list.content history_proof</code> gives the hash of this cell, while <code>Skip_list.back_pointers history_proof</code> is an array of hashes of earlier <code>history_proof</code>s in the inbox.</p><p>On the one hand, we think of this type as representing the whole Merkle structure of an inbox at a given level---it is the part of <a href="#type-t"><code>t</code></a> above that can actually be used to prove things (it cannot be forged by a malicious node because it much match the hash stored by the L1).</p><p>On the other hand, we think of this type as representing a single proof-step back through the history of the inbox; given a hash that appears at some point later in the inbox this type proves that that hash points to this particular combination of a witness and further back-pointers.</p><p>In terms of size, this type is a small set of hashes; one for the current witness and `O(log2(ix))` in the back-pointers, where <code>ix</code> is the index of the cell in the skip list. That is, <code>ix</code> is the number of non-empty levels between now and the origination level of the rollup.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <a href="V1/index.html#type-t">V1.t</a></span><span> = </span><span>{</span></code><ol><li id="type-t.level" class="def record field anchored"><a href="#type-t.level" class="anchor"></a><code><span>level : int32;</span></code></li><li id="type-t.old_levels_messages" class="def record field anchored"><a href="#type-t.old_levels_messages" class="anchor"></a><code><span>old_levels_messages : <a href="#type-history_proof">history_proof</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type of the inbox for a smart-contract rollup as stored by the protocol in the context. Values that inhabit this type only act as fingerprint for inboxes and contain:</p><ul><li><code>level</code> : the inbox level ;</li><li><code>old_levels_messages</code> : a witness of the inbox history.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Inbox_hash/index.html#type-t">Hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-t">t</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inbox_level"><a href="#val-inbox_level" class="anchor"></a><code><span><span class="keyword">val</span> inbox_level : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p><code>inbox_level inbox</code> returns the maximum level of message insertion in <code>inbox</code> or its initial level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_history_proof"><a href="#val-pp_history_proof" class="anchor"></a><code><span><span class="keyword">val</span> pp_history_proof : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-history_proof">history_proof</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-history_proof_encoding"><a href="#val-history_proof_encoding" class="anchor"></a><code><span><span class="keyword">val</span> history_proof_encoding : 
  <span><a href="#type-history_proof">history_proof</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal_history_proof"><a href="#val-equal_history_proof" class="anchor"></a><code><span><span class="keyword">val</span> equal_history_proof : <span><a href="#type-history_proof">history_proof</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-history_proof">history_proof</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-old_levels_messages"><a href="#val-old_levels_messages" class="anchor"></a><code><span><span class="keyword">val</span> old_levels_messages : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-history_proof">history_proof</a></span></code></div><div class="spec-doc"><p><code>old_levels_messages inbox</code> returns the latest skip list cell of the inbox history that is not up to change (i.e. not the current witness).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_witness"><a href="#val-current_witness" class="anchor"></a><code><span><span class="keyword">val</span> current_witness : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_merkelized_payload_hashes_hash/index.html#type-t">Tezos_crypto.Hashed.Smart_rollup_merkelized_payload_hashes_hash.t</a></span></code></div><div class="spec-doc"><p><code>current_witness inbox</code> returns the current witness of the inbox, i.e. the merkelized payload hash.</p></div></div></details></div></div></body></html>
