<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Indexed_store (octez-l2-libs.Tezos_layer2_store.Indexed_store)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-l2-libs</a> &#x00BB; <a href="../index.html">Tezos_layer2_store</a> &#x00BB; Indexed_store</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_layer2_store.Indexed_store</span></code></h1><p>This library provides functors to build various kinds of stores using mirage's <a href="https://github.com/mirage/index">index</a> and Octez <a href="https://gitlab.com/nomadic-labs/data-encoding">data-encoding</a> libraries.</p><p>It is tailored to build stores for the Layer 2 nodes of Tezos (Tx-rollups and Smart rollups).</p><p>The stores built with this library support concurrent accesses thanks to the use of the light scheduler provided by <code>Lwt_idle_waiter</code> for exclusive write access.</p></header><nav class="odoc-toc"><ul><li><a href="#signatures">Signatures</a></li><li><a href="#functors">Functors</a></li><li><a href="#helper-functors">Helper functors</a></li></ul></nav><div class="odoc-content"><h3 id="signatures"><a href="#signatures" class="anchor"></a>Signatures</h3><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-SINGLETON_STORE"><a href="#module-type-SINGLETON_STORE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-SINGLETON_STORE/index.html">SINGLETON_STORE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A store for single updatable values. Values are stored in a file on disk and are kept in memory in a cache.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-INDEXABLE_STORE"><a href="#module-type-INDEXABLE_STORE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-INDEXABLE_STORE/index.html">INDEXABLE_STORE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An index store mapping keys to values. It uses an index file internally.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-INDEXABLE_REMOVABLE_STORE"><a href="#module-type-INDEXABLE_REMOVABLE_STORE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-INDEXABLE_REMOVABLE_STORE/index.html">INDEXABLE_REMOVABLE_STORE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An index store mapping keys to values. Keys are associated to optional values in the index which allows them to be removed.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-INDEXED_FILE"><a href="#module-type-INDEXED_FILE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-INDEXED_FILE/index.html">INDEXED_FILE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An indexed file (i.e. a file and an index) mapping keys to values. Contrary to <a href="module-type-INDEXABLE_STORE/index.html"><code>INDEXABLE_STORE</code></a>, the values can vary in size. Internally, values are stored, concatenated, in a append only file. The index file associates keys to offsets in this file (and a header to retrieve information more efficiently).</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-SIMPLE_INDEXED_FILE"><a href="#module-type-SIMPLE_INDEXED_FILE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-SIMPLE_INDEXED_FILE/index.html">SIMPLE_INDEXED_FILE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Same as <a href="module-type-INDEXED_FILE/index.html"><code>INDEXED_FILE</code></a> but where headers are extracted from values.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-NAME"><a href="#module-type-NAME" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-NAME/index.html">NAME</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Names for stores.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-INDEX_KEY"><a href="#module-type-INDEX_KEY" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-INDEX_KEY/index.html">INDEX_KEY</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Values that can be used as keys for indices.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-ENCODABLE_VALUE"><a href="#module-type-ENCODABLE_VALUE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-ENCODABLE_VALUE/index.html">ENCODABLE_VALUE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Values that can be encoded.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-FIXED_ENCODABLE_VALUE"><a href="#module-type-FIXED_ENCODABLE_VALUE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-FIXED_ENCODABLE_VALUE/index.html">FIXED_ENCODABLE_VALUE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Values that can be encoded and whose encoding is a fixed size.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-ENCODABLE_VALUE_HEADER"><a href="#module-type-ENCODABLE_VALUE_HEADER" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-ENCODABLE_VALUE_HEADER/index.html">ENCODABLE_VALUE_HEADER</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Values with a given fixed size header.</p></div></div><h3 id="functors"><a href="#functors" class="anchor"></a>Functors</h3><div class="odoc-spec"><div class="spec module anchored" id="module-Make_singleton"><a href="#module-Make_singleton" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_singleton/index.html">Make_singleton</a></span><span>
  (<a href="Make_singleton/argument-1-S/index.html">S</a> : <a href="module-type-ENCODABLE_VALUE/index.html">ENCODABLE_VALUE</a>) : 
  <a href="module-type-SINGLETON_STORE/index.html">SINGLETON_STORE</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-SINGLETON_STORE/index.html#type-value">value</a> := <a href="Make_singleton/argument-1-S/index.html#type-t">S.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_indexable"><a href="#module-Make_indexable" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_indexable/index.html">Make_indexable</a></span><span>
  (<a href="Make_indexable/argument-1-_/index.html">_</a> : <a href="module-type-NAME/index.html">NAME</a>)
  (<a href="Make_indexable/argument-2-K/index.html">K</a> : <a href="module-type-INDEX_KEY/index.html">INDEX_KEY</a>)
  (<a href="Make_indexable/index.html#argument-3-V">V</a> : <span class="xref-unresolved">Index</span>.Value.S) : 
  <a href="module-type-INDEXABLE_STORE/index.html">INDEXABLE_STORE</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-INDEXABLE_STORE/index.html#type-key">key</a> := <a href="Make_indexable/argument-2-K/index.html#type-t">K.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-INDEXABLE_STORE/index.html#type-value">value</a> := <span class="xref-unresolved">V</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_indexable_removable"><a href="#module-Make_indexable_removable" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_indexable_removable/index.html">Make_indexable_removable</a></span><span>
  (<a href="Make_indexable_removable/argument-1-_/index.html">_</a> : <a href="module-type-NAME/index.html">NAME</a>)
  (<a href="Make_indexable_removable/argument-2-K/index.html">K</a> : <a href="module-type-INDEX_KEY/index.html">INDEX_KEY</a>)
  (<a href="Make_indexable_removable/index.html#argument-3-V">V</a> : <span class="xref-unresolved">Index</span>.Value.S) : 
  <a href="module-type-INDEXABLE_REMOVABLE_STORE/index.html">INDEXABLE_REMOVABLE_STORE</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-INDEXABLE_REMOVABLE_STORE/index.html#type-key">key</a> := <a href="Make_indexable_removable/argument-2-K/index.html#type-t">K.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-INDEXABLE_REMOVABLE_STORE/index.html#type-value">value</a> := <span class="xref-unresolved">V</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_indexed_file"><a href="#module-Make_indexed_file" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_indexed_file/index.html">Make_indexed_file</a></span><span>
  (<a href="Make_indexed_file/argument-1-_/index.html">_</a> : <a href="module-type-NAME/index.html">NAME</a>)
  (<a href="Make_indexed_file/argument-2-K/index.html">K</a> : <a href="module-type-INDEX_KEY/index.html">INDEX_KEY</a>)
  (<a href="Make_indexed_file/argument-3-V/index.html">V</a> : <a href="module-type-ENCODABLE_VALUE_HEADER/index.html">ENCODABLE_VALUE_HEADER</a>) : 
  <a href="module-type-INDEXED_FILE/index.html">INDEXED_FILE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-INDEXED_FILE/index.html#type-key">key</a> := <a href="Make_indexed_file/argument-2-K/index.html#type-t">K.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-INDEXED_FILE/index.html#type-value">value</a> := <a href="Make_indexed_file/argument-3-V/index.html#type-t">V.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-INDEXED_FILE/index.html#type-header">header</a> := <a href="Make_indexed_file/argument-3-V/Header/index.html#type-t">V.Header.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_simple_indexed_file"><a href="#module-Make_simple_indexed_file" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_simple_indexed_file/index.html">Make_simple_indexed_file</a></span><span>
  (<a href="Make_simple_indexed_file/argument-1-_/index.html">_</a> : <a href="module-type-NAME/index.html">NAME</a>)
  (<a href="Make_simple_indexed_file/argument-2-K/index.html">K</a> : <a href="module-type-INDEX_KEY/index.html">INDEX_KEY</a>)
  (<a href="Make_simple_indexed_file/argument-3-V/index.html">V</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) : 
  <a href="module-type-SIMPLE_INDEXED_FILE/index.html">SIMPLE_INDEXED_FILE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-SIMPLE_INDEXED_FILE/index.html#type-key">key</a> := <a href="Make_simple_indexed_file/argument-2-K/index.html#type-t">K.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-SIMPLE_INDEXED_FILE/index.html#type-value">value</a> := <a href="Make_simple_indexed_file/argument-3-V/index.html#type-t">V.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="module-type-SIMPLE_INDEXED_FILE/index.html#type-header">header</a> := <a href="Make_simple_indexed_file/argument-3-V/Header/index.html#type-t">V.Header.t</a></span></span></code></div></div><h3 id="helper-functors"><a href="#helper-functors" class="anchor"></a>Helper functors</h3><div class="odoc-spec"><div class="spec module anchored" id="module-Make_fixed_encodable"><a href="#module-Make_fixed_encodable" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_fixed_encodable/index.html">Make_fixed_encodable</a></span><span>
  (<a href="Make_fixed_encodable/argument-1-V/index.html">V</a> : <a href="module-type-ENCODABLE_VALUE/index.html">ENCODABLE_VALUE</a>) : 
  <a href="module-type-FIXED_ENCODABLE_VALUE/index.html">FIXED_ENCODABLE_VALUE</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-FIXED_ENCODABLE_VALUE/index.html#type-t">t</a> = <a href="Make_fixed_encodable/argument-1-V/index.html#type-t">V.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_index_value"><a href="#module-Make_index_value" class="anchor"></a><code><span><span class="keyword">module</span> Make_index_value</span><span>
  (<a href="Make_index_value/argument-1-E/index.html">E</a> : <a href="module-type-FIXED_ENCODABLE_VALUE/index.html">FIXED_ENCODABLE_VALUE</a>) : 
  <span class="xref-unresolved">Index</span>.Value.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">t</span> = <span class="xref-unresolved">E</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make_index_key"><a href="#module-Make_index_key" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make_index_key/index.html">Make_index_key</a></span><span> (<a href="Make_index_key/argument-1-E/index.html">E</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) : <a href="module-type-INDEX_KEY/index.html">INDEX_KEY</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-INDEX_KEY/index.html#type-t">t</a> = <a href="Make_index_key/argument-1-E/index.html#type-t">E.t</a></span></span></code></div></div></div></body></html>
