<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wasm (octez-l2-libs.Tezos_scoru_wasm_helpers.Wasm_utils.Make.Wasm)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">octez-l2-libs</a> &#x00BB; <a href="../../../index.html">Tezos_scoru_wasm_helpers</a> &#x00BB; <a href="../../index.html">Wasm_utils</a> &#x00BB; <a href="../index.html">Make</a> &#x00BB; Wasm</nav><header class="odoc-preamble"><h1>Module <code><span>Make.Wasm</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span><span class="keyword">type</span> tree</span><span> = <a href="../index.html#type-tree">tree</a></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_vm_sig/module-type-Generic/index.html">Tezos_scoru_wasm.Wasm_vm_sig.Generic</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_vm_sig/module-type-Generic/index.html#type-state">state</a> := <a href="#type-tree">tree</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step_many"><a href="#val-compute_step_many" class="anchor"></a><code><span><span class="keyword">val</span> compute_step_many : 
  <span><span class="optlabel">?reveal_builtins</span>:<a href="../../../../../octez-libs/Tezos_scoru_wasm/Builtins/index.html#type-reveals">Tezos_scoru_wasm.Builtins.reveals</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?hooks</span>:<a href="../../../../../octez-libs/Tezos_scoru_wasm/Hooks/index.html#type-t">Tezos_scoru_wasm.Hooks.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?write_debug</span>:<a href="../../../../../octez-libs/Tezos_scoru_wasm/Builtins/index.html#type-write_debug">Tezos_scoru_wasm.Builtins.write_debug</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stop_at_snapshot</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">max_steps</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-tree">tree</a> * int64)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step_many ~wasm_entrypoint ~max_steps pvm_state</code> forwards the VM by at most <code>max_step</code> compute tick, yielding if it reaches the maximum number of ticks for executing <code>wasm_entrypoint</code>.</p><p>If the VM is expecting input, it gets stuck. If the VM is already stuck, this function may raise an exception. It is more efficient than <code>compute_step</code> if it has to be called for more than one tick, but its resulting pvm_state will be stricly equivalent. Returns a tuple containing the number of executed ticks and the new pvm_state.</p><p>The <code>hooks</code> optional argument can be used to execute arbitrary code (hooks) to react to some execution events (see <code>Hooks.t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step"><a href="#val-compute_step" class="anchor"></a><code><span><span class="keyword">val</span> compute_step : <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step ~wasm_entrypoint pvm_state</code> forwards the VM by one compute tick. If the VM is expecting input, it gets stuck. If the VM is already stuck, this function may raise an exception.</p><p>It is strictly equivalent to <code>compute_step_many ~wasm_entrypoint ~max_step:1 pvm_state</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step_with_debug"><a href="#val-compute_step_with_debug" class="anchor"></a><code><span><span class="keyword">val</span> compute_step_with_debug : 
  <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">write_debug</span>:<a href="../../../../../octez-libs/Tezos_scoru_wasm/Builtins/index.html#type-write_debug">Tezos_scoru_wasm.Builtins.write_debug</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step_with_debug ~wasm_entrypoint ~debug_flag pvm_state</code> is exactly <code>compute_step ~wasm_entrypoint</code> but it has the ability to enable the debugging host functions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_input_step"><a href="#val-set_input_step" class="anchor"></a><code><span><span class="keyword">val</span> set_input_step : 
  <span><a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/index.html#type-input_info">Tezos_scoru_wasm.Wasm_pvm_state.input_info</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_input_step input_info message pvm_state</code> forwards the VM by one input tick. If the VM is not expecting input, it gets stuck. If the VM is already stuck, this function may raise an exception. Note at this point the function raises an exception if the VM is not expecting input.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reveal_step"><a href="#val-reveal_step" class="anchor"></a><code><span><span class="keyword">val</span> reveal_step : <span>bytes <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>reveal_step reveal_data pvm_state</code> loads the <code>reveal_data</code> in the memory of module of the currently executed function.</p><p>If the VM does not expect any reveal data, this function raises an exception.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_info"><a href="#val-get_info" class="anchor"></a><code><span><span class="keyword">val</span> get_info : <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/index.html#type-info">Tezos_scoru_wasm.Wasm_pvm_state.info</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_info pvm_state</code> provides a typed view of the current machine state. Should not raise.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-initial_state"><a href="#val-initial_state" class="anchor"></a><code><span><span class="keyword">val</span> initial_state : 
  <span><a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/index.html#type-version">Tezos_scoru_wasm.Wasm_pvm_state.version</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>initial_state empty_tree</code> computes the initial tree whose hash is hard-coded in the protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-install_boot_sector"><a href="#val-install_boot_sector" class="anchor"></a><code><span><span class="keyword">val</span> install_boot_sector : 
  <span><span class="label">ticks_per_snapshot</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">outbox_validity_period</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">outbox_message_limit</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>install_boot_sector ~ticks_per_snapshot ~output_validity_period payload
      tree</code> installs the <code>payload</code> passed as an argument in <code>tree</code> so that it is interpreted as the kernel to be used by the PVM.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_output"><a href="#val-get_output" class="anchor"></a><code><span><span class="keyword">val</span> get_output : 
  <span><a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/index.html#type-output_info">Tezos_scoru_wasm.Wasm_pvm_state.output_info</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_output output state</code> returns the payload associated with the given output. The result is meant to be deserialized using <code>Sc_rollup_PVM_sem.output_encoding</code>. If the output is missing, this function may raise an exception.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_wasm_version"><a href="#val-get_wasm_version" class="anchor"></a><code><span><span class="keyword">val</span> get_wasm_version : <span><a href="#type-tree">tree</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/index.html#type-version">Tezos_scoru_wasm.Wasm_pvm_state.version</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Unsafe"><a href="#module-Unsafe" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Unsafe/index.html">Unsafe</a></span><span> : <a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_sig/module-type-Unsafe/index.html">Tezos_scoru_wasm.Wasm_pvm_sig.Unsafe</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_sig/module-type-Unsafe/index.html#type-tree">tree</a> := <a href="#type-tree">tree</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : 
  <a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_sig/module-type-Internal_for_tests/index.html">Tezos_scoru_wasm.Wasm_pvm_sig.Internal_for_tests</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_sig/module-type-Internal_for_tests/index.html#type-tree">tree</a> := <a href="#type-tree">tree</a></span></span></code></div></div></div></body></html>
