<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Exec (octez-l2-libs.Octez_smart_rollup_wasm_benchmark_lib.Exec)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-l2-libs</a> &#x00BB; <a href="../index.html">Octez_smart_rollup_wasm_benchmark_lib</a> &#x00BB; Exec</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup_wasm_benchmark_lib.Exec</span></code></h1><p>Utilities used to run the PVM</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-phase"><a href="#type-phase" class="anchor"></a><code><span><span class="keyword">type</span> phase</span><span> = </span></code><ol><li id="type-phase.Decoding" class="def variant constructor anchored"><a href="#type-phase.Decoding" class="anchor"></a><code><span>| </span><span><span class="constructor">Decoding</span></span></code></li><li id="type-phase.Initialising" class="def variant constructor anchored"><a href="#type-phase.Initialising" class="anchor"></a><code><span>| </span><span><span class="constructor">Initialising</span></span></code></li><li id="type-phase.Linking" class="def variant constructor anchored"><a href="#type-phase.Linking" class="anchor"></a><code><span>| </span><span><span class="constructor">Linking</span></span></code></li><li id="type-phase.Evaluating" class="def variant constructor anchored"><a href="#type-phase.Evaluating" class="anchor"></a><code><span>| </span><span><span class="constructor">Evaluating</span></span></code></li><li id="type-phase.Padding" class="def variant constructor anchored"><a href="#type-phase.Padding" class="anchor"></a><code><span>| </span><span><span class="constructor">Padding</span></span></code></li></ol></div><div class="spec-doc"><p>the different phases in a top level call</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-do_while"><a href="#val-do_while" class="anchor"></a><code><span><span class="keyword">val</span> do_while : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>do_while reboot f a</code> apply <code>f</code> on a state <code>a</code> regardless of it's type. Will reboot at the end of the last phase according to <code>reboot</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_loop"><a href="#val-run_loop" class="anchor"></a><code><span><span class="keyword">val</span> run_loop : 
  <span><span class="optlabel">?reboot</span>:<span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span>)</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-phase">phase</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>run_loop ~reboot f a</code> folds <code>f</code> on all phases of an exection on a state <code>a</code> regardless of it's type. Will reboot at the end of the last phase according to the <code>reboot</code> predicate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show_phase"><a href="#val-show_phase" class="anchor"></a><code><span><span class="keyword">val</span> show_phase : <span><a href="#type-phase">phase</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>show_phase phase</code> returns the name of a given phase, for debugging and logging.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finish_top_level_call_on_state"><a href="#val-finish_top_level_call_on_state" class="anchor"></a><code><span><span class="keyword">val</span> finish_top_level_call_on_state : 
  <span><a href="../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Tezos_scoru_wasm.Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Tezos_scoru_wasm.Wasm_pvm_state.Internal_state.pvm_state</a> * int64)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>execute the PVM until a the end of a top level call e.g. until a snapshotable state is reached</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-execute_on_state"><a href="#val-execute_on_state" class="anchor"></a><code><span><span class="keyword">val</span> execute_on_state : 
  <span><span class="label">reveal_builtins</span>:<a href="../../../octez-libs/Tezos_scoru_wasm/Builtins/index.html#type-reveals">Tezos_scoru_wasm.Builtins.reveals</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-phase">phase</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Tezos_scoru_wasm.Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Tezos_scoru_wasm.Wasm_pvm_state.Internal_state.pvm_state</a> * int64)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>execute_on_state ~reveal_builtins phase state</code> Execute a given <code>phase</code> of the execution loop on the state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-execute_fast"><a href="#val-execute_fast" class="anchor"></a><code><span><span class="keyword">val</span> execute_fast : 
  <span><span class="label">reveal_builtins</span>:<a href="../../../octez-libs/Tezos_scoru_wasm/Builtins/index.html#type-reveals">Tezos_scoru_wasm.Builtins.reveals</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Tezos_scoru_wasm.Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../octez-libs/Tezos_scoru_wasm/Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Tezos_scoru_wasm.Wasm_pvm_state.Internal_state.pvm_state</a> * int64)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Execute one top level call using fast execution.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span class="xref-unresolved">Lwt_io</span>.file_name <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>run path k</code> execute <code>k</code> on the content of the file at <code>path</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initial_boot_sector_from_kernel"><a href="#val-initial_boot_sector_from_kernel" class="anchor"></a><code><span><span class="keyword">val</span> initial_boot_sector_from_kernel : 
  <span><span class="optlabel">?max_tick</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Pvm_instance/Wasm/index.html#type-tree">Pvm_instance.Wasm.tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>initial_boot_sector_from_kernel
        &quot;src/lib_scoru_wasm/bench/inputs/my_kernel.wasm&quot;</code> initialize a state from a kernel (byte format)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-input"><a href="#type-input" class="anchor"></a><code><span><span class="keyword">type</span> input</span><span> = </span></code><ol><li id="type-input.File" class="def variant constructor anchored"><a href="#type-input.File" class="anchor"></a><code><span>| </span><span><span class="constructor">File</span> <span class="keyword">of</span> string</span></code></li><li id="type-input.Str" class="def variant constructor anchored"><a href="#type-input.Str" class="anchor"></a><code><span>| </span><span><span class="constructor">Str</span> <span class="keyword">of</span> string</span></code></li></ol></div><div class="spec-doc"><p>Inputs can be given : as a filename containing the input, or directly as a string.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-message"><a href="#type-message" class="anchor"></a><code><span><span class="keyword">type</span> message</span><span> = </span></code><ol><li id="type-message.Transfer" class="def variant constructor anchored"><a href="#type-message.Transfer" class="anchor"></a><code><span>| </span><span><span class="constructor">Transfer</span> <span class="keyword">of</span> <a href="#type-input">input</a></span></code></li><li id="type-message.Other" class="def variant constructor anchored"><a href="#type-message.Other" class="anchor"></a><code><span>| </span><span><span class="constructor">Other</span> <span class="keyword">of</span> <a href="#type-input">input</a></span></code></li><li id="type-message.Encoded" class="def variant constructor anchored"><a href="#type-message.Encoded" class="anchor"></a><code><span>| </span><span><span class="constructor">Encoded</span> <span class="keyword">of</span> <a href="#type-input">input</a></span></code></li></ol></div><div class="spec-doc"><p>Types of messages to send to inbox. Can be either already encoded, or not. If it's not encoded then it must be designated as Deposit or Other to allow encoding</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load_messages"><a href="#val-load_messages" class="anchor"></a><code><span><span class="keyword">val</span> load_messages : 
  <span><span><a href="#type-message">message</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Pvm_instance/Wasm/index.html#type-tree">Pvm_instance.Wasm.tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Pvm_instance/Wasm/index.html#type-tree">Pvm_instance.Wasm.tree</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>load_messages messages level state</code> sends messages to the inbox, at a given level. Will fail if the VM is not accepting input, and advance until next Snapshot.</p></div></div></div></body></html>
