<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store_v5 (octez-l2-libs.Octez_smart_rollup_node_store.Store_v5)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-l2-libs</a> &#x00BB; <a href="../index.html">Octez_smart_rollup_node_store</a> &#x00BB; Store_v5</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup_node_store.Store_v5</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-version"><a href="#val-version" class="anchor"></a><code><span><span class="keyword">val</span> version : <a href="../Store_version/index.html#type-t">Store_version.t</a></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Sql_store/index.html">Sql_store</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = <span><span class="type-var">'a</span> <a href="../Sql_store/index.html#type-t">Sql_store.t</a></span></span></code></div><div class="spec-doc"><p>Type of store (a handler to the underlying database).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-rw"><a href="#type-rw" class="anchor"></a><code><span><span class="keyword">type</span> rw</span><span> = <span><a href="../../Tezos_layer2_store/Store_sigs/index.html#type-rw">Tezos_layer2_store.Store_sigs.rw</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Read/write store <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ro"><a href="#type-ro" class="anchor"></a><code><span><span class="keyword">type</span> ro</span><span> = <span><a href="../../Tezos_layer2_store/Store_sigs/index.html#type-ro">Tezos_layer2_store.Store_sigs.ro</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Read only store <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sqlite_file_name"><a href="#val-sqlite_file_name" class="anchor"></a><code><span><span class="keyword">val</span> sqlite_file_name : string</span></code></div><div class="spec-doc"><p>Name of SQLite file in data directory.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extra_sqlite_files"><a href="#val-extra_sqlite_files" class="anchor"></a><code><span><span class="keyword">val</span> extra_sqlite_files : <span>string list</span></span></code></div><div class="spec-doc"><p>Other files that make up the store.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><span><span class="type-var">'a</span> <a href="../../Tezos_layer2_store/Store_sigs/index.html#type-mode">Tezos_layer2_store.Store_sigs.mode</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>init mode ~data_dir</code> initializes the store and returns it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Close the store by freeing all resources and closing database connections.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-readonly"><a href="#val-readonly" class="anchor"></a><code><span><span class="keyword">val</span> readonly : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-ro">ro</a></span></code></div><div class="spec-doc"><p>Returns a read-only version of the store.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gc"><a href="#val-gc" class="anchor"></a><code><span><span class="keyword">val</span> gc : <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>gc store ~level</code> garbage collects data that relate to levels below <code>level</code> (by removing information from the database).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-export_store"><a href="#val-export_store" class="anchor"></a><code><span><span class="keyword">val</span> export_store : 
  <span><span class="label">data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">output_db_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>export_store ~data_dir ~output_db_file</code> exports the store database with data from the <code>data_dir</code> into the <code>output_db_file</code>. This function also removes data that is specific to the operator. This function is meant to be used to produce snapshots.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_transaction"><a href="#val-with_transaction" class="anchor"></a><code><span><span class="keyword">val</span> with_transaction : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../Octez_sqlite/Sqlite/index.html#type-conn">Octez_sqlite.Sqlite.conn</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>with_transaction store f</code> executes <code>f</code> with a single connection to the database in a transaction. I.e., if <code>f</code> returns an error or raises an exception, the store will not be modified.</p></div></div><h3 id="modules-for-storing-data-in-the-store"><a href="#modules-for-storing-data-in-the-store" class="anchor"></a>Modules for storing data in the store</h3><p>Each module maps to a table in the database. Every read and write function has two parameters: <code>store</code> and an optional <code>?conn</code>.</p><p>When <code>~conn</code> is provided, the database connection is used directly to execute the queries. If not, a new (or old) connection is taken from the pool of <code>store</code>.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Commitments"><a href="#module-Commitments" class="anchor"></a><code><span><span class="keyword">module</span> Commitments</span><span> = <a href="../Sql_store/Commitments/index.html">Sql_store.Commitments</a></span></code></div><div class="spec-doc"><p>Storage containing commitments and corresponding commitment hashes that the rollup node has knowledge of.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Commitments_published_at_levels"><a href="#module-Commitments_published_at_levels" class="anchor"></a><code><span><span class="keyword">module</span> Commitments_published_at_levels</span><span> =
  <a href="../Sql_store/Commitments_published_at_levels/index.html">Sql_store.Commitments_published_at_levels</a></span></code></div><div class="spec-doc"><p>Storage mapping commitment hashes to the level when they were published by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Inboxes"><a href="#module-Inboxes" class="anchor"></a><code><span><span class="keyword">module</span> Inboxes</span><span> = <a href="../Sql_store/Inboxes/index.html">Sql_store.Inboxes</a></span></code></div><div class="spec-doc"><p>Aggregated collection of messages from the L1 inbox</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Messages"><a href="#module-Messages" class="anchor"></a><code><span><span class="keyword">module</span> Messages</span><span> = <a href="../Sql_store/Messages/index.html">Sql_store.Messages</a></span></code></div><div class="spec-doc"><p>Storage for persisting messages downloaded from the L1 node.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Outbox_messages"><a href="#module-Outbox_messages" class="anchor"></a><code><span><span class="keyword">module</span> Outbox_messages</span><span> = <a href="../Sql_store/Outbox_messages/index.html">Sql_store.Outbox_messages</a></span></code></div><div class="spec-doc"><p>Storage for persisting outbox messages.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Protocols"><a href="#module-Protocols" class="anchor"></a><code><span><span class="keyword">module</span> Protocols</span><span> = <a href="../Sql_store/Protocols/index.html">Sql_store.Protocols</a></span></code></div><div class="spec-doc"><p>Storage for protocol activation levels.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal_slots_headers"><a href="#module-Dal_slots_headers" class="anchor"></a><code><span><span class="keyword">module</span> Dal_slots_headers</span><span> = <a href="../Sql_store/Dal_slots_headers/index.html">Sql_store.Dal_slots_headers</a></span></code></div><div class="spec-doc"><p>Published slot headers per block hash, stored as a list of bindings from <code>Dal_slot_index.t</code> to <code>Dal.Slot.t</code>. The encoding function converts this list into a <code>Dal.Slot_index.t</code>-indexed map.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal_slots_statuses"><a href="#module-Dal_slots_statuses" class="anchor"></a><code><span><span class="keyword">module</span> Dal_slots_statuses</span><span> = <a href="../Sql_store/Dal_slots_statuses/index.html">Sql_store.Dal_slots_statuses</a></span></code></div><div class="spec-doc"><p><code>Dal_slots_statuses</code> is used to store the attestation status of DAL slots. The values of this storage module have type `<code>`Confirmed |
    `Unconfirmed</code>`, depending on whether the content of the slot has been attested on L1 or not. If an entry is not present for a <code>(block_hash,
    slot_index)</code>, this means that the corresponding block is not processed yet.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-L2_levels"><a href="#module-L2_levels" class="anchor"></a><code><span><span class="keyword">module</span> L2_levels</span><span> = <a href="../Sql_store/L2_levels/index.html">Sql_store.L2_levels</a></span></code></div><div class="spec-doc"><p>Storage for associating levels to block hashes</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-L2_blocks"><a href="#module-L2_blocks" class="anchor"></a><code><span><span class="keyword">module</span> L2_blocks</span><span> = <a href="../Sql_store/L2_blocks/index.html">Sql_store.L2_blocks</a></span></code></div><div class="spec-doc"><p>Storage for L2 blocks contracted by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-State"><a href="#module-State" class="anchor"></a><code><span><span class="keyword">module</span> State</span><span> = <a href="../Sql_store/State/index.html">Sql_store.State</a></span></code></div><div class="spec-doc"><p>Storage of single values.</p></div></div></details></div></div></body></html>
