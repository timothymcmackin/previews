<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Protocols (octez-l2-libs.Octez_smart_rollup_node_store.Sql_store.Protocols)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">octez-l2-libs</a> &#x00BB; <a href="../../index.html">Octez_smart_rollup_node_store</a> &#x00BB; <a href="../index.html">Sql_store</a> &#x00BB; Protocols</nav><header class="odoc-preamble"><h1>Module <code><span>Sql_store.Protocols</span></code></h1><p>Storage for protocol activation levels.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-level"><a href="#type-level" class="anchor"></a><code><span><span class="keyword">type</span> level</span><span> = </span></code><ol><li id="type-level.First_known" class="def variant constructor anchored"><a href="#type-level.First_known" class="anchor"></a><code><span>| </span><span><span class="constructor">First_known</span> <span class="keyword">of</span> int32</span></code></li><li id="type-level.Activation_level" class="def variant constructor anchored"><a href="#type-level.Activation_level" class="anchor"></a><code><span>| </span><span><span class="constructor">Activation_level</span> <span class="keyword">of</span> int32</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-proto_info"><a href="#type-proto_info" class="anchor"></a><code><span><span class="keyword">type</span> proto_info</span><span> = </span><span>{</span></code><ol><li id="type-proto_info.level" class="def record field anchored"><a href="#type-proto_info.level" class="anchor"></a><code><span>level : <a href="#type-level">level</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The level at which we have seen the protocol for the first time, either because we saw its activation or because the first block we saw (at the origination of the rollup) was from this protocol.</p><span class="comment-delim">*)</span></div></li><li id="type-proto_info.proto_level" class="def record field anchored"><a href="#type-proto_info.proto_level" class="anchor"></a><code><span>proto_level : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The protocol level, i.e. its number in the sequence of protocol activations on the chain.</p><span class="comment-delim">*)</span></div></li><li id="type-proto_info.protocol" class="def record field anchored"><a href="#type-proto_info.protocol" class="anchor"></a><code><span>protocol : <a href="../../../../octez-libs/Tezos_crypto/Hashed/Protocol_hash/index.html#type-t">Tezos_base.TzPervasives.Protocol_hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The protocol this information concerns.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Each element of this type represents information we have about a Tezos protocol regarding its activation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-store"><a href="#val-store" class="anchor"></a><code><span><span class="keyword">val</span> store : 
  <span><span class="optlabel">?conn</span>:<a href="../../../Octez_sqlite/Sqlite/index.html#type-conn">Octez_sqlite.Sqlite.conn</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-proto_info">proto_info</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Store a new protocol with its activation level. NOTE: if the protocol hash is already registered, it will be overwritten.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><span class="optlabel">?conn</span>:<a href="../../../Octez_sqlite/Sqlite/index.html#type-conn">Octez_sqlite.Sqlite.conn</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../index.html#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_crypto/Hashed/Protocol_hash/index.html#type-t">Tezos_base.TzPervasives.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-proto_info">proto_info</a> option</span> <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Retrieve protocol information by protocol hash.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-proto_of_level"><a href="#val-proto_of_level" class="anchor"></a><code><span><span class="keyword">val</span> proto_of_level : 
  <span><span class="optlabel">?conn</span>:<a href="../../../Octez_sqlite/Sqlite/index.html#type-conn">Octez_sqlite.Sqlite.conn</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../index.html#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-proto_info">proto_info</a> option</span> <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>proto_of_level ?conn s level</code> returns the protocol in which <code>level</code> appears. It returns <code>None</code> if <code>level</code> is before the activation of the first known protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-last"><a href="#val-last" class="anchor"></a><code><span><span class="keyword">val</span> last : 
  <span><span class="optlabel">?conn</span>:<a href="../../../Octez_sqlite/Sqlite/index.html#type-conn">Octez_sqlite.Sqlite.conn</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../index.html#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-proto_info">proto_info</a> option</span> <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the last protocol by activation level.</p></div></div></div></body></html>
