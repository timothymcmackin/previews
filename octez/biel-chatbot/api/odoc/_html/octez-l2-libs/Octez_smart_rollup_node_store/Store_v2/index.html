<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store_v2 (octez-l2-libs.Octez_smart_rollup_node_store.Store_v2)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-l2-libs</a> &#x00BB; <a href="../index.html">Octez_smart_rollup_node_store</a> &#x00BB; Store_v2</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup_node_store.Store_v2</span></code></h1><p>This version of the store is used for the rollup nodes for protocols for and after Nairobi, i.e. &gt;= 17.</p></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Store_v1/index.html">Store_v1</a> <span class="keyword">end</span></span></code></summary><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Store_v0/index.html">Store_v0</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec module anchored" id="module-Irmin_store"><a href="#module-Irmin_store" class="anchor"></a><code><span><span class="keyword">module</span> Irmin_store</span><span> = <a href="../Store_v0/Irmin_store/index.html">Octez_smart_rollup_node_store.Store_v1.Irmin_store</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-L2_blocks"><a href="#module-L2_blocks" class="anchor"></a><code><span><span class="keyword">module</span> L2_blocks</span><span> = <a href="../Store_v0/L2_blocks/index.html">Octez_smart_rollup_node_store.Store_v1.L2_blocks</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Commitments_published_at_level"><a href="#module-Commitments_published_at_level" class="anchor"></a><code><span><span class="keyword">module</span> Commitments_published_at_level</span><span> =
  <a href="../Store_v0/Commitments_published_at_level/index.html">Octez_smart_rollup_node_store.Store_v1.Commitments_published_at_level</a></span></code></div><div class="spec-doc"><p>Storage mapping commitment hashes to the level when they were published by the rollup node. It only contains hashes of commitments published by this rollup node.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-L2_head"><a href="#module-L2_head" class="anchor"></a><code><span><span class="keyword">module</span> L2_head</span><span> = <a href="../Store_v0/L2_head/index.html">Octez_smart_rollup_node_store.Store_v1.L2_head</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Last_finalized_level"><a href="#module-Last_finalized_level" class="anchor"></a><code><span><span class="keyword">module</span> Last_finalized_level</span><span> =
  <a href="../Store_v0/Last_finalized_level/index.html">Octez_smart_rollup_node_store.Store_v1.Last_finalized_level</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Levels_to_hashes"><a href="#module-Levels_to_hashes" class="anchor"></a><code><span><span class="keyword">module</span> Levels_to_hashes</span><span> =
  <a href="../Store_v0/Levels_to_hashes/index.html">Octez_smart_rollup_node_store.Store_v1.Levels_to_hashes</a></span></code></div></div><div class="odoc-include shadowed-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Store_sig/module-type-S/index.html">Store_sig.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../Store_sig/module-type-S/index.html#type-store">store</a></span> := <span><span class="type-var">'a</span> <a href="../Store_v0/index.html#type-store">Store_v0.store</a></span></span></span></code></summary></details></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal_pages"><a href="#module-Dal_pages" class="anchor"></a><code><span><span class="keyword">module</span> Dal_pages</span><span> = <a href="../Store_v1/Dal_pages/index.html">Store_v1.Dal_pages</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal_processed_slots"><a href="#module-Dal_processed_slots" class="anchor"></a><code><span><span class="keyword">module</span> Dal_processed_slots</span><span> = <a href="../Store_v1/Dal_processed_slots/index.html">Store_v1.Dal_processed_slots</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal_slots_statuses"><a href="#module-Dal_slots_statuses" class="anchor"></a><code><span><span class="keyword">module</span> Dal_slots_statuses</span><span> = <a href="../Store_v1/Dal_slots_statuses/index.html">Store_v1.Dal_slots_statuses</a></span></code></div><div class="spec-doc"><p><code>Dal_slots_statuses</code> is a <code>Store_utils.Nested_map</code> used to store the attestation status of DAL slots. The values of this storage module have type `<code>`Confirmed | `Unconfirmed</code>`, depending on whether the content of the slot has been attested on L1 or not. If an entry is not present for a <code>(block_hash, slot_index)</code>, this means that the corresponding block is not processed yet.</p></div></div><div class="odoc-include shadowed-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Store_sig/module-type-S/index.html">Store_sig.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../Store_sig/module-type-S/index.html#type-store">store</a></span> := <span><span class="type-var">'a</span> <a href="../Store_v1/index.html#type-store">Store_v1.store</a></span></span></span></code></summary></details></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-Messages"><a href="#module-Messages" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Messages/index.html">Messages</a></span><span> : 
  <a href="../../Tezos_layer2_store/Indexed_store/module-type-INDEXED_FILE/index.html">Tezos_layer2_store.Indexed_store.INDEXED_FILE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-INDEXED_FILE/index.html#type-key">key</a> := <a href="../../Octez_smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Octez_smart_rollup.Merkelized_payload_hashes_hash.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-INDEXED_FILE/index.html#type-value">value</a> := <span>string list</span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-INDEXED_FILE/index.html#type-header">header</a> := <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a></span></span></code></div><div class="spec-doc"><p>Storage for persisting messages downloaded from the L1 node.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Inboxes"><a href="#module-Inboxes" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Inboxes/index.html">Inboxes</a></span><span> : 
  <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html">Tezos_layer2_store.Indexed_store.SIMPLE_INDEXED_FILE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html#type-key">key</a> := <a href="../../Octez_smart_rollup/Inbox_hash/index.html#type-t">Octez_smart_rollup.Inbox.Hash.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html#type-value">value</a> := <a href="../../Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html#type-header">header</a> := unit</span></span></code></div><div class="spec-doc"><p>Storage for persisting inboxes.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Commitments"><a href="#module-Commitments" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Commitments/index.html">Commitments</a></span><span> : 
  <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html">Tezos_layer2_store.Indexed_store.SIMPLE_INDEXED_FILE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html#type-key">key</a> := <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html#type-value">value</a> := <a href="../../Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SIMPLE_INDEXED_FILE/index.html#type-header">header</a> := unit</span></span></code></div><div class="spec-doc"><p>Storage containing commitments and corresponding commitment hashes that the rollup node has knowledge of.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Outbox_messages"><a href="#module-Outbox_messages" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Outbox_messages/index.html">Outbox_messages</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Lcc"><a href="#module-Lcc" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Lcc/index.html">Lcc</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Storage containing the last cemented commitment.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Lpc"><a href="#module-Lpc" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Lpc/index.html">Lpc</a></span><span> : 
  <a href="../../Tezos_layer2_store/Indexed_store/module-type-SINGLETON_STORE/index.html">Tezos_layer2_store.Indexed_store.SINGLETON_STORE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SINGLETON_STORE/index.html#type-value">value</a> := <a href="../../Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a></span></span></code></div><div class="spec-doc"><p>Storage containing a single commitment for the last published commitment.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Dal_slots_headers"><a href="#module-Dal_slots_headers" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Dal_slots_headers/index.html">Dal_slots_headers</a></span><span> : 
  <a href="../../Tezos_layer2_store/Store_sigs/module-type-Nested_map/index.html">Tezos_layer2_store.Store_sigs.Nested_map</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Store_sigs/module-type-Nested_map/index.html#type-primary_key">primary_key</a> := <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Store_sigs/module-type-Nested_map/index.html#type-secondary_key">secondary_key</a> := <a href="../../Octez_smart_rollup/Dal/Slot_index/index.html#type-t">Octez_smart_rollup.Dal.Slot_index.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Store_sigs/module-type-Nested_map/index.html#type-value">value</a> := <a href="../../Octez_smart_rollup/Dal/Slot_header/index.html#type-t">Octez_smart_rollup.Dal.Slot_header.t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <span>'a <a href="../../Tezos_layer2_store/Store_sigs/module-type-Nested_map/index.html#type-store">store</a></span> := <span><span class="type-var">'a</span> <a href="../Store_v0/Irmin_store/index.html#type-t">Irmin_store.t</a></span></span></span></code></div><div class="spec-doc"><p>Published slot headers per block hash, stored as a list of bindings from <code>Dal_slot_index.t</code> to <code>Dal.Slot.t</code>. The encoding function converts this list into a <code>Dal.Slot_index.t</code>-indexed map.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Protocols"><a href="#module-Protocols" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Protocols/index.html">Protocols</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Gc_levels"><a href="#module-Gc_levels" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Gc_levels/index.html">Gc_levels</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Data related to the effects of garbage collection.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Last_context_split"><a href="#module-Last_context_split" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Last_context_split/index.html">Last_context_split</a></span><span> : 
  <a href="../../Tezos_layer2_store/Indexed_store/module-type-SINGLETON_STORE/index.html">Tezos_layer2_store.Indexed_store.SINGLETON_STORE</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SINGLETON_STORE/index.html#type-value">value</a> := int32</span></span></code></div><div class="spec-doc"><p>Level at which context was last split.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-history_mode"><a href="#type-history_mode" class="anchor"></a><code><span><span class="keyword">type</span> history_mode</span><span> = </span></code><ol><li id="type-history_mode.Archive" class="def variant constructor anchored"><a href="#type-history_mode.Archive" class="anchor"></a><code><span>| </span><span><span class="constructor">Archive</span></span></code></li><li id="type-history_mode.Full" class="def variant constructor anchored"><a href="#type-history_mode.Full" class="anchor"></a><code><span>| </span><span><span class="constructor">Full</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-History_mode"><a href="#module-History_mode" class="anchor"></a><code><span><span class="keyword">module</span> <a href="History_mode/index.html">History_mode</a></span><span> : 
  <a href="../../Tezos_layer2_store/Indexed_store/module-type-SINGLETON_STORE/index.html">Tezos_layer2_store.Indexed_store.SINGLETON_STORE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_layer2_store/Indexed_store/module-type-SINGLETON_STORE/index.html#type-value">value</a> := <a href="#type-history_mode">history_mode</a></span></span></code></div><div class="spec-doc"><p>History mode of the rollup node.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-store"><a href="#type-store" class="anchor"></a><code><span><span class="keyword">type</span> <span>+'a store</span></span><span> = </span><span>{</span></code><ol><li id="type-store.l2_blocks" class="def record field anchored"><a href="#type-store.l2_blocks" class="anchor"></a><code><span>l2_blocks : <span><span class="type-var">'a</span> <a href="../Store_v0/L2_blocks/index.html#type-t">L2_blocks.t</a></span>;</span></code></li><li id="type-store.messages" class="def record field anchored"><a href="#type-store.messages" class="anchor"></a><code><span>messages : <span><span class="type-var">'a</span> <a href="Messages/index.html#type-t">Messages.t</a></span>;</span></code></li><li id="type-store.inboxes" class="def record field anchored"><a href="#type-store.inboxes" class="anchor"></a><code><span>inboxes : <span><span class="type-var">'a</span> <a href="Inboxes/index.html#type-t">Inboxes.t</a></span>;</span></code></li><li id="type-store.commitments" class="def record field anchored"><a href="#type-store.commitments" class="anchor"></a><code><span>commitments : <span><span class="type-var">'a</span> <a href="Commitments/index.html#type-t">Commitments.t</a></span>;</span></code></li><li id="type-store.commitments_published_at_level" class="def record field anchored"><a href="#type-store.commitments_published_at_level" class="anchor"></a><code><span>commitments_published_at_level : <span><span class="type-var">'a</span> <a href="../Store_v0/Commitments_published_at_level/index.html#type-t">Commitments_published_at_level.t</a></span>;</span></code></li><li id="type-store.outbox_messages" class="def record field anchored"><a href="#type-store.outbox_messages" class="anchor"></a><code><span>outbox_messages : <span><span class="type-var">'a</span> <a href="Outbox_messages/index.html#type-t">Outbox_messages.t</a></span>;</span></code></li><li id="type-store.l2_head" class="def record field anchored"><a href="#type-store.l2_head" class="anchor"></a><code><span>l2_head : <span><span class="type-var">'a</span> <a href="../Store_v0/L2_head/index.html#type-t">L2_head.t</a></span>;</span></code></li><li id="type-store.last_finalized_level" class="def record field anchored"><a href="#type-store.last_finalized_level" class="anchor"></a><code><span>last_finalized_level : <span><span class="type-var">'a</span> <a href="../Store_v0/Last_finalized_level/index.html#type-t">Last_finalized_level.t</a></span>;</span></code></li><li id="type-store.lcc" class="def record field anchored"><a href="#type-store.lcc" class="anchor"></a><code><span>lcc : <span><span class="type-var">'a</span> <a href="Lcc/index.html#type-t">Lcc.t</a></span>;</span></code></li><li id="type-store.lpc" class="def record field anchored"><a href="#type-store.lpc" class="anchor"></a><code><span>lpc : <span><span class="type-var">'a</span> <a href="Lpc/index.html#type-t">Lpc.t</a></span>;</span></code></li><li id="type-store.levels_to_hashes" class="def record field anchored"><a href="#type-store.levels_to_hashes" class="anchor"></a><code><span>levels_to_hashes : <span><span class="type-var">'a</span> <a href="../Store_v0/Levels_to_hashes/index.html#type-t">Levels_to_hashes.t</a></span>;</span></code></li><li id="type-store.protocols" class="def record field anchored"><a href="#type-store.protocols" class="anchor"></a><code><span>protocols : <span><span class="type-var">'a</span> <a href="Protocols/index.html#type-t">Protocols.t</a></span>;</span></code></li><li id="type-store.irmin_store" class="def record field anchored"><a href="#type-store.irmin_store" class="anchor"></a><code><span>irmin_store : <span><span class="type-var">'a</span> <a href="../Store_v0/Irmin_store/index.html#type-t">Irmin_store.t</a></span>;</span></code></li><li id="type-store.gc_levels" class="def record field anchored"><a href="#type-store.gc_levels" class="anchor"></a><code><span>gc_levels : <span><span class="type-var">'a</span> <a href="Gc_levels/index.html#type-t">Gc_levels.t</a></span>;</span></code></li><li id="type-store.successful_gc_levels" class="def record field anchored"><a href="#type-store.successful_gc_levels" class="anchor"></a><code><span>successful_gc_levels : <span><span class="type-var">'a</span> <a href="Gc_levels/index.html#type-t">Gc_levels.t</a></span>;</span></code></li><li id="type-store.last_context_split_level" class="def record field anchored"><a href="#type-store.last_context_split_level" class="anchor"></a><code><span>last_context_split_level : <span><span class="type-var">'a</span> <a href="Last_context_split/index.html#type-t">Last_context_split.t</a></span>;</span></code></li><li id="type-store.history_mode" class="def record field anchored"><a href="#type-store.history_mode" class="anchor"></a><code><span>history_mode : <span><span class="type-var">'a</span> <a href="History_mode/index.html#type-t">History_mode.t</a></span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Store_sig/module-type-S/index.html">Store_sig.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../Store_sig/module-type-S/index.html#type-store">store</a></span> := <span><span class="type-var">'a</span> <a href="#type-store">store</a></span></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = <span><span>[&lt; `Read <span>| `Write</span> Read ]</span> <span class="keyword">as</span> 'a <a href="#type-store">store</a></span></span></code></div><div class="spec-doc"><p>Type of store. The parameter indicates if the store can be written or only read.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-rw"><a href="#type-rw" class="anchor"></a><code><span><span class="keyword">type</span> rw</span><span> = <span><a href="../../Tezos_layer2_store/Store_sigs/index.html#type-rw">Tezos_layer2_store.Store_sigs.rw</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Read/write store <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ro"><a href="#type-ro" class="anchor"></a><code><span><span class="keyword">type</span> ro</span><span> = <span><a href="../../Tezos_layer2_store/Store_sigs/index.html#type-ro">Tezos_layer2_store.Store_sigs.ro</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Read only store <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-version"><a href="#val-version" class="anchor"></a><code><span><span class="keyword">val</span> version : <a href="../Store_version/index.html#type-t">Store_version.t</a></span></code></div><div class="spec-doc"><p>Version supported by this code.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>close store</code> closes the store.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : 
  <span><span><span class="type-var">'a</span> <a href="../../Tezos_layer2_store/Store_sigs/index.html#type-mode">Tezos_layer2_store.Store_sigs.mode</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">index_buffer_size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">l2_blocks_cache_size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> <a href="#type-store">store</a></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>load mode ~index_buffer_size ~l2_blocks_cache_size directory</code> loads a store from the data persisted in <code>directory</code>. If <code>mode</code> is <code>Store_sigs.Read_only</code>, then the indexes and irmin store will be opened in readonly mode and only read operations will be permitted. This allows to open a store for read access that is already opened in <code>Store_sigs.Read_write</code> mode in another process. <code>index_buffer_size</code> is the maximum cache size in memory before it is flushed to disk. <code>l2_blocks_cache_size</code> is the number of L2 blocks the rollup node will keep in memory.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-readonly"><a href="#val-readonly" class="anchor"></a><code><span><span class="keyword">val</span> readonly : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-ro">ro</a></span></code></div><div class="spec-doc"><p><code>readonly store</code> returns a read-only version of <code>store</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_l2_blocks"><a href="#val-iter_l2_blocks" class="anchor"></a><code><span><span class="keyword">val</span> iter_l2_blocks : 
  <span><span class="optlabel">?progress</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Octez_smart_rollup/Metadata/index.html#type-t">Octez_smart_rollup.Metadata.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>iter_l2_blocks ?progress metadata store f</code> iterates <code>f</code> on all L2 blocks reachable from the head, from newest to oldest. If <code>progress</code> is provided, a progress bar is displayed with the progress messages during the iteration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gc"><a href="#val-gc" class="anchor"></a><code><span><span class="keyword">val</span> gc : <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>gc store ~level</code> asynchronously garbage collects everything from the store that concerns blocks for levels below <code>level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_gc_completion"><a href="#val-wait_gc_completion" class="anchor"></a><code><span><span class="keyword">val</span> wait_gc_completion : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>wait_gc_completion store</code> returns a blocking thread if a GC run is currently ongoing.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_gc_finished"><a href="#val-is_gc_finished" class="anchor"></a><code><span><span class="keyword">val</span> is_gc_finished : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_gc_finished t</code> returns <code>true</code> if there is no GC running.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cancel_gc"><a href="#val-cancel_gc" class="anchor"></a><code><span><span class="keyword">val</span> cancel_gc : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>cancel_gc t</code> stops any currently ongoing GC. It returns <code>true</code> if a GC was canceled.</p></div></div></div></body></html>
