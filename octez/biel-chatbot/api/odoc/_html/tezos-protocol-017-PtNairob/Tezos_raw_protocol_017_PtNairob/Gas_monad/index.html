<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gas_monad (tezos-protocol-017-PtNairob.Tezos_raw_protocol_017_PtNairob.Gas_monad)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-017-PtNairob</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_017_PtNairob</a> &#x00BB; Gas_monad</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_017_PtNairob.Gas_monad</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'trace) t</span></span></code></div><div class="spec-doc"><p>This monad combines:</p><ul><li>a state monad where the state is the context</li><li>two levels of error monad to distinguish gas exhaustion from other errors</li></ul><p>It is useful for backtracking on type checking errors without backtracking the consumed gas.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-gas_monad"><a href="#type-gas_monad" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'trace) gas_monad</span></span><span> = <span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Alias of <code>('a, 'trace) t</code> to avoid confusion when the module is open</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return x</code> returns a value in the gas-monad.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f m</code> maps over successful results of <code>m</code> using <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind m f</code> binds successful results of <code>m</code> and feeds it to <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind_recover"><a href="#val-bind_recover" class="anchor"></a><code><span><span class="keyword">val</span> bind_recover : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="../../Tezos_protocol_environment_017_PtNairob/Pervasives/index.html#type-result">Tezos_protocol_environment_017_PtNairob.Pervasives.result</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>(<span class="type-var">'b</span>, <span class="type-var">'trace'</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span class="type-var">'trace'</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind_recover m f</code> binds the result of <code>m</code> and feeds it to <code>f</code>. It's another variant of <code>bind</code> that allows recovery from inner errors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_result"><a href="#val-of_result" class="anchor"></a><code><span><span class="keyword">val</span> of_result : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="../../Tezos_protocol_environment_017_PtNairob/Pervasives/index.html#type-result">Tezos_protocol_environment_017_PtNairob.Pervasives.result</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_result r</code> is a gas-free embedding of the result <code>r</code> into the gas monad.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consume_gas"><a href="#val-consume_gas" class="anchor"></a><code><span><span class="keyword">val</span> consume_gas : <span><a href="../Alpha_context/Gas/index.html#type-cost">Alpha_context.Gas.cost</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>consume_gas c</code> consumes c amounts of gas. It's a wrapper around <code>Gas.consume</code>. If that fails, the whole computation within the gas-monad returns an error. See the <code>Alpha_context.Gas</code> module for details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><a href="../Alpha_context/index.html#type-context">Alpha_context.context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="../../Tezos_protocol_environment_017_PtNairob/Pervasives/index.html#type-result">Tezos_protocol_environment_017_PtNairob.Pervasives.result</a></span>
   * <a href="../Alpha_context/index.html#type-context">Alpha_context.context</a>)</span>
    <a href="../../Tezos_protocol_environment_017_PtNairob/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_017_PtNairob.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>run ctxt m</code> runs <code>m</code> using the given context and returns the result along with the new context with updated gas. The given context has <code>unlimited</code> mode enabled, through <code>Gas.set_unlimited</code>, no gas is consumed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_trace_eval"><a href="#val-record_trace_eval" class="anchor"></a><code><span><span class="keyword">val</span> record_trace_eval : 
  <span><span class="label">error_details</span>:<span><span>(<span class="type-var">'error_context</span>, <span class="type-var">'error_trace</span>)</span> <a href="../Script_tc_errors/index.html#type-error_details">Script_tc_errors.error_details</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'error_context</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../Tezos_protocol_environment_017_PtNairob/Error_monad/index.html#type-error">Tezos_protocol_environment_017_PtNairob.Error_monad.error</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'error_trace</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'error_trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>record_trace_level ~error_details f m</code> returns a new gas-monad value that when run, records trace levels using <code>f</code>. This function has no effect in the case of a gas-exhaustion error or if <code>error_details</code> is <code>Fast</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span><span class="type-var">'trace</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'trace</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fail e</code> is <code>return (Error e)</code> .</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Syntax"><a href="#module-Syntax" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Syntax/index.html">Syntax</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Syntax module for the <a href="#"><code>Gas_monad</code></a>. This is intended to be opened locally in functions. Within the scope of this module, the code can include binding operators, leading to a <code>let</code>-style syntax. Similar to <code>Lwt_result_syntax</code> and other syntax modules.</p></div></div></div></body></html>
