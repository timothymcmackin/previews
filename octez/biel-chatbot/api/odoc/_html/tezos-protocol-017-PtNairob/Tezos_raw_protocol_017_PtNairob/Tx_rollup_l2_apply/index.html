<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tx_rollup_l2_apply (tezos-protocol-017-PtNairob.Tezos_raw_protocol_017_PtNairob.Tx_rollup_l2_apply)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tezos-protocol-017-PtNairob</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_017_PtNairob</a> &#x00BB; Tx_rollup_l2_apply</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_017_PtNairob.Tx_rollup_l2_apply</span></code></h1><p>This module introduces the interpretation (off-chain) of layer2 operations read from its inboxes.</p><p>The main concern is now to interpret operations in the layer2 context with a high-throughput and process a significant number of operations “per second.”</p><p>The operations can be crafted with indexes (see <a href="../Indexable/index.html"><code>Indexable</code></a>). It is meant to reduce the size of operations, and therefore, increase the number of those in a message to the layer2. You will see in this file indexables which are yet unknowns (see <a href="../Indexable/index.html#type-unknown"><code>Indexable.unknown</code></a>). They can be later on modified to indexes only (see <a href="../Indexable/index.html#type-index_only"><code>Indexable.index_only</code></a>) when the potential values have been replaced by their indexes.</p><p>Therefore, we need to have the minimal number of accesses to the context. Thus, when a value is read from its index in the context, it *must* be done once.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Counter_mismatch"><a href="#extension-decl-Counter_mismatch" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_017_PtNairob/Error_monad/index.html#type-error">Tezos_protocol_environment_017_PtNairob.Error_monad.error</a> += </span></code><ol><li id="extension-Counter_mismatch" class="def variant extension anchored"><a href="#extension-Counter_mismatch" class="anchor"></a><code><span>| </span><span><span class="extension">Counter_mismatch</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Tx_rollup_l2_apply.account" class="def record field anchored"><a href="#module-Tx_rollup_l2_apply.account" class="anchor"></a><code><span>account : <a href="../Tx_rollup_l2_address/index.html#type-t">Tx_rollup_l2_address.t</a>;</span></code></li><li id="module-Tx_rollup_l2_apply.expected" class="def record field anchored"><a href="#module-Tx_rollup_l2_apply.expected" class="anchor"></a><code><span>expected : int64;</span></code></li><li id="module-Tx_rollup_l2_apply.provided" class="def record field anchored"><a href="#module-Tx_rollup_l2_apply.provided" class="anchor"></a><code><span>provided : int64;</span></code></li></ol><code><span>}</span></code></li><li id="extension-Incorrect_aggregated_signature" class="def variant extension anchored"><a href="#extension-Incorrect_aggregated_signature" class="anchor"></a><code><span>| </span><span><span class="extension">Incorrect_aggregated_signature</span></span></code></li><li id="extension-Unallocated_metadata" class="def variant extension anchored"><a href="#extension-Unallocated_metadata" class="anchor"></a><code><span>| </span><span><span class="extension">Unallocated_metadata</span> <span class="keyword">of</span> int32</span></code></li><li id="extension-Multiple_operations_for_signer" class="def variant extension anchored"><a href="#extension-Multiple_operations_for_signer" class="anchor"></a><code><span>| </span><span><span class="extension">Multiple_operations_for_signer</span> <span class="keyword">of</span> <a href="../../Tezos_protocol_environment_017_PtNairob/Bls/Public_key/index.html#type-t">Tezos_protocol_environment_017_PtNairob.Bls.Public_key.t</a></span></code></li><li id="extension-Invalid_transaction_encoding" class="def variant extension anchored"><a href="#extension-Invalid_transaction_encoding" class="anchor"></a><code><span>| </span><span><span class="extension">Invalid_transaction_encoding</span></span></code></li><li id="extension-Invalid_batch_encoding" class="def variant extension anchored"><a href="#extension-Invalid_batch_encoding" class="anchor"></a><code><span>| </span><span><span class="extension">Invalid_batch_encoding</span></span></code></li><li id="extension-Unexpectedly_indexed_ticket" class="def variant extension anchored"><a href="#extension-Unexpectedly_indexed_ticket" class="anchor"></a><code><span>| </span><span><span class="extension">Unexpectedly_indexed_ticket</span></span></code></li><li id="extension-Missing_ticket" class="def variant extension anchored"><a href="#extension-Missing_ticket" class="anchor"></a><code><span>| </span><span><span class="extension">Missing_ticket</span> <span class="keyword">of</span> <a href="../Alpha_context/Ticket_hash/index.html#type-t">Alpha_context.Ticket_hash.t</a></span></code></li><li id="extension-Unknown_address" class="def variant extension anchored"><a href="#extension-Unknown_address" class="anchor"></a><code><span>| </span><span><span class="extension">Unknown_address</span> <span class="keyword">of</span> <a href="../Tx_rollup_l2_address/index.html#type-t">Tx_rollup_l2_address.t</a></span></code></li><li id="extension-Invalid_self_transfer" class="def variant extension anchored"><a href="#extension-Invalid_self_transfer" class="anchor"></a><code><span>| </span><span><span class="extension">Invalid_self_transfer</span></span></code></li><li id="extension-Invalid_zero_transfer" class="def variant extension anchored"><a href="#extension-Invalid_zero_transfer" class="anchor"></a><code><span>| </span><span><span class="extension">Invalid_zero_transfer</span></span></code></li><li id="extension-Maximum_withdraws_per_message_exceeded" class="def variant extension anchored"><a href="#extension-Maximum_withdraws_per_message_exceeded" class="anchor"></a><code><span>| </span><span><span class="extension">Maximum_withdraws_per_message_exceeded</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Tx_rollup_l2_apply.current" class="def record field anchored"><a href="#module-Tx_rollup_l2_apply.current" class="anchor"></a><code><span>current : int;</span></code></li><li id="module-Tx_rollup_l2_apply.maximum" class="def record field anchored"><a href="#module-Tx_rollup_l2_apply.maximum" class="anchor"></a><code><span>maximum : int;</span></code></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-indexes"><a href="#type-indexes" class="anchor"></a><code><span><span class="keyword">type</span> indexes</span><span> = </span><span>{</span></code><ol><li id="type-indexes.address_indexes" class="def record field anchored"><a href="#type-indexes.address_indexes" class="anchor"></a><code><span>address_indexes : <span><span>(<a href="../Tx_rollup_l2_address/index.html#type-t">Tx_rollup_l2_address.t</a>
                   * <a href="../Tx_rollup_l2_address/Indexable/index.html#type-index">Tx_rollup_l2_address.Indexable.index</a>)</span>
                    list</span>;</span></code></li><li id="type-indexes.ticket_indexes" class="def record field anchored"><a href="#type-indexes.ticket_indexes" class="anchor"></a><code><span>ticket_indexes : <span><span>(<a href="../Alpha_context/Ticket_hash/index.html#type-t">Alpha_context.Ticket_hash.t</a>
                  * <a href="../Tx_rollup_l2_context_sig/Ticket_indexable/index.html#type-index">Tx_rollup_l2_context_sig.Ticket_indexable.index</a>)</span>
                   list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Applying operations in the layer2 can result in creating indexes associated to both the addresses and the ticket hashes. We keep track of these creations in order to replace the values by their indexes in future operations.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Message_result"><a href="#module-Message_result" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Message_result/index.html">Message_result</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-parameters"><a href="#type-parameters" class="anchor"></a><code><span><span class="keyword">type</span> parameters</span><span> = </span><span>{</span></code><ol><li id="type-parameters.tx_rollup_max_withdrawals_per_batch" class="def record field anchored"><a href="#type-parameters.tx_rollup_max_withdrawals_per_batch" class="anchor"></a><code><span>tx_rollup_max_withdrawals_per_batch : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The record of parameters used during the application of messages.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Make/index.html">Make</a></span><span> (<a href="Make/argument-1-Context/index.html">Context</a> : <a href="../Tx_rollup_l2_context_sig/module-type-CONTEXT/index.html">Tx_rollup_l2_context_sig.CONTEXT</a>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
