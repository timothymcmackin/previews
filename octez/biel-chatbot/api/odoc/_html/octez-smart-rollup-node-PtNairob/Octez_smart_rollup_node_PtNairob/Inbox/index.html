<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Inbox (octez-smart-rollup-node-PtNairob.Octez_smart_rollup_node_PtNairob.Inbox)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-smart-rollup-node-PtNairob</a> &#x00BB; <a href="../index.html">Octez_smart_rollup_node_PtNairob</a> &#x00BB; Inbox</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup_node_PtNairob.Inbox</span></code></h1><p>The rollup node maintains an inbox of incoming messages.</p><p>The incoming messages for a rollup are published on the layer 1. To maintain the state of its inbox, a rollup node retrieves these messages each time the tezos blockchain is updated.</p><p>The inbox state is persistent.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-process_head"><a href="#val-process_head" class="anchor"></a><code><span><span class="keyword">val</span> process_head : 
  <span><a href="../../../octez-smart-rollup-node-lib/Octez_smart_rollup_node/Node_context/index.html#type-rw">Octez_smart_rollup_node.Node_context.rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor</span>:<a href="../../../octez-smart-rollup-node-lib/Octez_smart_rollup_node/Layer1/index.html#type-header">Octez_smart_rollup_node.Layer1.header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-smart-rollup-node-lib/Octez_smart_rollup_node/Layer1/index.html#type-header">Octez_smart_rollup_node.Layer1.header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox_hash/index.html#type-t">Octez_smart_rollup.Inbox.Hash.t</a>
   * <a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a>
   * <a href="../../../octez-l2-libs/Octez_smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Octez_smart_rollup.Merkelized_payload_hashes_hash.t</a>
   * <span>string list</span>)</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>process_head node_ctxt ~predecessor head operations</code> changes the state of the inbox to react to <code>head</code> (where <code>predecessor</code> is the predecessor of <code>head</code> in the L1 chain). In particular, this process filters the provided <code>operations</code> of the <code>head</code> block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_messages"><a href="#val-add_messages" class="anchor"></a><code><span><span class="keyword">val</span> add_messages : 
  <span><span class="label">is_first_block</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_timestamp</span>:
    <a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Timestamp/index.html#type-time">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Timestamp.time</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox_message/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox_message.t</a>
    list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox_merkelized_payload_hashes/History/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox_merkelized_payload_hashes.History.t</a>
   * <a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox_merkelized_payload_hashes/Hash/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox_merkelized_payload_hashes.Hash.t</a>
   * <a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox.t</a>
   * <span><a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox_message/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox_message.t</a>
       list</span>)</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>add_messages ~is_first_block ~predecessor_timestamp
    ~predecessor inbox messages</code> adds <code>messages</code> to the <code>inbox</code> using <code>Sc_rollup.Inbox.add_all_messages</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-payloads_history_of_messages"><a href="#val-payloads_history_of_messages" class="anchor"></a><code><span><span class="keyword">val</span> payloads_history_of_messages : 
  <span><span class="label">is_first_block</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_timestamp</span>:
    <a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Timestamp/index.html#type-time">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Timestamp.time</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox_merkelized_payload_hashes/History/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox_merkelized_payload_hashes.History.t</a>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>payloads_history_of_messages ~is_first_block ~predecessor
    ~predecessor_timestamp messages</code> builds the payloads history for the list of <code>messages</code>. This allows to not store payloads histories (which contain merkelized skip lists) but simply messages.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-payloads_history_of_all_messages"><a href="#val-payloads_history_of_all_messages" class="anchor"></a><code><span><span class="keyword">val</span> payloads_history_of_all_messages : 
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-017-PtNairob/Tezos_raw_protocol_017_PtNairob/Alpha_context/Sc_rollup/Inbox_merkelized_payload_hashes/History/index.html#type-t">Tezos_protocol_017_PtNairob.Protocol.Alpha_context.Sc_rollup.Inbox_merkelized_payload_hashes.History.t</a>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>payloads_history_of_all_messages messages</code> builds the merkelized payloads history for the list of serialzied messages <code>messages</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-same_as_layer_1"><a href="#val-same_as_layer_1" class="anchor"></a><code><span><span class="keyword">val</span> same_as_layer_1 : 
  <span><span><span class="type-var">_</span> <a href="../../../octez-smart-rollup-node-lib/Octez_smart_rollup_node/Node_context/index.html#type-t">Octez_smart_rollup_node.Node_context.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>same_as_layer_1 node_ctxt block node_inbox</code> ensures that the rollup node agrees with the L1 node that inbox for <code>block</code> is <code>node_inbox</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-serialize_external_message"><a href="#val-serialize_external_message" class="anchor"></a><code><span><span class="keyword">val</span> serialize_external_message : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p>Serialize an external messages to the protocol representation. NOTE: this adds a tag <code>'\001'</code> at the beginning.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><span class="label">predecessor_timestamp</span>:<a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a></span></code></div><div class="spec-doc"><p>Returns the initial global inbox where <code>level</code> is the first level of the protocol with smart rollups.</p></div></div></div></body></html>
