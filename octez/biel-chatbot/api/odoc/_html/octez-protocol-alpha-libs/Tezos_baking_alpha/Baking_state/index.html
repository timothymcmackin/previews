<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Baking_state (octez-protocol-alpha-libs.Tezos_baking_alpha.Baking_state)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-alpha-libs</a> &#x00BB; <a href="../index.html">Tezos_baking_alpha</a> &#x00BB; Baking_state</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_baking_alpha.Baking_state</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#consensus-key-type-and-functions">Consensus key type and functions</a></li><li><a href="#delegates-slots-type-and-functions">Delegates slots type and functions</a></li><li><a href="#consensus-operations-types-functions">Consensus operations types functions</a></li><li><a href="#block-info-types-and-functions">Block info types and functions</a></li><li><a href="#proposal-type-and-functions">Proposal type and functions</a></li><li><a href="#elected-block-type-and-functions">Elected block type and functions</a></li><li><a href="#locked_round-type-and-functions">Locked_round type and functions</a></li><li><a href="#attestable_payload-type-and-functions">Attestable_payload type and functions</a></li><li><a href="#level_state-type-and-functions">Level_state type and functions</a></li><li><a href="#round_state-type-and-functions">Round_state type and functions</a></li><li><a href="#forge-types-and-functions">Forge types and functions</a></li><li><a href="#global_state-types-and-functions">Global_state types and functions</a></li><li><a href="#timeout-type-and-functions">Timeout type and functions</a></li><li><a href="#state_data-type-and-functions">State_data type and functions</a></li><li><a href="#event-type-and-functions">Event type and functions</a></li></ul></nav><div class="odoc-content"><h3 id="consensus-key-type-and-functions"><a href="#consensus-key-type-and-functions" class="anchor"></a>Consensus key type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-consensus_key"><a href="#type-consensus_key" class="anchor"></a><code><span><span class="keyword">type</span> consensus_key</span><span> = </span><span>{</span></code><ol><li id="type-consensus_key.alias" class="def record field anchored"><a href="#type-consensus_key.alias" class="anchor"></a><code><span>alias : <span>string option</span>;</span></code></li><li id="type-consensus_key.public_key" class="def record field anchored"><a href="#type-consensus_key.public_key" class="anchor"></a><code><span>public_key : <a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-public_key">Tezos_base.TzPervasives.Signature.public_key</a>;</span></code></li><li id="type-consensus_key.public_key_hash" class="def record field anchored"><a href="#type-consensus_key.public_key_hash" class="anchor"></a><code><span>public_key_hash : <a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-public_key_hash">Tezos_base.TzPervasives.Signature.public_key_hash</a>;</span></code></li><li id="type-consensus_key.secret_key_uri" class="def record field anchored"><a href="#type-consensus_key.secret_key_uri" class="anchor"></a><code><span>secret_key_uri : <a href="../../../octez-shell-libs/Tezos_client_base/Client_keys/index.html#type-sk_uri">Tezos_client_base.Client_keys.sk_uri</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consensus_key_encoding"><a href="#val-consensus_key_encoding" class="anchor"></a><code><span><span class="keyword">val</span> consensus_key_encoding : 
  <span><a href="#type-consensus_key">consensus_key</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_consensus_key"><a href="#val-pp_consensus_key" class="anchor"></a><code><span><span class="keyword">val</span> pp_consensus_key : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-consensus_key">consensus_key</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-consensus_key_and_delegate"><a href="#type-consensus_key_and_delegate" class="anchor"></a><code><span><span class="keyword">type</span> consensus_key_and_delegate</span><span> =
  <a href="#type-consensus_key">consensus_key</a> * <a href="../../../octez-libs/Tezos_crypto/Signature/Public_key_hash/index.html#type-t">Tezos_base.TzPervasives.Signature.Public_key_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consensus_key_and_delegate_encoding"><a href="#val-consensus_key_and_delegate_encoding" class="anchor"></a><code><span><span class="keyword">val</span> consensus_key_and_delegate_encoding : 
  <span><a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_consensus_key_and_delegate"><a href="#val-pp_consensus_key_and_delegate" class="anchor"></a><code><span><span class="keyword">val</span> pp_consensus_key_and_delegate : 
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><h3 id="delegates-slots-type-and-functions"><a href="#delegates-slots-type-and-functions" class="anchor"></a>Delegates slots type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-delegate_slot"><a href="#type-delegate_slot" class="anchor"></a><code><span><span class="keyword">type</span> delegate_slot</span><span> = </span><span>{</span></code><ol><li id="type-delegate_slot.consensus_key_and_delegate" class="def record field anchored"><a href="#type-delegate_slot.consensus_key_and_delegate" class="anchor"></a><code><span>consensus_key_and_delegate : <a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a>;</span></code></li><li id="type-delegate_slot.first_slot" class="def record field anchored"><a href="#type-delegate_slot.first_slot" class="anchor"></a><code><span>first_slot : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Slot/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Slot.t</a>;</span></code></li><li id="type-delegate_slot.attesting_power" class="def record field anchored"><a href="#type-delegate_slot.attesting_power" class="anchor"></a><code><span>attesting_power : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A delegate slot consists of the delegate's consensus key, its public key hash, its first slot, and its attesting power at some level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_delegate_slot"><a href="#val-pp_delegate_slot" class="anchor"></a><code><span><span class="keyword">val</span> pp_delegate_slot : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-delegate_slot">delegate_slot</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Delegate_slots"><a href="#module-Delegate_slots" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Delegate_slots/index.html">Delegate_slots</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-delegate_slots"><a href="#type-delegate_slots" class="anchor"></a><code><span><span class="keyword">type</span> delegate_slots</span><span> = <a href="Delegate_slots/index.html#type-t">Delegate_slots.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_delegate_slots"><a href="#val-pp_delegate_slots" class="anchor"></a><code><span><span class="keyword">val</span> pp_delegate_slots : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-delegate_slots">delegate_slots</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_delegate_slots"><a href="#val-compute_delegate_slots" class="anchor"></a><code><span><span class="keyword">val</span> compute_delegate_slots : 
  <span><a href="../../Tezos_client_alpha/Protocol_client_context/class-type-full/index.html">Tezos_client_alpha.Protocol_client_context.full</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?block</span>:<a href="../../../octez-shell-libs/Tezos_shell_services/Block_services/index.html#type-block">Tezos_shell_services.Block_services.block</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">chain</span>:<a href="../../../octez-shell-libs/Tezos_shell_services/Shell_services/index.html#type-chain">Tezos_shell_services.Shell_services.chain</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-consensus_key">consensus_key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-delegate_slots">delegate_slots</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_delegate_slots cctxt ?block ~level ~chain delegates</code> computes the delegate slots of the given <code>delegates</code> for the <code>level</code></p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">block</span> <p>default to <code>`Head 0</code></p></li></ul></div></div><h3 id="consensus-operations-types-functions"><a href="#consensus-operations-types-functions" class="anchor"></a>Consensus operations types functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-dal_attestable_slots"><a href="#type-dal_attestable_slots" class="anchor"></a><code><span><span class="keyword">type</span> dal_attestable_slots</span><span> =
  <span><span>(<a href="../../../octez-libs/Tezos_crypto/Signature/Public_key_hash/index.html#type-t">Tezos_base.TzPervasives.Signature.Public_key_hash.t</a>
   * <span><span><a href="../../../tezos-dal-node-services/Tezos_dal_node_services/Types/index.html#type-attestable_slots">Tezos_dal_node_services.Types.attestable_slots</a>
       <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
       <span class="xref-unresolved">Lwt</span>.t</span>)</span>
    list</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-consensus_vote_kind"><a href="#type-consensus_vote_kind" class="anchor"></a><code><span><span class="keyword">type</span> consensus_vote_kind</span><span> = </span></code><ol><li id="type-consensus_vote_kind.Attestation" class="def variant constructor anchored"><a href="#type-consensus_vote_kind.Attestation" class="anchor"></a><code><span>| </span><span><span class="constructor">Attestation</span></span></code></li><li id="type-consensus_vote_kind.Preattestation" class="def variant constructor anchored"><a href="#type-consensus_vote_kind.Preattestation" class="anchor"></a><code><span>| </span><span><span class="constructor">Preattestation</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consensus_vote_kind_encoding"><a href="#val-consensus_vote_kind_encoding" class="anchor"></a><code><span><span class="keyword">val</span> consensus_vote_kind_encoding : 
  <span><a href="#type-consensus_vote_kind">consensus_vote_kind</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_consensus_vote_kind"><a href="#val-pp_consensus_vote_kind" class="anchor"></a><code><span><span class="keyword">val</span> pp_consensus_vote_kind : 
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-consensus_vote_kind">consensus_vote_kind</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unsigned_consensus_vote"><a href="#type-unsigned_consensus_vote" class="anchor"></a><code><span><span class="keyword">type</span> unsigned_consensus_vote</span><span> = </span><span>{</span></code><ol><li id="type-unsigned_consensus_vote.vote_kind" class="def record field anchored"><a href="#type-unsigned_consensus_vote.vote_kind" class="anchor"></a><code><span>vote_kind : <a href="#type-consensus_vote_kind">consensus_vote_kind</a>;</span></code></li><li id="type-unsigned_consensus_vote.vote_consensus_content" class="def record field anchored"><a href="#type-unsigned_consensus_vote.vote_consensus_content" class="anchor"></a><code><span>vote_consensus_content : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-consensus_content">Tezos_protocol_alpha.Protocol.Alpha_context.consensus_content</a>;</span></code></li><li id="type-unsigned_consensus_vote.delegate" class="def record field anchored"><a href="#type-unsigned_consensus_vote.delegate" class="anchor"></a><code><span>delegate : <a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a>;</span></code></li><li id="type-unsigned_consensus_vote.dal_content" class="def record field anchored"><a href="#type-unsigned_consensus_vote.dal_content" class="anchor"></a><code><span>dal_content : <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-dal_content">Tezos_protocol_alpha.Protocol.Alpha_context.dal_content</a> option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An unsigned consensus vote consists of the consensus vote kind, either an attestation or a preattestation, the delegate keys and its protocol and dal content.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-batch_content"><a href="#type-batch_content" class="anchor"></a><code><span><span class="keyword">type</span> batch_content</span><span> = </span><span>{</span></code><ol><li id="type-batch_content.level" class="def record field anchored"><a href="#type-batch_content.level" class="anchor"></a><code><span>level : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Raw_level/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Raw_level.t</a>;</span></code></li><li id="type-batch_content.round" class="def record field anchored"><a href="#type-batch_content.round" class="anchor"></a><code><span>round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-batch_content.block_payload_hash" class="def record field anchored"><a href="#type-batch_content.block_payload_hash" class="anchor"></a><code><span>block_payload_hash : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Block_payload_hash/index.html#type-t">Tezos_protocol_alpha.Protocol.Block_payload_hash.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A batch content contains information common to all consensus operation in a batch of consensus votes.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unsigned_consensus_vote_batch"><a href="#type-unsigned_consensus_vote_batch" class="anchor"></a><code><span><span class="keyword">type</span> unsigned_consensus_vote_batch</span><span> = <span class="keyword">private</span> </span><span>{</span></code><ol><li id="type-unsigned_consensus_vote_batch.batch_kind" class="def record field anchored"><a href="#type-unsigned_consensus_vote_batch.batch_kind" class="anchor"></a><code><span>batch_kind : <a href="#type-consensus_vote_kind">consensus_vote_kind</a>;</span></code></li><li id="type-unsigned_consensus_vote_batch.batch_content" class="def record field anchored"><a href="#type-unsigned_consensus_vote_batch.batch_content" class="anchor"></a><code><span>batch_content : <a href="#type-batch_content">batch_content</a>;</span></code></li><li id="type-unsigned_consensus_vote_batch.batch_branch" class="def record field anchored"><a href="#type-unsigned_consensus_vote_batch.batch_branch" class="anchor"></a><code><span>batch_branch : <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>;</span></code></li><li id="type-unsigned_consensus_vote_batch.unsigned_consensus_votes" class="def record field anchored"><a href="#type-unsigned_consensus_vote_batch.unsigned_consensus_votes" class="anchor"></a><code><span>unsigned_consensus_votes : <span><a href="#type-unsigned_consensus_vote">unsigned_consensus_vote</a> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An unsigned consensus batch consists of a batch kind: either preattestations or attestations, a batch content and a batch branch. These values should be common to each operations in the batch. This type also contains the list of unsigned consensus votes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_unsigned_consensus_vote_batch"><a href="#val-make_unsigned_consensus_vote_batch" class="anchor"></a><code><span><span class="keyword">val</span> make_unsigned_consensus_vote_batch : 
  <span><a href="#type-consensus_vote_kind">consensus_vote_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-batch_content">batch_content</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">batch_branch</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a>
   * <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Slot/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Slot.t</a>)</span>
    list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-unsigned_consensus_vote_batch">unsigned_consensus_vote_batch</a></span></code></div><div class="spec-doc"><p><code>make_unsigned_consensus_vote_batch kind batch_content ~batch_branch
    delegates_and_slots</code> maps the <code>delegates_and_slots</code> list to create a list of <a href="#type-unsigned_consensus_vote"><code>unsigned_consensus_vote</code></a> that is then included in an <a href="#type-unsigned_consensus_vote_batch"><code>unsigned_consensus_vote_batch</code></a> with <code>kind</code>, <code>batch_content</code> and <code>batch_branch</code>. Note: <code>dal_content</code> of each operations is set to <code>None</code>, <a href="#val-dal_content_map_p"><code>dal_content_map_p</code></a> needs to be called to update the <code>dal_content</code> field.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dal_content_map_p"><a href="#val-dal_content_map_p" class="anchor"></a><code><span><span class="keyword">val</span> dal_content_map_p : 
  <span><span>(<span><a href="#type-unsigned_consensus_vote">unsigned_consensus_vote</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-dal_content">Tezos_protocol_alpha.Protocol.Alpha_context.dal_content</a> option</span>
      <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
      <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-unsigned_consensus_vote_batch">unsigned_consensus_vote_batch</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-unsigned_consensus_vote_batch">unsigned_consensus_vote_batch</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>dal_content_map_p f unsigned_consensus_vote_batch</code> map each <code>unsigned_consensus_vote</code> in the batch with <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-signed_consensus_vote"><a href="#type-signed_consensus_vote" class="anchor"></a><code><span><span class="keyword">type</span> signed_consensus_vote</span><span> = </span><span>{</span></code><ol><li id="type-signed_consensus_vote.unsigned_consensus_vote" class="def record field anchored"><a href="#type-signed_consensus_vote.unsigned_consensus_vote" class="anchor"></a><code><span>unsigned_consensus_vote : <a href="#type-unsigned_consensus_vote">unsigned_consensus_vote</a>;</span></code></li><li id="type-signed_consensus_vote.signed_operation" class="def record field anchored"><a href="#type-signed_consensus_vote.signed_operation" class="anchor"></a><code><span>signed_operation : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-packed_operation">Tezos_protocol_alpha.Protocol.Alpha_context.packed_operation</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A signed consensus vote consists of an unsigned consensus vote and its packed version signed.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-signed_consensus_vote_batch"><a href="#type-signed_consensus_vote_batch" class="anchor"></a><code><span><span class="keyword">type</span> signed_consensus_vote_batch</span><span> = <span class="keyword">private</span> </span><span>{</span></code><ol><li id="type-signed_consensus_vote_batch.batch_kind" class="def record field anchored"><a href="#type-signed_consensus_vote_batch.batch_kind" class="anchor"></a><code><span>batch_kind : <a href="#type-consensus_vote_kind">consensus_vote_kind</a>;</span></code></li><li id="type-signed_consensus_vote_batch.batch_content" class="def record field anchored"><a href="#type-signed_consensus_vote_batch.batch_content" class="anchor"></a><code><span>batch_content : <a href="#type-batch_content">batch_content</a>;</span></code></li><li id="type-signed_consensus_vote_batch.batch_branch" class="def record field anchored"><a href="#type-signed_consensus_vote_batch.batch_branch" class="anchor"></a><code><span>batch_branch : <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>;</span></code></li><li id="type-signed_consensus_vote_batch.signed_consensus_votes" class="def record field anchored"><a href="#type-signed_consensus_vote_batch.signed_consensus_votes" class="anchor"></a><code><span>signed_consensus_votes : <span><a href="#type-signed_consensus_vote">signed_consensus_vote</a> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Similar to <a href="#type-unsigned_consensus_vote_batch"><code>unsigned_consensus_vote_batch</code></a> type but the list of the operation are signed consensus votes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_signed_consensus_vote_batch"><a href="#val-make_signed_consensus_vote_batch" class="anchor"></a><code><span><span class="keyword">val</span> make_signed_consensus_vote_batch : 
  <span><a href="#type-consensus_vote_kind">consensus_vote_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-batch_content">batch_content</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">batch_branch</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-signed_consensus_vote">signed_consensus_vote</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-signed_consensus_vote_batch">signed_consensus_vote_batch</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>make_signed_consensus_vote_batch batch_kind batch_content ~batch_branch
    signed_consensus_votes</code> creates a <code>signed_consensus_vote_batch</code>. This function raises an error if the batch is ill-formed:</p><ul><li>batch consensus vote has a different kind than <code>batch_kind</code></li><li>batch consensus vote has a different level than the one in <code>batch_content</code></li><li>batch consensus vote has a different round than the one in <code>batch_content</code></li><li>batch consensus vote has a different block hash payload than the one in <code>batch_content</code></li><li>kind is <code>Preattestation</code> and a batch consensus vote contains a dal_content.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_singleton_consensus_vote_batch"><a href="#val-make_singleton_consensus_vote_batch" class="anchor"></a><code><span><span class="keyword">val</span> make_singleton_consensus_vote_batch : 
  <span><a href="#type-signed_consensus_vote">signed_consensus_vote</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-signed_consensus_vote_batch">signed_consensus_vote_batch</a></span></code></div><div class="spec-doc"><p><code>make_singleton_consensus_vote_batch signed_consensus_vote</code> similar to <a href="#val-make_signed_consensus_vote_batch"><code>make_signed_consensus_vote_batch</code></a> but creates a batch with only one operation.</p></div></div><h3 id="block-info-types-and-functions"><a href="#block-info-types-and-functions" class="anchor"></a>Block info types and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-prequorum"><a href="#type-prequorum" class="anchor"></a><code><span><span class="keyword">type</span> prequorum</span><span> = </span><span>{</span></code><ol><li id="type-prequorum.level" class="def record field anchored"><a href="#type-prequorum.level" class="anchor"></a><code><span>level : int32;</span></code></li><li id="type-prequorum.round" class="def record field anchored"><a href="#type-prequorum.round" class="anchor"></a><code><span>round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-prequorum.block_payload_hash" class="def record field anchored"><a href="#type-prequorum.block_payload_hash" class="anchor"></a><code><span>block_payload_hash : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Block_payload_hash/index.html#type-t">Tezos_protocol_alpha.Protocol.Block_payload_hash.t</a>;</span></code></li><li id="type-prequorum.preattestations" class="def record field anchored"><a href="#type-prequorum.preattestations" class="anchor"></a><code><span>preattestations : <span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Kind/index.html#type-preattestation">Tezos_protocol_alpha.Protocol.Alpha_context.Kind.preattestation</a>
                    <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-operation">Tezos_protocol_alpha.Protocol.Alpha_context.operation</a></span>
                    list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A prequorum consists of a level, a round, a block_payload_hash and the list of preattestations that has a total voting power higher than the protocol threshold.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-block_info"><a href="#type-block_info" class="anchor"></a><code><span><span class="keyword">type</span> block_info</span><span> = </span><span>{</span></code><ol><li id="type-block_info.hash" class="def record field anchored"><a href="#type-block_info.hash" class="anchor"></a><code><span>hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>;</span></code></li><li id="type-block_info.shell" class="def record field anchored"><a href="#type-block_info.shell" class="anchor"></a><code><span>shell : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Block_header/index.html#type-shell_header">Tezos_protocol_alpha.Protocol.Alpha_context.Block_header.shell_header</a>;</span></code></li><li id="type-block_info.payload_hash" class="def record field anchored"><a href="#type-block_info.payload_hash" class="anchor"></a><code><span>payload_hash : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Block_payload_hash/index.html#type-t">Tezos_protocol_alpha.Protocol.Block_payload_hash.t</a>;</span></code></li><li id="type-block_info.payload_round" class="def record field anchored"><a href="#type-block_info.payload_round" class="anchor"></a><code><span>payload_round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-block_info.round" class="def record field anchored"><a href="#type-block_info.round" class="anchor"></a><code><span>round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-block_info.prequorum" class="def record field anchored"><a href="#type-block_info.prequorum" class="anchor"></a><code><span>prequorum : <span><a href="#type-prequorum">prequorum</a> option</span>;</span></code></li><li id="type-block_info.quorum" class="def record field anchored"><a href="#type-block_info.quorum" class="anchor"></a><code><span>quorum : <span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Kind/index.html#type-attestation">Tezos_protocol_alpha.Protocol.Alpha_context.Kind.attestation</a>
           <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-operation">Tezos_protocol_alpha.Protocol.Alpha_context.operation</a></span>
           list</span>;</span></code></li><li id="type-block_info.payload" class="def record field anchored"><a href="#type-block_info.payload" class="anchor"></a><code><span>payload : <a href="../Operation_pool/index.html#type-payload">Operation_pool.payload</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-block_info_encoding"><a href="#val-block_info_encoding" class="anchor"></a><code><span><span class="keyword">val</span> block_info_encoding : <span><a href="#type-block_info">block_info</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_block_info"><a href="#val-pp_block_info" class="anchor"></a><code><span><span class="keyword">val</span> pp_block_info : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-block_info">block_info</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h3 id="proposal-type-and-functions"><a href="#proposal-type-and-functions" class="anchor"></a>Proposal type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-proposal"><a href="#type-proposal" class="anchor"></a><code><span><span class="keyword">type</span> proposal</span><span> = </span><span>{</span></code><ol><li id="type-proposal.block" class="def record field anchored"><a href="#type-proposal.block" class="anchor"></a><code><span>block : <a href="#type-block_info">block_info</a>;</span></code></li><li id="type-proposal.predecessor" class="def record field anchored"><a href="#type-proposal.predecessor" class="anchor"></a><code><span>predecessor : <a href="#type-block_info">block_info</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A proposal consists of information about the current block proposal and its predecessor.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-proposal_encoding"><a href="#val-proposal_encoding" class="anchor"></a><code><span><span class="keyword">val</span> proposal_encoding : <span><a href="#type-proposal">proposal</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_proposal"><a href="#val-pp_proposal" class="anchor"></a><code><span><span class="keyword">val</span> pp_proposal : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-proposal">proposal</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h3 id="elected-block-type-and-functions"><a href="#elected-block-type-and-functions" class="anchor"></a>Elected block type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-elected_block"><a href="#type-elected_block" class="anchor"></a><code><span><span class="keyword">type</span> elected_block</span><span> = </span><span>{</span></code><ol><li id="type-elected_block.proposal" class="def record field anchored"><a href="#type-elected_block.proposal" class="anchor"></a><code><span>proposal : <a href="#type-proposal">proposal</a>;</span></code></li><li id="type-elected_block.attestation_qc" class="def record field anchored"><a href="#type-elected_block.attestation_qc" class="anchor"></a><code><span>attestation_qc : <span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Kind/index.html#type-attestation">Tezos_protocol_alpha.Protocol.Alpha_context.Kind.attestation</a>
                   <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-operation">Tezos_protocol_alpha.Protocol.Alpha_context.operation</a></span>
                   list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An elected block is a <code>proposal</code> where the quorum has been reached. The type consists of the proposal and the quorum proof ie. an attestation list where the total voting power of the operation is higher than the protocol threshold.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_elected_block"><a href="#val-pp_elected_block" class="anchor"></a><code><span><span class="keyword">val</span> pp_elected_block : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-elected_block">elected_block</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_first_block_in_protocol"><a href="#val-is_first_block_in_protocol" class="anchor"></a><code><span><span class="keyword">val</span> is_first_block_in_protocol : <span><a href="#type-proposal">proposal</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Identify the first block of the protocol, ie. the block that activates the current protocol.</p><p>This block should be baked by the baker of the previous protocol (that's why this same block is also referred to as the last block of the previous protocol). It is always considered final and therefore is not attested.</p></div></div><h3 id="locked_round-type-and-functions"><a href="#locked_round-type-and-functions" class="anchor"></a>Locked_round type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-locked_round"><a href="#type-locked_round" class="anchor"></a><code><span><span class="keyword">type</span> locked_round</span><span> = </span><span>{</span></code><ol><li id="type-locked_round.payload_hash" class="def record field anchored"><a href="#type-locked_round.payload_hash" class="anchor"></a><code><span>payload_hash : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Block_payload_hash/index.html#type-t">Tezos_protocol_alpha.Protocol.Block_payload_hash.t</a>;</span></code></li><li id="type-locked_round.round" class="def record field anchored"><a href="#type-locked_round.round" class="anchor"></a><code><span>round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A locked round is the last block attested by the baker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-locked_round_encoding"><a href="#val-locked_round_encoding" class="anchor"></a><code><span><span class="keyword">val</span> locked_round_encoding : 
  <span><a href="#type-locked_round">locked_round</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_locked_round"><a href="#val-pp_locked_round" class="anchor"></a><code><span><span class="keyword">val</span> pp_locked_round : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-locked_round">locked_round</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h3 id="attestable_payload-type-and-functions"><a href="#attestable_payload-type-and-functions" class="anchor"></a>Attestable_payload type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-attestable_payload"><a href="#type-attestable_payload" class="anchor"></a><code><span><span class="keyword">type</span> attestable_payload</span><span> = </span><span>{</span></code><ol><li id="type-attestable_payload.proposal" class="def record field anchored"><a href="#type-attestable_payload.proposal" class="anchor"></a><code><span>proposal : <a href="#type-proposal">proposal</a>;</span></code></li><li id="type-attestable_payload.prequorum" class="def record field anchored"><a href="#type-attestable_payload.prequorum" class="anchor"></a><code><span>prequorum : <a href="#type-prequorum">prequorum</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An attestable payload is a proposal on which the prequorum has been reached.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-attestable_payload_encoding"><a href="#val-attestable_payload_encoding" class="anchor"></a><code><span><span class="keyword">val</span> attestable_payload_encoding : 
  <span><a href="#type-attestable_payload">attestable_payload</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_attestable_payload"><a href="#val-pp_attestable_payload" class="anchor"></a><code><span><span class="keyword">val</span> pp_attestable_payload : 
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-attestable_payload">attestable_payload</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><h3 id="level_state-type-and-functions"><a href="#level_state-type-and-functions" class="anchor"></a>Level_state type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-level_state"><a href="#type-level_state" class="anchor"></a><code><span><span class="keyword">type</span> level_state</span><span> = </span><span>{</span></code><ol><li id="type-level_state.current_level" class="def record field anchored"><a href="#type-level_state.current_level" class="anchor"></a><code><span>current_level : int32;</span></code></li><li id="type-level_state.latest_proposal" class="def record field anchored"><a href="#type-level_state.latest_proposal" class="anchor"></a><code><span>latest_proposal : <a href="#type-proposal">proposal</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>latest validated block by the node that the baker work on.</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.is_latest_proposal_applied" class="def record field anchored"><a href="#type-level_state.is_latest_proposal_applied" class="anchor"></a><code><span>is_latest_proposal_applied : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>true when the proposal, validated by the block has also been applied.</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.locked_round" class="def record field anchored"><a href="#type-level_state.locked_round" class="anchor"></a><code><span>locked_round : <span><a href="#type-locked_round">locked_round</a> option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Has value when the baker have attested the current proposal</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.attestable_payload" class="def record field anchored"><a href="#type-level_state.attestable_payload" class="anchor"></a><code><span>attestable_payload : <span><a href="#type-attestable_payload">attestable_payload</a> option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Has value when a pqc has been reached on a previous or current round.</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.elected_block" class="def record field anchored"><a href="#type-level_state.elected_block" class="anchor"></a><code><span>elected_block : <span><a href="#type-elected_block">elected_block</a> option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A quorum has been reached on an applied proposal.</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.delegate_slots" class="def record field anchored"><a href="#type-level_state.delegate_slots" class="anchor"></a><code><span>delegate_slots : <a href="#type-delegate_slots">delegate_slots</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Delegate slots for the baker delegates at the current level</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.next_level_delegate_slots" class="def record field anchored"><a href="#type-level_state.next_level_delegate_slots" class="anchor"></a><code><span>next_level_delegate_slots : <a href="#type-delegate_slots">delegate_slots</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Delegate slots for the baker delegates at the next level</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.next_level_proposed_round" class="def record field anchored"><a href="#type-level_state.next_level_proposed_round" class="anchor"></a><code><span>next_level_proposed_round : <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>
                              option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Some if a proposal has been injected for the next level on the given round</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.dal_attestable_slots" class="def record field anchored"><a href="#type-level_state.dal_attestable_slots" class="anchor"></a><code><span>dal_attestable_slots : <a href="#type-dal_attestable_slots">dal_attestable_slots</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>For each (own) delegate having a DAL slot at the current level, store a promise to obtain the attestable slots for that level.</p><span class="comment-delim">*)</span></div></li><li id="type-level_state.next_level_dal_attestable_slots" class="def record field anchored"><a href="#type-level_state.next_level_dal_attestable_slots" class="anchor"></a><code><span>next_level_dal_attestable_slots : <a href="#type-dal_attestable_slots">dal_attestable_slots</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>and similarly for the next level</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A level state consists of all usefull information regarding the current level such as the latest proposal, its status, the delegate slots, etc.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_level_state"><a href="#val-pp_level_state" class="anchor"></a><code><span><span class="keyword">val</span> pp_level_state : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-level_state">level_state</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h3 id="round_state-type-and-functions"><a href="#round_state-type-and-functions" class="anchor"></a>Round_state type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-phase"><a href="#type-phase" class="anchor"></a><code><span><span class="keyword">type</span> phase</span><span> = </span></code><ol><li id="type-phase.Idle" class="def variant constructor anchored"><a href="#type-phase.Idle" class="anchor"></a><code><span>| </span><span><span class="constructor">Idle</span></span></code></li><li id="type-phase.Awaiting_preattestations" class="def variant constructor anchored"><a href="#type-phase.Awaiting_preattestations" class="anchor"></a><code><span>| </span><span><span class="constructor">Awaiting_preattestations</span></span></code></li><li id="type-phase.Awaiting_attestations" class="def variant constructor anchored"><a href="#type-phase.Awaiting_attestations" class="anchor"></a><code><span>| </span><span><span class="constructor">Awaiting_attestations</span></span></code></li><li id="type-phase.Awaiting_application" class="def variant constructor anchored"><a href="#type-phase.Awaiting_application" class="anchor"></a><code><span>| </span><span><span class="constructor">Awaiting_application</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-phase_encoding"><a href="#val-phase_encoding" class="anchor"></a><code><span><span class="keyword">val</span> phase_encoding : <span><a href="#type-phase">phase</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_phase"><a href="#val-pp_phase" class="anchor"></a><code><span><span class="keyword">val</span> pp_phase : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-phase">phase</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-round_state"><a href="#type-round_state" class="anchor"></a><code><span><span class="keyword">type</span> round_state</span><span> = </span><span>{</span></code><ol><li id="type-round_state.current_round" class="def record field anchored"><a href="#type-round_state.current_round" class="anchor"></a><code><span>current_round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-round_state.current_phase" class="def record field anchored"><a href="#type-round_state.current_phase" class="anchor"></a><code><span>current_phase : <a href="#type-phase">phase</a>;</span></code></li><li id="type-round_state.delayed_quorum" class="def record field anchored"><a href="#type-round_state.delayed_quorum" class="anchor"></a><code><span>delayed_quorum : <span><span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Kind/index.html#type-attestation">Tezos_protocol_alpha.Protocol.Alpha_context.Kind.attestation</a>
                   <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-operation">Tezos_protocol_alpha.Protocol.Alpha_context.operation</a></span>
                   list</span>
                   option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Has value when the Quorum has been reached but the current proposal has not yet been applied</p><span class="comment-delim">*)</span></div></li><li id="type-round_state.early_attestations" class="def record field anchored"><a href="#type-round_state.early_attestations" class="anchor"></a><code><span>early_attestations : <span><a href="#type-signed_consensus_vote">signed_consensus_vote</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Attestations ready for injection before the prequorum has been reached</p><span class="comment-delim">*)</span></div></li><li id="type-round_state.awaiting_unlocking_pqc" class="def record field anchored"><a href="#type-round_state.awaiting_unlocking_pqc" class="anchor"></a><code><span>awaiting_unlocking_pqc : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Used to avoid preattesting reproposal if its round is lower than the one we are locked on</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A round state consists of information related to the current round phase</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_round_state"><a href="#val-pp_round_state" class="anchor"></a><code><span><span class="keyword">val</span> pp_round_state : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-round_state">round_state</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h3 id="forge-types-and-functions"><a href="#forge-types-and-functions" class="anchor"></a>Forge types and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-block_kind"><a href="#type-block_kind" class="anchor"></a><code><span><span class="keyword">type</span> block_kind</span><span> = </span></code><ol><li id="type-block_kind.Fresh" class="def variant constructor anchored"><a href="#type-block_kind.Fresh" class="anchor"></a><code><span>| </span><span><span class="constructor">Fresh</span> <span class="keyword">of</span> <a href="../Operation_pool/index.html#type-pool">Operation_pool.pool</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A Fresh proposal contains the list its operations.</p><span class="comment-delim">*)</span></div></li><li id="type-block_kind.Reproposal" class="def variant constructor anchored"><a href="#type-block_kind.Reproposal" class="anchor"></a><code><span>| </span><span><span class="constructor">Reproposal</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-block_kind.consensus_operations" class="def record field anchored"><a href="#type-block_kind.consensus_operations" class="anchor"></a><code><span>consensus_operations : <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-packed_operation">Tezos_protocol_alpha.Protocol.Alpha_context.packed_operation</a>
                         list</span>;</span></code></li><li id="type-block_kind.payload_hash" class="def record field anchored"><a href="#type-block_kind.payload_hash" class="anchor"></a><code><span>payload_hash : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Block_payload_hash/index.html#type-t">Tezos_protocol_alpha.Protocol.Block_payload_hash.t</a>;</span></code></li><li id="type-block_kind.payload_round" class="def record field anchored"><a href="#type-block_kind.payload_round" class="anchor"></a><code><span>payload_round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-block_kind.payload" class="def record field anchored"><a href="#type-block_kind.payload" class="anchor"></a><code><span>payload : <a href="../Operation_pool/index.html#type-payload">Operation_pool.payload</a>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A Reproposal contains the consensus_operations as a proof that the prequorum was reached for this proposal. It also contains information about the payload of the previous proposal.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>A block kind is either a reproposal of a proposal that has reached a prequorum, or a fresh block.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-block_to_bake"><a href="#type-block_to_bake" class="anchor"></a><code><span><span class="keyword">type</span> block_to_bake</span><span> = </span><span>{</span></code><ol><li id="type-block_to_bake.predecessor" class="def record field anchored"><a href="#type-block_to_bake.predecessor" class="anchor"></a><code><span>predecessor : <a href="#type-block_info">block_info</a>;</span></code></li><li id="type-block_to_bake.round" class="def record field anchored"><a href="#type-block_to_bake.round" class="anchor"></a><code><span>round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-block_to_bake.delegate" class="def record field anchored"><a href="#type-block_to_bake.delegate" class="anchor"></a><code><span>delegate : <a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Delegate that have the right to bake the block.</p><span class="comment-delim">*)</span></div></li><li id="type-block_to_bake.kind" class="def record field anchored"><a href="#type-block_to_bake.kind" class="anchor"></a><code><span>kind : <a href="#type-block_kind">block_kind</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Either a reproposal or a fresh proposal</p><span class="comment-delim">*)</span></div></li><li id="type-block_to_bake.force_apply" class="def record field anchored"><a href="#type-block_to_bake.force_apply" class="anchor"></a><code><span>force_apply : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>if true, while baking the block, try and apply the block and its operations instead of only validating them. This can be set using the <code>--force-apply-from-round</code> flag (see <code>force_apply_from_round_arg</code> in <code>baking_commands.ml</code>).</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-forge_request"><a href="#type-forge_request" class="anchor"></a><code><span><span class="keyword">type</span> forge_request</span><span> = </span></code><ol><li id="type-forge_request.Forge_and_sign_block" class="def variant constructor anchored"><a href="#type-forge_request.Forge_and_sign_block" class="anchor"></a><code><span>| </span><span><span class="constructor">Forge_and_sign_block</span> <span class="keyword">of</span> <a href="#type-block_to_bake">block_to_bake</a></span></code></li><li id="type-forge_request.Forge_and_sign_preattestations" class="def variant constructor anchored"><a href="#type-forge_request.Forge_and_sign_preattestations" class="anchor"></a><code><span>| </span><span><span class="constructor">Forge_and_sign_preattestations</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-forge_request.unsigned_preattestations" class="def record field anchored"><a href="#type-forge_request.unsigned_preattestations" class="anchor"></a><code><span>unsigned_preattestations : <a href="#type-unsigned_consensus_vote_batch">unsigned_consensus_vote_batch</a>;</span></code></li></ol><code><span>}</span></code></li><li id="type-forge_request.Forge_and_sign_attestations" class="def variant constructor anchored"><a href="#type-forge_request.Forge_and_sign_attestations" class="anchor"></a><code><span>| </span><span><span class="constructor">Forge_and_sign_attestations</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-forge_request.unsigned_attestations" class="def record field anchored"><a href="#type-forge_request.unsigned_attestations" class="anchor"></a><code><span>unsigned_attestations : <a href="#type-unsigned_consensus_vote_batch">unsigned_consensus_vote_batch</a>;</span></code></li></ol><code><span>}</span></code></li></ol></div><div class="spec-doc"><p><code>forge_request</code> type used to push a concurrent forging task in the forge worker.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-prepared_block"><a href="#type-prepared_block" class="anchor"></a><code><span><span class="keyword">type</span> prepared_block</span><span> = </span><span>{</span></code><ol><li id="type-prepared_block.signed_block_header" class="def record field anchored"><a href="#type-prepared_block.signed_block_header" class="anchor"></a><code><span>signed_block_header : <a href="../../../tezos-protocol-alpha/Tezos_protocol_alpha/Protocol/index.html#type-block_header">Tezos_protocol_alpha.Protocol.block_header</a>;</span></code></li><li id="type-prepared_block.round" class="def record field anchored"><a href="#type-prepared_block.round" class="anchor"></a><code><span>round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li><li id="type-prepared_block.delegate" class="def record field anchored"><a href="#type-prepared_block.delegate" class="anchor"></a><code><span>delegate : <a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a>;</span></code></li><li id="type-prepared_block.operations" class="def record field anchored"><a href="#type-prepared_block.operations" class="anchor"></a><code><span>operations : <span><span><a href="../../../octez-libs/Tezos_base/Operation/index.html#type-t">Tezos_base.Operation.t</a> list</span> list</span>;</span></code></li><li id="type-prepared_block.baking_votes" class="def record field anchored"><a href="#type-prepared_block.baking_votes" class="anchor"></a><code><span>baking_votes : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Per_block_votes_repr/index.html#type-per_block_votes">Tezos_protocol_alpha.Protocol.Per_block_votes_repr.per_block_votes</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p><code>prepared_block</code> type returned by the forge worker and that contains all information useful for block injection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_prepared_block"><a href="#val-pp_prepared_block" class="anchor"></a><code><span><span class="keyword">val</span> pp_prepared_block : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-prepared_block">prepared_block</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-forge_event"><a href="#type-forge_event" class="anchor"></a><code><span><span class="keyword">type</span> forge_event</span><span> = </span></code><ol><li id="type-forge_event.Block_ready" class="def variant constructor anchored"><a href="#type-forge_event.Block_ready" class="anchor"></a><code><span>| </span><span><span class="constructor">Block_ready</span> <span class="keyword">of</span> <a href="#type-prepared_block">prepared_block</a></span></code></li><li id="type-forge_event.Preattestation_ready" class="def variant constructor anchored"><a href="#type-forge_event.Preattestation_ready" class="anchor"></a><code><span>| </span><span><span class="constructor">Preattestation_ready</span> <span class="keyword">of</span> <a href="#type-signed_consensus_vote">signed_consensus_vote</a></span></code></li><li id="type-forge_event.Attestation_ready" class="def variant constructor anchored"><a href="#type-forge_event.Attestation_ready" class="anchor"></a><code><span>| </span><span><span class="constructor">Attestation_ready</span> <span class="keyword">of</span> <a href="#type-signed_consensus_vote">signed_consensus_vote</a></span></code></li></ol></div><div class="spec-doc"><p><code>forge_event</code> type used to return the result of a task completion in the forge worker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-forge_event_encoding"><a href="#val-forge_event_encoding" class="anchor"></a><code><span><span class="keyword">val</span> forge_event_encoding : <span><a href="#type-forge_event">forge_event</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_forge_event"><a href="#val-pp_forge_event" class="anchor"></a><code><span><span class="keyword">val</span> pp_forge_event : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-forge_event">forge_event</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-forge_worker_hooks"><a href="#type-forge_worker_hooks" class="anchor"></a><code><span><span class="keyword">type</span> forge_worker_hooks</span><span> = </span><span>{</span></code><ol><li id="type-forge_worker_hooks.push_request" class="def record field anchored"><a href="#type-forge_worker_hooks.push_request" class="anchor"></a><code><span>push_request : <span><a href="#type-forge_request">forge_request</a> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></li><li id="type-forge_worker_hooks.get_forge_event_stream" class="def record field anchored"><a href="#type-forge_worker_hooks.get_forge_event_stream" class="anchor"></a><code><span>get_forge_event_stream : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-forge_event">forge_event</a> <span class="xref-unresolved">Lwt_stream</span>.t</span>;</span></code></li><li id="type-forge_worker_hooks.cancel_all_pending_tasks" class="def record field anchored"><a href="#type-forge_worker_hooks.cancel_all_pending_tasks" class="anchor"></a><code><span>cancel_all_pending_tasks : <span>unit <span class="arrow">&#45;&gt;</span></span> unit;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p><code>forge_worker_hooks</code> type that allows interactions with the forge worker. Hooks are needed in order to break a circular dependency.</p></div></div><h3 id="global_state-types-and-functions"><a href="#global_state-types-and-functions" class="anchor"></a>Global_state types and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-validation_mode"><a href="#type-validation_mode" class="anchor"></a><code><span><span class="keyword">type</span> validation_mode</span><span> = </span></code><ol><li id="type-validation_mode.Node" class="def variant constructor anchored"><a href="#type-validation_mode.Node" class="anchor"></a><code><span>| </span><span><span class="constructor">Node</span></span></code></li><li id="type-validation_mode.Local" class="def variant constructor anchored"><a href="#type-validation_mode.Local" class="anchor"></a><code><span>| </span><span><span class="constructor">Local</span> <span class="keyword">of</span> <a href="../Abstract_context_index/index.html#type-t">Abstract_context_index.t</a></span></code></li></ol></div><div class="spec-doc"><p>The validation mode specifies whether the baker (filters and) validates mempool operations via an RPC to the node, or if it does so &quot;locally&quot;, by using the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_validation_mode"><a href="#val-pp_validation_mode" class="anchor"></a><code><span><span class="keyword">val</span> pp_validation_mode : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-validation_mode">validation_mode</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-cache"><a href="#type-cache" class="anchor"></a><code><span><span class="keyword">type</span> cache</span><span> = </span><span>{</span></code><ol><li id="type-cache.known_timestamps" class="def record field anchored"><a href="#type-cache.known_timestamps" class="anchor"></a><code><span>known_timestamps : <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Timestamp/index.html#type-time">Tezos_protocol_alpha.Protocol.Alpha_context.Timestamp.time</a>
                     <a href="../Baking_cache/Timestamp_of_round_cache/index.html#type-t">Baking_cache.Timestamp_of_round_cache.t</a></span>;</span></code></li><li id="type-cache.round_timestamps" class="def record field anchored"><a href="#type-cache.round_timestamps" class="anchor"></a><code><span>round_timestamps : <span><span>(<a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Timestamp/index.html#type-time">Tezos_protocol_alpha.Protocol.Alpha_context.Timestamp.time</a>
                    * <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>
                    * <a href="#type-consensus_key_and_delegate">consensus_key_and_delegate</a>)</span>
                     <a href="../Baking_cache/Round_timestamp_interval_cache/index.html#type-t">Baking_cache.Round_timestamp_interval_cache.t</a></span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Caches of timestamps</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_cache"><a href="#val-create_cache" class="anchor"></a><code><span><span class="keyword">val</span> create_cache : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-cache">cache</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-global_state"><a href="#type-global_state" class="anchor"></a><code><span><span class="keyword">type</span> global_state</span><span> = </span><span>{</span></code><ol><li id="type-global_state.cctxt" class="def record field anchored"><a href="#type-global_state.cctxt" class="anchor"></a><code><span>cctxt : <a href="../../Tezos_client_alpha/Protocol_client_context/class-type-full/index.html">Tezos_client_alpha.Protocol_client_context.full</a>;</span></code></li><li id="type-global_state.chain_id" class="def record field anchored"><a href="#type-global_state.chain_id" class="anchor"></a><code><span>chain_id : <a href="../../../octez-libs/Tezos_crypto/Hashed/Chain_id/index.html#type-t">Tezos_base.TzPervasives.Chain_id.t</a>;</span></code></li><li id="type-global_state.config" class="def record field anchored"><a href="#type-global_state.config" class="anchor"></a><code><span>config : <a href="../Baking_configuration/index.html#type-t">Baking_configuration.t</a>;</span></code></li><li id="type-global_state.constants" class="def record field anchored"><a href="#type-global_state.constants" class="anchor"></a><code><span>constants : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Constants/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Constants.t</a>;</span></code></li><li id="type-global_state.round_durations" class="def record field anchored"><a href="#type-global_state.round_durations" class="anchor"></a><code><span>round_durations : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-round_durations">Tezos_protocol_alpha.Protocol.Alpha_context.Round.round_durations</a>;</span></code></li><li id="type-global_state.operation_worker" class="def record field anchored"><a href="#type-global_state.operation_worker" class="anchor"></a><code><span>operation_worker : <a href="../Operation_worker/index.html#type-t">Operation_worker.t</a>;</span></code></li><li id="type-global_state.forge_worker_hooks" class="def record field anchored"><a href="#type-global_state.forge_worker_hooks" class="anchor"></a><code><span><span class="keyword">mutable</span> forge_worker_hooks : <a href="#type-forge_worker_hooks">forge_worker_hooks</a>;</span></code></li><li id="type-global_state.validation_mode" class="def record field anchored"><a href="#type-global_state.validation_mode" class="anchor"></a><code><span>validation_mode : <a href="#type-validation_mode">validation_mode</a>;</span></code></li><li id="type-global_state.delegates" class="def record field anchored"><a href="#type-global_state.delegates" class="anchor"></a><code><span>delegates : <span><a href="#type-consensus_key">consensus_key</a> list</span>;</span></code></li><li id="type-global_state.cache" class="def record field anchored"><a href="#type-global_state.cache" class="anchor"></a><code><span>cache : <a href="#type-cache">cache</a>;</span></code></li><li id="type-global_state.dal_node_rpc_ctxt" class="def record field anchored"><a href="#type-global_state.dal_node_rpc_ctxt" class="anchor"></a><code><span>dal_node_rpc_ctxt : <span><a href="../../../octez-libs/Tezos_rpc/Context/class-type-generic/index.html">Tezos_rpc.Context.generic</a> option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A global state contains all information related to the chain and baker configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_global_state"><a href="#val-pp_global_state" class="anchor"></a><code><span><span class="keyword">val</span> pp_global_state : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-global_state">global_state</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-state"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span><span> = </span><span>{</span></code><ol><li id="type-state.global_state" class="def record field anchored"><a href="#type-state.global_state" class="anchor"></a><code><span>global_state : <a href="#type-global_state">global_state</a>;</span></code></li><li id="type-state.level_state" class="def record field anchored"><a href="#type-state.level_state" class="anchor"></a><code><span>level_state : <a href="#type-level_state">level_state</a>;</span></code></li><li id="type-state.round_state" class="def record field anchored"><a href="#type-state.round_state" class="anchor"></a><code><span>round_state : <a href="#type-round_state">round_state</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <a href="#type-state">state</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_current_phase"><a href="#val-update_current_phase" class="anchor"></a><code><span><span class="keyword">val</span> update_current_phase : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-phase">phase</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>update_current_phase t new_phase</code> updates the round state in <code>t</code> with the <code>new_phase</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-round_proposer"><a href="#val-round_proposer" class="anchor"></a><code><span><span class="keyword">val</span> round_proposer : 
  <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:<span>[ `Current <span>| `Next</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-delegate_slot">delegate_slot</a> option</span></span></code></div><div class="spec-doc"><p>Returns, among our *own* delegates, the delegate (and its attesting slot) that has a proposer slot at the given round and the current or next level, if any.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-timestamp_of_round"><a href="#val-timestamp_of_round" class="anchor"></a><code><span><span class="keyword">val</span> timestamp_of_round : 
  <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_timestamp</span>:<a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_round</span>:<a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">round</span>:<a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p>Memoization wrapper for <code>Round.timestamp_of_round</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_next_round_time"><a href="#val-compute_next_round_time" class="anchor"></a><code><span><span class="keyword">val</span> compute_next_round_time : 
  <span><a href="#type-state">state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a>
   * <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>)</span>
    option</span></span></code></div><div class="spec-doc"><p>From the current <code>state</code>, the function returns an optional association pair, which consists of the next round timestamp and its round.</p></div></div><h3 id="timeout-type-and-functions"><a href="#timeout-type-and-functions" class="anchor"></a>Timeout type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-timeout_kind"><a href="#type-timeout_kind" class="anchor"></a><code><span><span class="keyword">type</span> timeout_kind</span><span> = </span></code><ol><li id="type-timeout_kind.End_of_round" class="def variant constructor anchored"><a href="#type-timeout_kind.End_of_round" class="anchor"></a><code><span>| </span><span><span class="constructor">End_of_round</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-timeout_kind.ending_round" class="def record field anchored"><a href="#type-timeout_kind.ending_round" class="anchor"></a><code><span>ending_round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li></ol><code><span>}</span></code></li><li id="type-timeout_kind.Time_to_prepare_next_level_block" class="def variant constructor anchored"><a href="#type-timeout_kind.Time_to_prepare_next_level_block" class="anchor"></a><code><span>| </span><span><span class="constructor">Time_to_prepare_next_level_block</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-timeout_kind.at_round" class="def record field anchored"><a href="#type-timeout_kind.at_round" class="anchor"></a><code><span>at_round : <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Round/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Round.t</a>;</span></code></li></ol><code><span>}</span></code></li></ol></div><div class="spec-doc"><p>timeout kind is either a timeout triggered at the end of a round or a timeout triggered when it is time to prepare the block at the next level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-timeout_kind_encoding"><a href="#val-timeout_kind_encoding" class="anchor"></a><code><span><span class="keyword">val</span> timeout_kind_encoding : 
  <span><a href="#type-timeout_kind">timeout_kind</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_timeout_kind"><a href="#val-pp_timeout_kind" class="anchor"></a><code><span><span class="keyword">val</span> pp_timeout_kind : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-timeout_kind">timeout_kind</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><h3 id="state_data-type-and-functions"><a href="#state_data-type-and-functions" class="anchor"></a>State_data type and functions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-record_state"><a href="#val-record_state" class="anchor"></a><code><span><span class="keyword">val</span> record_state : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>record_state t</code> writes the current level, the locked round and the attestable payload to the disk.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-may_record_new_state"><a href="#val-may_record_new_state" class="anchor"></a><code><span><span class="keyword">val</span> may_record_new_state : 
  <span><span class="label">previous_state</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">new_state</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>may_record_new_state ~previous_state ~new_state</code> Does nothing if the baker configuration is set to <a href="../Baking_configuration/index.html#type-state_recorder_config.Memory"><code>Baking_configuration.state_recorder_config.Memory</code></a> only. Otherwise, check that information from the <code>new_state</code> are consistent with <code>previous_state</code> and if the information has been updated, record the <code>new_state</code> to the disk.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-state_data"><a href="#type-state_data" class="anchor"></a><code><span><span class="keyword">type</span> state_data</span><span> = </span><span>{</span></code><ol><li id="type-state_data.level_data" class="def record field anchored"><a href="#type-state_data.level_data" class="anchor"></a><code><span>level_data : int32;</span></code></li><li id="type-state_data.locked_round_data" class="def record field anchored"><a href="#type-state_data.locked_round_data" class="anchor"></a><code><span>locked_round_data : <span><a href="#type-locked_round">locked_round</a> option</span>;</span></code></li><li id="type-state_data.attestable_payload_data" class="def record field anchored"><a href="#type-state_data.attestable_payload_data" class="anchor"></a><code><span>attestable_payload_data : <span><a href="#type-attestable_payload">attestable_payload</a> option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>type used for data recorded on disk.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-state_data_encoding"><a href="#val-state_data_encoding" class="anchor"></a><code><span><span class="keyword">val</span> state_data_encoding : <span><a href="#type-state_data">state_data</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load_attestable_data"><a href="#val-load_attestable_data" class="anchor"></a><code><span><span class="keyword">val</span> load_attestable_data : 
  <span><a href="../../Tezos_client_alpha/Protocol_client_context/class-type-full/index.html">Tezos_client_alpha.Protocol_client_context.full</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ `State ]</span> <a href="../Baking_files/index.html#type-location">Baking_files.location</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-state_data">state_data</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>load_attestable_data cctxt location</code> tries to load the <code>state_data</code> from the <code>cctxt</code> at <code>location</code>, returns <code>None</code> if the file does not exists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-may_load_attestable_data"><a href="#val-may_load_attestable_data" class="anchor"></a><code><span><span class="keyword">val</span> may_load_attestable_data : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-t">t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>may_load_attestable_data t</code> tries to load locked round and attestable payload from <code>t</code> if it is recorded, if not, return the state.</p></div></div><h3 id="event-type-and-functions"><a href="#event-type-and-functions" class="anchor"></a>Event type and functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-event"><a href="#type-event" class="anchor"></a><code><span><span class="keyword">type</span> event</span><span> = </span></code><ol><li id="type-event.New_valid_proposal" class="def variant constructor anchored"><a href="#type-event.New_valid_proposal" class="anchor"></a><code><span>| </span><span><span class="constructor">New_valid_proposal</span> <span class="keyword">of</span> <a href="#type-proposal">proposal</a></span></code></li><li id="type-event.New_head_proposal" class="def variant constructor anchored"><a href="#type-event.New_head_proposal" class="anchor"></a><code><span>| </span><span><span class="constructor">New_head_proposal</span> <span class="keyword">of</span> <a href="#type-proposal">proposal</a></span></code></li><li id="type-event.Prequorum_reached" class="def variant constructor anchored"><a href="#type-event.Prequorum_reached" class="anchor"></a><code><span>| </span><span><span class="constructor">Prequorum_reached</span> <span class="keyword">of</span> <a href="../Operation_worker/index.html#type-candidate">Operation_worker.candidate</a>
  * <span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Kind/index.html#type-preattestation">Tezos_protocol_alpha.Protocol.Alpha_context.Kind.preattestation</a>
      <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-operation">Tezos_protocol_alpha.Protocol.Alpha_context.operation</a></span>
      list</span></span></code></li><li id="type-event.Quorum_reached" class="def variant constructor anchored"><a href="#type-event.Quorum_reached" class="anchor"></a><code><span>| </span><span><span class="constructor">Quorum_reached</span> <span class="keyword">of</span> <a href="../Operation_worker/index.html#type-candidate">Operation_worker.candidate</a>
  * <span><span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Kind/index.html#type-attestation">Tezos_protocol_alpha.Protocol.Alpha_context.Kind.attestation</a>
      <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-operation">Tezos_protocol_alpha.Protocol.Alpha_context.operation</a></span>
      list</span></span></code></li><li id="type-event.New_forge_event" class="def variant constructor anchored"><a href="#type-event.New_forge_event" class="anchor"></a><code><span>| </span><span><span class="constructor">New_forge_event</span> <span class="keyword">of</span> <a href="#type-forge_event">forge_event</a></span></code></li><li id="type-event.Timeout" class="def variant constructor anchored"><a href="#type-event.Timeout" class="anchor"></a><code><span>| </span><span><span class="constructor">Timeout</span> <span class="keyword">of</span> <a href="#type-timeout_kind">timeout_kind</a></span></code></li></ol></div><div class="spec-doc"><p>Event type used in the <code>baking_scheduling</code> to trigger state transition.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-event_encoding"><a href="#val-event_encoding" class="anchor"></a><code><span><span class="keyword">val</span> event_encoding : <span><a href="#type-event">event</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_event"><a href="#val-pp_event" class="anchor"></a><code><span><span class="keyword">val</span> pp_event : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-event">event</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_short_event"><a href="#val-pp_short_event" class="anchor"></a><code><span><span class="keyword">val</span> pp_short_event : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-event">event</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>
