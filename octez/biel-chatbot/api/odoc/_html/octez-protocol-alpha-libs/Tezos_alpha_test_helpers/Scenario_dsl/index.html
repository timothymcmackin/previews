<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Scenario_dsl (octez-protocol-alpha-libs.Tezos_alpha_test_helpers.Scenario_dsl)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-alpha-libs</a> &#x00BB; <a href="../index.html">Tezos_alpha_test_helpers</a> &#x00BB; Scenario_dsl</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_alpha_test_helpers.Scenario_dsl</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-scenarios"><a href="#type-scenarios" class="anchor"></a><code><span><span class="keyword">type</span> <span>('input, 'output) scenarios</span></span><span> = </span></code><ol><li id="type-scenarios.Action" class="def variant constructor anchored"><a href="#type-scenarios.Action" class="anchor"></a><code><span>| </span><span><span class="constructor">Action</span> : <span>(<span><span class="type-var">'input</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'output</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span>
                                                       <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Empty" class="def variant constructor anchored"><a href="#type-scenarios.Empty" class="anchor"></a><code><span>| </span><span><span class="constructor">Empty</span> : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Concat" class="def variant constructor anchored"><a href="#type-scenarios.Concat" class="anchor"></a><code><span>| </span><span><span class="constructor">Concat</span> : <span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> * <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Branch" class="def variant constructor anchored"><a href="#type-scenarios.Branch" class="anchor"></a><code><span>| </span><span><span class="constructor">Branch</span> : <span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> * <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Tag" class="def variant constructor anchored"><a href="#type-scenarios.Tag" class="anchor"></a><code><span>| </span><span><span class="constructor">Tag</span> : string <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Slow" class="def variant constructor anchored"><a href="#type-scenarios.Slow" class="anchor"></a><code><span>| </span><span><span class="constructor">Slow</span> : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li></ol></div><div class="spec-doc"><p>A scenario is a succession of actions. We define a branching path as a way to create multiple tests from the same point. This allows easy compositionality of behaviors with minimal code sharing. The <code>Tag</code> allows to give meaningful identifiers to the branches. It is good practice to tag each case in a branch (it's not necessary, but since test names must be unique, at most one branch can remain unnamed, and even then it can create conflicting names.)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-single_scenario"><a href="#type-single_scenario" class="anchor"></a><code><span><span class="keyword">type</span> <span>('input, 'output) single_scenario</span></span><span> = </span></code><ol><li id="type-single_scenario.End_scenario" class="def variant constructor anchored"><a href="#type-single_scenario.End_scenario" class="anchor"></a><code><span>| </span><span><span class="constructor">End_scenario</span> : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-single_scenario">single_scenario</a></span></span></code></li><li id="type-single_scenario.Cons" class="def variant constructor anchored"><a href="#type-single_scenario.Cons" class="anchor"></a><code><span>| </span><span><span class="constructor">Cons</span> : <span>(<span>(<span><span class="type-var">'input</span> <span class="arrow">&#45;&gt;</span></span>
        <span><span><span class="type-var">'t</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span>
        * <span><span>(<span class="type-var">'t</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span></span></code></li></ol></div><div class="spec-doc"><p>Unfolded scenario type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cat_ss"><a href="#val-cat_ss" class="anchor"></a><code><span><span class="keyword">val</span> cat_ss : 
  'a 'b 'c. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-single_scenario">single_scenario</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-combine"><a href="#val-combine" class="anchor"></a><code><span><span class="keyword">val</span> combine : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unfold_scenarios"><a href="#val-unfold_scenarios" class="anchor"></a><code><span><span class="keyword">val</span> unfold_scenarios : 
  'input 'output. <span><span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> * <span>string list</span> * bool)</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_scenario"><a href="#val-run_scenario" class="anchor"></a><code><span><span class="keyword">val</span> run_scenario : 
  'input 'output. <span><span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'input</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'output</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-test_closure"><a href="#type-test_closure" class="anchor"></a><code><span><span class="keyword">type</span> test_closure</span><span> = string * bool * <span>(<span><a href="../../../tezt-tezos/Tezt_tezos/Protocol/index.html#type-t">Tezt_tezos.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unfolded_to_test"><a href="#val-unfolded_to_test" class="anchor"></a><code><span><span class="keyword">val</span> unfolded_to_test : 
  <span><span>(<span><span>(unit, unit)</span> <a href="#type-single_scenario">single_scenario</a></span> * <span>string list</span> * bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-test_closure">test_closure</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_test"><a href="#val-register_test" class="anchor"></a><code><span><span class="keyword">val</span> register_test : <span><span class="label">__FILE__</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">tags</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_closure">test_closure</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_tests"><a href="#val-register_tests" class="anchor"></a><code><span><span class="keyword">val</span> register_tests : 
  <span><span class="label">__FILE__</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">tags</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-test_closure">test_closure</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><p>Useful aliases and operators</p><div class="odoc-spec"><div class="spec value anchored" id="val-noop"><a href="#val-noop" class="anchor"></a><code><span><span class="keyword">val</span> noop : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-no_tag"><a href="#val-no_tag" class="anchor"></a><code><span><span class="keyword">val</span> no_tag : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-concat"><a href="#val-concat" class="anchor"></a><code><span><span class="keyword">val</span> concat : 
  'a 'b 'c. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-branch"><a href="#val-branch" class="anchor"></a><code><span><span class="keyword">val</span> branch : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(--&gt;)"><a href="#val-(--&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (--&gt;) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Continuation connector: execute a then b</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(|+)"><a href="#val-(|+)" class="anchor"></a><code><span><span class="keyword">val</span> (|+) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Branching connector: creates two tests with different execution paths</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_map_branched"><a href="#val-list_map_branched" class="anchor"></a><code><span><span class="keyword">val</span> list_map_branched : 
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Branching combinator: creates a test path for each element in the list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_test"><a href="#val-end_test" class="anchor"></a><code><span><span class="keyword">val</span> end_test : <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Ends the test. Dump the state, returns <code>unit</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tests_of_scenarios"><a href="#val-tests_of_scenarios" class="anchor"></a><code><span><span class="keyword">val</span> tests_of_scenarios : 
  <span><span><span>(string * <span><span>(unit, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-test_closure">test_closure</a> list</span></span></code></div><div class="spec-doc"><p>Transforms scenarios into tests</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Arbitrary execution</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_state"><a href="#val-exec_state" class="anchor"></a><code><span><span class="keyword">val</span> exec_state : 
  <span><span>(<span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>, <span class="type-var">'a</span> * <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Execute a function that does not modify the block, only the state</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_unit"><a href="#val-exec_unit" class="anchor"></a><code><span><span class="keyword">val</span> exec_unit : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Execute a function that does not modify neither the block nor the state. Usually used for checks/asserts</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>fold f l</code> folds <code>f</code> over <code>l</code>, fails on empty list</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_tag"><a href="#val-fold_tag" class="anchor"></a><code><span><span class="keyword">val</span> fold_tag : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>fold_tag f l</code> folds <code>f</code> over <code>l</code>, <code>l</code> has a tag for each of its elements. Fails on empty list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_tag_f"><a href="#val-fold_tag_f" class="anchor"></a><code><span><span class="keyword">val</span> fold_tag_f : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>fold_tag_f f tag l</code> folds <code>f</code> over <code>l</code>, <code>tag</code> returns a tag for each element of <code>l</code>. Fails on empty list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unfold"><a href="#val-unfold" class="anchor"></a><code><span><span class="keyword">val</span> unfold : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>unfold f l</code> maps <code>f</code> over <code>l</code>, and runs them in order</p></div></div></div></body></html>
