<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Incremental (octez-protocol-alpha-libs.Tezos_alpha_test_helpers.Incremental)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-alpha-libs</a> &#x00BB; <a href="../index.html">Tezos_alpha_test_helpers</a> &#x00BB; Incremental</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_alpha_test_helpers.Incremental</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-incremental"><a href="#type-incremental" class="anchor"></a><code><span><span class="keyword">type</span> incremental</span><span> = <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-predecessor"><a href="#val-predecessor" class="anchor"></a><code><span><span class="keyword">val</span> predecessor : <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Block/index.html#type-t">Block.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-header"><a href="#val-header" class="anchor"></a><code><span><span class="keyword">val</span> header : 
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Block_header/index.html#type-t">Tezos_protocol_alpha.Protocol.Alpha_context.Block_header.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rev_tickets"><a href="#val-rev_tickets" class="anchor"></a><code><span><span class="keyword">val</span> rev_tickets : 
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-alpha/Tezos_protocol_alpha/Protocol/index.html#type-operation_receipt">Tezos_protocol_alpha.Protocol.operation_receipt</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-validation_state"><a href="#val-validation_state" class="anchor"></a><code><span><span class="keyword">val</span> validation_state : 
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-alpha/Tezos_protocol_alpha/Protocol/index.html#type-validation_state">Tezos_protocol_alpha.Protocol.validation_state</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-level"><a href="#val-level" class="anchor"></a><code><span><span class="keyword">val</span> level : <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-begin_construction"><a href="#val-begin_construction" class="anchor"></a><code><span><span class="keyword">val</span> begin_construction : 
  <span><span class="optlabel">?timestamp</span>:<a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?seed_nonce_hash</span>:<a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Nonce_hash/index.html#type-t">Tezos_protocol_alpha.Protocol.Nonce_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?mempool_mode</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?policy</span>:<a href="../Block/index.html#type-baker_policy">Block.baker_policy</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?liquidity_baking_toggle_vote</span>:
    <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Per_block_votes_repr/index.html#type-per_block_vote">Tezos_protocol_alpha.Protocol.Per_block_votes_repr.per_block_vote</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?adaptive_issuance_vote</span>:
    <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Per_block_votes_repr/index.html#type-per_block_vote">Tezos_protocol_alpha.Protocol.Per_block_votes_repr.per_block_vote</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-incremental">incremental</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>begin_construction ?mempool_mode predecessor</code> uses <code>Main.begin_validation_and_application</code> to create a validation and application state on top of <code>predecessor</code> for the construction of a new block.</p><p>Optional arguments allow to override defaults:</p><ul><li><code>?mempool_mode:bool</code>: when <code>true</code>, use <code>Partial_construction</code> mode. By default, it is <code>false</code> and the mode is <code>Construction</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-validate_operation"><a href="#val-validate_operation" class="anchor"></a><code><span><span class="keyword">val</span> validate_operation : 
  <span><span class="optlabel">?expect_failure</span>:
    <span>(<span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> list</span> <span class="arrow">&#45;&gt;</span></span>
      <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?check_size</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Operation/index.html#type-packed">Tezos_protocol_alpha.Protocol.Alpha_context.Operation.packed</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-incremental">incremental</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>validate_operation ?expect_failure ?check_size i op</code> tries to validate <code>op</code> in the validation state of <code>i</code>. If the validation succeeds, the function returns the incremental value with a validation state updated after the validate. Otherwise raise the error from the validation of <code>op</code>.</p><p>Optional arguments allow to override defaults:</p><ul><li><code>?expect_failure:(error list -&gt; unit tzresult Lwt.t)</code>: validation of <code>op</code> is expected to fail and <code>expect_failure</code> should handle the error. In case validate does not fail and an <code>expect_failure</code> is provided, <code>validate_operation</code> fails.</li><li><code>?check_size:bool</code>: enable the check that an operation size should not exceed <code>Constants_repr.max_operation_data_length</code>. Enabled (set to <code>true</code>) by default.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_operation"><a href="#val-add_operation" class="anchor"></a><code><span><span class="keyword">val</span> add_operation : 
  <span><span class="optlabel">?expect_failure</span>:
    <span>(<span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> list</span> <span class="arrow">&#45;&gt;</span></span>
      <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?expect_apply_failure</span>:
    <span>(<span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> list</span> <span class="arrow">&#45;&gt;</span></span>
      <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_manager_failure</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?check_size</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Operation/index.html#type-packed">Tezos_protocol_alpha.Protocol.Alpha_context.Operation.packed</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-incremental">incremental</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>add_operation ?expect_failure ?expect_apply_failure
    ?allow_manager_failure ?check_size i op</code> tries to validate then apply <code>op</code> in the validation and application state of <code>i</code>. If the validation of <code>op</code> succeeds, the function returns the incremental value with a validation state updated after the application of <code>op</code>. Otherwise raise the error from the validation of <code>op</code>.</p><p>Optional arguments allow to override defaults:</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">expect_failure</span> <p>validation of <code>op</code> is expected to fail and <code>expect_failure</code> should handle the error. In case validate does not fail and <code>expect_failure</code> is provided, <code>validate_operation</code> fails.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">expect_apply_failure</span> <p>application of <code>op</code> is expected to fail and <code>expect_apply_failure</code> should handle the errror. In case the application of <code>op</code> does not fail and <code>expect_apply_failure</code> is provided, <code>add_operation</code> fails.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">allow_manager_failure</span> <p>marks that manager operation failures after fee taken are ignored.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">check_size</span> <p>enable the check that an operation size should not exceed <code>Constants_repr.max_operation_data_length</code>. Enabled (set to <code>true</code>) by default.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_block"><a href="#val-finalize_block" class="anchor"></a><code><span><span class="keyword">val</span> finalize_block : 
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Block/index.html#type-t">Block.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>finalize_block i</code> creates a <code>Block.t</code> based on the protocol states and the operations contained in <code>i</code>. The function calls <code>Main.finalize_application</code> to compute a new context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_validate_operation_fails"><a href="#val-assert_validate_operation_fails" class="anchor"></a><code><span><span class="keyword">val</span> assert_validate_operation_fails : 
  <span><span>(<span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/Operation/index.html#type-packed">Tezos_protocol_alpha.Protocol.Alpha_context.Operation.packed</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>assert_validate_operation_fails expect_failure operation block</code> calls <a href="#val-begin_construction"><code>begin_construction</code></a> on top of <code>block</code>, then <a href="#val-validate_operation"><code>validate_operation</code></a> with <code>~expect_failure</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_ctxt"><a href="#val-rpc_ctxt" class="anchor"></a><code><span><span class="keyword">val</span> rpc_ctxt : <span><a href="#type-incremental">incremental</a> <a href="../../../tezos-protocol-alpha/Tezos_protocol_environment_alpha/RPC_context/class-type-simple/index.html">Tezos_protocol_alpha.Environment.RPC_context.simple</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alpha_ctxt"><a href="#val-alpha_ctxt" class="anchor"></a><code><span><span class="keyword">val</span> alpha_ctxt : 
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-context">Tezos_protocol_alpha.Protocol.Alpha_context.context</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_alpha_ctxt"><a href="#val-set_alpha_ctxt" class="anchor"></a><code><span><span class="keyword">val</span> set_alpha_ctxt : 
  <span><a href="#type-incremental">incremental</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-alpha/Tezos_raw_protocol_alpha/Alpha_context/index.html#type-context">Tezos_protocol_alpha.Protocol.Alpha_context.context</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-incremental">incremental</a></span></code></div></div></div></body></html>
