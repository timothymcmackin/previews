<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sc_rollup_storage (tezos-protocol-020-PsParisC.Tezos_raw_protocol_020_PsParisC.Sc_rollup_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tezos-protocol-020-PsParisC</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_020_PsParisC</a> &#x00BB; Sc_rollup_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_020_PsParisC.Sc_rollup_storage</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-originate"><a href="#val-originate" class="anchor"></a><code><span><span class="keyword">val</span> originate : 
  <span><span class="optlabel">?whitelist</span>:<a href="../Sc_rollup_whitelist_repr/index.html#type-t">Sc_rollup_whitelist_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">kind</span>:<a href="../Sc_rollups/Kind/index.html#type-t">Sc_rollups.Kind.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">parameters_ty</span>:<a href="../Script_repr/index.html#type-lazy_expr">Script_repr.lazy_expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">genesis_commitment</span>:<a href="../Sc_rollup_commitment_repr/index.html#type-t">Sc_rollup_commitment_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Sc_rollup_repr/Address/index.html#type-t">Sc_rollup_repr.Address.t</a>
   * <a href="../../Tezos_protocol_environment_020_PsParisC/Z/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Z.t</a>
   * <a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a>
   * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>originate ?whitelist context ~kind ~parameters_ty ~genesis_commitment</code> produces an address <code>a</code> for a smart contract rollup using the origination nonce found in <code>context</code>. This function also initializes the storage with a new entry indexed by <code>a</code> to remember the <code>kind</code> of the rollup at address <code>a</code>.</p><p>Also returns the number of allocated bytes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-raw_originate"><a href="#val-raw_originate" class="anchor"></a><code><span><span class="keyword">val</span> raw_originate : 
  <span><span class="optlabel">?whitelist</span>:<a href="../Sc_rollup_whitelist_repr/index.html#type-t">Sc_rollup_whitelist_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">kind</span>:<a href="../Sc_rollups/Kind/index.html#type-t">Sc_rollups.Kind.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">parameters_ty</span>:<a href="../Script_repr/index.html#type-lazy_expr">Script_repr.lazy_expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">genesis_commitment</span>:<a href="../Sc_rollup_commitment_repr/index.html#type-t">Sc_rollup_commitment_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">address</span>:<a href="../Sc_rollup_repr/Address/index.html#type-t">Sc_rollup_repr.Address.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_protocol_environment_020_PsParisC/Z/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Z.t</a>
   * <a href="../Sc_rollup_commitment_repr/Hash/index.html#type-t">Sc_rollup_commitment_repr.Hash.t</a>
   * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>raw_originate ?whitelist context ~kind ~parameters_ty ~genesis_commitment ~address</code> is exactly <a href="#val-originate"><code>originate</code></a> but provides the rollup's address (<code>address</code>) instead of randomly generating it.</p><p>This should not be used by <code>apply.ml</code>, this is needed for bootstrap smart rollups only.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Sc_rollups/Kind/index.html#type-t">Sc_rollups.Kind.t</a>)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>kind context address</code> returns the kind of the given rollup <code>address</code> iff <code>address</code> is an existing rollup. Fails with an <code>Sc_rollup_does_not_exist</code> error in case the rollup does not exist.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_unaccounted"><a href="#val-list_unaccounted" class="anchor"></a><code><span><span class="keyword">val</span> list_unaccounted : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> list</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-genesis_info"><a href="#val-genesis_info" class="anchor"></a><code><span><span class="keyword">val</span> genesis_info : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Sc_rollup_commitment_repr/index.html#type-genesis_info">Sc_rollup_commitment_repr.genesis_info</a>)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>genesis_info ctxt sc_rollup</code> returns the level at which a <code>sc_rollup</code> was originated, and its genesis commitment hash.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_metadata"><a href="#val-get_metadata" class="anchor"></a><code><span><span class="keyword">val</span> get_metadata : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Sc_rollup_metadata_repr/index.html#type-t">Sc_rollup_metadata_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_metadata ctxt rollup</code> retrieves the origination level of the <code>rollup</code> using <a href="../Sc_rollup_commitment_repr/index.html#type-genesis_info"><code>Sc_rollup_commitment_repr.genesis_info</code></a> and creates a <a href="../Sc_rollup_metadata_repr/index.html#type-t"><code>Sc_rollup_metadata_repr.t</code></a>. Fails with <code>Sc_rollup_does_not_exist {rollup}</code> if the genesis info is missing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parameters_type"><a href="#val-parameters_type" class="anchor"></a><code><span><span class="keyword">val</span> parameters_type : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="../Script_repr/index.html#type-lazy_expr">Script_repr.lazy_expr</a> option</span> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>parameters_type ctxt rollup</code> returns the registered type of a rollup. Returns <code>None</code> in case there is no registered type for the rollup.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-must_exist"><a href="#val-must_exist" class="anchor"></a><code><span><span class="keyword">val</span> must_exist : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Sc_rollup_repr/index.html#type-t">Sc_rollup_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>must_exist ctxt rollup</code> checks whether the given <code>rollup</code> exists in <code>ctxt</code>. If <code>rollup</code> exists, a new context is returned with gas consumed for the lookup cost. If it does not exist, an error is returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_previous_commitment_period"><a href="#val-set_previous_commitment_period" class="anchor"></a><code><span><span class="keyword">val</span> set_previous_commitment_period : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>set_previous_commitment_period ctxt previous_period</code> is expected to be called during the protocol stitching, to ensure the previous commitment period length remains available in the next protocol, in order to deal with the commitments posted during the previous protocol but not yet cemented.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-previous_protocol_constants"><a href="#val-previous_protocol_constants" class="anchor"></a><code><span><span class="keyword">val</span> previous_protocol_constants : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a> * int)</span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_020_PsParisC.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_020_PsParisC/Lwt/index.html#type-t">Tezos_protocol_environment_020_PsParisC.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>previous_protocol_constants ctxt</code> fetches from <code>ctxt</code> the first level of the current protocol and the previous commitment period.</p><p>Both values are bounded in size and small, so we don’t carbonate the call.</p><p><b>Warning: b</b> This function requires that the previous commitment period has been correctly set with <a href="#val-set_previous_commitment_period"><code>set_previous_commitment_period</code></a> during the latest stitching.</p></div></div></div></body></html>
