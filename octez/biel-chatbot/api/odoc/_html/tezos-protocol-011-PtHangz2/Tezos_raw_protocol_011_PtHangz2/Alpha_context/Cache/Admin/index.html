<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Admin (tezos-protocol-011-PtHangz2.Tezos_raw_protocol_011_PtHangz2.Alpha_context.Cache.Admin)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">tezos-protocol-011-PtHangz2</a> &#x00BB; <a href="../../../index.html">Tezos_raw_protocol_011_PtHangz2</a> &#x00BB; <a href="../../index.html">Alpha_context</a> &#x00BB; <a href="../index.html">Cache</a> &#x00BB; Admin</nav><header class="odoc-preamble"><h1>Module <code><span>Cache.Admin</span></code></h1><p>The following module acts on the whole cache, not on a specific sub-cache, unlike <code>Interface</code>. It is used to administrate the protocol cache, e.g., to maintain the cache in a consistent state with respect to the chain. This module is typically used by low-level layers of the protocol and by the shell.</p></header><nav class="odoc-toc"><ul><li><a href="#cache-helpers-for-rpcs">Cache helpers for RPCs</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-key"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> key</span></code></div><div class="spec-doc"><p>A key uniquely identifies a cached <code>value</code> in some subcache.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-value"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> value</span></code></div><div class="spec-doc"><p>Cached values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : 
  <span><a href="../../../../Tezos_protocol_environment_011_PtHangz2/Format/index.html#type-formatter">Tezos_protocol_environment_011_PtHangz2.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>pp fmt ctxt</code> is a pretty printter for the <code>cache</code> of <code>ctxt</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_cache_layout"><a href="#val-set_cache_layout" class="anchor"></a><code><span><span class="keyword">val</span> set_cache_layout : 
  <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../index.html#type-size">size</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../index.html#type-context">context</a> <a href="../../../../Tezos_protocol_environment_011_PtHangz2/Lwt/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>set_cache_layout ctxt layout</code> sets the caches of <code>ctxt</code> to comply with given <code>layout</code>. If there was already a cache in <code>ctxt</code>, it is erased by the new layout.</p><p>In that case, a fresh collection of empty caches is reconstructed from the new <code>layout</code>. Notice that cache <code>key</code>s are invalidated in that case, i.e., <code>find t k</code> will return <code>None</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sync"><a href="#val-sync" class="anchor"></a><code><span><span class="keyword">val</span> sync : 
  <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache_nonce</span>:<a href="../../../../Tezos_protocol_environment_011_PtHangz2/Bytes/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Bytes.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../index.html#type-context">context</a> <a href="../../../../Tezos_protocol_environment_011_PtHangz2/Lwt/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>sync ctxt ~cache_nonce</code> updates the context with the domain of the cache computed so far. Such function is expected to be called at the end of the validation of a block, when there is no more accesses to the cache.</p><p><code>cache_nonce</code> identifies the block that introduced new cache entries. The nonce should identify uniquely the block which modifies this value. It cannot be the block hash for circularity reasons: The value of the nonce is stored onto the context and consequently influences the context hash of the very same block. Such nonce cannot be determined by the shell and its computation is delegated to the economic protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-clear"><a href="#val-clear" class="anchor"></a><code><span><span class="keyword">val</span> clear : <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../index.html#type-context">context</a></span></code></div><div class="spec-doc"><p><code>clear ctxt</code> removes all cache entries.</p></div></div><h4 id="cache-helpers-for-rpcs"><a href="#cache-helpers-for-rpcs" class="anchor"></a>Cache helpers for RPCs</h4><div class="odoc-spec"><div class="spec value anchored" id="val-future_cache_expectation"><a href="#val-future_cache_expectation" class="anchor"></a><code><span><span class="keyword">val</span> future_cache_expectation : <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">time_in_blocks</span>:int <span class="arrow">&#45;&gt;</span></span> <a href="../../index.html#type-context">context</a></span></code></div><div class="spec-doc"><p><code>future_cache_expectation ctxt ~time_in_blocks</code> returns <code>ctxt</code> except that the entries of the caches that are presumably too old to still be in the caches in <code>n_blocks</code> are removed.</p><p>This function is based on a heuristic. The context maintains the median of the number of removed entries: this number is multipled by `n_blocks` to determine the entries that are likely to be removed in `n_blocks`.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cache_size"><a href="#val-cache_size" class="anchor"></a><code><span><span class="keyword">val</span> cache_size : <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">cache_index</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-size">size</a> option</span></span></code></div><div class="spec-doc"><p><code>cache_size ctxt ~cache_index</code> returns an overapproximation of the size of the cache. Returns <code>None</code> if <code>cache_index</code> is greater than the number of subcaches declared by the cache layout.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cache_size_limit"><a href="#val-cache_size_limit" class="anchor"></a><code><span><span class="keyword">val</span> cache_size_limit : <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">cache_index</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-size">size</a> option</span></span></code></div><div class="spec-doc"><p><code>cache_size_limit ctxt ~cache_index</code> returns the maximal size of the cache indexed by <code>cache_index</code>. Returns <code>None</code> if <code>cache_index</code> is greater than the number of subcaches declared by the cache layout.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-value_of_key"><a href="#val-value_of_key" class="anchor"></a><code><span><span class="keyword">val</span> value_of_key : 
  <span><a href="../../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../Tezos_protocol_environment_011_PtHangz2/Context/Cache/index.html#type-key">Tezos_protocol_environment_011_PtHangz2.Context.Cache.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../../Tezos_protocol_environment_011_PtHangz2/Context/Cache/index.html#type-value">Tezos_protocol_environment_011_PtHangz2.Context.Cache.value</a>
    <a href="../../../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_011_PtHangz2.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_011_PtHangz2/Lwt/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>value_of_key ctxt k</code> interprets the functions introduced by <code>register</code> to construct a cacheable value for a key <code>k</code>.</p></div></div></div></body></html>
