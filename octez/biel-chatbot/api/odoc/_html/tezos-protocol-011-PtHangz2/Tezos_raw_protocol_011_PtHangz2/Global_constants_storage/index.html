<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Global_constants_storage (tezos-protocol-011-PtHangz2.Tezos_raw_protocol_011_PtHangz2.Global_constants_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-011-PtHangz2</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_011_PtHangz2</a> &#x00BB; Global_constants_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_011_PtHangz2.Global_constants_storage</span></code></h1><p>This module represents access to a global table of constant Micheline values. Users may register a Micheline value in the table, paying the cost of storage. Once stored, contracts source code may reference this value by its hash.</p><p>Note: the table does not typecheck the values stored in it. Instead, any place that uses constants must first call <code>expand</code> before typechecking the code. This decision was made to make it as easy as possible for users to register values to the table, and also to allow maximum flexibility in the use of constants for different parts of a Michelson script (code, types, data, etc.).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Expression_too_deep"><a href="#extension-decl-Expression_too_deep" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-error">Tezos_protocol_environment_011_PtHangz2.Error_monad.error</a> += </span></code><ol><li id="extension-Expression_too_deep" class="def variant extension anchored"><a href="#extension-Expression_too_deep" class="anchor"></a><code><span>| </span><span><span class="extension">Expression_too_deep</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Expression_already_registered"><a href="#extension-decl-Expression_already_registered" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-error">Tezos_protocol_environment_011_PtHangz2.Error_monad.error</a> += </span></code><ol><li id="extension-Expression_already_registered" class="def variant extension anchored"><a href="#extension-Expression_already_registered" class="anchor"></a><code><span>| </span><span><span class="extension">Expression_already_registered</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Badly_formed_constant_expression"><a href="#extension-decl-Badly_formed_constant_expression" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-error">Tezos_protocol_environment_011_PtHangz2.Error_monad.error</a> += </span></code><ol><li id="extension-Badly_formed_constant_expression" class="def variant extension anchored"><a href="#extension-Badly_formed_constant_expression" class="anchor"></a><code><span>| </span><span><span class="extension">Badly_formed_constant_expression</span></span></code></li></ol></div><div class="spec-doc"><p>A constant is the prim of the literal characters &quot;constant&quot;. A constant must have a single argument, being a string with a well formed hash of a Micheline expression (i.e generated by <code>Script_expr_hash.to_b58check</code>).</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Nonexistent_global"><a href="#extension-decl-Nonexistent_global" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-error">Tezos_protocol_environment_011_PtHangz2.Error_monad.error</a> += </span></code><ol><li id="extension-Nonexistent_global" class="def variant extension anchored"><a href="#extension-Nonexistent_global" class="anchor"></a><code><span>| </span><span><span class="extension">Nonexistent_global</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Script_expr_hash/index.html#type-t">Script_expr_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Script_repr/index.html#type-expr">Script_repr.expr</a>)</span>
    <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_011_PtHangz2.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_011_PtHangz2/Lwt/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get context hash</code> retrieves the Micheline value with the given hash.</p><p>Fails with <code>Nonexistent_global</code> if no value is found at the given hash.</p><p>Fails with <code>Storage_error Corrupted_data</code> if the deserialisation fails.</p><p>Consumes <code>Gas_repr.read_bytes_cost &lt;size of the value&gt;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register"><a href="#val-register" class="anchor"></a><code><span><span class="keyword">val</span> register : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Script_repr/index.html#type-expr">Script_repr.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a>
   * <a href="../Script_expr_hash/index.html#type-t">Script_expr_hash.t</a>
   * <a href="../../Tezos_protocol_environment_011_PtHangz2/Z/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Z.t</a>)</span>
    <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_011_PtHangz2.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_011_PtHangz2/Lwt/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>register context value</code> registers a constant in the global table of constants, returning the hash and storage bytes consumed.</p><p>Does not type-check the Micheline code being registered, allow potentially ill-typed Michelson values to be stored in the table (see note at top of module).</p><p>The constant is stored unexpanded, but it is temporarily expanded at registration time only to check the expanded version respects the following limits. This also ensures there are no cyclic dependencies between constants.</p><p>Fails with <code>Expression_too_deep</code> if, after fully expanding all constants, the expression would have a depth greater than <code>Constant_repr.max_allowed_global_constant_depth</code>.</p><p>Fails with <code>Badly_formed_constant_expression</code> if constants are not well-formed (see declaration of <code>Badly_formed_constant_expression</code>) or with <code>Nonexistent_global</code> if a referenced constant does not exist in the table.</p><p>Consumes serialization cost. Consumes <code>Gas_repr.write_bytes_cost &lt;size&gt;</code> where size is the number of bytes in the binary serialization provided by <code>Script_repr.expr_encoding</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expand"><a href="#val-expand" class="anchor"></a><code><span><span class="keyword">val</span> expand : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Script_repr/index.html#type-expr">Script_repr.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Script_repr/index.html#type-expr">Script_repr.expr</a>)</span>
    <a href="../../Tezos_protocol_environment_011_PtHangz2/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_011_PtHangz2.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_011_PtHangz2/Lwt/index.html#type-t">Tezos_protocol_environment_011_PtHangz2.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>expand context expr</code> replaces every constant in the given Michelson expression with its value stored in the global table.</p><p>The expansion is applied recursively so that the returned expression contains no constant.</p><p>Fails with <code>Badly_formed_constant_expression</code> if constants are not well-formed (see declaration of <code>Badly_formed_constant_expression</code>) or with <code>Nonexistent_global</code> if a referenced constant does not exist in the table.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
