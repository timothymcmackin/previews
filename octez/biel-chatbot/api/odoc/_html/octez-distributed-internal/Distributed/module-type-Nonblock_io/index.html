<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Nonblock_io (octez-distributed-internal.Distributed.Nonblock_io)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-distributed-internal</a> &#x00BB; <a href="../index.html">Distributed</a> &#x00BB; Nonblock_io</nav><header class="odoc-preamble"><h1>Module type <code><span>Distributed.Nonblock_io</span></code></h1><p>Abstract type which can perform monadic concurrent IO.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The monadic light weight thread type returning value <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream"><a href="#type-stream" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a stream</span></span></code></div><div class="spec-doc"><p>An unbounded stream holding values of <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-input_channel"><a href="#type-input_channel" class="anchor"></a><code><span><span class="keyword">type</span> input_channel</span></code></div><div class="spec-doc"><p>A type to represent a non-blocking input channel</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-output_channel"><a href="#type-output_channel" class="anchor"></a><code><span><span class="keyword">type</span> output_channel</span></code></div><div class="spec-doc"><p>A type to represent a non-blocking output channel</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-server"><a href="#type-server" class="anchor"></a><code><span><span class="keyword">type</span> server</span></code></div><div class="spec-doc"><p>A type to represent a server</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Timeout"><a href="#exception-Timeout" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Timeout</span></span></code></div><div class="spec-doc"><p>Exception raised by <a href="#val-timeout"><code>timeout</code></a> operation</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-level"><a href="#type-level" class="anchor"></a><code><span><span class="keyword">type</span> level</span><span> = </span></code><ol><li id="type-level.Debug" class="def variant constructor anchored"><a href="#type-level.Debug" class="anchor"></a><code><span>| </span><span><span class="constructor">Debug</span></span></code></li><li id="type-level.Info" class="def variant constructor anchored"><a href="#type-level.Info" class="anchor"></a><code><span>| </span><span><span class="constructor">Info</span></span></code></li><li id="type-level.Warning" class="def variant constructor anchored"><a href="#type-level.Warning" class="anchor"></a><code><span>| </span><span><span class="constructor">Warning</span></span></code></li><li id="type-level.Error" class="def variant constructor anchored"><a href="#type-level.Error" class="anchor"></a><code><span>| </span><span><span class="constructor">Error</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Type to represent levels of a log message.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lib_name"><a href="#val-lib_name" class="anchor"></a><code><span><span class="keyword">val</span> lib_name : string</span></code></div><div class="spec-doc"><p>The name of the implementation, for logging purposes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lib_version"><a href="#val-lib_version" class="anchor"></a><code><span><span class="keyword">val</span> lib_version : string</span></code></div><div class="spec-doc"><p>The version implementation, for logging purposes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lib_description"><a href="#val-lib_description" class="anchor"></a><code><span><span class="keyword">val</span> lib_description : string</span></code></div><div class="spec-doc"><p>A description of the implementation (e.g., the url of the code repository ), for logging purposes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return v</code> creates a light weight thread returning <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;&gt;=)"><a href="#val-(&gt;&gt;=)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;&gt;=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind t f</code> is a thread which first waits for the thread <code>t</code> to terminate and then, if the thread succeeds, behaves as the application of function <code>f</code> to the return value of <code>t</code>. If the thread <code>t</code> fails, <code>bind t f</code> also fails, with the same exception.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span>exn <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fail e</code> is a thread that fails with the exception <code>e</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-catch"><a href="#val-catch" class="anchor"></a><code><span><span class="keyword">val</span> catch : <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>exn <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>catch t f</code> is a thread that behaves as the thread <code>t ()</code> if this thread succeeds. If the thread <code>t ()</code> fails with some exception, <code>catch t f</code> behaves as the application of <code>f</code> to this exception.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-async"><a href="#val-async" class="anchor"></a><code><span><span class="keyword">val</span> async : <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>async f starts</code> a thread without waiting for the result.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_stream"><a href="#val-create_stream" class="anchor"></a><code><span><span class="keyword">val</span> create_stream : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-stream">stream</a></span> * <span>(<span><span><span class="type-var">'a</span> option</span> <span class="arrow">&#45;&gt;</span></span> unit)</span></span></code></div><div class="spec-doc"><p><code>create ()</code> returns a new stream and a push function.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><span><span class="type-var">'a</span> <a href="#type-stream">stream</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>get st</code> removes and returns the first element of the stream, if any. Will block if the stream is empty.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stream_append"><a href="#val-stream_append" class="anchor"></a><code><span><span class="keyword">val</span> stream_append : <span><span><span class="type-var">'a</span> <a href="#type-stream">stream</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-stream">stream</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-stream">stream</a></span></span></code></div><div class="spec-doc"><p><code>stream_append s1 s2</code> returns a <code>stream</code> which returns all elements of <code>s1</code>, then all elements of <code>s2</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_input"><a href="#val-close_input" class="anchor"></a><code><span><span class="keyword">val</span> close_input : <span><a href="#type-input_channel">input_channel</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>close ch</code> closes the given channel immediately.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_output"><a href="#val-close_output" class="anchor"></a><code><span><span class="keyword">val</span> close_output : <span><a href="#type-output_channel">output_channel</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>close ch</code> closes the given channel. It performs all pending actions, flushes it and closes it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_value"><a href="#val-read_value" class="anchor"></a><code><span><span class="keyword">val</span> read_value : <span><a href="#type-input_channel">input_channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>read_value ic</code> reads a marshalled value from <code>ic</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_value"><a href="#val-write_value" class="anchor"></a><code><span><span class="keyword">val</span> write_value : 
  <span><a href="#type-output_channel">output_channel</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?flags</span>:<span><span class="xref-unresolved">Stdlib</span>.Marshal.extern_flags list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>write_value oc ?flags x</code> marshals the value <code>x</code> to <code>oc</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_connection"><a href="#val-open_connection" class="anchor"></a><code><span><span class="keyword">val</span> open_connection : <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-input_channel">input_channel</a> * <a href="#type-output_channel">output_channel</a>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>open_connection addr</code> opens a connection to the given address and returns two channels for using it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-establish_server"><a href="#val-establish_server" class="anchor"></a><code><span><span class="keyword">val</span> establish_server : 
  <span><span class="optlabel">?backlog</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Unix</span>.sockaddr <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-input_channel">input_channel</a> * <a href="#type-output_channel">output_channel</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-server">server</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>establish_server ?backlog sockaddr f</code> creates a server which will listen for incoming connections. New connections are passed to <code>f</code>. Note that <code>f</code> must not raise any exception. Backlog is the argument passed to Lwt_unix.listen.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown_server"><a href="#val-shutdown_server" class="anchor"></a><code><span><span class="keyword">val</span> shutdown_server : <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>shutdown_server server</code> will shutdown <code>server</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log"><a href="#val-log" class="anchor"></a><code><span><span class="keyword">val</span> log : <span><a href="#type-level">level</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>log level message_formatter</code> logs a message at the specified level using the formatter provided.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sleep"><a href="#val-sleep" class="anchor"></a><code><span><span class="keyword">val</span> sleep : <span>float <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>sleep d</code> is a thread that remains suspended for <code>d</code> seconds and then terminates.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-timeout"><a href="#val-timeout" class="anchor"></a><code><span><span class="keyword">val</span> timeout : <span>float <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>timeout d</code> is a thread that remains suspended for <code>d</code> seconds and then fails with â€‹<a href="#exception-Timeout"><code>Distributed.Nonblock_io.Timeout</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pick"><a href="#val-pick" class="anchor"></a><code><span><span class="keyword">val</span> pick : <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pick l</code> behaves as the first thread in l to terminate. If several threads are already terminated, one is chosen at random. Cancels all sleeping threads when one terminates.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-at_exit"><a href="#val-at_exit" class="anchor"></a><code><span><span class="keyword">val</span> at_exit : <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>at_exit fn</code> will call fn on program exit.</p></div></div></div></body></html>
