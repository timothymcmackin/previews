<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Uses (octez-libs.Tezt_wrapper.Uses)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezt_wrapper</a> &#x00BB; Uses</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_wrapper.Uses</span></code></h1><p>Test dependencies.</p><p><code>Test.register</code> and <code>Regression.register</code> take an optional argument <code>?uses</code> that allows to declare that the test uses a given file.</p><p>For instance, you can define:</p><pre class="language-ocaml"><code>let data = Uses.make ~tag:&quot;data&quot; ~path:&quot;data/file.dat&quot; ()</code></pre><p>You would then:</p><ul><li>declare your test with <code>~uses:[data]</code>;</li><li>use <code>Uses.path data</code> to get the path to your file.</li></ul><p><code>~uses:[data]</code> adds the tag of <code>data</code> to the test tags.</p><p><code>Uses.path data</code> checks that the current test was declared with <code>data</code> in its <code>~uses</code>. And when you declare a test with <code>~uses:[data]</code>, the test checks, at the end, that <code>Uses.path data</code> was called. This helps to maintain the invariant that a test that uses a given file has a given tag.</p><p>Note that some uses are added by default to all tests. See section <a href="#default" title="default">Default Uses</a> below.</p></header><nav class="odoc-toc"><ul><li><a href="#default">Default Uses</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Test dependencies.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="optlabel">?how_to_build</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">tag</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">path</span>:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Make a test dependency.</p><p>Multiple paths can be associated with the same tag, and the same paths can be associated with different tags.</p><p><code>how_to_build</code>, if set, is printed to the user should the dependency be missing, and should contain instructions on how to build the dependency. Example:</p><pre class="language-ocaml"><code>Uses.make
  ~how_to_build:&quot;make -f etherlink.ml build&quot;
  ~tag:&quot;evm_kernel&quot;
  ~path:&quot;evm_kernel.wasm&quot;
  ()</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-path"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the path of a test dependency.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tag"><a href="#val-tag" class="anchor"></a><code><span><span class="keyword">val</span> tag : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the tag of a test dependency.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup"><a href="#val-lookup" class="anchor"></a><code><span><span class="keyword">val</span> lookup : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>Get the first <code>Uses.t</code> that was created using <code>make</code> for a given path.</p><p>Paths are considered equal modulo some inconsequential variations. For instance, <code>&quot;./bin//./octez-node&quot;</code> and <code>&quot;bin/octez-node&quot;</code> are considered equivalent.</p></div></div><h3 id="default"><a href="#default" class="anchor"></a>Default Uses</h3><p>The following uses are added by default, but can be removed by specifying <code>~uses_node:false</code> or <code>~uses_client:false</code>.</p><div class="odoc-spec"><div class="spec value anchored" id="val-octez_node"><a href="#val-octez_node" class="anchor"></a><code><span><span class="keyword">val</span> octez_node : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>&quot;./octez-node&quot;</code>, with tag <code>&quot;node&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-octez_client"><a href="#val-octez_client" class="anchor"></a><code><span><span class="keyword">val</span> octez_client : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>&quot;./octez-client&quot;</code>, with tag <code>&quot;client&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-octez_admin_client"><a href="#val-octez_admin_client" class="anchor"></a><code><span><span class="keyword">val</span> octez_admin_client : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>&quot;./octez-admin-client&quot;</code>, with tag <code>&quot;admin_client&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-octez_baker_alpha"><a href="#val-octez_baker_alpha" class="anchor"></a><code><span><span class="keyword">val</span> octez_baker_alpha : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>&quot;./octez-baker-alpha&quot;</code>, with tag <code>&quot;baker_alpha&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_meta_test"><a href="#val-register_meta_test" class="anchor"></a><code><span><span class="keyword">val</span> register_meta_test : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a test that generates:</p><pre class="language-ocaml"><code>tezt/lib_wrapper/expected/tezt_wrapper.ml/runtime-dependency-tags.out</code></pre><p>This file can be used by the manifest to deduce which tests to run. By having this be a regression test, we guarantee that this list is always up-to-date and that there is only one source of truth.</p><p>To regenerate the file, run:</p><pre class="language-ocaml"><code>dune exec tezt/tests/main.exe -- \
  --reset-regressions -t 'meta: list runtime dependencies'</code></pre><p>Since the contents of the file depends on the tests which are registered, but the file is always the same, this function should only be called by the executable that is linked with all tests, i.e. <code>tezt/tests/main.exe</code>.</p></div></div></div></body></html>
