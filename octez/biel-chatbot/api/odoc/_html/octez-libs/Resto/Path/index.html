<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Path (octez-libs.Resto.Path)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Resto</a> &#x00BB; Path</nav><header class="odoc-preamble"><h1>Module <code><span>Resto.Path</span></code></h1><p>Paths describe URIs/URLs: segments separated by slashes (/).</p><p>Note that paths can be static (i.e., all the segments of the path are determined in advance) or dynamic (i.e., some segments of the path are actually arguments for the service -- e.g., paths can have the form <code>/user/&lt;user-name&gt;</code> where <code>&lt;user-name&gt;</code> is a string encoding of a user identifier).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('prefix, 'params) t</span></span></code></div><div class="spec-doc"><p>The type for service's paths</p><p>A <code>(p, a) path</code> is a path in which some segments encode a value of type <code>a</code>.</p><p>Typically a <code>(_, unit) path</code> is a static path. Also typically, a dynamic path has type <code>(_, ((unit * a) * b) * ..) path</code> where different segments encode the different components of the tuple (<code>a</code>, <code>b</code>, etc.). For example the path <code>/entries-by-date/&lt;year&gt;/&lt;month&gt;/&lt;day&gt;</code> may be described as a <code>(_, ((unit * int) * int) * int) path</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-path"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> <span>('prefix, 'params) path</span></span><span> = <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-context"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> <span>'prefix context</span></span><span> = <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'prefix</span>)</span> <a href="#type-path">path</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-root"><a href="#val-root" class="anchor"></a><code><span><span class="keyword">val</span> root : <span>unit <a href="#type-context">context</a></span></span></code></div><div class="spec-doc"><p><code>root</code> is the basis to build paths upon. It is the &quot;<code>Nil</code>&quot; of path construction.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_root"><a href="#val-open_root" class="anchor"></a><code><span><span class="keyword">val</span> open_root : <span><span class="type-var">'a</span> <a href="#type-context">context</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_suffix"><a href="#val-add_suffix" class="anchor"></a><code><span><span class="keyword">val</span> add_suffix : <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>add_suffix p s</code> is a path in which <code>s</code> has been appended to the sequence of segments described by <code>p</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(/)"><a href="#val-(/)" class="anchor"></a><code><span><span class="keyword">val</span> (/) : <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>(/)</code> is an infix operator for <code>add_suffix</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_arg"><a href="#val-add_arg" class="anchor"></a><code><span><span class="keyword">val</span> add_arg : 
  <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Arg/index.html#type-t">Arg.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span> * <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>add_arg p a</code> is a path in which a segment representing a value of type <code>a</code> has been appended to the sequence of segments described by <code>p</code>.</p><p>This is intended for use by services. Specifically, a service that is parameterized over a value of type <code>ty</code> is attached to a path that includes an argument for a value of type <code>ty</code>. When the service is called, Resto decodes the argument and passes its value to the service.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(/:)"><a href="#val-(/:)" class="anchor"></a><code><span><span class="keyword">val</span> (/:) : <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Arg/index.html#type-t">Arg.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span> * <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>(/:)</code> is an infix operator for <code>add_arg</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_final_args"><a href="#val-add_final_args" class="anchor"></a><code><span><span class="keyword">val</span> add_final_args : 
  <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Arg/index.html#type-t">Arg.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span> * <span><span class="type-var">'a</span> list</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>add_final_args p a</code> is a path in which an arbitrary sequence of segments representing values of type <code>a</code> has been appended to the sequence of segments described by <code>p</code>.</p><p>A similar use to the <code>add_arg</code> is intended, but for a list of values rather than a single value.</p><p>Note that, as the name suggests, <code>add_final_args</code> is final: you cannot add further suffixes or arguments to the resulting path. Attempting to do so raises <code>Invalid_arg</code>. Similarly, using the resulting path as a <code>prefix</code> (see below) raises the same exception. This is because paths built with <code>add_final_args</code> consume all the suffix as an unterminated list of arguments, there cannot be further suffixes or arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(/:*)"><a href="#val-(/:*)" class="anchor"></a><code><span><span class="keyword">val</span> (/:*) : 
  <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Arg/index.html#type-t">Arg.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span> * <span><span class="type-var">'a</span> list</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>( /:* )</code> is an infix operator for <code>add_final_args</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-prefix"><a href="#val-prefix" class="anchor"></a><code><span><span class="keyword">val</span> prefix : 
  <span><span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'prefix</span>, <span class="type-var">'params</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>prefix p q</code> is a path in which the sequence of segments of <code>p</code> is followed by the sequence of segments of <code>q</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subst0"><a href="#val-subst0" class="anchor"></a><code><span><span class="keyword">val</span> subst0 : <span><span><span>(<span class="type-var">'p</span>, <span class="type-var">'p</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'p2</span>, <span class="type-var">'p2</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>subst0 p</code> is a path akin to <code>p</code> but with a different type for the prefix parameter. This is useful when declaring a service in a part of the code where the type of the prefix parameters are not available.</p><p>The typical use-case is with protocol services. A service is declared with some dummy prefix parameters.</p><p>Later, the shell instantiates the protocol. The shell obtains this service declaration from the instantiated protocol. The shell maintains a protocol state (so called context), which is associated to a given chain (main, testnet, etc.).</p><p>The shell registers the service by substituting the shell-side prefix parameters.</p><p>For example, below is a commented excerpt from <code>src/lib_shell/block_directory.ml</code>.</p><pre class="language-ocaml"><code>(* new directory with concrete prefix parameters *)
let dir :
    (Store.chain_store * Block_hash.t * Block_header.t) Tezos_rpc.Directory.t
    ref =
  ref Tezos_rpc.Directory.empty
in
(* function to add a service to the new directory
   note the call to [subst0] which substitutes the dummy prefix parameters of
   [s] to the concrete ones *)
let register0 s f =
  dir :=
    Tezos_rpc.Directory.register
      !dir
      (Tezos_rpc.Service.subst0 s) (* apply [subst0] to the path of [s] *)
      (fun block p q -&gt; f block p q)
in
(* get the service declarations from the [Proto]col *)
let module Block_services = Block_services.Make (Proto) (Proto) in
let module S = Block_services.S in
register0
  S.hash (* service declared in the protocol used a dummy unit instead of
            [(chain, hash, header)] *)
  (fun (_, hash, _) () () -&gt; return hash) ;
(* more registration with subst0 threaded in …*)</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subst1"><a href="#val-subst1" class="anchor"></a><code><span><span class="keyword">val</span> subst1 : <span><span><span>(<span class="type-var">'p</span>, <span class="type-var">'p</span> * <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'p2</span>, <span class="type-var">'p2</span> * <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p>See <code>subst0</code> for rationale.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subst2"><a href="#val-subst2" class="anchor"></a><code><span><span class="keyword">val</span> subst2 : <span><span><span>(<span class="type-var">'p</span>, <span>(<span class="type-var">'p</span> * <span class="type-var">'a</span>)</span> * <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'p2</span>, <span>(<span class="type-var">'p2</span> * <span class="type-var">'a</span>)</span> * <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p>See <code>subst0</code> for rationale.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-subst3"><a href="#val-subst3" class="anchor"></a><code><span><span class="keyword">val</span> subst3 : 
  <span><span><span>(<span class="type-var">'p</span>, <span>(<span>(<span class="type-var">'p</span> * <span class="type-var">'a</span>)</span> * <span class="type-var">'b</span>)</span> * <span class="type-var">'c</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'p2</span>, <span>(<span>(<span class="type-var">'p2</span> * <span class="type-var">'a</span>)</span> * <span class="type-var">'b</span>)</span> * <span class="type-var">'c</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p>See <code>subst0</code> for rationale.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_segments"><a href="#val-to_segments" class="anchor"></a><code><span><span class="keyword">val</span> to_segments : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>to_segments path</code> evaluates in the list of the different elements that constitute the given <code>path</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>to_string path</code> evaluates in a string representation of the given <code>path</code>.</p></div></div></div></body></html>
