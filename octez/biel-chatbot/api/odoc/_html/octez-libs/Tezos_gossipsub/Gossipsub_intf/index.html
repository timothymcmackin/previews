<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gossipsub_intf (octez-libs.Tezos_gossipsub.Gossipsub_intf)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_gossipsub</a> &#x00BB; Gossipsub_intf</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_gossipsub.Gossipsub_intf</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-ITERABLE"><a href="#module-type-ITERABLE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-ITERABLE/index.html">ITERABLE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-AUTOMATON_SUBCONFIG"><a href="#module-type-AUTOMATON_SUBCONFIG" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-AUTOMATON_SUBCONFIG/index.html">AUTOMATON_SUBCONFIG</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-SPAN"><a href="#module-type-SPAN" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-SPAN/index.html">SPAN</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-TIME"><a href="#module-type-TIME" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-TIME/index.html">TIME</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-AUTOMATON_CONFIG"><a href="#module-type-AUTOMATON_CONFIG" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-AUTOMATON_CONFIG/index.html">AUTOMATON_CONFIG</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-per_topic_score_limits"><a href="#type-per_topic_score_limits" class="anchor"></a><code><span><span class="keyword">type</span> <span>'span per_topic_score_limits</span></span><span> = </span><span>{</span></code><ol><li id="type-per_topic_score_limits.time_in_mesh_weight" class="def record field anchored"><a href="#type-per_topic_score_limits.time_in_mesh_weight" class="anchor"></a><code><span>time_in_mesh_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P1: The weight of the score associated to the time spent in the mesh.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.time_in_mesh_cap" class="def record field anchored"><a href="#type-per_topic_score_limits.time_in_mesh_cap" class="anchor"></a><code><span>time_in_mesh_cap : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P1: The maximum value considered for the score associated to the time spent by a peer in the mesh.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.time_in_mesh_quantum" class="def record field anchored"><a href="#type-per_topic_score_limits.time_in_mesh_quantum" class="anchor"></a><code><span>time_in_mesh_quantum : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P1: The score associated to the time spent <code>t</code> in the mesh is <code>(min t time_in_mesh_cap) / time_in_mesh_quantum</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.first_message_deliveries_weight" class="def record field anchored"><a href="#type-per_topic_score_limits.first_message_deliveries_weight" class="anchor"></a><code><span>first_message_deliveries_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P2: The weight of the score associated to the number of first message deliveries.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.first_message_deliveries_cap" class="def record field anchored"><a href="#type-per_topic_score_limits.first_message_deliveries_cap" class="anchor"></a><code><span>first_message_deliveries_cap : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P2: The maximum value considered during score computation for the number of first message deliveries.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.first_message_deliveries_decay" class="def record field anchored"><a href="#type-per_topic_score_limits.first_message_deliveries_decay" class="anchor"></a><code><span>first_message_deliveries_decay : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P2: The score is multiplied by this factor every <code>score_cleanup_ticks</code> heartbeat. This parameter must be in the unit interval.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_message_deliveries_weight" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_message_deliveries_weight" class="anchor"></a><code><span>mesh_message_deliveries_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3: The weight of the score associated to the number of first/near-first mesh message deliveries.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_message_deliveries_window" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_message_deliveries_window" class="anchor"></a><code><span>mesh_message_deliveries_window : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3: The delay added to the first delivery of a message to obtain the upper bound up to which a duplicate message is counted as nearly-first delivered.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_message_deliveries_activation" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_message_deliveries_activation" class="anchor"></a><code><span>mesh_message_deliveries_activation : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3: How long should a peer be in the mesh before we start evaluating P3.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_message_deliveries_cap" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_message_deliveries_cap" class="anchor"></a><code><span>mesh_message_deliveries_cap : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3: The maximum value considered during score computation for the number of first/near-first mesh message deliveries.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_message_deliveries_threshold" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_message_deliveries_threshold" class="anchor"></a><code><span>mesh_message_deliveries_threshold : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3: The number of messages received from a peer in the mesh in the associated topic above which the peer won't be penalized</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_message_deliveries_decay" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_message_deliveries_decay" class="anchor"></a><code><span>mesh_message_deliveries_decay : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3: The score is multiplied by this factor every <code>score_cleanup_ticks</code> heartbeat. This parameter must be in the unit interval.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_failure_penalty_weight" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_failure_penalty_weight" class="anchor"></a><code><span>mesh_failure_penalty_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3b: Penalty induced when a peer gets pruned with a non-zero mesh message delivery deficit.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.mesh_failure_penalty_decay" class="def record field anchored"><a href="#type-per_topic_score_limits.mesh_failure_penalty_decay" class="anchor"></a><code><span>mesh_failure_penalty_decay : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P3b: The score is multiplied by this factor every <code>score_cleanup_ticks</code> heartbeat. This parameter must be in the unit interval.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.invalid_message_deliveries_weight" class="def record field anchored"><a href="#type-per_topic_score_limits.invalid_message_deliveries_weight" class="anchor"></a><code><span>invalid_message_deliveries_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P4: Penalty induced when a peer sends an invalid message.</p><span class="comment-delim">*)</span></div></li><li id="type-per_topic_score_limits.invalid_message_deliveries_decay" class="def record field anchored"><a href="#type-per_topic_score_limits.invalid_message_deliveries_decay" class="anchor"></a><code><span>invalid_message_deliveries_decay : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P4: The score is multiplied by this factor every <code>score_cleanup_ticks</code> heartbeat. This parameter must be in the unit interval.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-topic_score_limits"><a href="#type-topic_score_limits" class="anchor"></a><code><span><span class="keyword">type</span> <span>('topic, 'span) topic_score_limits</span></span><span> = </span></code><ol><li id="type-topic_score_limits.Topic_score_limits_single" class="def variant constructor anchored"><a href="#type-topic_score_limits.Topic_score_limits_single" class="anchor"></a><code><span>| </span><span><span class="constructor">Topic_score_limits_single</span> <span class="keyword">of</span> <span><span class="type-var">'span</span> <a href="#type-per_topic_score_limits">per_topic_score_limits</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Use this constructor when the topic score parameters do not depend on the topic.</p><span class="comment-delim">*)</span></div></li><li id="type-topic_score_limits.Topic_score_limits_family" class="def variant constructor anchored"><a href="#type-topic_score_limits.Topic_score_limits_family" class="anchor"></a><code><span>| </span><span><span class="constructor">Topic_score_limits_family</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-topic_score_limits.all_topics" class="def record field anchored"><a href="#type-topic_score_limits.all_topics" class="anchor"></a><code><span>all_topics : <span><span class="type-var">'topic</span> <a href="../../Tezos_error_monad/TzLwtreslib/Seq/index.html#type-t">Tezos_base.TzPervasives.Seq.t</a></span>;</span></code></li><li id="type-topic_score_limits.parameters" class="def record field anchored"><a href="#type-topic_score_limits.parameters" class="anchor"></a><code><span>parameters : <span><span class="type-var">'topic</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'span</span> <a href="#type-per_topic_score_limits">per_topic_score_limits</a></span>;</span></code></li><li id="type-topic_score_limits.weights" class="def record field anchored"><a href="#type-topic_score_limits.weights" class="anchor"></a><code><span>weights : <span><span class="type-var">'topic</span> <span class="arrow">&#45;&gt;</span></span> float;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Use this constructor when the topic score parameters may depend on the topic.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-score_limits"><a href="#type-score_limits" class="anchor"></a><code><span><span class="keyword">type</span> <span>('topic, 'span) score_limits</span></span><span> = </span><span>{</span></code><ol><li id="type-score_limits.topics" class="def record field anchored"><a href="#type-score_limits.topics" class="anchor"></a><code><span>topics : <span><span>(<span class="type-var">'topic</span>, <span class="type-var">'span</span>)</span> <a href="#type-topic_score_limits">topic_score_limits</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Per-topic score parameters.</p><span class="comment-delim">*)</span></div></li><li id="type-score_limits.topic_score_cap" class="def record field anchored"><a href="#type-score_limits.topic_score_cap" class="anchor"></a><code><span>topic_score_cap : <span>float option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>An optional cap on the total positive contribution of topics to the score of the peer. If not equal to <code>None</code>, must be non-negative.</p><span class="comment-delim">*)</span></div></li><li id="type-score_limits.behaviour_penalty_weight" class="def record field anchored"><a href="#type-score_limits.behaviour_penalty_weight" class="anchor"></a><code><span>behaviour_penalty_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P7: The weight of the score associated to the behaviour penalty. This parameter must be negative.</p><span class="comment-delim">*)</span></div></li><li id="type-score_limits.behaviour_penalty_threshold" class="def record field anchored"><a href="#type-score_limits.behaviour_penalty_threshold" class="anchor"></a><code><span>behaviour_penalty_threshold : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P7: The threshold on the behaviour penalty counter above which we start penalizing the peer.</p><span class="comment-delim">*)</span></div></li><li id="type-score_limits.behaviour_penalty_decay" class="def record field anchored"><a href="#type-score_limits.behaviour_penalty_decay" class="anchor"></a><code><span>behaviour_penalty_decay : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P7: The score is multiplied by a factor of <code>behaviour_penalty_decay</code> every <code>score_cleanup_ticks</code> heartbeat. This parameter must be in the unit interval.</p><span class="comment-delim">*)</span></div></li><li id="type-score_limits.app_specific_weight" class="def record field anchored"><a href="#type-score_limits.app_specific_weight" class="anchor"></a><code><span>app_specific_weight : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>P5: Application-specific peer scoring</p><span class="comment-delim">*)</span></div></li><li id="type-score_limits.decay_zero" class="def record field anchored"><a href="#type-score_limits.decay_zero" class="anchor"></a><code><span>decay_zero : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The minimum value under which a score is considered to be equal to 0 after applying decay. This parameter must be non-negative.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-limits"><a href="#type-limits" class="anchor"></a><code><span><span class="keyword">type</span> <span>('topic, 'peer, 'message_id, 'span) limits</span></span><span> = </span><span>{</span></code><ol><li id="type-limits.max_recv_ihave_per_heartbeat" class="def record field anchored"><a href="#type-limits.max_recv_ihave_per_heartbeat" class="anchor"></a><code><span>max_recv_ihave_per_heartbeat : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The maximum number of IHave control messages we can receive from a peer between two heartbeats. It is called <code>MaxIHaveMessages</code> in the Go implementation.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.max_sent_iwant_per_heartbeat" class="def record field anchored"><a href="#type-limits.max_sent_iwant_per_heartbeat" class="anchor"></a><code><span>max_sent_iwant_per_heartbeat : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The maximum number of IWant control message ids we can send to a peer between two heartbeats. It is also the maximum number of message ids to include in an IHave message. It is called <code>MaxIHaveLength</code> in the Go implementation.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.max_gossip_retransmission" class="def record field anchored"><a href="#type-limits.max_gossip_retransmission" class="anchor"></a><code><span>max_gossip_retransmission : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The maximum number of times the local peer allows a remote peer to request the same message id through IWant gossip before the local peer starts ignoring them. This is designed to prevent peers from spamming with requests.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.degree_optimal" class="def record field anchored"><a href="#type-limits.degree_optimal" class="anchor"></a><code><span>degree_optimal : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The optimal number of full connections per topic. For example, if it is 6, each peer will want to have about six peers in their mesh for each topic they're subscribed to. It should be set somewhere between <a href="#type-limits.degree_low"><code>degree_low</code></a> and <a href="#type-limits.degree_high"><code>degree_high</code></a>.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.publish_threshold" class="def record field anchored"><a href="#type-limits.publish_threshold" class="anchor"></a><code><span>publish_threshold : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The threshold value (as a score) from which we can publish a message to our peers.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.gossip_threshold" class="def record field anchored"><a href="#type-limits.gossip_threshold" class="anchor"></a><code><span>gossip_threshold : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The threshold value (as a score) for a peer to emit/accept gossip: if the remote peer score is below this threshold, the local peer won't emit or accept gossip from the remote peer.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.do_px" class="def record field anchored"><a href="#type-limits.do_px" class="anchor"></a><code><span>do_px : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The flag controls whether peer exchange (PX) is enabled.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.accept_px_threshold" class="def record field anchored"><a href="#type-limits.accept_px_threshold" class="anchor"></a><code><span>accept_px_threshold : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The threshold value (as a score) from which we accept peer exchanges.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.peers_to_px" class="def record field anchored"><a href="#type-limits.peers_to_px" class="anchor"></a><code><span>peers_to_px : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of peers to include in prune Peer eXchange. (This is called <code>PrunePeers</code> in the Go implementation.)</p><span class="comment-delim">*)</span></div></li><li id="type-limits.unsubscribe_backoff" class="def record field anchored"><a href="#type-limits.unsubscribe_backoff" class="anchor"></a><code><span>unsubscribe_backoff : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The duration that prevent reconnections after leaving a topic to our full connections.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.graft_flood_threshold" class="def record field anchored"><a href="#type-limits.graft_flood_threshold" class="anchor"></a><code><span>graft_flood_threshold : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>If a graft comes before <code>graft_flood_threshold</code> has elapsed since the last prune, then there is an extra score penalty applied to the peer through P7.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.prune_backoff" class="def record field anchored"><a href="#type-limits.prune_backoff" class="anchor"></a><code><span>prune_backoff : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The duration added when we prune a peer.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.retain_duration" class="def record field anchored"><a href="#type-limits.retain_duration" class="anchor"></a><code><span>retain_duration : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The duration added to remove metadata about a disconnected peer.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.fanout_ttl" class="def record field anchored"><a href="#type-limits.fanout_ttl" class="anchor"></a><code><span>fanout_ttl : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>fanout_ttl</code> controls how long we keep track of a fanout topic. If it's been <code>fanout_ttl</code> since we've published to a topic that we're not subscribed to, then we don't track that topic anymore, that is, we delete it from the fanout map.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.heartbeat_interval" class="def record field anchored"><a href="#type-limits.heartbeat_interval" class="anchor"></a><code><span>heartbeat_interval : <span class="type-var">'span</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The time between heartbeats.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.backoff_cleanup_ticks" class="def record field anchored"><a href="#type-limits.backoff_cleanup_ticks" class="anchor"></a><code><span>backoff_cleanup_ticks : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of heartbeat ticks setting the frequency at which the backoffs are checked and potentially cleared.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.score_cleanup_ticks" class="def record field anchored"><a href="#type-limits.score_cleanup_ticks" class="anchor"></a><code><span>score_cleanup_ticks : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>score_cleanup_ticks</code> is the number of heartbeat ticks setting the frequency at which the scores are refreshed and potentially cleared.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.degree_low" class="def record field anchored"><a href="#type-limits.degree_low" class="anchor"></a><code><span>degree_low : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The lower bound on the number of peers we keep in a topic mesh. If we have fewer than <code>degree_low</code> peers, the heartbeat will attempt to graft some more into the mesh at the next heartbeat.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.degree_high" class="def record field anchored"><a href="#type-limits.degree_high" class="anchor"></a><code><span>degree_high : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The upper bound on the number of peers we keep in a topic mesh. If there are more than <code>degree_high</code> peers, the heartbeat will select some to prune from the mesh at the next heartbeat.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.degree_score" class="def record field anchored"><a href="#type-limits.degree_score" class="anchor"></a><code><span>degree_score : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>degree_score</code> affects how peers are selected when pruning a mesh due to over subscription. At least <code>degree_score</code> of the retained peers will be high-scoring, while the remainder are chosen randomly.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.degree_out" class="def record field anchored"><a href="#type-limits.degree_out" class="anchor"></a><code><span>degree_out : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of outbound connections to maintain in a topic mesh. When the mesh is pruned due to over subscription, we make sure that we have outbound connections to at least <code>degree_out</code> of the survivor peers. This prevents Sybil attackers from overwhelming our mesh with incoming connections. <code>degree_out</code> must be set below <a href="#type-limits.degree_low"><code>degree_low</code></a>, and must not exceed <code>degree_optimal / 2</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.degree_lazy" class="def record field anchored"><a href="#type-limits.degree_lazy" class="anchor"></a><code><span>degree_lazy : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>degree_lazy</code> affects how many peers the local peer will emit gossip to at each heartbeat. The local peer will send gossip to at least <code>degree_lazy</code> peers outside its mesh or fanout. The actual number may be more, depending on <code>gossip_factor</code> and how many peers the local peer is connected to.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.gossip_factor" class="def record field anchored"><a href="#type-limits.gossip_factor" class="anchor"></a><code><span>gossip_factor : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>gossip_factor</code> affects how many peers the local peer will emit gossip to at each heartbeat. The local peer will send gossip to <code>gossip_factor</code> * (total number of non-mesh/non-fanout peers), or <code>degree_lazy</code> peers, whichever is greater.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.history_length" class="def record field anchored"><a href="#type-limits.history_length" class="anchor"></a><code><span>history_length : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The size of the message cache used for gossip. The message cache will remember messages for <code>history_length</code> heartbeats.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.history_gossip_length" class="def record field anchored"><a href="#type-limits.history_gossip_length" class="anchor"></a><code><span>history_gossip_length : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>history_gossip_length</code> controls how many cached message ids the local peer will advertise in IHave gossip messages. When asked for its seen message ids, the local peer will return only those from the most recent <code>history_gossip_length</code> heartbeats. The slack between <code>history_gossip_length</code> and <code>history_length</code> allows the local peer to avoid advertising messages that will be expired by the time they're requested. <code>history_gossip_length</code> must be less than or equal to <code>history_length</code>.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.opportunistic_graft_ticks" class="def record field anchored"><a href="#type-limits.opportunistic_graft_ticks" class="anchor"></a><code><span>opportunistic_graft_ticks : int64;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of heartbeat ticks setting the frequency at which to attempt to improve the mesh with opportunistic grafting. Every <code>opportunistic_graft_ticks</code>, if the median score of the mesh peers falls below the <a href="#type-limits.opportunistic_graft_threshold"><code>opportunistic_graft_threshold</code></a>, then the local peer will select some high-scoring mesh peers to graft.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.opportunistic_graft_peers" class="def record field anchored"><a href="#type-limits.opportunistic_graft_peers" class="anchor"></a><code><span>opportunistic_graft_peers : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The number of peers to opportunistically graft.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.opportunistic_graft_threshold" class="def record field anchored"><a href="#type-limits.opportunistic_graft_threshold" class="anchor"></a><code><span>opportunistic_graft_threshold : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The median mesh score threshold before triggering opportunistic grafting; this should have a small positive value.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.score_limits" class="def record field anchored"><a href="#type-limits.score_limits" class="anchor"></a><code><span>score_limits : <span><span>(<span class="type-var">'topic</span>, <span class="type-var">'span</span>)</span> <a href="#type-score_limits">score_limits</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>score-specific parameters.</p><span class="comment-delim">*)</span></div></li><li id="type-limits.seen_history_length" class="def record field anchored"><a href="#type-limits.seen_history_length" class="anchor"></a><code><span>seen_history_length : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>seen_history_length</code> controls the size of the message cache used for recording seen messages. The seen messages cache will remember messages for <code>seen_history_length</code> heartbeats.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-parameters"><a href="#type-parameters" class="anchor"></a><code><span><span class="keyword">type</span> <span>('peer, 'message_id) parameters</span></span><span> = </span><span>{</span></code><ol><li id="type-parameters.peer_filter" class="def record field anchored"><a href="#type-parameters.peer_filter" class="anchor"></a><code><span>peer_filter : <span><span class="type-var">'peer</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`IHave of <span class="type-var">'message_id</span></span> <span><span>| `IWant</span> of <span class="type-var">'message_id</span></span> <span>| `Graft</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  bool;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-SCORE"><a href="#module-type-SCORE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-SCORE/index.html">SCORE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The <code>SCORE</code> module type describes primitives used to update the scores associated to each peer. Score computation is described in more details in <a href="https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.1.md#peer-scoring">the specification</a>.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-MESSAGE_CACHE"><a href="#module-type-MESSAGE_CACHE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-MESSAGE_CACHE/index.html">MESSAGE_CACHE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-AUTOMATON"><a href="#module-type-AUTOMATON" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-AUTOMATON/index.html">AUTOMATON</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-WORKER_CONFIGURATION"><a href="#module-type-WORKER_CONFIGURATION" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-WORKER_CONFIGURATION/index.html">WORKER_CONFIGURATION</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-WORKER"><a href="#module-type-WORKER" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-WORKER/index.html">WORKER</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The interface of a gossipsub worker.</p></div></div></div></body></html>
