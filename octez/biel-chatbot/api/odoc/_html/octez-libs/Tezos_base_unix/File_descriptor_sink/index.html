<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>File_descriptor_sink (octez-libs.Tezos_base_unix.File_descriptor_sink)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_base_unix</a> &#x00BB; File_descriptor_sink</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_base_unix.File_descriptor_sink</span></code></h1><p>An implementation of <code>Tezos_base.Internal_event.SINK</code> which writes the events as JSON or pretty printed into a single file-descriptor.</p><p>An URI scheme is used to describe such file descriptors:</p><ul><li><code>&quot;file-descriptor-path&quot;</code> outputs to the file at the URI path</li><li><code>&quot;file-descriptor-stdout&quot;</code> outputs to <code>stdout</code></li><li><code>&quot;file-descriptor-stderr&quot;</code> outputs to <code>stderr</code></li><li><code>&quot;file-descriptor-syslog&quot;</code> ouputs to a <code>syslog</code> facility</li></ul><p>Available options are</p><ul><li><code>&quot;level-at-least&quot;</code> the minimal log-level that the sink will output (see <a href="../../Tezos_event_logging/Internal_event/index.html#type-level"><code>Tezos_event_logging.Internal_event.level</code></a>).</li><li><code>&quot;section-prefix&quot;</code> can be given many times and defines a list of pairs <code>&quot;&lt;section-prefix&gt;:&lt;level-threshold&gt;&quot;</code> which can be used to setup more precise filters. <code>&quot;level-at-least=info&quot;</code> is understood as <code>&quot;section-prefix=:info&quot;</code> (the empty section prefix matches all sections). To exclude completely a section from the log stream that the sink will output, you can use the special level-threshold &quot;none&quot;.</li></ul><ul><li><code>&quot;format&quot;</code> the output format used.Note that syslog output will ignore this option and use the syslog formatting. Possible values are</li><li><code>&quot;one-per-line&quot;</code> (the default),</li><li><code>&quot;netstring&quot;</code> (see <a href="https://en.wikipedia.org/wiki/Netstring">The Netstring format</a>) (both to separate JSON records),</li><li><code>&quot;pp-rfc5424&quot;</code> to output the events pretty-printed as text using <a href="https://www.rfc-editor.org/rfc/rfc5424">RFC 5424</a></li><li><code>&quot;pp-short&quot;</code> to output the events pretty-printed in a shorter and more user-friendly fashion.</li></ul><ul><li><code>&quot;color=true&quot;</code> enables logs coloring. It only works on ttys and for <code>&quot;format=pp-short&quot;</code>.</li></ul><p>Options available only for <code>&quot;file-descriptor-path://&quot;</code>:</p><ul><li><code>&quot;with-pid=true&quot;</code> adds the current process id to the file path provided.</li><li><code>&quot;fresh=true&quot;</code> smashes the content of the file if it already exists instead of appending to it.</li><li><code>&quot;chmod=&lt;INT&gt;&quot;</code> sets the access-rights of the file at creation time (default is <code>0o600</code>, provided <a href="https://en.wikipedia.org/wiki/Umask"><code>umask</code></a> allows it).</li><li><code>&quot;daily-logs=&lt;INT&gt;&quot;</code> sets up a rotation for log files, keeping only the last N days where N is the given parameter. It creates a file for each day and and adds the day of the year with format <code>&quot;yyyymmdd&quot;</code> to the path provided.</li><li><code>&quot;create-dirs=true&quot;</code> allows to create the directory where the log files are stored and all its parents recursively if they don't exist.</li></ul><p>Option available only for <code>&quot;file-descriptor-syslog://&quot;</code>:</p><ul><li><code>&quot;facility=&lt;facility&gt;&quot;</code> is the targeted syslog output. <code>User</code> is the default value if no value is provided. See <a href="https://www.rfc-editor.org/rfc/rfc3164">RFC 3164</a> for more information. The possible values are defined in module <code>Syslog</code>.</li></ul><p>Examples:</p><ul><li><code>export TEZOS_EVENTS_CONFIG=&quot;file-descriptor-path:///the/path/to/write.log?format=one-per-line&amp;section-prefix=p2p.maintenance:none&amp;with-pid=true&amp;chmod=0o640&quot;</code>: By default all executables will write all log events of level at least <code>Info</code> to a file <code>&quot;/the/path/to/write-XXXX.log&quot;</code> where <code>&quot;XXXX&quot;</code> is the process ID, the file will be also readable by the user's group (<code>0o640</code>). The maintenance module will be excluded from the stream.</li><li><code>export TEZOS_EVENTS_CONFIG=&quot;file-descriptor-path:///the/path/to/write.log?section-prefix=rpc:debug&amp;section-prefix=validator:debug&amp;section-prefix=:none&quot;</code>: Write only sections validator and rpc at debug level but exclude all other sections from the stream.</li><li><code>export TEZOS_EVENTS_CONFIG=&quot;file-descriptor-path:///the/path/to/write.log?format=one-per-line&amp;level-at-least=notice&amp;with-pid=true&amp;chmod=0o640&quot;</code>: Executables will write all log events of level at least <code>Notice</code> to a file <code>&quot;/the/path/to/write-XXXX.log&quot;</code> where <code>&quot;XXXX&quot;</code> is the process ID, the file will be also readable by the user's group (<code>0o640</code>).</li><li><code>&quot;export TEZOS_EVENTS_CONFIG=file-descriptor-stderr://?format=netstring&quot;</code> Executables will write to <code>stderr</code>.</li><li><code>export TEZOS_EVENTS_CONFIG=&quot;file-descriptor-path:///dev/fd/4?format=netstring&quot;</code> Executables will write to the <code>4</code> file-descriptor likely opened by a parent monitoring process (non-standard feature available on mainstream UNIX hosts, e.g. Linux and MacOSX).</li></ul><ul><li><code>export TEZOS_EVENT_HOSTNAME=&quot;hostname&quot;</code> The <code>hostname</code> will be used in the JSON representation of the event. By default, it is the hostname given by <code>Unix.gethostname ()</code>.</li><li><code>&quot;export TEZOS_EVENTS_CONFIG=file-descriptor-path:///tmp/node.log?daily-logs=5&amp;section-prefix=:info&quot;</code> sets up log files with a rotation of 5 days and verbosity level <code>info</code> for all logs. Files will be named <code>node-19700101.log</code> in an example of a file produced in 1970, January, the 1st.</li></ul></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Sink_implementation_path"><a href="#module-Sink_implementation_path" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sink_implementation_path/index.html">Sink_implementation_path</a></span><span> : 
  <a href="../../Tezos_event_logging/Internal_event/module-type-SINK/index.html">Tezos_event_logging.Internal_event.SINK</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_event_logging/Internal_event/module-type-SINK/index.html#type-t">t</a> = <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Sink_implementation_stdout"><a href="#module-Sink_implementation_stdout" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sink_implementation_stdout/index.html">Sink_implementation_stdout</a></span><span> : 
  <a href="../../Tezos_event_logging/Internal_event/module-type-SINK/index.html">Tezos_event_logging.Internal_event.SINK</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_event_logging/Internal_event/module-type-SINK/index.html#type-t">t</a> = <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Sink_implementation_stderr"><a href="#module-Sink_implementation_stderr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sink_implementation_stderr/index.html">Sink_implementation_stderr</a></span><span> : 
  <a href="../../Tezos_event_logging/Internal_event/module-type-SINK/index.html">Tezos_event_logging.Internal_event.SINK</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_event_logging/Internal_event/module-type-SINK/index.html#type-t">t</a> = <a href="#type-t">t</a></span></span></code></div></div></div></body></html>
