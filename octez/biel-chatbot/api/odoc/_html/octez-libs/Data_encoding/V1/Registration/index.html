<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Registration (octez-libs.Data_encoding.V1.Registration)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">octez-libs</a> &#x00BB; <a href="../../index.html">Data_encoding</a> &#x00BB; <a href="../index.html">V1</a> &#x00BB; Registration</nav><header class="odoc-preamble"><h1>Module <code><span>V1.Registration</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#introspection-api">Introspection API</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-id"><a href="#type-id" class="anchor"></a><code><span><span class="keyword">type</span> id</span><span> = string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A encoding that has been <a href="#val-register"><code>register</code></a>ed. It can be retrieved using either <a href="#val-list"><code>list</code></a> or <a href="#val-find"><code>find</code></a>.</p><p>Note registration/retrieval erases the type information that is built by the combinator. In other words, <code>t</code> is a non-parametric type. As a result, you cannot recover an OCaml value of the type of the registered encoding. You can only perform operations where the type doesn't escape — e.g., converting between binary and json.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-binary_schema"><a href="#val-binary_schema" class="anchor"></a><code><span><span class="keyword">val</span> binary_schema : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Binary_schema/index.html#type-t">Binary_schema.t</a></span></code></div><div class="spec-doc"><p>Descriptions and schemas of registered encodings.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-json_schema"><a href="#val-json_schema" class="anchor"></a><code><span><span class="keyword">val</span> json_schema : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Json/index.html#type-schema">Json.schema</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-description"><a href="#val-description" class="anchor"></a><code><span><span class="keyword">val</span> description : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-json_pretty_printer"><a href="#val-json_pretty_printer" class="anchor"></a><code><span><span class="keyword">val</span> json_pretty_printer : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="../Json/index.html#type-t">Json.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Printers for the encodings.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-binary_pretty_printer"><a href="#val-binary_pretty_printer" class="anchor"></a><code><span><span class="keyword">val</span> binary_pretty_printer : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register"><a href="#val-register" class="anchor"></a><code><span><span class="keyword">val</span> register : 
  <span><span class="optlabel">?pp</span>:<span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>register (def id encoding)</code> registers the <code>encoding</code> with the <code>id</code>. It can later be found using <a href="#val-find"><code>find</code></a> and providing the matching <code>id</code>. It will also appear in the results of <a href="#val-list"><code>list</code></a>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>[Invalid_argument]</code> <p>if <code>encoding</code> is not of one of the following form:</p><ul><li><code>def id _</code> (see <a href="../Encoding/index.html#val-def"><code>Encoding.def</code></a>)</li><li><code>splitted ~binary:(def id _)</code> (see <a href="../Encoding/index.html#val-splitted"><code>Encoding.splitted</code></a>)</li><li><code>dynamic_size (def id _)</code> (see <a href="../Encoding/index.html#val-dynamic_size"><code>Encoding.dynamic_size</code></a>)</li><li><code>check_size _ (def id _)</code> (see <a href="../Encoding/index.html#val-check_size"><code>Encoding.check_size</code></a>)</li></ul></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slice"><a href="#val-slice" class="anchor"></a><code><span><span class="keyword">val</span> slice : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Binary/Slicer/index.html#type-slice">Binary.Slicer.slice</a> list</span>, <a href="../Binary/index.html#type-read_error">Binary.read_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>slice r b</code> attempts to slice a binary representation <code>b</code> of some data assuming it is correctly described by the registered encoding <code>r</code>. If <code>r</code> does not correctly describe <code>b</code>, then it returns <code>None</code>.</p><p>See <a href="../Binary/Slicer/index.html#val-slice_string"><code>Binary.Slicer.slice_string</code></a> for details about slicing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slice_all"><a href="#val-slice_all" class="anchor"></a><code><span><span class="keyword">val</span> slice_all : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(string * <span><a href="../Binary/Slicer/index.html#type-slice">Binary.Slicer.slice</a> list</span>)</span> list</span></span></code></div><div class="spec-doc"><p><code>slice_all b</code> attempts to slice a binary representation <code>b</code> of some data for all of the registered encodings. It returns a list of the slicing for each of the registered encodings that correctly describe <code>b</code>.</p><p>See <a href="../Binary/Slicer/index.html#val-slice_string"><code>Binary.Slicer.slice_string</code></a> for details about slicing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p><code>find id</code> is <code>Some r</code> if <code>register (def id e)</code> has been called, in which case <code>r</code> matches <code>e</code>. Otherwise, it is <code>None</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-id">id</a> * <a href="#type-t">t</a>)</span> list</span></span></code></div><div class="spec-doc"><p><code>list ()</code> is a list of pairs <code>(id, r)</code> where <code>r</code> is a registered encoding for the <code>id</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bytes_of_json"><a href="#val-bytes_of_json" class="anchor"></a><code><span><span class="keyword">val</span> bytes_of_json : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Json/index.html#type-t">Json.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t option</span></span></code></div><div class="spec-doc"><p>Conversion functions from JSON to bytes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-json_of_bytes"><a href="#val-json_of_bytes" class="anchor"></a><code><span><span class="keyword">val</span> json_of_bytes : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../Json/index.html#type-t">Json.t</a> option</span></span></code></div><div class="spec-doc"><p>Conversion functions from bytes to JSON.</p></div></div><h4 id="introspection-api"><a href="#introspection-api" class="anchor"></a>Introspection API</h4><p>The introspection functions below expose some internal representations of the registered <code>encoding</code>s. These functions are not for the casual user and are subject to changes from one version of the library to another.</p><div class="odoc-spec"><div class="spec type anchored" id="type-introspectable"><a href="#type-introspectable" class="anchor"></a><code><span><span class="keyword">type</span> introspectable</span><span> = </span></code><ol><li id="type-introspectable.Any" class="def variant constructor anchored"><a href="#type-introspectable.Any" class="anchor"></a><code><span>| </span><span><span class="constructor">Any</span> : <span><span class="type-var">_</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span class="arrow">&#45;&gt;</span> <a href="#type-introspectable">introspectable</a></span></code></li></ol></div><div class="spec-doc"><p>A transparent, raw form of a <a href="#val-register"><code>register</code></a>ed encoding, allowing far greater introspection than a <a href="#type-t"><code>t</code></a> value. It can be retrieved using <a href="#val-find_introspectable"><code>find_introspectable</code></a> or operated upon using <a href="#val-iter"><code>iter</code></a>.</p><p>Note that retrieval and iteration over <code>introspectable</code> preserve, but do not present, the type information of the original combinator. In other words, <code>introspectable</code> is a non-parametric abstraction over arbitrarily-typed <code>Encoding.t</code>. This means that, while it cannot be used in any way that would allow the underlying type parameter to escape, it can be operated upon (e.g. using <a href="#val-iter"><code>iter</code></a>) using functions with locally abstract types (<code>fun (type a) -&gt; ...</code>) or explicit polymorphism.</p><p>The inclusion of this type is intended almost exclusively for use in specialized external tools rather than by casual users. As this type and its related functions permit introspection into a registered encoding that is otherwise opaque-by-design, it should only be relied upon as a last resort when no other options are available.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_introspectable"><a href="#val-find_introspectable" class="anchor"></a><code><span><span class="keyword">val</span> find_introspectable : <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-introspectable">introspectable</a> option</span></span></code></div><div class="spec-doc"><p><code>find_introspectable id</code> is <code>Some e'</code> if <code>register (def id e)</code> has been called, in which case <code>e'</code> should be <code>Any e</code>. Otherwise, it is <code>None</code>.</p><p>As with the <code>introspectable</code> type itself, casual users are discouraged from calling this function; it is designed only for external tools to process raw encodings that cannot be brought into scope except through querying the <code>Registration</code> module.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter"><a href="#val-iter" class="anchor"></a><code><span><span class="keyword">val</span> iter : <span><span class="label">id</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-introspectable">introspectable</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter ~id f</code> is equivalent to calling <code>Option.iter f (find_introspectable id)</code>. It may be called wherever the result of <code>find_introspectable id</code> would otherwise be used only once, as an argument to a function call, and discarded subsequently.</p><p>As with the <code>introspectable</code> type itself, casual users are discouraged from calling this function; it is designed only for external tools to process raw encodings that cannot be brought into scope except through querying the <code>Registration</code> module.</p></div></div></div></body></html>
