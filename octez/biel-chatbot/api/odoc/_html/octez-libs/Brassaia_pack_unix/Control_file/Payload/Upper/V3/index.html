<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>V3 (octez-libs.Brassaia_pack_unix.Control_file.Payload.Upper.V3)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">octez-libs</a> &#x00BB; <a href="../../../../index.html">Brassaia_pack_unix</a> &#x00BB; <a href="../../../index.html">Control_file</a> &#x00BB; <a href="../../index.html">Payload</a> &#x00BB; <a href="../index.html">Upper</a> &#x00BB; V3</nav><header class="odoc-preamble"><h1>Module <code><span>Upper.V3</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-from_v1_v2_post_upgrade"><a href="#type-from_v1_v2_post_upgrade" class="anchor"></a><code><span><span class="keyword">type</span> from_v1_v2_post_upgrade</span><span> = </span><span>{</span></code><ol><li id="type-from_v1_v2_post_upgrade.entry_offset_at_upgrade_to_v3" class="def record field anchored"><a href="#type-from_v1_v2_post_upgrade.entry_offset_at_upgrade_to_v3" class="anchor"></a><code><span>entry_offset_at_upgrade_to_v3 : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p><code>entry_offset_at_upgrade_to_v3</code> is the offset of the first entry that is known to have been created using <code>brassaia_pack_version = `V2</code> or more. The entries before that point may be v1 entries. V1 entries need an entry in index because it is the only place their lenght is stored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-from_v1_v2_post_upgrade_t"><a href="#val-from_v1_v2_post_upgrade_t" class="anchor"></a><code><span><span class="keyword">val</span> from_v1_v2_post_upgrade_t : <span><a href="#type-from_v1_v2_post_upgrade">from_v1_v2_post_upgrade</a> <a href="../../../../../Brassaia/Type/index.html#type-t">Brassaia.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-from_v3_gced"><a href="#type-from_v3_gced" class="anchor"></a><code><span><span class="keyword">type</span> from_v3_gced</span><span> = </span><span>{</span></code><ol><li id="type-from_v3_gced.suffix_start_offset" class="def record field anchored"><a href="#type-from_v3_gced.suffix_start_offset" class="anchor"></a><code><span>suffix_start_offset : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-from_v3_gced.generation" class="def record field anchored"><a href="#type-from_v3_gced.generation" class="anchor"></a><code><span>generation : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p><code>suffix_start_offset</code> is 0 if the suffix file was never garbage collected. Otherwise it is the offset of the very first entry of the suffix file. Note that offsets in the suffix file are virtual. The garbage collections don't reset the offsets.</p><p><code>generation</code> is the number of past GCs. A suffix file, a prefix file and a mapping containing that integer in their filename exist.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-from_v3_gced_t"><a href="#val-from_v3_gced_t" class="anchor"></a><code><span><span class="keyword">val</span> from_v3_gced_t : <span><a href="#type-from_v3_gced">from_v3_gced</a> <a href="../../../../../Brassaia/Type/index.html#type-t">Brassaia.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-status"><a href="#type-status" class="anchor"></a><code><span><span class="keyword">type</span> status</span><span> = </span></code><ol><li id="type-status.From_v1_v2_post_upgrade" class="def variant constructor anchored"><a href="#type-status.From_v1_v2_post_upgrade" class="anchor"></a><code><span>| </span><span><span class="constructor">From_v1_v2_post_upgrade</span> <span class="keyword">of</span> <a href="#type-from_v1_v2_post_upgrade">from_v1_v2_post_upgrade</a></span></code></li><li id="type-status.From_v3_no_gc_yet" class="def variant constructor anchored"><a href="#type-status.From_v3_no_gc_yet" class="anchor"></a><code><span>| </span><span><span class="constructor">From_v3_no_gc_yet</span></span></code></li><li id="type-status.From_v3_used_non_minimal_indexing_strategy" class="def variant constructor anchored"><a href="#type-status.From_v3_used_non_minimal_indexing_strategy" class="anchor"></a><code><span>| </span><span><span class="constructor">From_v3_used_non_minimal_indexing_strategy</span></span></code></li><li id="type-status.From_v3_gced" class="def variant constructor anchored"><a href="#type-status.From_v3_gced" class="anchor"></a><code><span>| </span><span><span class="constructor">From_v3_gced</span> <span class="keyword">of</span> <a href="#type-from_v3_gced">from_v3_gced</a></span></code></li><li id="type-status.T1" class="def variant constructor anchored"><a href="#type-status.T1" class="anchor"></a><code><span>| </span><span><span class="constructor">T1</span></span></code></li><li id="type-status.T2" class="def variant constructor anchored"><a href="#type-status.T2" class="anchor"></a><code><span>| </span><span><span class="constructor">T2</span></span></code></li><li id="type-status.T3" class="def variant constructor anchored"><a href="#type-status.T3" class="anchor"></a><code><span>| </span><span><span class="constructor">T3</span></span></code></li><li id="type-status.T4" class="def variant constructor anchored"><a href="#type-status.T4" class="anchor"></a><code><span>| </span><span><span class="constructor">T4</span></span></code></li><li id="type-status.T5" class="def variant constructor anchored"><a href="#type-status.T5" class="anchor"></a><code><span>| </span><span><span class="constructor">T5</span></span></code></li><li id="type-status.T6" class="def variant constructor anchored"><a href="#type-status.T6" class="anchor"></a><code><span>| </span><span><span class="constructor">T6</span></span></code></li><li id="type-status.T7" class="def variant constructor anchored"><a href="#type-status.T7" class="anchor"></a><code><span>| </span><span><span class="constructor">T7</span></span></code></li><li id="type-status.T8" class="def variant constructor anchored"><a href="#type-status.T8" class="anchor"></a><code><span>| </span><span><span class="constructor">T8</span></span></code></li><li id="type-status.T9" class="def variant constructor anchored"><a href="#type-status.T9" class="anchor"></a><code><span>| </span><span><span class="constructor">T9</span></span></code></li><li id="type-status.T10" class="def variant constructor anchored"><a href="#type-status.T10" class="anchor"></a><code><span>| </span><span><span class="constructor">T10</span></span></code></li><li id="type-status.T11" class="def variant constructor anchored"><a href="#type-status.T11" class="anchor"></a><code><span>| </span><span><span class="constructor">T11</span></span></code></li><li id="type-status.T12" class="def variant constructor anchored"><a href="#type-status.T12" class="anchor"></a><code><span>| </span><span><span class="constructor">T12</span></span></code></li><li id="type-status.T13" class="def variant constructor anchored"><a href="#type-status.T13" class="anchor"></a><code><span>| </span><span><span class="constructor">T13</span></span></code></li><li id="type-status.T14" class="def variant constructor anchored"><a href="#type-status.T14" class="anchor"></a><code><span>| </span><span><span class="constructor">T14</span></span></code></li><li id="type-status.T15" class="def variant constructor anchored"><a href="#type-status.T15" class="anchor"></a><code><span>| </span><span><span class="constructor">T15</span></span></code></li></ol></div><div class="spec-doc"><p><code>From_v1_v2_post_upgrade</code> corresponds to a pack store that was upgraded to <code>`V3</code>. It contains infos related to backward compatibility. GCs are forbidden on it.</p><p><code>From_v3_no_gc_yet</code> corresponds to a pack store that was created using <code>`V3</code> code. It never underwent a GC.</p><p><code>From_v3_used_non_minimal_indexing_strategy</code> corresponds to a pack store that was created using <code>`V3</code> code. It never underwent a GC and it will never be possible to GC it because entries were pushed using a non-minimal indexing strategy.</p><p><code>From_v3_gced</code> is a store that was GCed at least once.</p><p>The <code>T*</code> tags are provisional tags that the binary decoder is aware of and that may in the future be used to add features to the <code>`V3</code> payload.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-status_t"><a href="#val-status_t" class="anchor"></a><code><span><span class="keyword">val</span> status_t : <span><a href="#type-status">status</a> <a href="../../../../../Brassaia/Type/index.html#type-t">Brassaia.Type.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.dict_end_poff" class="def record field anchored"><a href="#type-t.dict_end_poff" class="anchor"></a><code><span>dict_end_poff : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-t.suffix_end_poff" class="def record field anchored"><a href="#type-t.suffix_end_poff" class="anchor"></a><code><span>suffix_end_poff : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-t.status" class="def record field anchored"><a href="#type-t.status" class="anchor"></a><code><span>status : <a href="#type-status">status</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The <code>`V3</code> payload of the brassaia-pack control file. <code>`V3</code> is a major version. If <code>`V4</code> ever exists, it will have its own dedicated payload, but the <code>`V3</code> definition will still have to stick in the codebase for backward compatibilty of old pack stores.</p><p>A store may only change its major version during an <code>open_rw</code> in <code>File_manager</code>. Note that upgrading a major version is the only reason why <code>open_rw</code> would modify files in an brassaia-pack directory.</p><p>For a given major version, the format of a payload may change, but only in a backward compatible way. I.e., all versions of brassaia-pack should forever be able to decode a <code>`V3</code> control file, it allows for control file corruption and out-of-date code to be distinguishable.</p><p>It is legal for the payload decoder to not fully consume the input buffer. Remaining bytes means that the definition of a payload was changed.</p><p>Fields</p><p><code>dict_end_poff</code> is the offset in the dict file just after the last valid dict bytes. The next data to be pushed to the dict will be pushed at this offset.</p><p><code>suffix_end_poff</code> is similar to <code>dict_end_poff</code> but for the suffix file.</p><p><code>status</code> is a variant that encode the state of the brassaia-pack directory. This field MUST be the last field of the record, in order to allow extensions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-t"><a href="#val-t" class="anchor"></a><code><span><span class="keyword">val</span> t : <span><a href="#type-t">t</a> <a href="../../../../../Brassaia/Type/index.html#type-t">Brassaia.Type.t</a></span></span></code></div></div></div></body></html>
