<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt_option_syntax (octez-libs.Traced_structs.Map.Make.Monad.Lwt_option_syntax)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../../../index.html">octez-libs</a> &#x00BB; <a href="../../../../index.html">Traced_structs</a> &#x00BB; <a href="../../../index.html">Map</a> &#x00BB; <a href="../../index.html">Make</a> &#x00BB; <a href="../index.html">Monad</a> &#x00BB; Lwt_option_syntax</nav><header class="odoc-preamble"><h1>Module <code><span>Monad.Lwt_option_syntax</span></code></h1><p>Syntax module for Lwt+Option. This is intended to be opened locally in functions which use Lwt and <code>option</code> for control-flow. Within the scope of this module, the code can include binding operators, leading to a <code>let</code>-style syntax.</p><p>See also <code>Lwt</code>, <code>Option</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>return x</code> is <code>Lwt.return (Some x)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return_unit"><a href="#val-return_unit" class="anchor"></a><code><span><span class="keyword">val</span> return_unit : <span><span>unit option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>return_unit</code> is <code>Lwt.return (Some ())</code> .</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return_nil"><a href="#val-return_nil" class="anchor"></a><code><span><span class="keyword">val</span> return_nil : <span><span><span><span class="type-var">'a</span> list</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>return_nil</code> is <code>Lwt.return (Some [])</code> .</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return_true"><a href="#val-return_true" class="anchor"></a><code><span><span class="keyword">val</span> return_true : <span><span>bool option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>return_true</code> is <code>Lwt.return (Some true)</code> .</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return_false"><a href="#val-return_false" class="anchor"></a><code><span><span class="keyword">val</span> return_false : <span><span>bool option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>return_false</code> is <code>Lwt.return (Some false)</code> .</p></div></div><p>Note that we do not provide <code>return_some</code> nor <code>return_none</code>. Both of these functions are possible but somewhat confusing and rarely useful in practice. If you need to carry <code>option</code>s within a LwtOption-monad computation (yielding values of the type <code>'a option option Lwt.t</code>), you need to do so by hand: <code>return (Some …)</code> and <code>return (None)</code>.</p><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>fail</code> is <code>Lwt.return None</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-let*"><a href="#val-let*" class="anchor"></a><code><span><span class="keyword">val</span> let* : <span><span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>let*</code> is a binding operator alias for <code>Lwt.bind</code> mixed with <code>Option.bind</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-and*"><a href="#val-and*" class="anchor"></a><code><span><span class="keyword">val</span> and* : <span><span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>and*</code> is a binding operator alias for <code>both</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-let+"><a href="#val-let+" class="anchor"></a><code><span><span class="keyword">val</span> let+ : <span><span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>let+</code> is a binding operator alias for <code>Lwt.map</code> mixed with <code>Option.map</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-and+"><a href="#val-and+" class="anchor"></a><code><span><span class="keyword">val</span> and+ : <span><span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>and*</code> is a binding operator alias for <code>both</code>.</p></div></div><p>The following values are for mixing expressions that are Lwt-only or Option-only within the Lwt option monad. Note that there are fundamental differences between <code>option</code> and <code>Lwt.t</code>: the former can be simply matched on (i.e., it is possible to get out of the monad at any point) whereas the latter can only be bound on (i.e., it is not possible to get out of the monad). In addition, the former is for aborting computations on failures (which in this case means that no value can be produced) whereas the latter is for waiting before continuing.</p><p>Still, from a syntax point-of-view, both are handled the same way: with a specialised binding operator.</p><div class="odoc-spec"><div class="spec value anchored" id="val-let*!"><a href="#val-let*!" class="anchor"></a><code><span><span class="keyword">val</span> let*! : <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>let*!</code> is for binding Lwt-only expressions into the Lwt option combined monad.</p><pre class="language-ocaml"><code>let open Lwt_option_syntax in
let* x = … in
let*! y = … in
return (x + y)</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-let*?"><a href="#val-let*?" class="anchor"></a><code><span><span class="keyword">val</span> let*? : <span><span><span class="type-var">'a</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>let*?</code> is for binding the value from Option-only expressions into the Lwt option combined monad.</p><pre class="language-ocaml"><code>let open Lwt_option_syntax in
let* x = … in
let*? y = … in
…</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-both"><a href="#val-both" class="anchor"></a><code><span><span class="keyword">val</span> both : <span><span><span><span class="type-var">'a</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'b</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>both</code> is the joining of two concurrent optional non-unit values.</p></div></div></div></body></html>
