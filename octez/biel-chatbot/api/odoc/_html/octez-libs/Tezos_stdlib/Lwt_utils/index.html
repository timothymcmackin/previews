<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt_utils (octez-libs.Tezos_stdlib.Lwt_utils)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_stdlib</a> &#x00BB; Lwt_utils</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_stdlib.Lwt_utils</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec exception anchored" id="exception-None_successful"><a href="#exception-None_successful" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">None_successful</span> <span class="keyword">of</span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-never_ending"><a href="#val-never_ending" class="anchor"></a><code><span><span class="keyword">val</span> never_ending : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-worker"><a href="#val-worker" class="anchor"></a><code><span><span class="keyword">val</span> worker : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">on_event</span>:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Ended <span><span>| `Failed</span> of string</span> <span>| `Started</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">run</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cancel</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>worker name ~on_event ~run ~cancel</code> internally calls <code>run ()</code> (which returns a promise <code>p</code>) and returns its own promise <code>work</code>. If <code>p</code> becomes fulfilled, then <code>work</code> also becomes fulfilled. If <code>p</code> becomes rejected then <code>cancel ()</code> is called and, once its promise is resolved, <code>work</code> is fulfilled. This gives the opportunity for the function <code>cancel</code> to clean-up some resources.</p><p>The function <code>on_event</code> is called at different times (start, failure, end) and is mostly meant as a logging mechanism but can also be used for other purposes such as synchronization between different workers.</p><p>If the promises returned by <code>on_event</code> or <code>cancel</code> raise an exception or become rejected, the exception/failure is simply ignored and the promise is treated as having resolved anyway.</p><p>Note that the promise <code>work</code> returned by the <code>worker</code> function is not cancelable. If you need to cancel the promise returned by <code>run</code>, you need to embed your own synchronization system within <code>run</code>. E.g.,</p><p><code>let p, r = Lwt.wait in
     let run () =
        let main = … in
        Lwt.pick [main ; p]
     in</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pick_successful"><a href="#val-pick_successful" class="anchor"></a><code><span><span class="keyword">val</span> pick_successful : <span><span><span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pick_successful promises</code> succeeds when it picks the first successful promise. On finding a successful promise, an attempt will be made to cancel all pending promises.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-None_successful"><code>None_successful</code></a> <p>exception when all <code>promises</code> are rejected.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>exception if initial <code>promises</code> list is empty.</p></li></ul></div></div></div></body></html>
