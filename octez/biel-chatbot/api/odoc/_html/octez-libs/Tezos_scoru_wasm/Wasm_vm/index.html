<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wasm_vm (octez-libs.Tezos_scoru_wasm.Wasm_vm)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_scoru_wasm</a> &#x00BB; Wasm_vm</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_scoru_wasm.Wasm_vm</span></code></h1></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Wasm_vm_sig/module-type-S/index.html">Wasm_vm_sig.S</a></span></code></summary><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Wasm_vm_sig/module-type-Generic/index.html">Wasm_vm_sig.Generic</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Wasm_vm_sig/module-type-Generic/index.html#type-state">state</a> := <a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step_many"><a href="#val-compute_step_many" class="anchor"></a><code><span><span class="keyword">val</span> compute_step_many : 
  <span><span class="optlabel">?reveal_builtins</span>:<a href="../Builtins/index.html#type-reveals">Builtins.reveals</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?hooks</span>:<a href="../Hooks/index.html#type-t">Hooks.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?write_debug</span>:<a href="../Builtins/index.html#type-write_debug">Builtins.write_debug</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stop_at_snapshot</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">max_steps</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> * int64)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step_many ~wasm_entrypoint ~max_steps pvm_state</code> forwards the VM by at most <code>max_step</code> compute tick, yielding if it reaches the maximum number of ticks for executing <code>wasm_entrypoint</code>.</p><p>If the VM is expecting input, it gets stuck. If the VM is already stuck, this function may raise an exception. It is more efficient than <code>compute_step</code> if it has to be called for more than one tick, but its resulting pvm_state will be stricly equivalent. Returns a tuple containing the number of executed ticks and the new pvm_state.</p><p>The <code>hooks</code> optional argument can be used to execute arbitrary code (hooks) to react to some execution events (see <a href="../Hooks/index.html#type-t"><code>Hooks.t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step"><a href="#val-compute_step" class="anchor"></a><code><span><span class="keyword">val</span> compute_step : 
  <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step ~wasm_entrypoint pvm_state</code> forwards the VM by one compute tick. If the VM is expecting input, it gets stuck. If the VM is already stuck, this function may raise an exception.</p><p>It is strictly equivalent to <code>compute_step_many ~wasm_entrypoint ~max_step:1 pvm_state</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step_with_debug"><a href="#val-compute_step_with_debug" class="anchor"></a><code><span><span class="keyword">val</span> compute_step_with_debug : 
  <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">write_debug</span>:<a href="../Builtins/index.html#type-write_debug">Builtins.write_debug</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step_with_debug ~wasm_entrypoint ~debug_flag pvm_state</code> is exactly <code>compute_step ~wasm_entrypoint</code> but it has the ability to enable the debugging host functions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_input_step"><a href="#val-set_input_step" class="anchor"></a><code><span><span class="keyword">val</span> set_input_step : 
  <span><a href="../Wasm_pvm_state/index.html#type-input_info">Wasm_pvm_state.input_info</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_input_step input_info message pvm_state</code> forwards the VM by one input tick. If the VM is not expecting input, it gets stuck. If the VM is already stuck, this function may raise an exception. Note at this point the function raises an exception if the VM is not expecting input.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reveal_step"><a href="#val-reveal_step" class="anchor"></a><code><span><span class="keyword">val</span> reveal_step : 
  <span>bytes <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>reveal_step reveal_data pvm_state</code> loads the <code>reveal_data</code> in the memory of module of the currently executed function.</p><p>If the VM does not expect any reveal data, this function raises an exception.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_info"><a href="#val-get_info" class="anchor"></a><code><span><span class="keyword">val</span> get_info : 
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/index.html#type-info">Wasm_pvm_state.info</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_info pvm_state</code> provides a typed view of the current machine state. Should not raise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_wasm_version"><a href="#val-get_wasm_version" class="anchor"></a><code><span><span class="keyword">val</span> get_wasm_version : 
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/index.html#type-version">Wasm_pvm_state.version</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_wasm_version pvm_state</code> returns the current version at which the WASM PVM operates.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_step_many_until"><a href="#val-compute_step_many_until" class="anchor"></a><code><span><span class="keyword">val</span> compute_step_many_until : 
  <span><span class="label">wasm_entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_steps</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?hooks</span>:<a href="../Hooks/index.html#type-t">Hooks.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_builtins</span>:<a href="../Builtins/index.html#type-reveals">Builtins.reveals</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?write_debug</span>:<a href="../Builtins/index.html#type-write_debug">Builtins.write_debug</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> * int64)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>compute_step_many_until ~wasm_entrypoint ?max_steps ?reveal_builtins ?write_debug should_continue pvm_state</code> advances forwards the VM in the same manners as <code>compute_step_many</code> as long as <code>should_continue</code> returns true.</p><p>Returns the new state and number of the executed ticks.</p><p>IS applied on <code>pvm_state</code> rather than a tree.</p><p>/!\ as it allows to redefine the stop condition, this function should not be used in unit test: the test could hide regression if the condition change in the code, but not in the test.</p><p>The <code>hooks</code> optional argument can be used to execute arbitrary code (hooks) to react to some execution events (see <a href="../Hooks/index.html#type-t"><code>Hooks.t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_output"><a href="#val-get_output" class="anchor"></a><code><span><span class="keyword">val</span> get_output : 
  <span><a href="../Wasm_pvm_state/index.html#type-output_info">Wasm_pvm_state.output_info</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_webassembly_interpreter/Output_buffer/index.html#type-t">Tezos_webassembly_interpreter.Output_buffer.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_output output buffer</code> returns the payload associated with the given output. The result is meant to be deserialized using <code>Sc_rollup_PVM_sem.output_encoding</code>. Raises an exception if the output is not present.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_has_finished"><a href="#val-eval_has_finished" class="anchor"></a><code><span><span class="keyword">val</span> eval_has_finished : <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-tick_state">Wasm_pvm_state.Internal_state.tick_state</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>eval_has_finished tick_state</code> returns <code>true</code> if the evaluation phase has finished successfully.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch_flags_on_eval_successful"><a href="#val-patch_flags_on_eval_successful" class="anchor"></a><code><span><span class="keyword">val</span> patch_flags_on_eval_successful : <span><a href="../Durable/index.html#type-t">Durable.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Durable/index.html#type-t">Durable.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>patch_flags_on_eval_successful durable</code> clears flags set by previous attempted runs of kernel_run. Once an evaluation has succeeded, these can be safely deleted.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-should_compute"><a href="#val-should_compute" class="anchor"></a><code><span><span class="keyword">val</span> should_compute : 
  <span><span class="optlabel">?reveal_builtins</span>:<a href="../Builtins/index.html#type-reveals">Builtins.reveals</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  bool</span></code></div><div class="spec-doc"><p><code>should_compute pvm_state</code> probes whether it is possible to continue with more computational steps.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-has_reboot_flag"><a href="#val-has_reboot_flag" class="anchor"></a><code><span><span class="keyword">val</span> has_reboot_flag : <span><a href="../Durable/index.html#type-t">Durable.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>has_reboot_flag durable</code> checks if the reboot flag is set in the durable storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mark_for_reboot"><a href="#val-mark_for_reboot" class="anchor"></a><code><span><span class="keyword">val</span> mark_for_reboot : 
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Forcing_yield <span>| `Reboot</span> <span>| `Yielding</span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mark_for_reboot reboot_counter durable</code> figures out the computational status with respect to what the PVM shall do next. E.g. schedule a reboot.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_reboot_counter"><a href="#val-next_reboot_counter" class="anchor"></a><code><span><span class="keyword">val</span> next_reboot_counter : 
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-pvm_state">Wasm_pvm_state.Internal_state.pvm_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Wasm_pvm_state/Internal_state/index.html#type-computation_status">Wasm_pvm_state.Internal_state.computation_status</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Z</span>.t</span></code></div><div class="spec-doc"><p><code>next_reboot_counter pvm_state status</code> computes the next reboot counter.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_fallback_kernel"><a href="#val-save_fallback_kernel" class="anchor"></a><code><span><span class="keyword">val</span> save_fallback_kernel : <span><a href="../Durable/index.html#type-t">Durable.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Durable/index.html#type-t">Durable.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_fallback_kernel durable</code> stores the current kernel as a fallback kernel.</p></div></div></div></body></html>
