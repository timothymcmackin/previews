<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Profiler (octez-libs.Tezos_base.Profiler)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_base</a> &#x00BB; Profiler</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_base.Profiler</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#doc-profiler">Profiler</a><ul><li><a href="#summary">Summary</a></li><li><a href="#types-and-utility-functions">Types and utility functions</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="doc-profiler"><a href="#doc-profiler" class="anchor"></a>Profiler</h2><h3 id="summary"><a href="#summary" class="anchor"></a>Summary</h3><p>This profiling library declares a high-level interface meant to be used to instrument code in order to measure the time spent in the different parts in such a way to yield a (human-)processable report. This module declares a generic interface (driver) that will provide an API to the developer to instrument the code. When the profiling data is recorded, the abstracted profiler will feed it to its &quot;plugged&quot; backend (instance) which will process the different profiler's nodes in order to produce the reports. Reports may also be combined to interwine different components' traces.</p><p>The provided API is intentionally simplistic to simplify its usage. The basic usage is to call <code>record &lt;symbol&gt;</code> before the desired section to profile and <code>stop ()</code> when we exit it. Nested calls are also supported and, given that the backend supports it, will be displayed as a callgraph. The API is also augmented with higher-level combinators in order to avoid mismatched <code>stop</code>s and to support <code>Lwt</code> function calls.</p><div class="odoc-spec"><div class="spec type anchored" id="type-metadata"><a href="#type-metadata" class="anchor"></a><code><span><span class="keyword">type</span> metadata</span><span> = <span><span>(string * string)</span> list</span></span></code></div><div class="spec-doc"><p>Type used in order to (optionally) add information to a profiling call in the most generic way possible, allowing for different backends to need different data.</p><p>For instance, a prometheus-based profiler (which can't handle as many different metrics as the file-based ones) would rely on the <code>&quot;prometheus&quot;</code> key being present or not in metadata in order to determine if the function should be monitored or not.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-id"><a href="#type-id" class="anchor"></a><code><span><span class="keyword">type</span> id</span><span> = string * <a href="#type-metadata">metadata</a></span></code></div><div class="spec-doc"><p>Name of a metric, with (possibly empty) metadata attached.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ids"><a href="#type-ids" class="anchor"></a><code><span><span class="keyword">type</span> ids</span><span> = <span>string list</span> * <a href="#type-metadata">metadata</a></span></code></div><div class="spec-doc"><p>Stack of names used for nested metrics (the head is the name of the metric, the second element is the name of the parent section, the third element the parent of the parent, etc...) with (possibly empty) metadata attached.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-IdMap"><a href="#module-IdMap" class="anchor"></a><code><span><span class="keyword">module</span> <a href="IdMap/index.html">IdMap</a></span><span> : <a href="../../Tezos_error_monad/TzLwtreslib/Map/module-type-S/index.html">Tezos_error_monad.TzLwtreslib.Map.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Tezos_error_monad/TzLwtreslib/Map/module-type-S/index.html#type-key">key</a> = <a href="#type-id">id</a></span></span></code></div></div><h3 id="types-and-utility-functions"><a href="#types-and-utility-functions" class="anchor"></a>Types and utility functions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-time"><a href="#type-time" class="anchor"></a><code><span><span class="keyword">type</span> time</span><span> = </span><span>{</span></code><ol><li id="type-time.wall" class="def record field anchored"><a href="#type-time.wall" class="anchor"></a><code><span>wall : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Wall-clock time: total time elapsed.</p><span class="comment-delim">*)</span></div></li><li id="type-time.cpu" class="def record field anchored"><a href="#type-time.cpu" class="anchor"></a><code><span>cpu : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>CPU time: time elapsed in the CPU.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-span"><a href="#type-span" class="anchor"></a><code><span><span class="keyword">type</span> span</span><span> = </span></code><ol><li id="type-span.Span" class="def variant constructor anchored"><a href="#type-span.Span" class="anchor"></a><code><span>| </span><span><span class="constructor">Span</span> <span class="keyword">of</span> <a href="#type-time">time</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-zero_time"><a href="#val-zero_time" class="anchor"></a><code><span><span class="keyword">val</span> zero_time : <a href="#type-span">span</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(-*)"><a href="#val-(-*)" class="anchor"></a><code><span><span class="keyword">val</span> (-*) : <span><a href="#type-time">time</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-time">time</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-time">time</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(+*)"><a href="#val-(+*)" class="anchor"></a><code><span><span class="keyword">val</span> (+*) : <span><a href="#type-time">time</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-time">time</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-time">time</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-verbosity"><a href="#type-verbosity" class="anchor"></a><code><span><span class="keyword">type</span> verbosity</span><span> = </span></code><ol><li id="type-verbosity.Notice" class="def variant constructor anchored"><a href="#type-verbosity.Notice" class="anchor"></a><code><span>| </span><span><span class="constructor">Notice</span></span></code></li><li id="type-verbosity.Info" class="def variant constructor anchored"><a href="#type-verbosity.Info" class="anchor"></a><code><span>| </span><span><span class="constructor">Info</span></span></code></li><li id="type-verbosity.Debug" class="def variant constructor anchored"><a href="#type-verbosity.Debug" class="anchor"></a><code><span>| </span><span><span class="constructor">Debug</span></span></code></li></ol></div><div class="spec-doc"><p>The level of detail of report sections. The driver can choose to use this information to skip or aggregate sections below a given level. The driver could also record everything, including the level of detail, and let a post processor skip or aggregate at display time.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-aggregated_node"><a href="#type-aggregated_node" class="anchor"></a><code><span><span class="keyword">type</span> aggregated_node</span><span> = </span><span>{</span></code><ol><li id="type-aggregated_node.count" class="def record field anchored"><a href="#type-aggregated_node.count" class="anchor"></a><code><span>count : int;</span></code></li><li id="type-aggregated_node.total" class="def record field anchored"><a href="#type-aggregated_node.total" class="anchor"></a><code><span>total : <a href="#type-span">span</a>;</span></code></li><li id="type-aggregated_node.children" class="def record field anchored"><a href="#type-aggregated_node.children" class="anchor"></a><code><span>children : <span><a href="#type-aggregated_node">aggregated_node</a> <a href="IdMap/index.html#type-t">IdMap.t</a></span>;</span></code></li><li id="type-aggregated_node.node_verbosity" class="def record field anchored"><a href="#type-aggregated_node.node_verbosity" class="anchor"></a><code><span>node_verbosity : <a href="#type-verbosity">verbosity</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An aggregate node registers multiple calls to a section and sum their occurences and time. It also recursively aggregate its sub-aggregation nodes.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-seq_item"><a href="#type-seq_item" class="anchor"></a><code><span><span class="keyword">type</span> seq_item</span><span> = </span><span>{</span></code><ol><li id="type-seq_item.start" class="def record field anchored"><a href="#type-seq_item.start" class="anchor"></a><code><span>start : <a href="#type-time">time</a>;</span></code></li><li id="type-seq_item.duration" class="def record field anchored"><a href="#type-seq_item.duration" class="anchor"></a><code><span>duration : <a href="#type-span">span</a>;</span></code></li><li id="type-seq_item.contents" class="def record field anchored"><a href="#type-seq_item.contents" class="anchor"></a><code><span>contents : <a href="#type-report">report</a>;</span></code></li><li id="type-seq_item.item_verbosity" class="def record field anchored"><a href="#type-seq_item.item_verbosity" class="anchor"></a><code><span>item_verbosity : <a href="#type-verbosity">verbosity</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A sequence item registers one section with potential sub-reports and registers elapsed-time.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-report"><a href="#type-report" class="anchor"></a><code><span><span class="keyword">and</span> report</span><span> = </span><span>{</span></code><ol><li id="type-report.aggregated" class="def record field anchored"><a href="#type-report.aggregated" class="anchor"></a><code><span>aggregated : <span><a href="#type-aggregated_node">aggregated_node</a> <a href="IdMap/index.html#type-t">IdMap.t</a></span>;</span></code></li><li id="type-report.recorded" class="def record field anchored"><a href="#type-report.recorded" class="anchor"></a><code><span>recorded : <span><span>(<a href="#type-id">id</a> * <a href="#type-seq_item">seq_item</a>)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-report_encoding"><a href="#val-report_encoding" class="anchor"></a><code><span><span class="keyword">val</span> report_encoding : <span><a href="#type-report">report</a> <a href="../../Data_encoding/index.html#type-t">Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-kind"><a href="#type-kind" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, _) kind</span></span><span> = </span><span>..</span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-DRIVER"><a href="#module-type-DRIVER" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-DRIVER/index.html">DRIVER</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-driver"><a href="#type-driver" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a driver</span></span><span> = <span>(<span class="keyword">module</span> <a href="module-type-DRIVER/index.html">DRIVER</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-DRIVER/index.html#type-config">config</a> = <span class="type-var">'a</span>)</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-instance"><a href="#type-instance" class="anchor"></a><code><span><span class="keyword">type</span> instance</span></code></div><div class="spec-doc"><p>Instance</p><p>A specific instance of a <a href="#driver" title="driver">Driver</a> implementation.</p><p>Example: this driver that writes text files in a unix filesystem will write them in this specific file with this specific level of details</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-instance"><a href="#val-instance" class="anchor"></a><code><span><span class="keyword">val</span> instance : <span><span><span class="type-var">'a</span> <a href="#type-driver">driver</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-instance">instance</a></span></code></div><div class="spec-doc"><p><code>instance driver params</code> will instantiate the <code>driver</code> with the given <code>params</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-time"><a href="#val-time" class="anchor"></a><code><span><span class="keyword">val</span> time : <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-time">time</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-report"><a href="#val-report" class="anchor"></a><code><span><span class="keyword">val</span> report : <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-report">report</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-report_s"><a href="#val-report_s" class="anchor"></a><code><span><span class="keyword">val</span> report_s : <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-report">report</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-profiler"><a href="#type-profiler" class="anchor"></a><code><span><span class="keyword">type</span> profiler</span></code></div><div class="spec-doc"><p>Profiler</p><p>The profiler is an API that needs to be attached to a backend. A backend is composed of:</p><ul><li>a <a href="#driver" title="driver">Driver</a></li><li>a <a href="#instance" title="instance">Instance</a></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-plug"><a href="#val-plug" class="anchor"></a><code><span><span class="keyword">val</span> plug : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>plug profiler instance</code> plugs <code>profiler</code> to <code>instance</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unplug"><a href="#val-unplug" class="anchor"></a><code><span><span class="keyword">val</span> unplug : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>unplug profiler instance</code> unplugs <code>profiler</code> from <code>instance</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_and_unplug"><a href="#val-close_and_unplug" class="anchor"></a><code><span><span class="keyword">val</span> close_and_unplug : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-instance">instance</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>close_and_unplug profiler instance</code> closes <code>profiler</code> and unplugs it from <code>instance</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_and_unplug_all"><a href="#val-close_and_unplug_all" class="anchor"></a><code><span><span class="keyword">val</span> close_and_unplug_all : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>close_and_unplug_all profiler</code> closes <code>profiler</code> and unplugs it from all instances it was plugged to</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-plugged"><a href="#val-plugged" class="anchor"></a><code><span><span class="keyword">val</span> plugged : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-instance">instance</a> list</span></span></code></div><div class="spec-doc"><p><code>plugged profiler</code> returns all the instances plugged to <code>profiler</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record"><a href="#val-record" class="anchor"></a><code><span><span class="keyword">val</span> record : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Open a sequence in the current sequence. If currently aggregating (not all aggregation scopes are closed), this has the same semantics as <a href="#val-aggregate"><code>aggregate</code></a> instead.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-aggregate"><a href="#val-aggregate" class="anchor"></a><code><span><span class="keyword">val</span> aggregate : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Open an aggregation node in the current sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stop"><a href="#val-stop" class="anchor"></a><code><span><span class="keyword">val</span> stop : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Close the most recently opened sequence or aggregation scope.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stamp"><a href="#val-stamp" class="anchor"></a><code><span><span class="keyword">val</span> stamp : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Record a timestamp in the most recently opened sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mark"><a href="#val-mark" class="anchor"></a><code><span><span class="keyword">val</span> mark : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ids">ids</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Count this event's occurences in the most recent sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span"><a href="#val-span" class="anchor"></a><code><span><span class="keyword">val</span> span : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-span">span</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ids">ids</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Sum the time spent in this event in the most recent sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inc"><a href="#val-inc" class="anchor"></a><code><span><span class="keyword">val</span> inc : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-report">report</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Include a report in the current sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_f"><a href="#val-record_f" class="anchor"></a><code><span><span class="keyword">val</span> record_f : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>record_f profiler verbosity label f</code> will call:</p><pre class="language-ocaml"><code>record profiler verbosity name;
f ();
stop ();</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_s"><a href="#val-record_s" class="anchor"></a><code><span><span class="keyword">val</span> record_s : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-record_f"><code>record_f</code></a> but for Lwt function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-aggregate_f"><a href="#val-aggregate_f" class="anchor"></a><code><span><span class="keyword">val</span> aggregate_f : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>aggregate_f profiler verbosity label f</code> will call:</p><pre class="language-ocaml"><code>aggregate profiler verbosity name;
f ();
stop ();</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-aggregate_s"><a href="#val-aggregate_s" class="anchor"></a><code><span><span class="keyword">val</span> aggregate_s : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-aggregate_f"><code>aggregate_f</code></a> but for Lwt functions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span_f"><a href="#val-span_f" class="anchor"></a><code><span><span class="keyword">val</span> span_f : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ids">ids</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>span_f profiler verbosity label_list f</code> will compute <code>span</code> but specifically around <code>f</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span_s"><a href="#val-span_s" class="anchor"></a><code><span><span class="keyword">val</span> span_s : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ids">ids</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-span_f"><code>span_f</code></a> but for Lwt functions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unplugged"><a href="#val-unplugged" class="anchor"></a><code><span><span class="keyword">val</span> unplugged : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-profiler">profiler</a></span></code></div><div class="spec-doc"><p><code>unplugged ()</code> returns a new profiler</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-main"><a href="#val-main" class="anchor"></a><code><span><span class="keyword">val</span> main : <a href="#type-profiler">profiler</a></span></code></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-GLOBAL_PROFILER"><a href="#module-type-GLOBAL_PROFILER" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-GLOBAL_PROFILER/index.html">GLOBAL_PROFILER</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wrap"><a href="#val-wrap" class="anchor"></a><code><span><span class="keyword">val</span> wrap : <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span> <span>(<span class="keyword">module</span> <a href="module-type-GLOBAL_PROFILER/index.html">GLOBAL_PROFILER</a>)</span></span></code></div><div class="spec-doc"><p><code>wrap profiler</code> stores <code>profiler</code> in a <a href="module-type-GLOBAL_PROFILER/index.html"><code>GLOBAL_PROFILER</code></a> module allowing to use the <code>profiler</code> functions without having to provide it as a parameter</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-section_maker"><a href="#type-section_maker" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a section_maker</span></span><span> = <span><span>(<span class="type-var">'a</span> * <a href="#type-metadata">metadata</a>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-section_maker"><a href="#val-section_maker" class="anchor"></a><code><span><span class="keyword">val</span> section_maker : 
  <span><span class="optlabel">?verbosity</span>:<a href="#type-verbosity">verbosity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-profiler">profiler</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-section_maker">section_maker</a></span></span></code></div><div class="spec-doc"><p><code>section_maker equal to_string profiler</code> Creates a function to open a new section (and close the one opened before) using <code>record</code> function when a new entity is encountered.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">verbosity</span> <ul><li>usual verbosity argument. Defaults to <code>Notice</code></li></ul></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">equal</span> <ul><li>used for entities comparison.</li></ul></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">to_string</span> <ul><li>used for labeling the entity when using the <code>record</code> function.</li></ul></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">profiler</span> <ul><li>profiler instance used to track sections and record profiling data.</li></ul></li></ul></div></div></div></body></html>
