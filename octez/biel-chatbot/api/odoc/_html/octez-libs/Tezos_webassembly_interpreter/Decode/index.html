<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Decode (octez-libs.Tezos_webassembly_interpreter.Decode)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_webassembly_interpreter</a> &#x00BB; Decode</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_webassembly_interpreter.Decode</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Vector"><a href="#module-Vector" class="anchor"></a><code><span><span class="keyword">module</span> Vector</span><span> = <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html">Tezos_lazy_containers.Lazy_vector.Int32Vector</a></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Code"><a href="#exception-Code" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Code</span> <span class="keyword">of</span> <a href="../Source/index.html#type-region">Source.region</a> * string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-state"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span><span> = </span></code><ol><li id="type-state.Byte_vector_step" class="def variant constructor anchored"><a href="#type-state.Byte_vector_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Byte_vector_step</span></span></code></li><li id="type-state.Instr_step" class="def variant constructor anchored"><a href="#type-state.Instr_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Instr_step</span></span></code></li><li id="type-state.Instr_block_step" class="def variant constructor anchored"><a href="#type-state.Instr_block_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Instr_block_step</span></span></code></li><li id="type-state.Block_step" class="def variant constructor anchored"><a href="#type-state.Block_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Block_step</span></span></code></li><li id="type-state.Name_step" class="def variant constructor anchored"><a href="#type-state.Name_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Name_step</span></span></code></li><li id="type-state.Func_type_step" class="def variant constructor anchored"><a href="#type-state.Func_type_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Func_type_step</span></span></code></li><li id="type-state.Import_step" class="def variant constructor anchored"><a href="#type-state.Import_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Import_step</span></span></code></li><li id="type-state.Export_step" class="def variant constructor anchored"><a href="#type-state.Export_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Export_step</span></span></code></li><li id="type-state.Code_step" class="def variant constructor anchored"><a href="#type-state.Code_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Code_step</span></span></code></li><li id="type-state.Elem_step" class="def variant constructor anchored"><a href="#type-state.Elem_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Elem_step</span></span></code></li><li id="type-state.Data_step" class="def variant constructor anchored"><a href="#type-state.Data_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Data_step</span></span></code></li><li id="type-state.Module_step" class="def variant constructor anchored"><a href="#type-state.Module_step" class="anchor"></a><code><span>| </span><span><span class="constructor">Module_step</span></span></code></li></ol></div><div class="spec-doc"><p>States representation.</p></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Step_error"><a href="#exception-Step_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Step_error</span> <span class="keyword">of</span> <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p>Exception raised when the small-step parser evaluate an impossible state.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-lazy_stack"><a href="#type-lazy_stack" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a lazy_stack</span></span><span> = </span></code><ol><li id="type-lazy_stack.LazyStack" class="def variant constructor anchored"><a href="#type-lazy_stack.LazyStack" class="anchor"></a><code><span>| </span><span><span class="constructor">LazyStack</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-lazy_stack.length" class="def record field anchored"><a href="#type-lazy_stack.length" class="anchor"></a><code><span>length : int32;</span></code></li><li id="type-lazy_stack.vector" class="def record field anchored"><a href="#type-lazy_stack.vector" class="anchor"></a><code><span>vector : <span><span class="type-var">'a</span> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li></ol><code><span>}</span></code></li></ol></div><div class="spec-doc"><p>Lazy stack using an underlying lazy vector, and a pointer on the head of the stack.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty_stack"><a href="#val-empty_stack" class="anchor"></a><code><span><span class="keyword">val</span> empty_stack : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span></span></code></div><div class="spec-doc"><p><code>empty_stack ()</code> returns a new empty stack.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push_stack"><a href="#val-push_stack" class="anchor"></a><code><span><span class="keyword">val</span> push_stack : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span></span></code></div><div class="spec-doc"><p><code>push_stack v s</code> pushes value <code>v</code> on the stack <code>s</code> at index <code>s.length</code> and updates the length. If <code>s.vector</code> is full, it appends the value to the vector (growing it by 1), otherwise it set the value in the vector.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push_rev_values"><a href="#val-push_rev_values" class="anchor"></a><code><span><span class="keyword">val</span> push_rev_values : <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span></span></code></div><div class="spec-doc"><p><code>push_rev_values vs s</code> pushes values in <code>vs</code> on the stack <code>s</code>, starting from the end of the list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_stack"><a href="#val-pop_stack" class="anchor"></a><code><span><span class="keyword">val</span> pop_stack : <span><span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span>)</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pop_stack s</code> returns the value at <code>s.length - 1</code> and a new stack with length decreased by one.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_at_most"><a href="#val-pop_at_most" class="anchor"></a><code><span><span class="keyword">val</span> pop_at_most : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> list</span> * <span><span class="type-var">'a</span> <a href="#type-lazy_stack">lazy_stack</a></span>)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pop_at_most n s</code> returns at most the <code>n</code> values on top of the stack, and the resulting stack.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-instr_block_kont"><a href="#type-instr_block_kont" class="anchor"></a><code><span><span class="keyword">type</span> instr_block_kont</span><span> = </span></code><ol><li id="type-instr_block_kont.IKStop" class="def variant constructor anchored"><a href="#type-instr_block_kont.IKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">IKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_label">Ast.block_label</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Final step of a block parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-instr_block_kont.IKNext" class="def variant constructor anchored"><a href="#type-instr_block_kont.IKNext" class="anchor"></a><code><span>| </span><span><span class="constructor">IKNext</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_label">Ast.block_label</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Tag parsing, containing the accumulation of already parsed values.</p><span class="comment-delim">*)</span></div></li><li id="type-instr_block_kont.IKBlock" class="def variant constructor anchored"><a href="#type-instr_block_kont.IKBlock" class="anchor"></a><code><span>| </span><span><span class="constructor">IKBlock</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_type">Ast.block_type</a> * int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Block parsing step.</p><span class="comment-delim">*)</span></div></li><li id="type-instr_block_kont.IKLoop" class="def variant constructor anchored"><a href="#type-instr_block_kont.IKLoop" class="anchor"></a><code><span>| </span><span><span class="constructor">IKLoop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_type">Ast.block_type</a> * int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Loop parsing step.</p><span class="comment-delim">*)</span></div></li><li id="type-instr_block_kont.IKIf1" class="def variant constructor anchored"><a href="#type-instr_block_kont.IKIf1" class="anchor"></a><code><span>| </span><span><span class="constructor">IKIf1</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_type">Ast.block_type</a> * int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>If parsing step.</p><span class="comment-delim">*)</span></div></li><li id="type-instr_block_kont.IKIf2" class="def variant constructor anchored"><a href="#type-instr_block_kont.IKIf2" class="anchor"></a><code><span>| </span><span><span class="constructor">IKIf2</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_type">Ast.block_type</a> * int * <a href="../Ast/index.html#type-block_label">Ast.block_label</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>If .. else parsing step.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Instruction parsing continuations.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-block_kont"><a href="#type-block_kont" class="anchor"></a><code><span><span class="keyword">type</span> block_kont</span><span> = </span></code><ol><li id="type-block_kont.BlockStart" class="def variant constructor anchored"><a href="#type-block_kont.BlockStart" class="anchor"></a><code><span>| </span><span><span class="constructor">BlockStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Initial step of a block parsing, allocating the block in the block table.</p><span class="comment-delim">*)</span></div></li><li id="type-block_kont.BlockParse" class="def variant constructor anchored"><a href="#type-block_kont.BlockParse" class="anchor"></a><code><span>| </span><span><span class="constructor">BlockParse</span> <span class="keyword">of</span> <span><a href="#type-instr_block_kont">instr_block_kont</a> <a href="#type-lazy_stack">lazy_stack</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Parsing of a block, with the continuation stack.</p><span class="comment-delim">*)</span></div></li><li id="type-block_kont.BlockStop" class="def variant constructor anchored"><a href="#type-block_kont.BlockStop" class="anchor"></a><code><span>| </span><span><span class="constructor">BlockStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-block_label">Ast.block_label</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>End of a block, returning the label corresponding to the allocated block at the beginning.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Block parsing continuations.</p></div></div><p>Vector and size continuations</p><div class="odoc-spec"><div class="spec type anchored" id="type-lazy_vec_kont"><a href="#type-lazy_vec_kont" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a lazy_vec_kont</span></span><span> = </span></code><ol><li id="type-lazy_vec_kont.LazyVec" class="def variant constructor anchored"><a href="#type-lazy_vec_kont.LazyVec" class="anchor"></a><code><span>| </span><span><span class="constructor">LazyVec</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-lazy_vec_kont.offset" class="def record field anchored"><a href="#type-lazy_vec_kont.offset" class="anchor"></a><code><span>offset : int32;</span></code></li><li id="type-lazy_vec_kont.vector" class="def record field anchored"><a href="#type-lazy_vec_kont.vector" class="anchor"></a><code><span>vector : <span><span class="type-var">'a</span> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li></ol><code><span>}</span></code></li></ol></div><div class="spec-doc"><p>Lazy vector accumulator, with the current offset to write the next value in the vector.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-pos"><a href="#type-pos" class="anchor"></a><code><span><span class="keyword">type</span> pos</span><span> = int</span></code></div><div class="spec-doc"><p>Position of a value on the stream.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-size"><a href="#type-size" class="anchor"></a><code><span><span class="keyword">type</span> size</span><span> = </span><span>{</span></code><ol><li id="type-size.size" class="def record field anchored"><a href="#type-size.size" class="anchor"></a><code><span>size : int;</span></code></li><li id="type-size.start" class="def record field anchored"><a href="#type-size.start" class="anchor"></a><code><span>start : <a href="#type-pos">pos</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Size checking version of <code>sized</code> for CPS-style parsing.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-byte_vector_kont"><a href="#type-byte_vector_kont" class="anchor"></a><code><span><span class="keyword">type</span> byte_vector_kont</span><span> = </span></code><ol><li id="type-byte_vector_kont.VKStart" class="def variant constructor anchored"><a href="#type-byte_vector_kont.VKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">VKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Initial step.</p><span class="comment-delim">*)</span></div></li><li id="type-byte_vector_kont.VKRead" class="def variant constructor anchored"><a href="#type-byte_vector_kont.VKRead" class="anchor"></a><code><span>| </span><span><span class="constructor">VKRead</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-data_label">Ast.data_label</a> * int64 * int64</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Reading step, containing the current position in the string and the length, reading byte per byte.</p><span class="comment-delim">*)</span></div></li><li id="type-byte_vector_kont.VKStop" class="def variant constructor anchored"><a href="#type-byte_vector_kont.VKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">VKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-data_label">Ast.data_label</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Final step, cannot reduce.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Incremental chunked byte vector creation (from implicit input).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-name_step"><a href="#type-name_step" class="anchor"></a><code><span><span class="keyword">type</span> name_step</span><span> = </span></code><ol><li id="type-name_step.NKStart" class="def variant constructor anchored"><a href="#type-name_step.NKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">NKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>UTF8 name starting point.</p><span class="comment-delim">*)</span></div></li><li id="type-name_step.NKParse" class="def variant constructor anchored"><a href="#type-name_step.NKParse" class="anchor"></a><code><span>| </span><span><span class="constructor">NKParse</span> <span class="keyword">of</span> <a href="#type-pos">pos</a> * <span class="xref-unresolved">Stdlib</span>.Buffer.t * int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>UTF8 char parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-name_step.NKStop" class="def variant constructor anchored"><a href="#type-name_step.NKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">NKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-name">Ast.name</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>UTF8 name final step.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-func_type_kont"><a href="#type-func_type_kont" class="anchor"></a><code><span><span class="keyword">type</span> func_type_kont</span><span> = </span></code><ol><li id="type-func_type_kont.FKStart" class="def variant constructor anchored"><a href="#type-func_type_kont.FKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">FKStart</span></span></code></li><li id="type-func_type_kont.FKIns" class="def variant constructor anchored"><a href="#type-func_type_kont.FKIns" class="anchor"></a><code><span>| </span><span><span class="constructor">FKIns</span> <span class="keyword">of</span> <span><a href="../Types/index.html#type-value_type">Types.value_type</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code></li><li id="type-func_type_kont.FKOut" class="def variant constructor anchored"><a href="#type-func_type_kont.FKOut" class="anchor"></a><code><span>| </span><span><span class="constructor">FKOut</span> <span class="keyword">of</span> <span><a href="../Types/index.html#type-value_type">Types.value_type</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span> * <span><a href="../Types/index.html#type-value_type">Types.value_type</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code></li><li id="type-func_type_kont.FKStop" class="def variant constructor anchored"><a href="#type-func_type_kont.FKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">FKStop</span> <span class="keyword">of</span> <a href="../Types/index.html#type-func_type">Types.func_type</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-import_kont"><a href="#type-import_kont" class="anchor"></a><code><span><span class="keyword">type</span> import_kont</span><span> = </span></code><ol><li id="type-import_kont.ImpKStart" class="def variant constructor anchored"><a href="#type-import_kont.ImpKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">ImpKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Import parsing starting point.</p><span class="comment-delim">*)</span></div></li><li id="type-import_kont.ImpKModuleName" class="def variant constructor anchored"><a href="#type-import_kont.ImpKModuleName" class="anchor"></a><code><span>| </span><span><span class="constructor">ImpKModuleName</span> <span class="keyword">of</span> <a href="#type-name_step">name_step</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Import module name parsing UTF8 char per char step.</p><span class="comment-delim">*)</span></div></li><li id="type-import_kont.ImpKItemName" class="def variant constructor anchored"><a href="#type-import_kont.ImpKItemName" class="anchor"></a><code><span>| </span><span><span class="constructor">ImpKItemName</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-name">Ast.name</a> * <a href="#type-name_step">name_step</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Import item name parsing UTF8 char per char step.</p><span class="comment-delim">*)</span></div></li><li id="type-import_kont.ImpKStop" class="def variant constructor anchored"><a href="#type-import_kont.ImpKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">ImpKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-import'">Ast.import'</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Import final step.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-export_kont"><a href="#type-export_kont" class="anchor"></a><code><span><span class="keyword">type</span> export_kont</span><span> = </span></code><ol><li id="type-export_kont.ExpKStart" class="def variant constructor anchored"><a href="#type-export_kont.ExpKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">ExpKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Export parsing starting point.</p><span class="comment-delim">*)</span></div></li><li id="type-export_kont.ExpKName" class="def variant constructor anchored"><a href="#type-export_kont.ExpKName" class="anchor"></a><code><span>| </span><span><span class="constructor">ExpKName</span> <span class="keyword">of</span> <a href="#type-name_step">name_step</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Export name parsing UTF8 char per char step.</p><span class="comment-delim">*)</span></div></li><li id="type-export_kont.ExpKStop" class="def variant constructor anchored"><a href="#type-export_kont.ExpKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">ExpKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-export'">Ast.export'</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Export final step.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-code_kont"><a href="#type-code_kont" class="anchor"></a><code><span><span class="keyword">type</span> code_kont</span><span> = </span></code><ol><li id="type-code_kont.CKStart" class="def variant constructor anchored"><a href="#type-code_kont.CKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">CKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Starting point of a function parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-code_kont.CKLocalsParse" class="def variant constructor anchored"><a href="#type-code_kont.CKLocalsParse" class="anchor"></a><code><span>| </span><span><span class="constructor">CKLocalsParse</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-code_kont.left" class="def record field anchored"><a href="#type-code_kont.left" class="anchor"></a><code><span>left : <a href="#type-pos">pos</a>;</span></code></li><li id="type-code_kont.size" class="def record field anchored"><a href="#type-code_kont.size" class="anchor"></a><code><span>size : <a href="#type-size">size</a>;</span></code></li><li id="type-code_kont.pos" class="def record field anchored"><a href="#type-code_kont.pos" class="anchor"></a><code><span>pos : <a href="#type-pos">pos</a>;</span></code></li><li id="type-code_kont.vec_kont" class="def record field anchored"><a href="#type-code_kont.vec_kont" class="anchor"></a><code><span>vec_kont : <span><span>(int32 * <a href="../Types/index.html#type-value_type">Types.value_type</a>)</span> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span>;</span></code></li><li id="type-code_kont.locals_size" class="def record field anchored"><a href="#type-code_kont.locals_size" class="anchor"></a><code><span>locals_size : <span class="xref-unresolved">Stdlib</span>.Int64.t;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Parse a local value with its number of occurences.</p><span class="comment-delim">*)</span></div></li><li id="type-code_kont.CKLocalsAccumulate" class="def variant constructor anchored"><a href="#type-code_kont.CKLocalsAccumulate" class="anchor"></a><code><span>| </span><span><span class="constructor">CKLocalsAccumulate</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-code_kont.left" class="def record field anchored"><a href="#type-code_kont.left" class="anchor"></a><code><span>left : <a href="#type-pos">pos</a>;</span></code></li><li id="type-code_kont.size" class="def record field anchored"><a href="#type-code_kont.size" class="anchor"></a><code><span>size : <a href="#type-size">size</a>;</span></code></li><li id="type-code_kont.pos" class="def record field anchored"><a href="#type-code_kont.pos" class="anchor"></a><code><span>pos : <a href="#type-pos">pos</a>;</span></code></li><li id="type-code_kont.type_vec" class="def record field anchored"><a href="#type-code_kont.type_vec" class="anchor"></a><code><span>type_vec : <span><span>(int32 * <a href="../Types/index.html#type-value_type">Types.value_type</a>)</span> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span>;</span></code></li><li id="type-code_kont.curr_type" class="def record field anchored"><a href="#type-code_kont.curr_type" class="anchor"></a><code><span>curr_type : <span><span>(int32 * <a href="../Types/index.html#type-value_type">Types.value_type</a>)</span> option</span>;</span></code></li><li id="type-code_kont.vec_kont" class="def record field anchored"><a href="#type-code_kont.vec_kont" class="anchor"></a><code><span>vec_kont : <span><a href="../Types/index.html#type-value_type">Types.value_type</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Accumulate local values.</p><span class="comment-delim">*)</span></div></li><li id="type-code_kont.CKBody" class="def variant constructor anchored"><a href="#type-code_kont.CKBody" class="anchor"></a><code><span>| </span><span><span class="constructor">CKBody</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-code_kont.left" class="def record field anchored"><a href="#type-code_kont.left" class="anchor"></a><code><span>left : <a href="#type-pos">pos</a>;</span></code></li><li id="type-code_kont.size" class="def record field anchored"><a href="#type-code_kont.size" class="anchor"></a><code><span>size : <a href="#type-size">size</a>;</span></code></li><li id="type-code_kont.locals" class="def record field anchored"><a href="#type-code_kont.locals" class="anchor"></a><code><span>locals : <span><a href="../Types/index.html#type-value_type">Types.value_type</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-code_kont.const_kont" class="def record field anchored"><a href="#type-code_kont.const_kont" class="anchor"></a><code><span>const_kont : <a href="#type-block_kont">block_kont</a>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Parsing step of the body of a function.</p><span class="comment-delim">*)</span></div></li><li id="type-code_kont.CKStop" class="def variant constructor anchored"><a href="#type-code_kont.CKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">CKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-func">Ast.func</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Final step of a parsed function, irreducible.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Code section parsing.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-index_kind"><a href="#type-index_kind" class="anchor"></a><code><span><span class="keyword">type</span> index_kind</span><span> = </span></code><ol><li id="type-index_kind.Indexed" class="def variant constructor anchored"><a href="#type-index_kind.Indexed" class="anchor"></a><code><span>| </span><span><span class="constructor">Indexed</span></span></code></li><li id="type-index_kind.Const" class="def variant constructor anchored"><a href="#type-index_kind.Const" class="anchor"></a><code><span>| </span><span><span class="constructor">Const</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-elem_kont"><a href="#type-elem_kont" class="anchor"></a><code><span><span class="keyword">type</span> elem_kont</span><span> = </span></code><ol><li id="type-elem_kont.EKStart" class="def variant constructor anchored"><a href="#type-elem_kont.EKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">EKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Starting point of an element segment parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-elem_kont.EKMode" class="def variant constructor anchored"><a href="#type-elem_kont.EKMode" class="anchor"></a><code><span>| </span><span><span class="constructor">EKMode</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-elem_kont.left" class="def record field anchored"><a href="#type-elem_kont.left" class="anchor"></a><code><span>left : <a href="#type-pos">pos</a>;</span></code></li><li id="type-elem_kont.index" class="def record field anchored"><a href="#type-elem_kont.index" class="anchor"></a><code><span>index : <span>int32 <a href="../Source/index.html#type-phrase">Source.phrase</a></span>;</span></code></li><li id="type-elem_kont.index_kind" class="def record field anchored"><a href="#type-elem_kont.index_kind" class="anchor"></a><code><span>index_kind : <a href="#type-index_kind">index_kind</a>;</span></code></li><li id="type-elem_kont.early_ref_type" class="def record field anchored"><a href="#type-elem_kont.early_ref_type" class="anchor"></a><code><span>early_ref_type : <span><a href="../Types/index.html#type-ref_type">Types.ref_type</a> option</span>;</span></code></li><li id="type-elem_kont.offset_kont" class="def record field anchored"><a href="#type-elem_kont.offset_kont" class="anchor"></a><code><span>offset_kont : <a href="#type-pos">pos</a> * <a href="#type-block_kont">block_kont</a>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Element segment mode parsing step.</p><span class="comment-delim">*)</span></div></li><li id="type-elem_kont.EKInitIndexed" class="def variant constructor anchored"><a href="#type-elem_kont.EKInitIndexed" class="anchor"></a><code><span>| </span><span><span class="constructor">EKInitIndexed</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-elem_kont.mode" class="def record field anchored"><a href="#type-elem_kont.mode" class="anchor"></a><code><span>mode : <a href="../Ast/index.html#type-segment_mode">Ast.segment_mode</a>;</span></code></li><li id="type-elem_kont.ref_type" class="def record field anchored"><a href="#type-elem_kont.ref_type" class="anchor"></a><code><span>ref_type : <a href="../Types/index.html#type-ref_type">Types.ref_type</a>;</span></code></li><li id="type-elem_kont.einit_vec" class="def record field anchored"><a href="#type-elem_kont.einit_vec" class="anchor"></a><code><span>einit_vec : <span><a href="../Ast/index.html#type-const">Ast.const</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Element segment initialization code parsing step for referenced values.</p><span class="comment-delim">*)</span></div></li><li id="type-elem_kont.EKInitConst" class="def variant constructor anchored"><a href="#type-elem_kont.EKInitConst" class="anchor"></a><code><span>| </span><span><span class="constructor">EKInitConst</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-elem_kont.mode" class="def record field anchored"><a href="#type-elem_kont.mode" class="anchor"></a><code><span>mode : <a href="../Ast/index.html#type-segment_mode">Ast.segment_mode</a>;</span></code></li><li id="type-elem_kont.ref_type" class="def record field anchored"><a href="#type-elem_kont.ref_type" class="anchor"></a><code><span>ref_type : <a href="../Types/index.html#type-ref_type">Types.ref_type</a>;</span></code></li><li id="type-elem_kont.einit_vec" class="def record field anchored"><a href="#type-elem_kont.einit_vec" class="anchor"></a><code><span>einit_vec : <span><a href="../Ast/index.html#type-const">Ast.const</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span>;</span></code></li><li id="type-elem_kont.einit_kont" class="def record field anchored"><a href="#type-elem_kont.einit_kont" class="anchor"></a><code><span>einit_kont : <a href="#type-pos">pos</a> * <a href="#type-block_kont">block_kont</a>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Element segment initialization code parsing step for constant values.</p><span class="comment-delim">*)</span></div></li><li id="type-elem_kont.EKStop" class="def variant constructor anchored"><a href="#type-elem_kont.EKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">EKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-elem_segment'">Ast.elem_segment'</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Final step of a segment parsing.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-data_kont"><a href="#type-data_kont" class="anchor"></a><code><span><span class="keyword">type</span> data_kont</span><span> = </span></code><ol><li id="type-data_kont.DKStart" class="def variant constructor anchored"><a href="#type-data_kont.DKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">DKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Starting point of a data segment parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-data_kont.DKMode" class="def variant constructor anchored"><a href="#type-data_kont.DKMode" class="anchor"></a><code><span>| </span><span><span class="constructor">DKMode</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-data_kont.left" class="def record field anchored"><a href="#type-data_kont.left" class="anchor"></a><code><span>left : <a href="#type-pos">pos</a>;</span></code></li><li id="type-data_kont.index" class="def record field anchored"><a href="#type-data_kont.index" class="anchor"></a><code><span>index : <span>int32 <a href="../Source/index.html#type-phrase">Source.phrase</a></span>;</span></code></li><li id="type-data_kont.offset_kont" class="def record field anchored"><a href="#type-data_kont.offset_kont" class="anchor"></a><code><span>offset_kont : <a href="#type-pos">pos</a> * <a href="#type-block_kont">block_kont</a>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Data segment mode parsing step.</p><span class="comment-delim">*)</span></div></li><li id="type-data_kont.DKInit" class="def variant constructor anchored"><a href="#type-data_kont.DKInit" class="anchor"></a><code><span>| </span><span><span class="constructor">DKInit</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-data_kont.dmode" class="def record field anchored"><a href="#type-data_kont.dmode" class="anchor"></a><code><span>dmode : <a href="../Ast/index.html#type-segment_mode">Ast.segment_mode</a>;</span></code></li><li id="type-data_kont.init_kont" class="def record field anchored"><a href="#type-data_kont.init_kont" class="anchor"></a><code><span>init_kont : <a href="#type-byte_vector_kont">byte_vector_kont</a>;</span></code></li></ol><code><span>}</span></code></li><li id="type-data_kont.DKStop" class="def variant constructor anchored"><a href="#type-data_kont.DKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">DKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-data_segment'">Ast.data_segment'</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Final step of a data segment parsing.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-section_tag"><a href="#type-section_tag" class="anchor"></a><code><span><span class="keyword">type</span> section_tag</span><span> = </span><span>[ </span></code><ol><li id="type-section_tag.CodeSection" class="def variant constructor anchored"><a href="#type-section_tag.CodeSection" class="anchor"></a><code><span>| </span><span>`CodeSection</span></code></li><li id="type-section_tag.CustomSection" class="def variant constructor anchored"><a href="#type-section_tag.CustomSection" class="anchor"></a><code><span>| </span><span>`CustomSection</span></code></li><li id="type-section_tag.DataCountSection" class="def variant constructor anchored"><a href="#type-section_tag.DataCountSection" class="anchor"></a><code><span>| </span><span>`DataCountSection</span></code></li><li id="type-section_tag.DataSection" class="def variant constructor anchored"><a href="#type-section_tag.DataSection" class="anchor"></a><code><span>| </span><span>`DataSection</span></code></li><li id="type-section_tag.ElemSection" class="def variant constructor anchored"><a href="#type-section_tag.ElemSection" class="anchor"></a><code><span>| </span><span>`ElemSection</span></code></li><li id="type-section_tag.ExportSection" class="def variant constructor anchored"><a href="#type-section_tag.ExportSection" class="anchor"></a><code><span>| </span><span>`ExportSection</span></code></li><li id="type-section_tag.FuncSection" class="def variant constructor anchored"><a href="#type-section_tag.FuncSection" class="anchor"></a><code><span>| </span><span>`FuncSection</span></code></li><li id="type-section_tag.GlobalSection" class="def variant constructor anchored"><a href="#type-section_tag.GlobalSection" class="anchor"></a><code><span>| </span><span>`GlobalSection</span></code></li><li id="type-section_tag.ImportSection" class="def variant constructor anchored"><a href="#type-section_tag.ImportSection" class="anchor"></a><code><span>| </span><span>`ImportSection</span></code></li><li id="type-section_tag.MemorySection" class="def variant constructor anchored"><a href="#type-section_tag.MemorySection" class="anchor"></a><code><span>| </span><span>`MemorySection</span></code></li><li id="type-section_tag.StartSection" class="def variant constructor anchored"><a href="#type-section_tag.StartSection" class="anchor"></a><code><span>| </span><span>`StartSection</span></code></li><li id="type-section_tag.TableSection" class="def variant constructor anchored"><a href="#type-section_tag.TableSection" class="anchor"></a><code><span>| </span><span>`TableSection</span></code></li><li id="type-section_tag.TypeSection" class="def variant constructor anchored"><a href="#type-section_tag.TypeSection" class="anchor"></a><code><span>| </span><span>`TypeSection</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Representation of a section tag.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-vec_repr"><a href="#type-vec_repr" class="anchor"></a><code><span><span class="keyword">type</span> vec_repr</span><span> = </span></code><ol><li id="type-vec_repr.VecRepr" class="def variant constructor anchored"><a href="#type-vec_repr.VecRepr" class="anchor"></a><code><span>| </span><span><span class="constructor">VecRepr</span></span></code></li></ol></div><div class="spec-doc"><p>Type witness for a LazyVector.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-opt_repr"><a href="#type-opt_repr" class="anchor"></a><code><span><span class="keyword">type</span> opt_repr</span><span> = </span></code><ol><li id="type-opt_repr.OptRepr" class="def variant constructor anchored"><a href="#type-opt_repr.OptRepr" class="anchor"></a><code><span>| </span><span><span class="constructor">OptRepr</span></span></code></li></ol></div><div class="spec-doc"><p>Type witness for an option.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-field_type"><a href="#type-field_type" class="anchor"></a><code><span><span class="keyword">type</span> <span>(_, _) field_type</span></span><span> = </span></code><ol><li id="type-field_type.TypeField" class="def variant constructor anchored"><a href="#type-field_type.TypeField" class="anchor"></a><code><span>| </span><span><span class="constructor">TypeField</span> : <span><span>(<a href="../Ast/index.html#type-type_">Ast.type_</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.ImportField" class="def variant constructor anchored"><a href="#type-field_type.ImportField" class="anchor"></a><code><span>| </span><span><span class="constructor">ImportField</span> : <span><span>(<a href="../Ast/index.html#type-import">Ast.import</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.FuncField" class="def variant constructor anchored"><a href="#type-field_type.FuncField" class="anchor"></a><code><span>| </span><span><span class="constructor">FuncField</span> : <span><span>(<a href="../Ast/index.html#type-var">Ast.var</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.TableField" class="def variant constructor anchored"><a href="#type-field_type.TableField" class="anchor"></a><code><span>| </span><span><span class="constructor">TableField</span> : <span><span>(<a href="../Ast/index.html#type-table">Ast.table</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.MemoryField" class="def variant constructor anchored"><a href="#type-field_type.MemoryField" class="anchor"></a><code><span>| </span><span><span class="constructor">MemoryField</span> : <span><span>(<a href="../Ast/index.html#type-memory">Ast.memory</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.GlobalField" class="def variant constructor anchored"><a href="#type-field_type.GlobalField" class="anchor"></a><code><span>| </span><span><span class="constructor">GlobalField</span> : <span><span>(<a href="../Ast/index.html#type-global">Ast.global</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.ExportField" class="def variant constructor anchored"><a href="#type-field_type.ExportField" class="anchor"></a><code><span>| </span><span><span class="constructor">ExportField</span> : <span><span>(<a href="../Ast/index.html#type-export">Ast.export</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.StartField" class="def variant constructor anchored"><a href="#type-field_type.StartField" class="anchor"></a><code><span>| </span><span><span class="constructor">StartField</span> : <span><span>(<a href="../Ast/index.html#type-start">Ast.start</a>, <a href="#type-opt_repr">opt_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.ElemField" class="def variant constructor anchored"><a href="#type-field_type.ElemField" class="anchor"></a><code><span>| </span><span><span class="constructor">ElemField</span> : <span><span>(<a href="../Ast/index.html#type-elem_segment">Ast.elem_segment</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.DataCountField" class="def variant constructor anchored"><a href="#type-field_type.DataCountField" class="anchor"></a><code><span>| </span><span><span class="constructor">DataCountField</span> : <span><span>(int32, <a href="#type-opt_repr">opt_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.CodeField" class="def variant constructor anchored"><a href="#type-field_type.CodeField" class="anchor"></a><code><span>| </span><span><span class="constructor">CodeField</span> : <span><span>(<a href="../Ast/index.html#type-func">Ast.func</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li><li id="type-field_type.DataField" class="def variant constructor anchored"><a href="#type-field_type.DataField" class="anchor"></a><code><span>| </span><span><span class="constructor">DataField</span> : <span><span>(<a href="../Ast/index.html#type-data_segment">Ast.data_segment</a>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span></span></code></li></ol></div><div class="spec-doc"><p>Sections representation.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-field"><a href="#type-field" class="anchor"></a><code><span><span class="keyword">type</span> field</span><span> = </span></code><ol><li id="type-field.VecField" class="def variant constructor anchored"><a href="#type-field.VecField" class="anchor"></a><code><span>| </span><span><span class="constructor">VecField</span> : <span><span>(<span class="type-var">'a</span>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span> * <span><span class="type-var">'a</span> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span> <span class="arrow">&#45;&gt;</span> <a href="#type-field">field</a></span></code></li><li id="type-field.SingleField" class="def variant constructor anchored"><a href="#type-field.SingleField" class="anchor"></a><code><span>| </span><span><span class="constructor">SingleField</span> : <span><span>(<span class="type-var">'a</span>, <a href="#type-opt_repr">opt_repr</a>)</span> <a href="#type-field_type">field_type</a></span> * <span><span class="type-var">'a</span> option</span> <span class="arrow">&#45;&gt;</span> <a href="#type-field">field</a></span></code></li></ol></div><div class="spec-doc"><p>Result of a section parsing, being either a single value or a vector.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-module_kont"><a href="#type-module_kont" class="anchor"></a><code><span><span class="keyword">type</span> module_kont</span><span> = </span></code><ol><li id="type-module_kont.MKStart" class="def variant constructor anchored"><a href="#type-module_kont.MKStart" class="anchor"></a><code><span>| </span><span><span class="constructor">MKStart</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Initial state of a module parsing</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKSkipCustom" class="def variant constructor anchored"><a href="#type-module_kont.MKSkipCustom" class="anchor"></a><code><span>| </span><span><span class="constructor">MKSkipCustom</span> : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'repr</span>)</span> <a href="#type-field_type">field_type</a></span> option</span> <span class="arrow">&#45;&gt;</span> <a href="#type-module_kont">module_kont</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Custom section which are skipped, with the next section to parse.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKFieldStart" class="def variant constructor anchored"><a href="#type-module_kont.MKFieldStart" class="anchor"></a><code><span>| </span><span><span class="constructor">MKFieldStart</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'repr</span>)</span> <a href="#type-field_type">field_type</a></span> <span class="arrow">&#45;&gt;</span> <a href="#type-module_kont">module_kont</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Starting point of a section, handles parsing generic section header.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKField" class="def variant constructor anchored"><a href="#type-module_kont.MKField" class="anchor"></a><code><span>| </span><span><span class="constructor">MKField</span> : <span><span>(<span class="type-var">'a</span>, <a href="#type-vec_repr">vec_repr</a>)</span> <a href="#type-field_type">field_type</a></span> * <a href="#type-size">size</a> * <span><span class="type-var">'a</span> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span> <span class="arrow">&#45;&gt;</span> <a href="#type-module_kont">module_kont</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Section currently parsed, accumulating each element from the underlying vector.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKElaborateFunc" class="def variant constructor anchored"><a href="#type-module_kont.MKElaborateFunc" class="anchor"></a><code><span>| </span><span><span class="constructor">MKElaborateFunc</span> : <span><a href="../Ast/index.html#type-var">Ast.var</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>
  * <span><a href="../Ast/index.html#type-func">Ast.func</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>
  * <span><a href="../Ast/index.html#type-func">Ast.func</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span>
  * <span><span><span><a href="../Ast/index.html#type-instr">Ast.instr</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span> option</span>
  * bool <span class="arrow">&#45;&gt;</span> <a href="#type-module_kont">module_kont</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Elaboration of functions from the code section with their declared type in the func section, and accumulating invariants conditions associated to functions.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKBuild" class="def variant constructor anchored"><a href="#type-module_kont.MKBuild" class="anchor"></a><code><span>| </span><span><span class="constructor">MKBuild</span> <span class="keyword">of</span> <span><span><a href="../Ast/index.html#type-func">Ast.func</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span> option</span> * bool</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Accumulating the parsed sections vectors into a module and checking invariants.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKStop" class="def variant constructor anchored"><a href="#type-module_kont.MKStop" class="anchor"></a><code><span>| </span><span><span class="constructor">MKStop</span> <span class="keyword">of</span> <a href="../Ast/index.html#type-module_">Ast.module_</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Final step of the parsing, cannot reduce.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKTypes" class="def variant constructor anchored"><a href="#type-module_kont.MKTypes" class="anchor"></a><code><span>| </span><span><span class="constructor">MKTypes</span> <span class="keyword">of</span> <a href="#type-func_type_kont">func_type_kont</a> * <a href="#type-pos">pos</a> * <a href="#type-size">size</a> * <span><a href="../Ast/index.html#type-type_">Ast.type_</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Function types section parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKImport" class="def variant constructor anchored"><a href="#type-module_kont.MKImport" class="anchor"></a><code><span>| </span><span><span class="constructor">MKImport</span> <span class="keyword">of</span> <a href="#type-import_kont">import_kont</a> * <a href="#type-pos">pos</a> * <a href="#type-size">size</a> * <span><a href="../Ast/index.html#type-import">Ast.import</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Import section parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKExport" class="def variant constructor anchored"><a href="#type-module_kont.MKExport" class="anchor"></a><code><span>| </span><span><span class="constructor">MKExport</span> <span class="keyword">of</span> <a href="#type-export_kont">export_kont</a> * <a href="#type-pos">pos</a> * <a href="#type-size">size</a> * <span><a href="../Ast/index.html#type-export">Ast.export</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Export section parsing.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKGlobal" class="def variant constructor anchored"><a href="#type-module_kont.MKGlobal" class="anchor"></a><code><span>| </span><span><span class="constructor">MKGlobal</span> <span class="keyword">of</span> <a href="../Types/index.html#type-global_type">Types.global_type</a>
  * int
  * <a href="#type-block_kont">block_kont</a>
  * <a href="#type-size">size</a>
  * <span><a href="../Ast/index.html#type-global">Ast.global</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Globals section parsing, containing the starting position, the continuation of the current global block instruction, and the size of the section.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKElem" class="def variant constructor anchored"><a href="#type-module_kont.MKElem" class="anchor"></a><code><span>| </span><span><span class="constructor">MKElem</span> <span class="keyword">of</span> <a href="#type-elem_kont">elem_kont</a> * int * <a href="#type-size">size</a> * <span><a href="../Ast/index.html#type-elem_segment">Ast.elem_segment</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Element segments section parsing, containing the current element parsing continuation, the starting position of the current element, the size of the section.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKData" class="def variant constructor anchored"><a href="#type-module_kont.MKData" class="anchor"></a><code><span>| </span><span><span class="constructor">MKData</span> <span class="keyword">of</span> <a href="#type-data_kont">data_kont</a> * int * <a href="#type-size">size</a> * <span><a href="../Ast/index.html#type-data_segment">Ast.data_segment</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Data segments section parsing, containing the current data parsing continuation, the starting position of the current data, the size of the section.</p><span class="comment-delim">*)</span></div></li><li id="type-module_kont.MKCode" class="def variant constructor anchored"><a href="#type-module_kont.MKCode" class="anchor"></a><code><span>| </span><span><span class="constructor">MKCode</span> <span class="keyword">of</span> <a href="#type-code_kont">code_kont</a> * int * <a href="#type-size">size</a> * <span><a href="../Ast/index.html#type-func">Ast.func</a> <a href="#type-lazy_vec_kont">lazy_vec_kont</a></span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Code section parsing, containing the current function parsing continuation, the starting position of the current function, the size of the section.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Module parsing steps</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream"><a href="#type-stream" class="anchor"></a><code><span><span class="keyword">type</span> stream</span><span> = </span><span>{</span></code><ol><li id="type-stream.name" class="def record field anchored"><a href="#type-stream.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-stream.bytes" class="def record field anchored"><a href="#type-stream.bytes" class="anchor"></a><code><span>bytes : <a href="../../Tezos_lazy_containers/Chunked_byte_vector/index.html#type-t">Tezos_lazy_containers.Chunked_byte_vector.t</a>;</span></code></li><li id="type-stream.pos" class="def record field anchored"><a href="#type-stream.pos" class="anchor"></a><code><span><span class="keyword">mutable</span> pos : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Parsed bytes with the current reading position.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-building_state"><a href="#type-building_state" class="anchor"></a><code><span><span class="keyword">type</span> building_state</span><span> = </span><span>{</span></code><ol><li id="type-building_state.types" class="def record field anchored"><a href="#type-building_state.types" class="anchor"></a><code><span>types : <span><a href="../Ast/index.html#type-type_">Ast.type_</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.imports" class="def record field anchored"><a href="#type-building_state.imports" class="anchor"></a><code><span>imports : <span><a href="../Ast/index.html#type-import">Ast.import</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.vars" class="def record field anchored"><a href="#type-building_state.vars" class="anchor"></a><code><span>vars : <span><a href="../Ast/index.html#type-var">Ast.var</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.tables" class="def record field anchored"><a href="#type-building_state.tables" class="anchor"></a><code><span>tables : <span><a href="../Ast/index.html#type-table">Ast.table</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.memories" class="def record field anchored"><a href="#type-building_state.memories" class="anchor"></a><code><span>memories : <span><a href="../Ast/index.html#type-memory">Ast.memory</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.globals" class="def record field anchored"><a href="#type-building_state.globals" class="anchor"></a><code><span>globals : <span><a href="../Ast/index.html#type-global">Ast.global</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.exports" class="def record field anchored"><a href="#type-building_state.exports" class="anchor"></a><code><span>exports : <span><a href="../Ast/index.html#type-export">Ast.export</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.start" class="def record field anchored"><a href="#type-building_state.start" class="anchor"></a><code><span>start : <span><a href="../Ast/index.html#type-start">Ast.start</a> option</span>;</span></code></li><li id="type-building_state.elems" class="def record field anchored"><a href="#type-building_state.elems" class="anchor"></a><code><span>elems : <span><a href="../Ast/index.html#type-elem_segment">Ast.elem_segment</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.data_count" class="def record field anchored"><a href="#type-building_state.data_count" class="anchor"></a><code><span>data_count : <span>int32 option</span>;</span></code></li><li id="type-building_state.code" class="def record field anchored"><a href="#type-building_state.code" class="anchor"></a><code><span>code : <span><a href="../Ast/index.html#type-func">Ast.func</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li><li id="type-building_state.datas" class="def record field anchored"><a href="#type-building_state.datas" class="anchor"></a><code><span>datas : <span><a href="../Ast/index.html#type-data_segment">Ast.data_segment</a> <a href="../../Tezos_lazy_containers/Lazy_vector/Int32Vector/index.html#type-t">Vector.t</a></span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Accumulator of parsed fields</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-decode_kont"><a href="#type-decode_kont" class="anchor"></a><code><span><span class="keyword">type</span> decode_kont</span><span> = </span><span>{</span></code><ol><li id="type-decode_kont.building_state" class="def record field anchored"><a href="#type-decode_kont.building_state" class="anchor"></a><code><span>building_state : <a href="#type-building_state">building_state</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Accumulated parsed sections, used to build the final module.</p><span class="comment-delim">*)</span></div></li><li id="type-decode_kont.module_kont" class="def record field anchored"><a href="#type-decode_kont.module_kont" class="anchor"></a><code><span>module_kont : <a href="#type-module_kont">module_kont</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Module continuation.</p><span class="comment-delim">*)</span></div></li><li id="type-decode_kont.allocation_state" class="def record field anchored"><a href="#type-decode_kont.allocation_state" class="anchor"></a><code><span>allocation_state : <a href="../Ast/index.html#type-allocations">Ast.allocations</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Basic blocks allocated.</p><span class="comment-delim">*)</span></div></li><li id="type-decode_kont.stream_pos" class="def record field anchored"><a href="#type-decode_kont.stream_pos" class="anchor"></a><code><span>stream_pos : int;</span></code></li><li id="type-decode_kont.stream_name" class="def record field anchored"><a href="#type-decode_kont.stream_name" class="anchor"></a><code><span>stream_name : string;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Decoding continuation step.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_stream"><a href="#val-make_stream" class="anchor"></a><code><span><span class="keyword">val</span> make_stream : 
  <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">bytes</span>:<a href="../../Tezos_lazy_containers/Chunked_byte_vector/index.html#type-t">Tezos_lazy_containers.Chunked_byte_vector.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-stream">stream</a></span></code></div><div class="spec-doc"><p><code>make_stream filename bytes</code> returns a new stream to decode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initial_decode_kont"><a href="#val-initial_decode_kont" class="anchor"></a><code><span><span class="keyword">val</span> initial_decode_kont : <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span> <a href="#type-decode_kont">decode_kont</a></span></code></div><div class="spec-doc"><p><code>initial_decode_kont ~name</code> returns the initial tick state to be fed to <code>module_step</code>, such that <code>name</code> is the name of the input (generally the name of the file that contains said input).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-module_step"><a href="#val-module_step" class="anchor"></a><code><span><span class="keyword">val</span> module_step : 
  <span><span class="label">allow_floats</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_lazy_containers/Chunked_byte_vector/index.html#type-t">Tezos_lazy_containers.Chunked_byte_vector.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-decode_kont">decode_kont</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-decode_kont">decode_kont</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>module_step ~allow_floats stream kont</code> takes one step of parsing from a continuation and returns a new continuation. Fails when the continuation of the module is <code>MKStop</code> since it cannot reduce.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Floating_point.Error</code> <p>if it decodes a float instruction or type and <code>allow_floats</code> is false.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode"><a href="#val-decode" class="anchor"></a><code><span><span class="keyword">val</span> decode : 
  <span><span class="label">allow_floats</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">bytes</span>:<a href="../../Tezos_lazy_containers/Chunked_byte_vector/index.html#type-t">Tezos_lazy_containers.Chunked_byte_vector.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Ast/index.html#type-module_">Ast.module_</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>decode ~name ~bytes</code> decodes a module <code>name</code> from its <code>bytes</code> encoding.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Code"><code>Code</code></a> <p>on parsing errors.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Floating_point.Error</code> <p>if it decodes a float instruction or type and <code>allow_floats</code> is false.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decode_custom"><a href="#val-decode_custom" class="anchor"></a><code><span><span class="keyword">val</span> decode_custom : 
  <span><a href="../Ast/index.html#type-name">Ast.name</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">bytes</span>:<a href="../../Tezos_lazy_containers/Chunked_byte_vector/index.html#type-t">Tezos_lazy_containers.Chunked_byte_vector.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>decode ~name ~bytes</code> decodes a custom section of name <code>name</code> from its <code>bytes</code> encoding.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Code"><code>Code</code></a> <p>on parsing errors.</p></li></ul></div></div></div></body></html>
