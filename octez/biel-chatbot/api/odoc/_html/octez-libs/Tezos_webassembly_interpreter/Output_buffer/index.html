<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Output_buffer (octez-libs.Tezos_webassembly_interpreter.Output_buffer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-libs</a> &#x00BB; <a href="../index.html">Tezos_webassembly_interpreter</a> &#x00BB; Output_buffer</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_webassembly_interpreter.Output_buffer</span></code></h1><p>This module implements a bounded FIFO queue to model the outputs. Each element of the queue is a list of outbox messages produced on this level.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-output_info"><a href="#type-output_info" class="anchor"></a><code><span><span class="keyword">type</span> output_info</span><span> = </span><span>{</span></code><ol><li id="type-output_info.outbox_level" class="def record field anchored"><a href="#type-output_info.outbox_level" class="anchor"></a><code><span>outbox_level : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The outbox level at which the message exists.</p><span class="comment-delim">*)</span></div></li><li id="type-output_info.message_index" class="def record field anchored"><a href="#type-output_info.message_index" class="anchor"></a><code><span>message_index : <span class="xref-unresolved">Z</span>.t;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The index of the message in the outbox.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Non_initialized_outbox"><a href="#exception-Non_initialized_outbox" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Non_initialized_outbox</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Already_initialized_outbox"><a href="#exception-Already_initialized_outbox" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Already_initialized_outbox</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_outbox_limit"><a href="#exception-Invalid_outbox_limit" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_outbox_limit</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Full_outbox"><a href="#exception-Full_outbox" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Full_outbox</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Outdated_level"><a href="#exception-Outdated_level" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Outdated_level</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_level"><a href="#exception-Invalid_level" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_level</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_id"><a href="#exception-Invalid_id" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_id</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_diff"><a href="#exception-Invalid_diff" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_diff</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Messages"><a href="#module-Messages" class="anchor"></a><code><span><span class="keyword">module</span> Messages</span><span> = <a href="../../Tezos_lazy_containers/Lazy_vector/Mutable/ZVector/index.html">Tezos_lazy_containers.Lazy_vector.Mutable.ZVector</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Outboxes"><a href="#module-Outboxes" class="anchor"></a><code><span><span class="keyword">module</span> Outboxes</span><span> = <a href="../../Tezos_lazy_containers/Lazy_map/Mutable/LwtInt32Map/index.html">Tezos_lazy_containers.Lazy_map.Mutable.LwtInt32Map</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.outboxes" class="def record field anchored"><a href="#type-t.outboxes" class="anchor"></a><code><span>outboxes : <span><span>bytes <a href="../../Tezos_lazy_containers/Lazy_vector/Mutable/ZVector/index.html#type-t">Messages.t</a></span> <a href="../../Tezos_lazy_containers/Lazy_map/Mutable/LwtInt32Map/index.html#type-t">Outboxes.t</a></span>;</span></code></li><li id="type-t.last_level" class="def record field anchored"><a href="#type-t.last_level" class="anchor"></a><code><span><span class="keyword">mutable</span> last_level : <span>int32 option</span>;</span></code></li><li id="type-t.validity_period" class="def record field anchored"><a href="#type-t.validity_period" class="anchor"></a><code><span>validity_period : int32;</span></code></li><li id="type-t.message_limit" class="def record field anchored"><a href="#type-t.message_limit" class="anchor"></a><code><span>message_limit : <span class="xref-unresolved">Z</span>.t;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Limit of messages per outbox</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alloc"><a href="#val-alloc" class="anchor"></a><code><span><span class="keyword">val</span> alloc : 
  <span><span class="label">validity_period</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">message_limit</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">last_level</span>:<span>int32 option</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>alloc ~validity_period ~last_level</code> allocates a new output_buffer. If <code>last_level</code> is <code>Some level</code>, the corresponding outbox is allocated.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_initialized"><a href="#val-is_initialized" class="anchor"></a><code><span><span class="keyword">val</span> is_initialized : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_initialized buffer</code> returns <code>true</code> if the output buffer has been initialized.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initialize_outbox"><a href="#val-initialize_outbox" class="anchor"></a><code><span><span class="keyword">val</span> initialize_outbox : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>initialize_outbox buffer level</code> initialize the output_buffer with a fresh inbox at the given level.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Already_initialized_outbox"><code>Already_initialized_outbox</code></a> <p>if the output_buffer has already been initialized</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-move_outbox_forward"><a href="#val-move_outbox_forward" class="anchor"></a><code><span><span class="keyword">val</span> move_outbox_forward : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>move_outbox_forward outboxes</code> increments the last level of the outbox, allocates a new outbox and removes the outbox at the previous first level, according to the validity period.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Non_initialized_outbox"><code>Non_initialized_outbox</code></a> <p>if the output buffer has never been initialized.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push_message"><a href="#val-push_message" class="anchor"></a><code><span><span class="keyword">val</span> push_message : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>bytes <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-output_info">output_info</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>push_message outboxes msg</code> push a new message in the last outbox, and returns the its level and index in the outbox.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Full_outbox"><code>Full_outbox</code></a> <p>if the last outbox is full.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_outbox"><a href="#val-get_outbox" class="anchor"></a><code><span><span class="keyword">val</span> get_outbox : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> <span><span>bytes <a href="../../Tezos_lazy_containers/Lazy_vector/ZVector/index.html#type-t">Messages.Vector.t</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_outbox outboxes level</code> returns the outbox for the given <code>level</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Invalid_level"><code>Invalid_level</code></a> <p>if no outbox exists for the given level.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Outdated_level"><code>Outdated_level</code></a> <p>if the outbox is outdated according to the validity period.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_message"><a href="#val-get_message" class="anchor"></a><code><span><span class="keyword">val</span> get_message : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-output_info">output_info</a> <span class="arrow">&#45;&gt;</span></span> <span>bytes <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_message outboxes message_info</code> finds a message in the output buffer.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Invalid_level"><code>Invalid_level</code></a> <p>if no outbox exists for the given level.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Outdated_level"><code>Outdated_level</code></a> <p>if the outbox is outdated according to the validity period.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Invalid_id"><code>Invalid_id</code></a> <p>if no message with the given id exists in the outbox at this level.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-snapshot"><a href="#val-snapshot" class="anchor"></a><code><span><span class="keyword">val</span> snapshot : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>sandbox outboxes</code> create a snapshot of the outbox. You can modify original one, snapshotted one will stay untouched.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
