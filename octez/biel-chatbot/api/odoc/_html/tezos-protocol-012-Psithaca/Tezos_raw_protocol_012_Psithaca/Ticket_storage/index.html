<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ticket_storage (tezos-protocol-012-Psithaca.Tezos_raw_protocol_012_Psithaca.Ticket_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-012-Psithaca</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_012_Psithaca</a> &#x00BB; Ticket_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_012_Psithaca.Ticket_storage</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-key_hash"><a href="#type-key_hash" class="anchor"></a><code><span><span class="keyword">type</span> key_hash</span></code></div><div class="spec-doc"><p>A value of type <code>key_hash</code> is a hashed combination of:</p><ul><li>Ticketer</li><li>Content type</li><li>Content</li><li>Owner</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-script_expr_hash_of_key_hash"><a href="#val-script_expr_hash_of_key_hash" class="anchor"></a><code><span><span class="keyword">val</span> script_expr_hash_of_key_hash : <span><a href="#type-key_hash">key_hash</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Script_expr_hash/index.html#type-t">Script_expr_hash.t</a></span></code></div><div class="spec-doc"><p><code>script_expr_hash_of_key_hash key_hash</code> returns a <code>Script_expr_hash.t</code> value representation of the given <code>key_hash</code>. This is useful for comparing and pretty-printing key-hash values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_key_hash"><a href="#val-make_key_hash" class="anchor"></a><code><span><span class="keyword">val</span> make_key_hash : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ticketer</span>:<a href="../Script_repr/index.html#type-node">Script_repr.node</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">typ</span>:<a href="../Script_repr/index.html#type-node">Script_repr.node</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">contents</span>:<a href="../Script_repr/index.html#type-node">Script_repr.node</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">owner</span>:<a href="../Script_repr/index.html#type-node">Script_repr.node</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-key_hash">key_hash</a> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_012_Psithaca/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_012_Psithaca.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>make_key_hash ctxt ~ticketer ~typ ~contents ~owner</code> creates a hashed representation of the given <code>ticketer</code>, <code>typ</code>, <code>contents</code> and <code>owner</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_balance"><a href="#val-get_balance" class="anchor"></a><code><span><span class="keyword">val</span> get_balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key_hash">key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="../../Tezos_protocol_environment_012_Psithaca/Z/index.html#type-t">Tezos_protocol_environment_012_Psithaca.Z.t</a> option</span> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_012_Psithaca/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_012_Psithaca.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_012_Psithaca/Lwt/index.html#type-t">Tezos_protocol_environment_012_Psithaca.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_balance ctxt key</code> receives the ticket balance for the given <code>key</code> in the context <code>ctxt</code>. The <code>key</code> represents a ticket content and a ticket creator pair. In case there exists no value for the given <code>key</code>, <code>None</code> is returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-adjust_balance"><a href="#val-adjust_balance" class="anchor"></a><code><span><span class="keyword">val</span> adjust_balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-key_hash">key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delta</span>:<a href="../../Tezos_protocol_environment_012_Psithaca/Z/index.html#type-t">Tezos_protocol_environment_012_Psithaca.Z.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_protocol_environment_012_Psithaca/Z/index.html#type-t">Tezos_protocol_environment_012_Psithaca.Z.t</a> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_012_Psithaca/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_012_Psithaca.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_012_Psithaca/Lwt/index.html#type-t">Tezos_protocol_environment_012_Psithaca.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>adjust_balance ctxt key ~delta</code> adjusts the balance of the given key (representing a ticket content, creator and owner pair) and <code>delta</code>. The value of <code>delta</code> can be positive as well as negative. If there is no pre-exising balance for the given ticket type and owner, it is assumed to be 0 and the new balance is <code>delta</code>. The function also returns the difference between the old and the new size of the storage. Note that the difference may be negative. For example, because when setting the balance to zero, an entry is removed.</p><p>The function fails with a <code>Negative_ticket_balance</code> error in case the resulting balance is negative.</p></div></div></div></body></html>
