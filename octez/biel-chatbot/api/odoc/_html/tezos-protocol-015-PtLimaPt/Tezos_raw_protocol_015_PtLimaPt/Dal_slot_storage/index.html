<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dal_slot_storage (tezos-protocol-015-PtLimaPt.Tezos_raw_protocol_015_PtLimaPt.Dal_slot_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-015-PtLimaPt</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_015_PtLimaPt</a> &#x00BB; Dal_slot_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_015_PtLimaPt.Dal_slot_storage</span></code></h1><p>Storage management of slots for the data-availability layer.</p></header><nav class="odoc-toc"><ul><li><a href="#overview">Overview</a></li></ul></nav><div class="odoc-content"><h2 id="overview"><a href="#overview" class="anchor"></a>Overview</h2><p>This module is an interface for the slot storage for the layer 1.</p><p>Depending on the current level of the context and the <code>lag</code> (a constant given by the context), the status of the slot may differ:</p><ul><li>For every level in the interval <code>current_level; current_level +
   lag -1</code> the slot is <code>Pending</code>. This means a slot header was proposed but was not declared available yet.</li></ul><ul><li>For every level above <code>current_level + lag</code>, the slot may be <code>confirmed</code>. For any slot confirmed by the protocol (i.e. indices returned by <code>finalize_pending_slots</code>), subscribers of the DAL should take into account the corresponding slots.</li></ul><ul><li>For every level below <code>current_level - lag</code>, there should not be any slot in the storage.</li></ul><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span><a href="../Dal_slot_repr/index.html#type-t">Dal_slot_repr.t</a> list</span> option</span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find ctxt level</code> returns <code>Some slots</code> where <code>slots</code> are pending slots at level <code>level</code>. <code>None</code> is returned if no <code>slot</code> was registered at this level. The function fails if the reading into the context fails.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_current_slots"><a href="#val-finalize_current_slots" class="anchor"></a><code><span><span class="keyword">val</span> finalize_current_slots : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>finalize_current_slots ctxt</code> finalizes the current slots posted on this block and marks them as pending into the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_pending_slots"><a href="#val-finalize_pending_slots" class="anchor"></a><code><span><span class="keyword">val</span> finalize_pending_slots : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Dal_endorsement_repr/index.html#type-t">Dal_endorsement_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>finalize_pending_slots ctxt</code> finalizes pending slots which are old enough (i.e. registered at level <code>current_level - lag</code>). All slots marked as available are returned. All the pending slots at <code>current_level - lag</code> level are removed from the context.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_slots_history"><a href="#val-get_slots_history" class="anchor"></a><code><span><span class="keyword">val</span> get_slots_history : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Dal_slot_repr/Slots_history/index.html#type-t">Dal_slot_repr.Slots_history.t</a>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_slots_history ctxt</code> returns the current value of slots_history stored in <code>ctxt</code>, or Slots_history.genesis if no value is stored yet.</p></div></div></div></body></html>
