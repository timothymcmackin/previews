<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Consensus (tezos-protocol-015-PtLimaPt.Tezos_raw_protocol_015_PtLimaPt.Alpha_context.Consensus)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-protocol-015-PtLimaPt</a> &#x00BB; <a href="../../index.html">Tezos_raw_protocol_015_PtLimaPt</a> &#x00BB; <a href="../index.html">Alpha_context</a> &#x00BB; Consensus</nav><header class="odoc-preamble"><h1>Module <code><span>Alpha_context.Consensus</span></code></h1><p>This module re-exports definitions from <a href="../../Raw_context/Consensus/index.html"><code>Raw_context.Consensus</code></a>.</p></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../Raw_context/module-type-CONSENSUS/index.html">Raw_context.CONSENSUS</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Raw_context/module-type-CONSENSUS/index.html#type-t">t</a> := <a href="../index.html#type-t">t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Raw_context/module-type-CONSENSUS/index.html#type-slot">slot</a> := <a href="../Slot/index.html#type-t">Slot.t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <span>'a <a href="../../Raw_context/module-type-CONSENSUS/index.html#type-slot_map">slot_map</a></span> := <span><span class="type-var">'a</span> <a href="../Slot/Map/index.html#type-t">Slot.Map.t</a></span></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Raw_context/module-type-CONSENSUS/index.html#type-slot_set">slot_set</a> := <a href="../Slot/Set/index.html#type-t">Slot.Set.t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Raw_context/module-type-CONSENSUS/index.html#type-round">round</a> := <a href="../Round/index.html#type-t">Round.t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Raw_context/module-type-CONSENSUS/index.html#type-consensus_pk">consensus_pk</a> := <a href="../Consensus_key/index.html#type-pk">Consensus_key.pk</a></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-allowed_endorsements"><a href="#val-allowed_endorsements" class="anchor"></a><code><span><span class="keyword">val</span> allowed_endorsements : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Consensus_key/index.html#type-pk">Consensus_key.pk</a> * int)</span> <a href="../Slot/Map/index.html#type-t">Slot.Map.t</a></span></span></code></div><div class="spec-doc"><p>Returns a map where each endorser's pkh is associated to the list of its endorsing slots (in decreasing order) for a given level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allowed_preendorsements"><a href="#val-allowed_preendorsements" class="anchor"></a><code><span><span class="keyword">val</span> allowed_preendorsements : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Consensus_key/index.html#type-pk">Consensus_key.pk</a> * int)</span> <a href="../Slot/Map/index.html#type-t">Slot.Map.t</a></span></span></code></div><div class="spec-doc"><p>Returns a map where each endorser's pkh is associated to the list of its endorsing slots (in decreasing order) for a given level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_endorsement_power"><a href="#val-current_endorsement_power" class="anchor"></a><code><span><span class="keyword">val</span> current_endorsement_power : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>endorsement power ctx</code> returns the endorsement power of the current block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initialize_consensus_operation"><a href="#val-initialize_consensus_operation" class="anchor"></a><code><span><span class="keyword">val</span> initialize_consensus_operation : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">allowed_endorsements</span>:<span><span>(<a href="../Consensus_key/index.html#type-pk">Consensus_key.pk</a> * int)</span> <a href="../Slot/Map/index.html#type-t">Slot.Map.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">allowed_preendorsements</span>:<span><span>(<a href="../Consensus_key/index.html#type-pk">Consensus_key.pk</a> * int)</span> <a href="../Slot/Map/index.html#type-t">Slot.Map.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../index.html#type-t">t</a></span></code></div><div class="spec-doc"><p>Initializes the map of allowed endorsements and preendorsements, this function must be called only once and before applying any consensus operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_grand_parent_endorsement"><a href="#val-record_grand_parent_endorsement" class="anchor"></a><code><span><span class="keyword">val</span> record_grand_parent_endorsement : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Tezos_protocol_environment_015_PtLimaPt/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-t">t</a> <a href="../../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>record_grand_parent_endorsement ctx pkh</code> records an grand_parent_endorsement for the current block. This is only useful for the partial construction mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_endorsement"><a href="#val-record_endorsement" class="anchor"></a><code><span><span class="keyword">val</span> record_endorsement : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">initial_slot</span>:<a href="../Slot/index.html#type-t">Slot.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">power</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-t">t</a> <a href="../../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>record_endorsement ctx ~initial_slot ~power</code> records an endorsement for the current block.</p><p>The endorsement should be valid in the sense that <code>Int_map.find_opt initial_slot allowed_endorsement ctx = Some
      (pkh, power)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_preendorsement"><a href="#val-record_preendorsement" class="anchor"></a><code><span><span class="keyword">val</span> record_preendorsement : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">initial_slot</span>:<a href="../Slot/index.html#type-t">Slot.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">power</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Round/index.html#type-t">Round.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-t">t</a> <a href="../../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>record_preendorsement ctx ~initial_slot ~power round
     payload_hash power</code> records a preendorsement for a proposal at <code>round</code> with payload <code>payload_hash</code>.</p><p>The preendorsement should be valid in the sense that <code>Int_map.find_opt initial_slot allowed_preendorsement ctx = Some
     (pkh, power)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-endorsements_seen"><a href="#val-endorsements_seen" class="anchor"></a><code><span><span class="keyword">val</span> endorsements_seen : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Slot/Set/index.html#type-t">Slot.Set.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_preendorsements_quorum_round"><a href="#val-get_preendorsements_quorum_round" class="anchor"></a><code><span><span class="keyword">val</span> get_preendorsements_quorum_round : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Round/index.html#type-t">Round.t</a> option</span></span></code></div><div class="spec-doc"><p><code>get_preendorsements_quorum_round ctx</code> returns <code>None</code> if no preendorsement are included in the current block. Otherwise, return <code>Some r</code> where <code>r</code> is the round of the preendorsements included in the block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_preendorsements_quorum_round"><a href="#val-set_preendorsements_quorum_round" class="anchor"></a><code><span><span class="keyword">val</span> set_preendorsements_quorum_round : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Round/index.html#type-t">Round.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-t">t</a></span></code></div><div class="spec-doc"><p><code>set_preendorsements_quorum_round ctx round</code> sets the round for preendorsements included in this block. This function should be called only once.</p><p>This function is only used in <code>Full_construction</code> mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-locked_round_evidence"><a href="#val-locked_round_evidence" class="anchor"></a><code><span><span class="keyword">val</span> locked_round_evidence : <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Round/index.html#type-t">Round.t</a> * int)</span> option</span></span></code></div><div class="spec-doc"><p><code>locked_round_evidence ctx</code> returns the round of the recorded preendorsements as well as their power.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_endorsement_branch"><a href="#val-set_endorsement_branch" class="anchor"></a><code><span><span class="keyword">val</span> set_endorsement_branch : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../Tezos_protocol_environment_015_PtLimaPt/Block_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Block_hash.t</a> * <a href="../../Block_payload_hash/index.html#type-t">Block_payload_hash.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../index.html#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-endorsement_branch"><a href="#val-endorsement_branch" class="anchor"></a><code><span><span class="keyword">val</span> endorsement_branch : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../Tezos_protocol_environment_015_PtLimaPt/Block_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Block_hash.t</a> * <a href="../../Block_payload_hash/index.html#type-t">Block_payload_hash.t</a>)</span>
    option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_grand_parent_branch"><a href="#val-set_grand_parent_branch" class="anchor"></a><code><span><span class="keyword">val</span> set_grand_parent_branch : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../Tezos_protocol_environment_015_PtLimaPt/Block_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Block_hash.t</a> * <a href="../../Block_payload_hash/index.html#type-t">Block_payload_hash.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../index.html#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-grand_parent_branch"><a href="#val-grand_parent_branch" class="anchor"></a><code><span><span class="keyword">val</span> grand_parent_branch : 
  <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../Tezos_protocol_environment_015_PtLimaPt/Block_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Block_hash.t</a> * <a href="../../Block_payload_hash/index.html#type-t">Block_payload_hash.t</a>)</span>
    option</span></span></code></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-store_endorsement_branch"><a href="#val-store_endorsement_branch" class="anchor"></a><code><span><span class="keyword">val</span> store_endorsement_branch : 
  <span><a href="../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../Tezos_protocol_environment_015_PtLimaPt/Block_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Block_hash.t</a> * <a href="../../Block_payload_hash/index.html#type-t">Block_payload_hash.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-context">context</a> <a href="../../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>store_endorsement_branch context branch</code> sets the &quot;endorsement branch&quot; (see <a href="../../Storage/Tenderbake/Endorsement_branch/index.html"><code>Storage.Tenderbake.Endorsement_branch</code></a> to <code>branch</code> in both the disk storage and RAM.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-store_grand_parent_branch"><a href="#val-store_grand_parent_branch" class="anchor"></a><code><span><span class="keyword">val</span> store_grand_parent_branch : 
  <span><a href="../index.html#type-context">context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../Tezos_protocol_environment_015_PtLimaPt/Block_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Block_hash.t</a> * <a href="../../Block_payload_hash/index.html#type-t">Block_payload_hash.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-context">context</a> <a href="../../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>store_grand_parent_branch context branch</code> sets the &quot;grand-parent branch&quot; (see <a href="../../Storage/Tenderbake/Grand_parent_branch/index.html"><code>Storage.Tenderbake.Grand_parent_branch</code></a> to <code>branch</code> in both the disk storage and RAM.</p></div></div></div></body></html>
