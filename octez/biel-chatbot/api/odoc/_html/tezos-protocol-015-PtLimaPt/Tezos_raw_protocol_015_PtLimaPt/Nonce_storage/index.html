<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Nonce_storage (tezos-protocol-015-PtLimaPt.Tezos_raw_protocol_015_PtLimaPt.Nonce_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-015-PtLimaPt</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_015_PtLimaPt</a> &#x00BB; Nonce_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_015_PtLimaPt.Nonce_storage</span></code></h1><p>This module provides types and functions to manipulate nonces.</p><p>A nonce is a byte sequence of fixed length, which is supposed to be random and used only once, provided by a block producer and used to generate a random seed (see <a href="../Seed_repr/index.html"><code>Seed_repr</code></a>).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <a href="../Seed_repr/index.html#type-nonce">Seed_repr.nonce</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-nonce"><a href="#type-nonce" class="anchor"></a><code><span><span class="keyword">type</span> nonce</span><span> = <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Too_late_revelation"><a href="#extension-decl-Too_late_revelation" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-error">Tezos_protocol_environment_015_PtLimaPt.Error_monad.error</a> += </span></code><ol><li id="extension-Too_late_revelation" class="def variant extension anchored"><a href="#extension-Too_late_revelation" class="anchor"></a><code><span>| </span><span><span class="extension">Too_late_revelation</span></span></code></li><li id="extension-Too_early_revelation" class="def variant extension anchored"><a href="#extension-Too_early_revelation" class="anchor"></a><code><span>| </span><span><span class="extension">Too_early_revelation</span></span></code></li><li id="extension-Already_revealed_nonce" class="def variant extension anchored"><a href="#extension-Already_revealed_nonce" class="anchor"></a><code><span>| </span><span><span class="extension">Already_revealed_nonce</span></span></code></li><li id="extension-Inconsistent_nonce" class="def variant extension anchored"><a href="#extension-Inconsistent_nonce" class="anchor"></a><code><span>| </span><span><span class="extension">Inconsistent_nonce</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-nonce">nonce</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Data_encoding/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unrevealed"><a href="#type-unrevealed" class="anchor"></a><code><span><span class="keyword">type</span> unrevealed</span><span> = <a href="../Storage/Seed/index.html#type-unrevealed_nonce">Storage.Seed.unrevealed_nonce</a></span><span> = </span><span>{</span></code><ol><li id="type-unrevealed.nonce_hash" class="def record field anchored"><a href="#type-unrevealed.nonce_hash" class="anchor"></a><code><span>nonce_hash : <a href="../Nonce_hash/index.html#type-t">Nonce_hash.t</a>;</span></code></li><li id="type-unrevealed.delegate" class="def record field anchored"><a href="#type-unrevealed.delegate" class="anchor"></a><code><span>delegate : <a href="../../Tezos_protocol_environment_015_PtLimaPt/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Signature.Public_key_hash.t</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-status"><a href="#type-status" class="anchor"></a><code><span><span class="keyword">type</span> status</span><span> = </span></code><ol><li id="type-status.Unrevealed" class="def variant constructor anchored"><a href="#type-status.Unrevealed" class="anchor"></a><code><span>| </span><span><span class="constructor">Unrevealed</span> <span class="keyword">of</span> <a href="#type-unrevealed">unrevealed</a></span></code></li><li id="type-status.Revealed" class="def variant constructor anchored"><a href="#type-status.Revealed" class="anchor"></a><code><span>| </span><span><span class="constructor">Revealed</span> <span class="keyword">of</span> <a href="../Seed_repr/index.html#type-nonce">Seed_repr.nonce</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Level_repr/index.html#type-t">Level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-status">status</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-nonce_presence"><a href="#type-nonce_presence" class="anchor"></a><code><span><span class="keyword">type</span> nonce_presence</span><span> = </span></code><ol><li id="type-nonce_presence.No_nonce_expected" class="def variant constructor anchored"><a href="#type-nonce_presence.No_nonce_expected" class="anchor"></a><code><span>| </span><span><span class="constructor">No_nonce_expected</span></span></code></li><li id="type-nonce_presence.Nonce_expected" class="def variant constructor anchored"><a href="#type-nonce_presence.Nonce_expected" class="anchor"></a><code><span>| </span><span><span class="constructor">Nonce_expected</span> <span class="keyword">of</span> <a href="#type-status">status</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check"><a href="#val-check" class="anchor"></a><code><span><span class="keyword">val</span> check : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Level_repr/index.html#type-t">Level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-nonce_presence">nonce_presence</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-record_hash"><a href="#val-record_hash" class="anchor"></a><code><span><span class="keyword">val</span> record_hash : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-unrevealed">unrevealed</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_unrevealed"><a href="#val-check_unrevealed" class="anchor"></a><code><span><span class="keyword">val</span> check_unrevealed : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Level_repr/index.html#type-t">Level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Checks that a nonce revelation operation can be safely applied.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Too_early_revelation</code> if the current cycle is the cycle 0 or if the previous cycle is lesser than the cycle of the input level.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Too_late_revelation</code> if the previous cycle is greater than the cycle of the input level. This error is also returned if the current level cycle position is greater or equal to the nonce revelation threshold.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Already_revealed_nonce</code> if a nonce is already revealed in the context for the input level.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Inconsistent_nonce</code> if the hash of the input nonce does not correspond to the nonce recover from the context for the given level.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reveal"><a href="#val-reveal" class="anchor"></a><code><span><span class="keyword">val</span> reveal : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Level_repr/index.html#type-t">Level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_015_PtLimaPt/Lwt/index.html#type-t">Tezos_protocol_environment_015_PtLimaPt.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_bytes"><a href="#val-of_bytes" class="anchor"></a><code><span><span class="keyword">val</span> of_bytes : 
  <span>bytes <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-nonce">nonce</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Nonce_hash/index.html#type-t">Nonce_hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_hash"><a href="#val-check_hash" class="anchor"></a><code><span><span class="keyword">val</span> check_hash : <span><a href="#type-nonce">nonce</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Nonce_hash/index.html#type-t">Nonce_hash.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div></div></body></html>
