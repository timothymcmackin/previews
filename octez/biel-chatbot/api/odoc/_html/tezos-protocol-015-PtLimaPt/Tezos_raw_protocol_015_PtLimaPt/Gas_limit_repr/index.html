<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gas_limit_repr (tezos-protocol-015-PtLimaPt.Tezos_raw_protocol_015_PtLimaPt.Gas_limit_repr)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-015-PtLimaPt</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_015_PtLimaPt</a> &#x00BB; Gas_limit_repr</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_015_PtLimaPt.Gas_limit_repr</span></code></h1><p>Internal representation of the gas limit available to the node baking a new block. It should be proportional to the time and energy required to perform a computation.</p><p>This protects the bakers from performing exceedingly costly computations while baking and also allows them to select cheaper-to-compute operations to include in their blocks, as their reward for baking a block is not directly related to the resources consumed by the machine performing the operation.</p><p>It can be <code>Unaccounted</code> (unlimited) or <code>Limited</code> to some fixed-point value (see <code>Fixed_point_repr</code> for the details). The value is represented with 3 decimal places of precision.</p><p>All computations on gas are performed in saturation arithmetic (see <code>Saturation_repr</code>) bounded between <code>0</code> and <code>2 ^ 62 - 1</code></p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Arith"><a href="#module-Arith" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Arith/index.html">Arith</a></span><span> : 
  <a href="../Fixed_point_repr/module-type-Full/index.html">Fixed_point_repr.Full</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../Fixed_point_repr/module-type-Full/index.html#type-t">t</a></span> = <span class="keyword">private</span> <span><a href="../Saturation_repr/index.html#type-may_saturate">Saturation_repr.may_saturate</a> <a href="../Saturation_repr/index.html#type-t">Saturation_repr.t</a></span></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span></code><ol><li id="type-t.Unaccounted" class="def variant constructor anchored"><a href="#type-t.Unaccounted" class="anchor"></a><code><span>| </span><span><span class="constructor">Unaccounted</span></span></code></li><li id="type-t.Limited" class="def variant constructor anchored"><a href="#type-t.Limited" class="anchor"></a><code><span>| </span><span><span class="constructor">Limited</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-t.remaining" class="def record field anchored"><a href="#type-t.remaining" class="anchor"></a><code><span>remaining : <a href="Arith/index.html#type-fp">Arith.fp</a>;</span></code></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-t">t</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Data_encoding/index.html#type-encoding">Tezos_protocol_environment_015_PtLimaPt.Data_encoding.encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../Tezos_protocol_environment_015_PtLimaPt/Format/index.html#type-formatter">Tezos_protocol_environment_015_PtLimaPt.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-cost"><a href="#type-cost" class="anchor"></a><code><span><span class="keyword">type</span> cost</span><span> = <span><a href="../Saturation_repr/index.html#type-may_saturate">Saturation_repr.may_saturate</a> <a href="../Saturation_repr/index.html#type-t">Saturation_repr.t</a></span></span></code></div><div class="spec-doc"><p>Represents a gas cost of an operation. The gas model is constructed such that the cost of each operation is roughly proportional to the time required to perform the operation. If the gas cost of an operation exceeds the available limit, such an operation is rejected. This is especially meant to protect bakers against DoS attacks.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cost_encoding"><a href="#val-cost_encoding" class="anchor"></a><code><span><span class="keyword">val</span> cost_encoding : 
  <span><a href="#type-cost">cost</a> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Data_encoding/index.html#type-encoding">Tezos_protocol_environment_015_PtLimaPt.Data_encoding.encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_cost"><a href="#val-pp_cost" class="anchor"></a><code><span><span class="keyword">val</span> pp_cost : 
  <span><a href="../../Tezos_protocol_environment_015_PtLimaPt/Format/index.html#type-formatter">Tezos_protocol_environment_015_PtLimaPt.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-cost">cost</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_cost_as_gas"><a href="#val-pp_cost_as_gas" class="anchor"></a><code><span><span class="keyword">val</span> pp_cost_as_gas : 
  <span><a href="../../Tezos_protocol_environment_015_PtLimaPt/Format/index.html#type-formatter">Tezos_protocol_environment_015_PtLimaPt.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-cost">cost</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Print the gas cost as gas unit</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-raw_consume"><a href="#val-raw_consume" class="anchor"></a><code><span><span class="keyword">val</span> raw_consume : <span><a href="Arith/index.html#type-fp">Arith.fp</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-cost">cost</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Arith/index.html#type-fp">Arith.fp</a> option</span></span></code></div><div class="spec-doc"><p>Subtracts the cost from the current limit. Returns <code>None</code> if the limit would fall below <code>0</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-free"><a href="#val-free" class="anchor"></a><code><span><span class="keyword">val</span> free : <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>The cost of free operation is <code>0</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cost_of_gas"><a href="#val-cost_of_gas" class="anchor"></a><code><span><span class="keyword">val</span> cost_of_gas : <span><span><span class="type-var">'a</span> <a href="Arith/index.html#type-t">Arith.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Convert a fixed-point amount of gas to a cost.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fp_of_milligas_int"><a href="#val-fp_of_milligas_int" class="anchor"></a><code><span><span class="keyword">val</span> fp_of_milligas_int : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="Arith/index.html#type-fp">Arith.fp</a></span></code></div><div class="spec-doc"><p>Convert an amount of milligas expressed as a value of type <code>int</code> to <code>Arith.fp</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-atomic_step_cost"><a href="#val-atomic_step_cost" class="anchor"></a><code><span><span class="keyword">val</span> atomic_step_cost : <span><span><span class="type-var">_</span> <a href="../Saturation_repr/index.html#type-t">Saturation_repr.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p><code>atomic_step_cost x</code> corresponds to <code>x</code> milliunit of gas.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-step_cost"><a href="#val-step_cost" class="anchor"></a><code><span><span class="keyword">val</span> step_cost : <span><span><span class="type-var">_</span> <a href="../Saturation_repr/index.html#type-t">Saturation_repr.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p><code>step_cost x</code> corresponds to <code>x</code> units of gas.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alloc_cost"><a href="#val-alloc_cost" class="anchor"></a><code><span><span class="keyword">val</span> alloc_cost : <span><span><span class="type-var">_</span> <a href="../Saturation_repr/index.html#type-t">Saturation_repr.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Cost of allocating qwords of storage.</p><p><code>alloc_cost n</code> estimates the cost of allocating <code>n</code> qwords of storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alloc_bytes_cost"><a href="#val-alloc_bytes_cost" class="anchor"></a><code><span><span class="keyword">val</span> alloc_bytes_cost : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Cost of allocating bytes in the storage.</p><p><code>alloc_bytes_cost b</code> estimates the cost of allocating <code>b</code> bytes of storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alloc_mbytes_cost"><a href="#val-alloc_mbytes_cost" class="anchor"></a><code><span><span class="keyword">val</span> alloc_mbytes_cost : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Cost of allocating bytes in the storage.</p><p><code>alloc_mbytes_cost b</code> estimates the cost of allocating <code>b</code> bytes of storage and the cost of a header to describe these bytes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_bytes_cost"><a href="#val-read_bytes_cost" class="anchor"></a><code><span><span class="keyword">val</span> read_bytes_cost : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Cost of reading the storage.</p><p><code>read_bytes_const n</code> estimates the cost of reading <code>n</code> bytes of storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_bytes_cost"><a href="#val-write_bytes_cost" class="anchor"></a><code><span><span class="keyword">val</span> write_bytes_cost : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Cost of writing to storage.</p><p><code>write_bytes_const n</code> estimates the cost of writing <code>n</code> bytes to the storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(*@)"><a href="#val-(*@)" class="anchor"></a><code><span><span class="keyword">val</span> (*@) : <span><span><span class="type-var">_</span> <a href="../Saturation_repr/index.html#type-t">Saturation_repr.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-cost">cost</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Multiply a cost by a factor. Both arguments are saturated arithmetic values, so no negative numbers are involved.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(+@)"><a href="#val-(+@)" class="anchor"></a><code><span><span class="keyword">val</span> (+@) : <span><a href="#type-cost">cost</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-cost">cost</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-cost">cost</a></span></code></div><div class="spec-doc"><p>Add two costs together.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Gas_limit_too_high"><a href="#extension-decl-Gas_limit_too_high" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-error">Tezos_protocol_environment_015_PtLimaPt.Error_monad.error</a> += </span></code><ol><li id="extension-Gas_limit_too_high" class="def variant extension anchored"><a href="#extension-Gas_limit_too_high" class="anchor"></a><code><span>| </span><span><span class="extension">Gas_limit_too_high</span></span></code></li></ol></div><div class="spec-doc"><p>Ill-formed <code>gas_limit</code>: see <a href="#val-check_gas_limit"><code>check_gas_limit</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_gas_limit"><a href="#val-check_gas_limit" class="anchor"></a><code><span><span class="keyword">val</span> check_gas_limit : 
  <span><span class="label">hard_gas_limit_per_operation</span>:<a href="Arith/index.html#type-integral">Arith.integral</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">gas_limit</span>:<span><span class="type-var">'a</span> <a href="Arith/index.html#type-t">Arith.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../Tezos_protocol_environment_015_PtLimaPt/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_015_PtLimaPt.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Check that <code>gas_limit</code> is well-formed, i.e. it is at most the given <code>hard_gas_limit_per_operation</code>, and it is nonnegative.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Gas_limit_too_high</code> otherwise.</p></li></ul></div></div></div></body></html>
