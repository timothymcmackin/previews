<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Contract_storage (tezos-protocol-019-PtParisB.Tezos_raw_protocol_019_PtParisB.Contract_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-019-PtParisB</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_019_PtParisB</a> &#x00BB; Contract_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_019_PtParisB.Contract_storage</span></code></h1><p>Low-level handlers of raw contexts for base operations on contracts.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Balance_too_low"><a href="#extension-decl-Balance_too_low" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-error">Tezos_protocol_environment_019_PtParisB.Error_monad.error</a> += </span></code><ol><li id="extension-Balance_too_low" class="def variant extension anchored"><a href="#extension-Balance_too_low" class="anchor"></a><code><span>| </span><span><span class="extension">Balance_too_low</span> <span class="keyword">of</span> <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> * <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> * <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a></span></code></li><li id="extension-Counter_in_the_past" class="def variant extension anchored"><a href="#extension-Counter_in_the_past" class="anchor"></a><code><span>| </span><span><span class="extension">Counter_in_the_past</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Contract_storage.contract" class="def record field anchored"><a href="#module-Contract_storage.contract" class="anchor"></a><code><span>contract : <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a>;</span></code></li><li id="module-Contract_storage.expected" class="def record field anchored"><a href="#module-Contract_storage.expected" class="anchor"></a><code><span>expected : <a href="../Manager_counter_repr/index.html#type-t">Manager_counter_repr.t</a>;</span></code></li><li id="module-Contract_storage.found" class="def record field anchored"><a href="#module-Contract_storage.found" class="anchor"></a><code><span>found : <a href="../Manager_counter_repr/index.html#type-t">Manager_counter_repr.t</a>;</span></code></li></ol><code><span>}</span></code></li><li id="extension-Counter_in_the_future" class="def variant extension anchored"><a href="#extension-Counter_in_the_future" class="anchor"></a><code><span>| </span><span><span class="extension">Counter_in_the_future</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Contract_storage.contract" class="def record field anchored"><a href="#module-Contract_storage.contract" class="anchor"></a><code><span>contract : <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a>;</span></code></li><li id="module-Contract_storage.expected" class="def record field anchored"><a href="#module-Contract_storage.expected" class="anchor"></a><code><span>expected : <a href="../Manager_counter_repr/index.html#type-t">Manager_counter_repr.t</a>;</span></code></li><li id="module-Contract_storage.found" class="def record field anchored"><a href="#module-Contract_storage.found" class="anchor"></a><code><span>found : <a href="../Manager_counter_repr/index.html#type-t">Manager_counter_repr.t</a>;</span></code></li></ol><code><span>}</span></code></li><li id="extension-Non_existing_contract" class="def variant extension anchored"><a href="#extension-Non_existing_contract" class="anchor"></a><code><span>| </span><span><span class="extension">Non_existing_contract</span> <span class="keyword">of</span> <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a></span></code></li><li id="extension-Inconsistent_public_key" class="def variant extension anchored"><a href="#extension-Inconsistent_public_key" class="anchor"></a><code><span>| </span><span><span class="extension">Inconsistent_public_key</span> <span class="keyword">of</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key.t</a>
  * <a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key.t</a></span></code></li><li id="extension-Failure" class="def variant extension anchored"><a href="#extension-Failure" class="anchor"></a><code><span>| </span><span><span class="extension">Failure</span> <span class="keyword">of</span> string</span></code></li><li id="extension-Empty_implicit_contract" class="def variant extension anchored"><a href="#extension-Empty_implicit_contract" class="anchor"></a><code><span>| </span><span><span class="extension">Empty_implicit_contract</span> <span class="keyword">of</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key_hash.t</a></span></code></li><li id="extension-Empty_implicit_delegated_contract" class="def variant extension anchored"><a href="#extension-Empty_implicit_delegated_contract" class="anchor"></a><code><span>| </span><span><span class="extension">Empty_implicit_delegated_contract</span> <span class="keyword">of</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key_hash.t</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allocated"><a href="#val-allocated" class="anchor"></a><code><span><span class="keyword">val</span> allocated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>allocated ctxt contract</code> returns <code>true</code> if and only if the contract is stored in <a href="../Storage/Contract/Spendable_balance/index.html"><code>Storage.Contract.Spendable_balance</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exists"><a href="#val-exists" class="anchor"></a><code><span><span class="keyword">val</span> exists : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>exists ctxt contract</code> returns <code>true</code> if and only if either the contract is implicit or it is (originated and) <a href="#val-allocated"><code>allocated</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-must_exist"><a href="#val-must_exist" class="anchor"></a><code><span><span class="keyword">val</span> must_exist : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>must_exist ctxt contract</code> fails with the <code>Non_existing_contract</code> error if <code>exists ctxt contract</code> returns <code>false</code>. Even though this function is gas-free, it is always called in a context where some gas consumption is guaranteed whenever necessary. The first context is that of a transfer operation, and in that case the base cost of a manager operation (<code>Micheclson_v1_gas.Cost_of.manager_operation</code>) is consumed. The second context is that of an activation operation, and in that case no gas needs to be consumed since that operation is not a manager operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-must_be_allocated"><a href="#val-must_be_allocated" class="anchor"></a><code><span><span class="keyword">val</span> must_be_allocated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>must_be_allocated ctxt contract</code> fails when the contract is not allocated. It fails with <code>Non_existing_contract</code> if the contract is originated, and it fails with <code>Empty_implicit_contract</code> if the contract is implicit.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> list</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_counter_increment"><a href="#val-check_counter_increment" class="anchor"></a><code><span><span class="keyword">val</span> check_counter_increment : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Manager_counter_repr/index.html#type-t">Manager_counter_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-increment_counter"><a href="#val-increment_counter" class="anchor"></a><code><span><span class="keyword">val</span> increment_counter : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_balance"><a href="#val-get_balance" class="anchor"></a><code><span><span class="keyword">val</span> get_balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_balance ctxt contract</code> returns the balance of spendable tez owned by <code>contract</code> given raw context <code>ctxt</code>. This does not include the contract's frozen balances.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_balance_carbonated"><a href="#val-get_balance_carbonated" class="anchor"></a><code><span><span class="keyword">val</span> get_balance_carbonated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_allocated_and_get_balance"><a href="#val-check_allocated_and_get_balance" class="anchor"></a><code><span><span class="keyword">val</span> check_allocated_and_get_balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_019_PtParisB/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_019_PtParisB.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Return the balance of spendable tez owned by the Implicit contract of the given <code>public_key_hash</code>.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Empty_implicit_contract</code> if the contract is not allocated in <a href="../Storage/Contract/Spendable_balance/index.html"><code>Storage.Contract.Spendable_balance</code></a>.</p><p>This function is a fusion of <a href="#val-must_be_allocated"><code>must_be_allocated</code></a> and <a href="#val-get_balance"><code>get_balance</code></a> for Implicit contracts exclusively.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_counter"><a href="#val-get_counter" class="anchor"></a><code><span><span class="keyword">val</span> get_counter : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_019_PtParisB/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Manager_counter_repr/index.html#type-t">Manager_counter_repr.t</a>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_script_code"><a href="#val-get_script_code" class="anchor"></a><code><span><span class="keyword">val</span> get_script_code : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Script_repr/index.html#type-lazy_expr">Script_repr.lazy_expr</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_script"><a href="#val-get_script" class="anchor"></a><code><span><span class="keyword">val</span> get_script : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Script_repr/index.html#type-t">Script_repr.t</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_storage"><a href="#val-get_storage" class="anchor"></a><code><span><span class="keyword">val</span> get_storage : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Script_repr/index.html#type-expr">Script_repr.expr</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Legacy_big_map_diff"><a href="#module-Legacy_big_map_diff" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Legacy_big_map_diff/index.html">Legacy_big_map_diff</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_script_storage"><a href="#val-update_script_storage" class="anchor"></a><code><span><span class="keyword">val</span> update_script_storage : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Script_repr/index.html#type-expr">Script_repr.expr</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Lazy_storage_diff/index.html#type-diffs">Lazy_storage_diff.diffs</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-credit_only_call_from_token"><a href="#val-credit_only_call_from_token" class="anchor"></a><code><span><span class="keyword">val</span> credit_only_call_from_token : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-spend_only_call_from_token"><a href="#val-spend_only_call_from_token" class="anchor"></a><code><span><span class="keyword">val</span> spend_only_call_from_token : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-raw_originate"><a href="#val-raw_originate" class="anchor"></a><code><span><span class="keyword">val</span> raw_originate : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">prepaid_bootstrap_storage</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">script</span>:<span>(<a href="../Script_repr/index.html#type-t">Script_repr.t</a> * <span><a href="../Lazy_storage_diff/index.html#type-diffs">Lazy_storage_diff.diffs</a> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>raw_originate ctxt ~prepaid_bootstrap_storage contract ~script</code> originates the <code>contract</code> parameter. The <code>storage</code> space allocated by this origination is considered to be free of charge or to have been already paid for by the user, if and only if <code>prepaid_bootstrap_storage</code> is <code>true</code>. In particular, the amount of space allocated by this origination will be part of the consumed space to pay for returned by the next call to <code>Fees_storage.record_paid_storage_space ctxt contract</code>, if and only if <code>prepaid_bootstrap_storage</code> is <code>false</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fresh_contract_from_current_nonce"><a href="#val-fresh_contract_from_current_nonce" class="anchor"></a><code><span><span class="keyword">val</span> fresh_contract_from_current_nonce : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Contract_hash/index.html#type-t">Contract_hash.t</a>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-originated_from_current_nonce"><a href="#val-originated_from_current_nonce" class="anchor"></a><code><span><span class="keyword">val</span> originated_from_current_nonce : 
  <span><span class="label">since</span>:<a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">until</span>:<a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> list</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-used_storage_space"><a href="#val-used_storage_space" class="anchor"></a><code><span><span class="keyword">val</span> used_storage_space : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-paid_storage_space"><a href="#val-paid_storage_space" class="anchor"></a><code><span><span class="keyword">val</span> paid_storage_space : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_paid_storage_space_and_return_fees_to_pay"><a href="#val-set_paid_storage_space_and_return_fees_to_pay" class="anchor"></a><code><span><span class="keyword">val</span> set_paid_storage_space_and_return_fees_to_pay : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-increase_paid_storage"><a href="#val-increase_paid_storage" class="anchor"></a><code><span><span class="keyword">val</span> increase_paid_storage : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_hash/index.html#type-t">Contract_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">amount_in_bytes</span>:<a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Enable a payer to increase the paid storage of a contract by some amount.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_balance_and_frozen_bonds"><a href="#val-get_balance_and_frozen_bonds" class="anchor"></a><code><span><span class="keyword">val</span> get_balance_and_frozen_bonds : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_balance_and_frozen_bonds ctxt contract</code> returns the sum of the (spendable) balance and the frozen bonds associated to <code>contract</code>.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Frozen_bonds_must_be_spent_at_once"><a href="#extension-decl-Frozen_bonds_must_be_spent_at_once" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-error">Tezos_protocol_environment_019_PtParisB.Error_monad.error</a> += </span></code><ol><li id="extension-Frozen_bonds_must_be_spent_at_once" class="def variant extension anchored"><a href="#extension-Frozen_bonds_must_be_spent_at_once" class="anchor"></a><code><span>| </span><span><span class="extension">Frozen_bonds_must_be_spent_at_once</span> <span class="keyword">of</span> <a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> * <a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a></span></code></li></ol></div><div class="spec-doc"><p>This error is raised when <code>spend_bond_only_call_from_token</code> is called with an amount that is not equal to the deposit associated to the given contract and bond id.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bond_allocated"><a href="#val-bond_allocated" class="anchor"></a><code><span><span class="keyword">val</span> bond_allocated : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * bool)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>bond_allocated ctxt contract bond_id</code> returns a new context because of an access to carbonated data, and <code>true</code> if there is a bond associated to <code>contract</code> and <code>bond_id</code>, or <code>false</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_bond"><a href="#val-find_bond" class="anchor"></a><code><span><span class="keyword">val</span> find_bond : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> option</span>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_bond ctxt contract bond_id</code> returns a new context because of an access to carbonated data, and the bond associated to <code>(contract, bond_id)</code> if there is one, or <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-spend_bond_only_call_from_token"><a href="#val-spend_bond_only_call_from_token" class="anchor"></a><code><span><span class="keyword">val</span> spend_bond_only_call_from_token : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>spend_bond ctxt contract bond_id amount</code> withdraws the given <code>amount</code> from the value of the bond associated to <code>contract</code> and <code>bond_id</code>.</p><p>The argument <code>amount</code> is required to be strictly positive.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>a</code> <p><code>Storage_Error Missing_key</code> error when there is no bond associated to <code>contract</code> and <code>bond_id</code>.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>a</code> <p><code>Frozen_bonds_must_be_spent_at_once (contract, bond_id)</code> error when the amount is different from the bond associated to <code>contract</code> and <code>bond_id</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-credit_bond_only_call_from_token"><a href="#val-credit_bond_only_call_from_token" class="anchor"></a><code><span><span class="keyword">val</span> credit_bond_only_call_from_token : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>credit_bond ctxt contract bond_id amount</code> adds the given <code>amount</code> to the bond associated to <code>contract</code> and <code>bond_id</code>. If no bond exists, one whose value is <code>amount</code> is created.</p><p>The argument <code>amount</code> is required to be strictly positive.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>a</code> <p><code>Addition_overflow</code> error when <code>(find ctxt contract bond_id) + amount &gt; Int64.max_int</code>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-has_frozen_bonds"><a href="#val-has_frozen_bonds" class="anchor"></a><code><span><span class="keyword">val</span> has_frozen_bonds : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>bool <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>has_frozen_bonds ctxt contract</code> returns <code>true</code> if there are frozen bonds associated to <code>contract</code>, and returns <code>false</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_frozen_bonds"><a href="#val-get_frozen_bonds" class="anchor"></a><code><span><span class="keyword">val</span> get_frozen_bonds : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_frozen_bonds ctxt contract</code> returns the total amount of bonds associated to <code>contract</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_on_bond_ids"><a href="#val-fold_on_bond_ids" class="anchor"></a><code><span><span class="keyword">val</span> fold_on_bond_ids : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">order</span>:<span>[ `Sorted <span>| `Undefined</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">init</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">f</span>:<span>(<span><a href="../Bond_id_repr/index.html#type-t">Bond_id_repr.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>fold_on_bond_ids ctxt contract order init f</code> folds <code>f</code> on all bond identifiers associated to <code>contract</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ensure_deallocated_if_empty"><a href="#val-ensure_deallocated_if_empty" class="anchor"></a><code><span><span class="keyword">val</span> ensure_deallocated_if_empty : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Contract_repr/index.html#type-t">Contract_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>ensure_deallocated_if_empty ctxt contract</code> de-allocates <code>contract</code> if its full balance is zero, and it does not delegate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-simulate_spending"><a href="#val-simulate_spending" class="anchor"></a><code><span><span class="keyword">val</span> simulate_spending : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">balance</span>:<a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">amount</span>:<a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_019_PtParisB/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_019_PtParisB.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> * bool)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>simulate_spending ctxt ~balance ~amount source</code> removes <code>amount</code> from <code>balance</code> as if it were the balance of the implicit contract associated with <code>source</code>. It returns the resulting <code>new_balance</code>, and a boolean <code>still_allocated</code> that indicates whether this contract would still exist.</p><p><code>still_allocated</code> is always <code>true</code> when <code>new_balance</code> is positive. When <code>new_balance</code> is zero, it depends on the contract's delegated status and frozen bonds (cf <a href="#val-spend_only_call_from_token"><code>spend_only_call_from_token</code></a> and <a href="#val-ensure_deallocated_if_empty"><code>ensure_deallocated_if_empty</code></a>).</p><p>Note that this function does not retrieve the actual balance of the contract, nor does it update or delete it. Indeed, its purpose is to simulate the spending of fees when validating operations, without actually spending them.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Balance_too_low</code> if <code>balance</code> is smaller than <code>amount</code>.</p></li></ul><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p><code>Error Empty_implicit_delegated_contract</code> if <code>new_balance</code> would be zero and the contract has a delegate that is not the contract's own manager.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_total_supply"><a href="#val-get_total_supply" class="anchor"></a><code><span><span class="keyword">val</span> get_total_supply : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Tez_repr/index.html#type-t">Tez_repr.t</a> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-For_RPC"><a href="#module-For_RPC" class="anchor"></a><code><span><span class="keyword">module</span> <a href="For_RPC/index.html">For_RPC</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
