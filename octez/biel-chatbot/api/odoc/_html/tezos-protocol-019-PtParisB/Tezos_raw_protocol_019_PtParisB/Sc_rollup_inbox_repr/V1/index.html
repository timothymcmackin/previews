<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>V1 (tezos-protocol-019-PtParisB.Tezos_raw_protocol_019_PtParisB.Sc_rollup_inbox_repr.V1)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-protocol-019-PtParisB</a> &#x00BB; <a href="../../index.html">Tezos_raw_protocol_019_PtParisB</a> &#x00BB; <a href="../index.html">Sc_rollup_inbox_repr</a> &#x00BB; V1</nav><header class="odoc-preamble"><h1>Module <code><span>Sc_rollup_inbox_repr.V1</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-level_proof"><a href="#type-level_proof" class="anchor"></a><code><span><span class="keyword">type</span> level_proof</span><span> = </span><span>{</span></code><ol><li id="type-level_proof.hash" class="def record field anchored"><a href="#type-level_proof.hash" class="anchor"></a><code><span>hash : <a href="../../Sc_rollup_inbox_merkelized_payload_hashes_repr/Hash/index.html#type-t">Sc_rollup_inbox_merkelized_payload_hashes_repr.Hash.t</a>;</span></code></li><li id="type-level_proof.level" class="def record field anchored"><a href="#type-level_proof.level" class="anchor"></a><code><span>level : <a href="../../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-history_proof"><a href="#type-history_proof" class="anchor"></a><code><span><span class="keyword">type</span> history_proof</span><span> = <span><span>(<a href="#type-level_proof">level_proof</a>, <a href="../Hash/index.html#type-t">Hash.t</a>)</span> <a href="../Skip_list/index.html#type-cell">Skip_list.cell</a></span></span></code></div><div class="spec-doc"><p>A <code>history_proof</code> is a <code>Skip_list.cell</code> that stores multiple hashes. <code>Skip_list.content history_proof</code> gives the hash of this cell, while <code>Skip_list.back_pointers history_proof</code> is an array of hashes of earlier <code>history_proof</code>s in the inbox.</p><p>On the one hand, we think of this type as representing the whole Merkle structure of an inbox at a given level---it is the part of <a href="#type-t"><code>t</code></a> above that can actually be used to prove things (it cannot be forged by a malicious node because it much match the hash stored by the L1).</p><p>On the other hand, we think of this type as representing a single proof-step back through the history of the inbox; given a hash that appears at some point later in the inbox this type proves that that hash points to this particular combination of a witness and further back-pointers.</p><p>In terms of size, this type is a small set of hashes; one for the current witness and `O(log2(ix))` in the back-pointers, where <code>ix</code> is the index of the cell in the skip list. That is, <code>ix</code> is the number of non-empty levels between now and the origination level of the rollup.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.level" class="def record field anchored"><a href="#type-t.level" class="anchor"></a><code><span>level : <a href="../../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a>;</span></code></li><li id="type-t.old_levels_messages" class="def record field anchored"><a href="#type-t.old_levels_messages" class="anchor"></a><code><span>old_levels_messages : <a href="#type-history_proof">history_proof</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type of the inbox for a smart-contract rollup as stored by the protocol in the context. Values that inhabit this type only act as fingerprint for inboxes and contain:</p><ul><li><code>level</code> : the inbox level ;</li><li><code>old_levels_messages</code> : a witness of the inbox history.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../../Tezos_protocol_environment_019_PtParisB/Format/index.html#type-formatter">Tezos_protocol_environment_019_PtParisB.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Hash/index.html#type-t">Hash.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encoding"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-t">t</a> <a href="../../../Tezos_protocol_environment_019_PtParisB/Data_encoding/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inbox_level"><a href="#val-inbox_level" class="anchor"></a><code><span><span class="keyword">val</span> inbox_level : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../Raw_level_repr/index.html#type-t">Raw_level_repr.t</a></span></code></div><div class="spec-doc"><p><code>inbox_level inbox</code> returns the maximum level of message insertion in <code>inbox</code> or its initial level.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-History"><a href="#module-History" class="anchor"></a><code><span><span class="keyword">module</span> <a href="History/index.html">History</a></span><span> : 
  <a href="../../Bounded_history_repr/module-type-S/index.html">Bounded_history_repr.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Bounded_history_repr/module-type-S/index.html#type-key">key</a> = <a href="../Hash/index.html#type-t">Hash.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Bounded_history_repr/module-type-S/index.html#type-value">value</a> = <a href="#type-history_proof">history_proof</a></span></span></code></div><div class="spec-doc"><p>A <code>History.t</code> is basically a lookup table of <a href="#type-history_proof"><code>history_proof</code></a>s. We need this if we want to produce inbox proofs because it allows us to dereference the 'pointer' hashes in any of the <code>history_proof</code>s. This <code>deref</code> function is passed to <code>Skip_list.back_path</code> or <code>Skip_list.search</code> to allow these functions to construct valid paths back through the skip list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_history_proof"><a href="#val-pp_history_proof" class="anchor"></a><code><span><span class="keyword">val</span> pp_history_proof : 
  <span><a href="../../../Tezos_protocol_environment_019_PtParisB/Format/index.html#type-formatter">Tezos_protocol_environment_019_PtParisB.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-history_proof">history_proof</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-history_proof_encoding"><a href="#val-history_proof_encoding" class="anchor"></a><code><span><span class="keyword">val</span> history_proof_encoding : 
  <span><a href="#type-history_proof">history_proof</a> <a href="../../../Tezos_protocol_environment_019_PtParisB/Data_encoding/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal_history_proof"><a href="#val-equal_history_proof" class="anchor"></a><code><span><span class="keyword">val</span> equal_history_proof : <span><a href="#type-history_proof">history_proof</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-history_proof">history_proof</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-old_levels_messages"><a href="#val-old_levels_messages" class="anchor"></a><code><span><span class="keyword">val</span> old_levels_messages : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-history_proof">history_proof</a></span></code></div><div class="spec-doc"><p><code>old_levels_messages inbox</code> returns the latest skip list cell of the inbox history that is not up to change (i.e. not the current witness).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_witness"><a href="#val-current_witness" class="anchor"></a><code><span><span class="keyword">val</span> current_witness : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../Sc_rollup_inbox_merkelized_payload_hashes_repr/Hash/index.html#type-t">Sc_rollup_inbox_merkelized_payload_hashes_repr.Hash.t</a></span></code></div><div class="spec-doc"><p><code>current_witness inbox</code> returns the current witness of the inbox, i.e. the merkelized payload hash.</p></div></div></div></body></html>
