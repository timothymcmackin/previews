<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ticket_storage (tezos-protocol-019-PtParisB.Tezos_raw_protocol_019_PtParisB.Ticket_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-019-PtParisB</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_019_PtParisB</a> &#x00BB; Ticket_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_019_PtParisB.Ticket_storage</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Negative_ticket_balance"><a href="#extension-decl-Negative_ticket_balance" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-error">Tezos_protocol_environment_019_PtParisB.Error_monad.error</a> += </span></code><ol><li id="extension-Negative_ticket_balance" class="def variant extension anchored"><a href="#extension-Negative_ticket_balance" class="anchor"></a><code><span>| </span><span><span class="extension">Negative_ticket_balance</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Ticket_storage.key" class="def record field anchored"><a href="#module-Ticket_storage.key" class="anchor"></a><code><span>key : <a href="../Ticket_hash_repr/index.html#type-t">Ticket_hash_repr.t</a>;</span></code></li><li id="module-Ticket_storage.balance" class="def record field anchored"><a href="#module-Ticket_storage.balance" class="anchor"></a><code><span>balance : <a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a>;</span></code></li></ol><code><span>}</span></code></li><li id="extension-Used_storage_space_underflow" class="def variant extension anchored"><a href="#extension-Used_storage_space_underflow" class="anchor"></a><code><span>| </span><span><span class="extension">Used_storage_space_underflow</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_balance"><a href="#val-get_balance" class="anchor"></a><code><span><span class="keyword">val</span> get_balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Ticket_hash_repr/index.html#type-t">Ticket_hash_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> option</span> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_balance ctxt key</code> receives the ticket balance for the given <code>key</code> in the context <code>ctxt</code>. The <code>key</code> represents a ticket content and a ticket creator pair. In case there exists no value for the given <code>key</code>, <code>None</code> is returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-adjust_balance"><a href="#val-adjust_balance" class="anchor"></a><code><span><span class="keyword">val</span> adjust_balance : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Ticket_hash_repr/index.html#type-t">Ticket_hash_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delta</span>:<a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>adjust_balance ctxt key ~delta</code> adjusts the balance of the given key (representing a ticket content, creator and owner pair) and <code>delta</code>. The value of <code>delta</code> can be positive as well as negative. If there is no pre-exising balance for the given ticket type and owner, it is assumed to be 0 and the new balance is <code>delta</code>. The function also returns the difference between the old and the new size of the storage. Note that the difference may be negative. For example, because when setting the balance to zero, an entry is removed.</p><p>The function fails with a <code>Negative_ticket_balance</code> error in case the resulting balance is negative.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-adjust_storage_space"><a href="#val-adjust_storage_space" class="anchor"></a><code><span><span class="keyword">val</span> adjust_storage_space : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">storage_diff</span>:<a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_protocol_environment_019_PtParisB/Z/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Z.t</a> * <a href="../Raw_context/index.html#type-t">Raw_context.t</a>)</span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_019_PtParisB.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_019_PtParisB/Lwt/index.html#type-t">Tezos_protocol_environment_019_PtParisB.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>adjust_storage_space ctxt ~storage_diff</code> updates the used storage space for the ticket-table according to <code>storage_diff</code>. The additional positive amount of unpaid storage is returned. If no unpaid storage is consumed, this amount is 0.</p><p>Note that when storage space for the ticket table is released we may later use that space for free. For this reason, the amount returned may be less than the given (positive) <code>storage_diff</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
