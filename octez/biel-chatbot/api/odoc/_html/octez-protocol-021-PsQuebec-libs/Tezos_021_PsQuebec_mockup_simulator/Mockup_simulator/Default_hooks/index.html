<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Default_hooks (octez-protocol-021-PsQuebec-libs.Tezos_021_PsQuebec_mockup_simulator.Mockup_simulator.Default_hooks)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">octez-protocol-021-PsQuebec-libs</a> &#x00BB; <a href="../../index.html">Tezos_021_PsQuebec_mockup_simulator</a> &#x00BB; <a href="../index.html">Mockup_simulator</a> &#x00BB; Default_hooks</nav><header class="odoc-preamble"><h1>Module <code><span>Mockup_simulator.Default_hooks</span></code></h1><p>The default hook implementation.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-on_inject_block"><a href="#val-on_inject_block" class="anchor"></a><code><span><span class="keyword">val</span> on_inject_block : 
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">round</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_hash</span>:<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_header</span>:<a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">operations</span>:<span><span><a href="../../../../octez-libs/Tezos_base/Operation/index.html#type-t">Tezos_base.TzPervasives.Operation.t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">protocol_data</span>:
    <a href="../../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-protocol_data">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.protocol_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>
   * <a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a>
   * <span><span><a href="../../../../octez-libs/Tezos_base/Operation/index.html#type-t">Tezos_base.TzPervasives.Operation.t</a> list</span> list</span>
   * <a href="../index.html#type-propagation_vector">propagation_vector</a>)</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>This function is called on injection of a block by a particular baker. It allows us to inspect, change, or discard the block. Calling the injection RPC and actually updating the state of the mockup node are two different operations. Normally the first entails the latter, but not always. In particular, the <code>propagation_vector</code> controls what bakers will see and incorporate the block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_inject_operation"><a href="#val-on_inject_operation" class="anchor"></a><code><span><span class="keyword">val</span> on_inject_operation : 
  <span><span class="label">op_hash</span>:<a href="../../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">op</span>:<a href="../../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>
   * <a href="../../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a>
   * <a href="../index.html#type-propagation_vector">propagation_vector</a>)</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>This function is called on injection of an operation. It is similar to <code>on_inject_block</code>, which see.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_new_validated_block"><a href="#val-on_new_validated_block" class="anchor"></a><code><span><span class="keyword">val</span> on_new_validated_block : 
  <span><span class="label">block_hash</span>:<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_header</span>:<a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">operations</span>:<span><span><a href="../../../../octez-libs/Tezos_base/Operation/index.html#type-t">Tezos_base.TzPervasives.Operation.t</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>
   * <a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a>
   * <span><span><a href="../../../../octez-libs/Tezos_base/Operation/index.html#type-t">Tezos_base.TzPervasives.Operation.t</a> list</span> list</span>)</span>
    option</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>This is called when a new validated block is going to be sent as the response to a &quot;monitor validated blocks&quot; RPC call. Returning <code>None</code> here terminates the process for the baker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_new_head"><a href="#val-on_new_head" class="anchor"></a><code><span><span class="keyword">val</span> on_new_head : 
  <span><span class="label">block_hash</span>:<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_header</span>:<a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a>
   * <a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a>)</span>
    option</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>This is called when a new head is going to be sent as the response to a &quot;monitor heads&quot; RPC call. Returning <code>None</code> here terminates the process for the baker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_new_operation"><a href="#val-on_new_operation" class="anchor"></a><code><span><span class="keyword">val</span> on_new_operation : 
  <span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>
   * <a href="../../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>
   * <a href="../../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a>)</span>
    option</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>This is called when a new operation is going to be sent as the response to a &quot;monitor operations&quot; RPC call. Returning <code>None</code> here indicates that the node has advanced to the next level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_block_before_processing"><a href="#val-check_block_before_processing" class="anchor"></a><code><span><span class="keyword">val</span> check_block_before_processing : 
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">round</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_hash</span>:<a href="../../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_header</span>:<a href="../../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">protocol_data</span>:
    <a href="../../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-protocol_data">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.protocol_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Check a block before processing it in the mockup.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_chain_after_processing"><a href="#val-check_chain_after_processing" class="anchor"></a><code><span><span class="keyword">val</span> check_chain_after_processing : 
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">round</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">chain</span>:<a href="../index.html#type-chain">chain</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Check the chain after processing a proposal.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_mempool_after_processing"><a href="#val-check_mempool_after_processing" class="anchor"></a><code><span><span class="keyword">val</span> check_mempool_after_processing : 
  <span><span class="label">mempool</span>:
    <span><span>(<a href="../../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.t</a>
     * <a href="../../../../tezos-protocol-021-PsQuebec/Tezos_protocol_021_PsQuebec_lifted/Lifted_protocol/index.html#type-operation">Tezos_client_021_PsQuebec.Mockup.M.Protocol.operation</a>)</span>
      list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Check operations in the mempool after injecting an operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stop_on_event"><a href="#val-stop_on_event" class="anchor"></a><code><span><span class="keyword">val</span> stop_on_event : <span><a href="../../../Tezos_baking_021_PsQuebec/Baking_state/index.html#type-event">Tezos_baking_021_PsQuebec.Baking_state.event</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>This hook is used to decide when the baker is supposed to shut down. It is triggered by receiving an event.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_start_baker"><a href="#val-on_start_baker" class="anchor"></a><code><span><span class="keyword">val</span> on_start_baker : 
  <span><span class="label">baker_position</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delegates</span>:<span><a href="../../../Tezos_baking_021_PsQuebec/Baking_state/index.html#type-consensus_key">Tezos_baking_021_PsQuebec.Baking_state.consensus_key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cctxt</span>:<a href="../../../Tezos_client_021_PsQuebec/Protocol_client_context/class-type-full/index.html">Tezos_client_021_PsQuebec.Protocol_client_context.full</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>This hook is used to gather information on the baker when it is started (usually recording for later use). The first argument <code>baker_position</code>, is the position of the baker in the list of bakers that were started for this run.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_chain_on_success"><a href="#val-check_chain_on_success" class="anchor"></a><code><span><span class="keyword">val</span> check_chain_on_success : 
  <span><span class="label">chain</span>:<a href="../index.html#type-chain">chain</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Check to run on the chain upon successful termination.</p></div></div></div></body></html>
