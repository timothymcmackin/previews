<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Scenario (octez-protocol-021-PsQuebec-libs.Tezos_021_PsQuebec_test_helpers.Scenario)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-021-PsQuebec-libs</a> &#x00BB; <a href="../index.html">Tezos_021_PsQuebec_test_helpers</a> &#x00BB; Scenario</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_021_PsQuebec_test_helpers.Scenario</span></code></h1><p>This module centralises all modules related to <code>Scenario</code> writing and execution. Most scenario tests would use most if not all of them, so they only need to <code>open Scenario</code>.</p></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Scenario_base/index.html">Scenario_base</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a></span></code></div><div class="spec-doc"><p>Usual threaded state for the tests. Contains the current block, pending operations and the known <code>State.t</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log"><a href="#val-log" class="anchor"></a><code><span><span class="keyword">val</span> log : 
  <span><span class="optlabel">?level</span>:<span class="xref-unresolved">Tezt_core</span>.Cli.Logs.level <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_core</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span>)</span>
    <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_baker"><a href="#val-set_baker" class="anchor"></a><code><span><span class="keyword">val</span> set_baker : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Sets the de facto baker for all future blocks</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exclude_bakers"><a href="#val-exclude_bakers" class="anchor"></a><code><span><span class="keyword">val</span> exclude_bakers : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Exclude a list of delegates from baking</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unset_baking_policy"><a href="#val-unset_baking_policy" class="anchor"></a><code><span><span class="keyword">val</span> unset_baking_policy : <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Unsets the baking policy, it returns to default (<code>By_round 0</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-snapshot_balances"><a href="#val-snapshot_balances" class="anchor"></a><code><span><span class="keyword">val</span> snapshot_balances : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Creates a snapshot of the current balances for the given account names. Can be used to check that balances at point A and B in the execution of a test are the same (either nothing happened, or a succession of actions resulted in getting the same values as before</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_snapshot_balances"><a href="#val-check_snapshot_balances" class="anchor"></a><code><span><span class="keyword">val</span> check_snapshot_balances : 
  <span><span class="optlabel">?f</span>:
    <span>(<span><span class="label">name</span>:<a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">old_balance</span>:<a href="../State_account/index.html#type-balance">State_account.balance</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">new_balance</span>:<a href="../State_account/index.html#type-balance">State_account.balance</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check balances against a previously defined snapshot</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_current_rate"><a href="#val-save_current_rate" class="anchor"></a><code><span><span class="keyword">val</span> save_current_rate : <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Save the current issuance rate for future use</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_rate_evolution"><a href="#val-check_rate_evolution" class="anchor"></a><code><span><span class="keyword">val</span> check_rate_evolution : 
  <span><span>(<span><span class="xref-unresolved">Q</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Q</span>.t <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check that <code>f saved_rate current_rate</code> is true. <code>f</code> is typically a comparison function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_failure_aux"><a href="#val-check_failure_aux" class="anchor"></a><code><span><span class="keyword">val</span> check_failure_aux : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">expected_error</span>:
    <span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_fail_and_rollback"><a href="#val-check_fail_and_rollback" class="anchor"></a><code><span><span class="keyword">val</span> check_fail_and_rollback : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">expected_error</span>:
    <span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-single_scenario">Scenario_dsl.single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_failure"><a href="#val-assert_failure" class="anchor"></a><code><span><span class="keyword">val</span> assert_failure : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">expected_error</span>:
    <span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Useful function to test expected failures: runs the given branch until it fails, then rollbacks to before execution. Fails if the given branch Succeeds</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_success"><a href="#val-assert_success" class="anchor"></a><code><span><span class="keyword">val</span> assert_success : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check a scenario does not fail, and rolls back to before the assert</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_failure_in_check_snapshot_balances"><a href="#val-assert_failure_in_check_snapshot_balances" class="anchor"></a><code><span><span class="keyword">val</span> assert_failure_in_check_snapshot_balances : 
  <span><span class="label">loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?f</span>:
    <span>(<span><span class="label">name</span>:<a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">old_balance</span>:<a href="../State_account/index.html#type-balance">State_account.balance</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">new_balance</span>:<a href="../State_account/index.html#type-balance">State_account.balance</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loop"><a href="#val-loop" class="anchor"></a><code><span><span class="keyword">val</span> loop : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Loop</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loop_action"><a href="#val-loop_action" class="anchor"></a><code><span><span class="keyword">val</span> loop_action : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_balance_field"><a href="#val-check_balance_field" class="anchor"></a><code><span><span class="keyword">val</span> check_balance_field : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Bonds
  <span>| `Liquid</span>
  <span>| `Staked</span>
  <span>| `Total</span>
  <span>| `Unstaked_finalizable</span>
  <span>| `Unstaked_frozen_total</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Tez/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check a specific balance field for a specific account is equal to a specific amount</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_failure_in_check_balance_field"><a href="#val-assert_failure_in_check_balance_field" class="anchor"></a><code><span><span class="keyword">val</span> assert_failure_in_check_balance_field : 
  <span><span class="label">loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Bonds
  <span>| `Liquid</span>
  <span>| `Staked</span>
  <span>| `Total</span>
  <span>| `Unstaked_finalizable</span>
  <span>| `Unstaked_frozen_total</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Tez/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_balance_fields"><a href="#val-check_balance_fields" class="anchor"></a><code><span><span class="keyword">val</span> check_balance_fields : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">liquid</span>:<a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Tez/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">staked</span>:<a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Tez/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?unstaked_frozen_total</span>:<a href="../Tez_staking_helpers/Tez/index.html#type-t">Tezos_021_PsQuebec_test_helpers.State_account.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Scenario_op/index.html">Scenario_op</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-normalize_parameters"><a href="#val-normalize_parameters" class="anchor"></a><code><span><span class="keyword">val</span> normalize_parameters : 
  <span><a href="../Adaptive_issuance_helpers/index.html#type-staking_parameters">Adaptive_issuance_helpers.staking_parameters</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Adaptive_issuance_helpers/index.html#type-staking_parameters">Adaptive_issuance_helpers.staking_parameters</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_delegate_params"><a href="#val-set_delegate_params" class="anchor"></a><code><span><span class="keyword">val</span> set_delegate_params : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Adaptive_issuance_helpers/index.html#type-staking_parameters">Adaptive_issuance_helpers.staking_parameters</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Set delegate parameters for the given delegate</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_account"><a href="#val-add_account" class="anchor"></a><code><span><span class="keyword">val</span> add_account : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Add a new account with the given name</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reveal"><a href="#val-reveal" class="anchor"></a><code><span><span class="keyword">val</span> reveal : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Reveal operation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-transfer"><a href="#val-transfer" class="anchor"></a><code><span><span class="keyword">val</span> transfer : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_helpers/Ez_tez/index.html#type-tez_quantity">Tez_helpers.Ez_tez.tez_quantity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Transfer from src to dst</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-current_cycle"><a href="#val-current_cycle" class="anchor"></a><code><span><span class="keyword">val</span> current_cycle : 
  <span><a href="../Block/index.html#type-block">Block.block</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Cycle/index.html#type-cycle">Tezos_021_PsQuebec_test_helpers.State_account.Cycle.cycle</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_delegate"><a href="#val-set_delegate" class="anchor"></a><code><span><span class="keyword">val</span> set_delegate : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/index.html#type-t">Tezos_base.TzPervasives.String.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Set delegate for src. If <code>delegate_name_opt = None</code>, then unset current delegate</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stake"><a href="#val-stake" class="anchor"></a><code><span><span class="keyword">val</span> stake : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_helpers/Ez_tez/index.html#type-tez_quantity">Tez_helpers.Ez_tez.tez_quantity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Stake operation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unstake"><a href="#val-unstake" class="anchor"></a><code><span><span class="keyword">val</span> unstake : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_helpers/Ez_tez/index.html#type-tez_quantity">Tez_helpers.Ez_tez.tez_quantity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>unstake operation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalize_unstake"><a href="#val-finalize_unstake" class="anchor"></a><code><span><span class="keyword">val</span> finalize_unstake : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>finalize unstake operation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_pending_slashings"><a href="#val-check_pending_slashings" class="anchor"></a><code><span><span class="keyword">val</span> check_pending_slashings : 
  <span><span class="label">loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-order_attestations"><a href="#val-order_attestations" class="anchor"></a><code><span><span class="keyword">val</span> order_attestations : 
  <span><span class="label">correct_order</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Tezos_raw_protocol_021_PsQuebec__Alpha_context.operation</span></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Tezos_raw_protocol_021_PsQuebec__Alpha_context.operation</span></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Tezos_raw_protocol_021_PsQuebec__Alpha_context.operation</span></span>
  * <span><span class="type-var">'a</span> <span class="xref-unresolved">Tezos_raw_protocol_021_PsQuebec__Alpha_context.operation</span></span></span></code></div><div class="spec-doc"><p>Double attestation helpers</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-op_double_attestation"><a href="#val-op_double_attestation" class="anchor"></a><code><span><span class="keyword">val</span> op_double_attestation : 
  <span><span class="optlabel">?correct_order</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-attestation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.attestation</a>
    <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-attestation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.attestation</a>
    <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-packed">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.packed</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-op_double_preattestation"><a href="#val-op_double_preattestation" class="anchor"></a><code><span><span class="keyword">val</span> op_double_preattestation : 
  <span><span class="optlabel">?correct_order</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-preattestation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.preattestation</a>
    <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-preattestation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.preattestation</a>
    <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-t">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-packed">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.packed</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-order_block_hashes"><a href="#val-order_block_hashes" class="anchor"></a><code><span><span class="keyword">val</span> order_block_hashes : 
  <span><span class="label">correct_order</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-block_header">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.block_header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-block_header">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.block_header</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-block_header">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.block_header</a>
  * <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-block_header">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.block_header</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-op_double_baking"><a href="#val-op_double_baking" class="anchor"></a><code><span><span class="keyword">val</span> op_double_baking : 
  <span><span class="optlabel">?correct_order</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-block_header">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.block_header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Block_header/index.html#type-block_header">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Block_header.block_header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Operation/index.html#type-packed">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Operation.packed</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_bake_op"><a href="#val-double_bake_op" class="anchor"></a><code><span><span class="keyword">val</span> double_bake_op : 
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>double_bake_op delegate_names (block, state)</code> performs a double baking with the given delegate names. The first delegate in the list bakes the new main branch. All delegates (including the first) will bake two other blocks at the same level/different round.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_bake"><a href="#val-double_bake" class="anchor"></a><code><span><span class="keyword">val</span> double_bake : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_bake_many"><a href="#val-double_bake_many" class="anchor"></a><code><span><span class="keyword">val</span> double_bake_many : 
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_attest_op"><a href="#val-double_attest_op" class="anchor"></a><code><span><span class="keyword">val</span> double_attest_op : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">op</span>:
    <span>(<span><span class="label">delegate</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/Public_key_hash/index.html#type-t">Tezos_base.TzPervasives.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(<span><span><span class="type-var">'a</span> <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-consensus">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.consensus</a></span>
         <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.operation</a></span>,
        <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span>
        <span class="xref-unresolved">Stdlib</span>.result</span>
        <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">op_evidence</span>:
    <span>(<span><span><span><span class="type-var">'a</span> <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-consensus">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.consensus</a></span>
       <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.operation</a></span> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span><span class="type-var">'a</span> <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Kind/index.html#type-consensus">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.Kind.consensus</a></span>
        <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.operation</a></span> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../Context/index.html#type-t">Context.t</a> <span class="arrow">&#45;&gt;</span></span>
      <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">kind</span>:<a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Misbehaviour_repr/index.html#type-kind">Tezos_protocol_021_PsQuebec.Protocol.Misbehaviour_repr.kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>double_attest_op ?other_bakers ~op ~op_evidence ~kind delegate_names
  (block, state)</code> performs a double (pre)attestation with the given delegate names. Starting at block level `n`, it creates two 2-block branches and all delegates will (pre)attest the two blocks at level `n+2`. <code>other_bakers</code> can be used to force using specific bakers to avoid reusing forbidden ones</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_attest_"><a href="#val-double_attest_" class="anchor"></a><code><span><span class="keyword">val</span> double_attest_ : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_attest_many"><a href="#val-double_attest_many" class="anchor"></a><code><span><span class="keyword">val</span> double_attest_many : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_attest"><a href="#val-double_attest" class="anchor"></a><code><span><span class="keyword">val</span> double_attest : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_preattest_"><a href="#val-double_preattest_" class="anchor"></a><code><span><span class="keyword">val</span> double_preattest_ : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_preattest_many"><a href="#val-double_preattest_many" class="anchor"></a><code><span><span class="keyword">val</span> double_preattest_many : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-double_preattest"><a href="#val-double_preattest" class="anchor"></a><code><span><span class="keyword">val</span> double_preattest : 
  <span><span class="optlabel">?other_bakers</span>:<span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cycle_from_level"><a href="#val-cycle_from_level" class="anchor"></a><code><span><span class="keyword">val</span> cycle_from_level : 
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Cycle/index.html#type-cycle">Tezos_021_PsQuebec_test_helpers.State_account.Cycle.cycle</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pct_from_kind"><a href="#val-pct_from_kind" class="anchor"></a><code><span><span class="keyword">val</span> pct_from_kind : 
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Misbehaviour_repr/index.html#type-kind">Tezos_protocol_021_PsQuebec.Protocol.Misbehaviour_repr.kind</a> <span class="arrow">&#45;&gt;</span></span>
  int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_pending_slashed_pct_for_delegate"><a href="#val-get_pending_slashed_pct_for_delegate" class="anchor"></a><code><span><span class="keyword">val</span> get_pending_slashed_pct_for_delegate : 
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Signature/Public_key_hash/index.html#type-t">Tezos_base.TzPervasives.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_state_denunciation"><a href="#val-update_state_denunciation" class="anchor"></a><code><span><span class="keyword">val</span> update_state_denunciation : 
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-double_signing_state">State.double_signing_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../State/index.html#type-t">State.t</a> * bool, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_denunciations_op"><a href="#val-make_denunciations_op" class="anchor"></a><code><span><span class="keyword">val</span> make_denunciations_op : 
  <span><span class="optlabel">?single</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rev</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?filter</span>:<span>(<span><a href="../State/index.html#type-double_signing_state">State.double_signing_state</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../State/index.html#type-t">State.t</a>
   * <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a> list</span>,
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>make_denunciations_op ?single ?rev ?filter ()</code> denounces all double signers in the state. If <code>single</code> is set, only one denunciation is made. If <code>rev</code> is set, the denunciations are made in reverse order. If <code>filter</code> is set, only the double signers for which the filter returns true are denounced.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_denunciations"><a href="#val-make_denunciations" class="anchor"></a><code><span><span class="keyword">val</span> make_denunciations : 
  <span><span class="optlabel">?single</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rev</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?filter</span>:<span>(<span><a href="../State/index.html#type-double_signing_state">State.double_signing_state</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_account_with_funds"><a href="#val-add_account_with_funds" class="anchor"></a><code><span><span class="keyword">val</span> add_account_with_funds : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">funder</span>:<a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Tez_helpers/Ez_tez/index.html#type-tez_quantity">Tez_helpers.Ez_tez.tez_quantity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Create an account and give an initial balance funded by <code>funder</code></p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Scenario_dsl/index.html">Scenario_dsl</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-scenarios"><a href="#type-scenarios" class="anchor"></a><code><span><span class="keyword">type</span> <span>('input, 'output) scenarios</span></span><span> = <span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span><span> = </span></code><ol><li id="type-scenarios.Action" class="def variant constructor anchored"><a href="#type-scenarios.Action" class="anchor"></a><code><span>| </span><span><span class="constructor">Action</span> : <span>(<span><span class="type-var">'input</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'output</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span>
                                                       <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Empty" class="def variant constructor anchored"><a href="#type-scenarios.Empty" class="anchor"></a><code><span>| </span><span><span class="constructor">Empty</span> : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Concat" class="def variant constructor anchored"><a href="#type-scenarios.Concat" class="anchor"></a><code><span>| </span><span><span class="constructor">Concat</span> : <span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> * <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Branch" class="def variant constructor anchored"><a href="#type-scenarios.Branch" class="anchor"></a><code><span>| </span><span><span class="constructor">Branch</span> : <span>(<span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> * <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Tag" class="def variant constructor anchored"><a href="#type-scenarios.Tag" class="anchor"></a><code><span>| </span><span><span class="constructor">Tag</span> : string <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li><li id="type-scenarios.Slow" class="def variant constructor anchored"><a href="#type-scenarios.Slow" class="anchor"></a><code><span>| </span><span><span class="constructor">Slow</span> : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></li></ol></div><div class="spec-doc"><p>A scenario is a succession of actions. We define a branching path as a way to create multiple tests from the same point. This allows easy compositionality of behaviors with minimal code sharing. The <code>Tag</code> allows to give meaningful identifiers to the branches. It is good practice to tag each case in a branch (it's not necessary, but since test names must be unique, at most one branch can remain unnamed, and even then it can create conflicting names.)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-single_scenario"><a href="#type-single_scenario" class="anchor"></a><code><span><span class="keyword">type</span> <span>('input, 'output) single_scenario</span></span><span> =
  <span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="../Scenario_dsl/index.html#type-single_scenario">Scenario_dsl.single_scenario</a></span></span><span> =
  </span></code><ol><li id="type-single_scenario.End_scenario" class="def variant constructor anchored"><a href="#type-single_scenario.End_scenario" class="anchor"></a><code><span>| </span><span><span class="constructor">End_scenario</span> : <span><span>(<span class="type-var">'t</span>, <span class="type-var">'t</span>)</span> <a href="#type-single_scenario">single_scenario</a></span></span></code></li><li id="type-single_scenario.Cons" class="def variant constructor anchored"><a href="#type-single_scenario.Cons" class="anchor"></a><code><span>| </span><span><span class="constructor">Cons</span> : <span>(<span>(<span><span class="type-var">'input</span> <span class="arrow">&#45;&gt;</span></span>
        <span><span><span class="type-var">'t</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span>
        * <span><span>(<span class="type-var">'t</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span></span></code></li></ol></div><div class="spec-doc"><p>Unfolded scenario type</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cat_ss"><a href="#val-cat_ss" class="anchor"></a><code><span><span class="keyword">val</span> cat_ss : 
  'a 'b 'c. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-single_scenario">single_scenario</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-combine"><a href="#val-combine" class="anchor"></a><code><span><span class="keyword">val</span> combine : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unfold_scenarios"><a href="#val-unfold_scenarios" class="anchor"></a><code><span><span class="keyword">val</span> unfold_scenarios : 
  'input 'output. <span><span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> * <span>string list</span> * bool)</span> list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_scenario"><a href="#val-run_scenario" class="anchor"></a><code><span><span class="keyword">val</span> run_scenario : 
  'input 'output. <span><span><span>(<span class="type-var">'input</span>, <span class="type-var">'output</span>)</span> <a href="#type-single_scenario">single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'input</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'output</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-test_closure"><a href="#type-test_closure" class="anchor"></a><code><span><span class="keyword">type</span> test_closure</span><span> = string * bool * <span>(<span><a href="../../../tezt-tezos/Tezt_tezos/Protocol/index.html#type-t">Tezt_tezos.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unfolded_to_test"><a href="#val-unfolded_to_test" class="anchor"></a><code><span><span class="keyword">val</span> unfolded_to_test : 
  <span><span>(<span><span>(unit, unit)</span> <a href="#type-single_scenario">single_scenario</a></span> * <span>string list</span> * bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-test_closure">test_closure</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_test"><a href="#val-register_test" class="anchor"></a><code><span><span class="keyword">val</span> register_test : <span><span class="label">__FILE__</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">tags</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_closure">test_closure</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_tests"><a href="#val-register_tests" class="anchor"></a><code><span><span class="keyword">val</span> register_tests : 
  <span><span class="label">__FILE__</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">tags</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-test_closure">test_closure</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><p>Useful aliases and operators</p><div class="odoc-spec"><div class="spec value anchored" id="val-noop"><a href="#val-noop" class="anchor"></a><code><span><span class="keyword">val</span> noop : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-no_tag"><a href="#val-no_tag" class="anchor"></a><code><span><span class="keyword">val</span> no_tag : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-concat"><a href="#val-concat" class="anchor"></a><code><span><span class="keyword">val</span> concat : 
  'a 'b 'c. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-branch"><a href="#val-branch" class="anchor"></a><code><span><span class="keyword">val</span> branch : 
  'a 'b. <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(--&gt;)"><a href="#val-(--&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (--&gt;) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Continuation connector: execute a then b</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(|+)"><a href="#val-(|+)" class="anchor"></a><code><span><span class="keyword">val</span> (|+) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Branching connector: creates two tests with different execution paths</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_test"><a href="#val-end_test" class="anchor"></a><code><span><span class="keyword">val</span> end_test : <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Ends the test. Dump the state, returns <code>unit</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tests_of_scenarios"><a href="#val-tests_of_scenarios" class="anchor"></a><code><span><span class="keyword">val</span> tests_of_scenarios : 
  <span><span><span>(string * <span><span>(unit, <span class="type-var">'t</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-test_closure">test_closure</a> list</span></span></code></div><div class="spec-doc"><p>Transforms scenarios into tests</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Arbitrary execution</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_state"><a href="#val-exec_state" class="anchor"></a><code><span><span class="keyword">val</span> exec_state : 
  <span><span>(<span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>, <span class="type-var">'a</span> * <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Execute a function that does not modify the block, only the state</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_unit"><a href="#val-exec_unit" class="anchor"></a><code><span><span class="keyword">val</span> exec_unit : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p>Execute a function that does not modify neither the block nor the state. Usually used for checks/asserts</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>fold f l</code> folds <code>f</code> over <code>l</code>, fails on empty list</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_tag"><a href="#val-fold_tag" class="anchor"></a><code><span><span class="keyword">val</span> fold_tag : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>fold_tag f l</code> folds <code>f</code> over <code>l</code>, <code>l</code> has a tag for each of its elements. Fails on empty list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_tag_f"><a href="#val-fold_tag_f" class="anchor"></a><code><span><span class="keyword">val</span> fold_tag_f : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>fold_tag_f f tag l</code> folds <code>f</code> over <code>l</code>, <code>tag</code> returns a tag for each element of <code>l</code>. Fails on empty list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unfold"><a href="#val-unfold" class="anchor"></a><code><span><span class="keyword">val</span> unfold : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-scenarios">scenarios</a></span></span></code></div><div class="spec-doc"><p><code>unfold f l</code> maps <code>f</code> over <code>l</code>, and runs them in order</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Scenario_begin/index.html">Scenario_begin</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Inconsistent_number_of_bootstrap_accounts"><a href="#extension-decl-Inconsistent_number_of_bootstrap_accounts" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> += </span></code><ol><li id="extension-Inconsistent_number_of_bootstrap_accounts" class="def variant extension anchored"><a href="#extension-Inconsistent_number_of_bootstrap_accounts" class="anchor"></a><code><span>| </span><span><span class="extension">Inconsistent_number_of_bootstrap_accounts</span></span></code></li></ol></div><div class="spec-doc"><p>Returns when the number of bootstrap accounts created by <code>Context.init_n n</code> is not equal to <code>n</code></p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-starter_constants"><a href="#type-starter_constants" class="anchor"></a><code><span><span class="keyword">type</span> starter_constants</span><span> = <a href="../Scenario_begin/index.html#type-starter_constants">Scenario_begin.starter_constants</a></span><span> = </span></code><ol><li id="type-starter_constants.Mainnet" class="def variant constructor anchored"><a href="#type-starter_constants.Mainnet" class="anchor"></a><code><span>| </span><span><span class="constructor">Mainnet</span></span></code></li><li id="type-starter_constants.Sandbox" class="def variant constructor anchored"><a href="#type-starter_constants.Sandbox" class="anchor"></a><code><span>| </span><span><span class="constructor">Sandbox</span></span></code></li><li id="type-starter_constants.Test" class="def variant constructor anchored"><a href="#type-starter_constants.Test" class="anchor"></a><code><span>| </span><span><span class="constructor">Test</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : 
  <span><span class="label">constants</span>:<a href="#type-starter_constants">starter_constants</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start_with"><a href="#val-start_with" class="anchor"></a><code><span><span class="keyword">val</span> start_with : 
  <span><span class="label">constants</span>:<a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start_with_list"><a href="#val-start_with_list" class="anchor"></a><code><span><span class="keyword">val</span> start_with_list : 
  <span><span class="label">constants</span>:<span><span>(string * <a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-activate_ai"><a href="#val-activate_ai" class="anchor"></a><code><span><span class="keyword">val</span> activate_ai : 
  <span><span>[&lt; `Force
  <span><span>| `Force_and_vote_with_threshold</span> of int32</span>
  <span>| `No</span>
  <span><span>| `With_vote_threshold</span> of int32</span>
  <span>| `Zero_threshold</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>, <a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>)</span>
    <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_constants"><a href="#val-init_constants" class="anchor"></a><code><span><span class="keyword">val</span> init_constants : 
  <span><span class="optlabel">?default</span>:<a href="#type-starter_constants">starter_constants</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reward_per_block</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?deactivate_dynamic</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?blocks_per_cycle</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?delegate_parameters_activation_delay</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Initializes the constants for testing, with well chosen default values. Recommended over <code>start</code> or <code>start_with</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-begin_test"><a href="#val-begin_test" class="anchor"></a><code><span><span class="keyword">val</span> begin_test : 
  <span><span class="optlabel">?burn_rewards</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force_attest_all</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_constants/index.html#type-constants">Scenario_constants.constants</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Initialize the test, given some initial parameters</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Scenario_constants/index.html">Scenario_constants</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-constants"><a href="#type-constants" class="anchor"></a><code><span><span class="keyword">type</span> constants</span><span> = <a href="../Constants_helpers/index.html#type-t">Constants_helpers.t</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-S"><a href="#module-S" class="anchor"></a><code><span><span class="keyword">module</span> S</span><span> = <a href="../Constants_helpers/Set/index.html">Tezos_021_PsQuebec_test_helpers.Scenario_constants.S</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_opt"><a href="#val-set_opt" class="anchor"></a><code><span><span class="keyword">val</span> set_opt : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sets"><a href="#val-sets" class="anchor"></a><code><span><span class="keyword">val</span> sets : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sets_f"><a href="#val-sets_f" class="anchor"></a><code><span><span class="keyword">val</span> sets_f : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-branch_flag"><a href="#val-branch_flag" class="anchor"></a><code><span><span class="keyword">val</span> branch_flag : 
  <span><span>(<span>bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-branch_flags"><a href="#val-branch_flags" class="anchor"></a><code><span><span class="keyword">val</span> branch_flags : 
  <span><span><span>(<span>bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sets_int"><a href="#val-sets_int" class="anchor"></a><code><span><span class="keyword">val</span> sets_int : 
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-constants">constants</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-constants">constants</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>int list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-constants">constants</a>, <a href="#type-constants">constants</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../Scenario_bake/index.html">Scenario_bake</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-apply_end_cycle"><a href="#val-apply_end_cycle" class="anchor"></a><code><span><span class="keyword">val</span> apply_end_cycle : 
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Cycle/index.html#type-t">Tezos_021_PsQuebec_test_helpers.State_account.Cycle.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../State/index.html#type-t">State.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Applies when baking the last block of a cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-apply_new_cycle"><a href="#val-apply_new_cycle" class="anchor"></a><code><span><span class="keyword">val</span> apply_new_cycle : 
  <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/Cycle/index.html#type-cycle">Tezos_021_PsQuebec_test_helpers.State_account.Cycle.cycle</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../State/index.html#type-t">State.t</a></span></code></div><div class="spec-doc"><p>Applies when baking the first block of a cycle. Technically nothing special happens, but we need to update the unslashable unstakes since it's done lazily</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_all_balances"><a href="#val-check_all_balances" class="anchor"></a><code><span><span class="keyword">val</span> check_all_balances : 
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>After baking and applying rewards in state</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_misc"><a href="#val-check_misc" class="anchor"></a><code><span><span class="keyword">val</span> check_misc : 
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Misc checks at block end</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_issuance_rpc"><a href="#val-check_issuance_rpc" class="anchor"></a><code><span><span class="keyword">val</span> check_issuance_rpc : <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-attest_all_"><a href="#val-attest_all_" class="anchor"></a><code><span><span class="keyword">val</span> attest_all_ : 
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tztrace">Tezos_base.TzPervasives.Error_monad.tztrace</a>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-attest_all"><a href="#val-attest_all" class="anchor"></a><code><span><span class="keyword">val</span> attest_all : <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake"><a href="#val-bake" class="anchor"></a><code><span><span class="keyword">val</span> bake : 
  <span><span class="optlabel">?baker</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake a block, with the given baker and the given operations.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-repeat"><a href="#val-repeat" class="anchor"></a><code><span><span class="keyword">val</span> repeat : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until_level"><a href="#val-bake_until_level" class="anchor"></a><code><span><span class="keyword">val</span> bake_until_level : 
  <span><span class="label">target_level</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until"><a href="#val-bake_until" class="anchor"></a><code><span><span class="keyword">val</span> bake_until : 
  <span><span class="label">target_cycle</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Cycle_end <span>| `Cycle_end_but_one</span> <span>| `New_cycle</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until_next_cycle"><a href="#val-bake_until_next_cycle" class="anchor"></a><code><span><span class="keyword">val</span> bake_until_next_cycle : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake until a cycle is reached, using <code>bake</code> instead of <code>Block.bake</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until_dawn_of_next_cycle"><a href="#val-bake_until_dawn_of_next_cycle" class="anchor"></a><code><span><span class="keyword">val</span> bake_until_dawn_of_next_cycle : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake all the remaining blocks of the current cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until_next_cycle_end_but_one"><a href="#val-bake_until_next_cycle_end_but_one" class="anchor"></a><code><span><span class="keyword">val</span> bake_until_next_cycle_end_but_one : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_block"><a href="#val-next_block" class="anchor"></a><code><span><span class="keyword">val</span> next_block : <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Bake a single block</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_block_with_baker"><a href="#val-next_block_with_baker" class="anchor"></a><code><span><span class="keyword">val</span> next_block_with_baker : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Bake a single block with a specific baker</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_cycle_"><a href="#val-next_cycle_" class="anchor"></a><code><span><span class="keyword">val</span> next_cycle_ : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake until the end of a cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_cycle"><a href="#val-next_cycle" class="anchor"></a><code><span><span class="keyword">val</span> next_cycle : <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Bake until the end of a cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_op"><a href="#val-exec_op" class="anchor"></a><code><span><span class="keyword">val</span> exec_op : 
  <span><span>(<span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>(<a href="../State/index.html#type-t">State.t</a>
     * <span><a href="../../../tezos-protocol-021-PsQuebec/Tezos_raw_protocol_021_PsQuebec/Alpha_context/index.html#type-packed_operation">Tezos_protocol_021_PsQuebec.Protocol.Alpha_context.packed_operation</a> list</span>,
      <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span>
      <span class="xref-unresolved">Stdlib</span>.result</span>
      <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <span class="type-var">'a</span>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Executes an operation: f should return a new state and a list of operations, which are then applied</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_cycles"><a href="#val-wait_n_cycles" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_cycles : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Waiting functions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_blocks"><a href="#val-wait_n_blocks" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_blocks : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_cycle_f_es"><a href="#val-wait_cycle_f_es" class="anchor"></a><code><span><span class="keyword">val</span> wait_cycle_f_es : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>bool <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_cycle_f"><a href="#val-wait_cycle_f" class="anchor"></a><code><span><span class="keyword">val</span> wait_cycle_f : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Waits until <code>condition init_t current_t</code> is fulfilled. It is checked on the first block of every cycle. If it returns false, another cycle is baked, until it succeeds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_cycle_until"><a href="#val-wait_cycle_until" class="anchor"></a><code><span><span class="keyword">val</span> wait_cycle_until : 
  <span><span>[&lt; `AI_activation
  <span>| `AI_activation_with_votes</span>
  <span><span>| `And</span> of <span class="type-var">'a</span> * <span class="type-var">'a</span></span>
  <span>| `delegate_parameters_activation</span>
  <span>| `right_before_delegate_parameters_activation</span> ]</span> <span class="keyword">as</span> 'a <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Wait until we are in a cycle satisfying the given condition. Fails if AI_activation is requested and AI is not set to be activated in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_ai_activation"><a href="#val-wait_ai_activation" class="anchor"></a><code><span><span class="keyword">val</span> wait_ai_activation : 
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Wait until AI activates. Fails if AI is not set to be activated in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_delegate_parameters_activation"><a href="#val-wait_delegate_parameters_activation" class="anchor"></a><code><span><span class="keyword">val</span> wait_delegate_parameters_activation : 
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>wait delegate_parameters_activation_delay cycles</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_cycles_f_es"><a href="#val-wait_n_cycles_f_es" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_cycles_f_es : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_cycles_f"><a href="#val-wait_n_cycles_f" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_cycles_f : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div></details></div></div></body></html>
