<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Delegate_slashed_deposits_storage (tezos-protocol-alpha.Tezos_raw_protocol_alpha.Delegate_slashed_deposits_storage)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-alpha</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_alpha</a> &#x00BB; Delegate_slashed_deposits_storage</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_alpha.Delegate_slashed_deposits_storage</span></code></h1><p>This module handles the slashing of delegates for double signing.</p><p>It is behind the <a href="../Alpha_context/index.html"><code>Alpha_context</code></a> abstraction: some functions are re-exported in <a href="../Alpha_context/Delegate/index.html"><code>Alpha_context.Delegate</code></a>.</p><p>This module is responsible for maintaining the <code>Storage.Contract.Slashed_deposits</code> table. It also interacts heavily with <a href="../Pending_denunciations_storage/index.html"><code>Pending_denunciations_storage</code></a>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-reward_and_burn"><a href="#type-reward_and_burn" class="anchor"></a><code><span><span class="keyword">type</span> reward_and_burn</span><span> = </span><span>{</span></code><ol><li id="type-reward_and_burn.reward" class="def record field anchored"><a href="#type-reward_and_burn.reward" class="anchor"></a><code><span>reward : <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a>;</span></code></li><li id="type-reward_and_burn.amount_to_burn" class="def record field anchored"><a href="#type-reward_and_burn.amount_to_burn" class="anchor"></a><code><span>amount_to_burn : <a href="../Tez_repr/index.html#type-t">Tez_repr.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The <code>reward_and_burn</code> type embeds amounts involved when slashing a delegate for double attesting or double baking.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-punishing_amounts"><a href="#type-punishing_amounts" class="anchor"></a><code><span><span class="keyword">type</span> punishing_amounts</span><span> = </span><span>{</span></code><ol><li id="type-punishing_amounts.staked" class="def record field anchored"><a href="#type-punishing_amounts.staked" class="anchor"></a><code><span>staked : <a href="#type-reward_and_burn">reward_and_burn</a>;</span></code></li><li id="type-punishing_amounts.unstaked" class="def record field anchored"><a href="#type-punishing_amounts.unstaked" class="anchor"></a><code><span>unstaked : <span><span>(<a href="../Cycle_repr/index.html#type-t">Cycle_repr.t</a> * <a href="#type-reward_and_burn">reward_and_burn</a>)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The <code>punishing_amounts</code> type embeds amounts involved when slashing a delegate for double attesting or double baking.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-punish_double_signing"><a href="#val-punish_double_signing" class="anchor"></a><code><span><span class="keyword">val</span> punish_double_signing : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">operation_hash</span>:<a href="../../Tezos_protocol_environment_alpha/Operation_hash/index.html#type-t">Tezos_protocol_environment_alpha.Operation_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Misbehaviour_repr/index.html#type-t">Misbehaviour_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_protocol_environment_alpha/Signature/Public_key_hash/index.html#type-t">Tezos_protocol_environment_alpha.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Level_repr/index.html#type-t">Level_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rewarded</span>:<a href="../../Tezos_protocol_environment_alpha/Signature/index.html#type-public_key_hash">Tezos_protocol_environment_alpha.Signature.public_key_hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <a href="../../Tezos_protocol_environment_alpha/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_alpha.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_alpha/Lwt/index.html#type-t">Tezos_protocol_environment_alpha.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Record in the context that the given delegate is both marked for slashing for the given misbehaviour, and forbidden from taking part in the consensus process (baking/attesting).</p><p><code>operation_hash</code> corresponds to the denunciation that prompted this punishment. The level argument is the level of the duplicate blocks, or the level that the duplicate (pre)attestations point to, **not** the level of the block that contains the denunciation.</p><p>This function asserts that the delegate has not already been denounced for the same misbehaviour at the same level. Indeed, if this were the case, then the current denunciation operation should have been rejected by <a href="../Validate/index.html"><code>Validate</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-apply_and_clear_denunciations"><a href="#val-apply_and_clear_denunciations" class="anchor"></a><code><span><span class="keyword">val</span> apply_and_clear_denunciations : 
  <span><a href="../Raw_context/index.html#type-t">Raw_context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Raw_context/index.html#type-t">Raw_context.t</a> * <a href="../Receipt_repr/index.html#type-balance_updates">Receipt_repr.balance_updates</a>)</span>
    <a href="../../Tezos_protocol_environment_alpha/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_alpha.Error_monad.tzresult</a></span>
    <a href="../../Tezos_protocol_environment_alpha/Lwt/index.html#type-t">Tezos_protocol_environment_alpha.Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Applies pending denunciations in <a href="../Storage/Pending_denunciations/index.html"><code>Storage.Pending_denunciations</code></a> at the end of a cycle. The applicable denunciations are those that point to a misbehavior whose max slashable period is ending. (because <code>max_slashable_period = 2</code>, the misbehavior must be in the previous cycle).</p><p>The denunciations are applied in chronological order of misbehaviour. This function slashes the misbehaving bakers, by a proportion defined in <a href="../Slash_percentage/index.html"><code>Slash_percentage</code></a>, and updates the respective <code>Storage.Contract.Slashed_deposits</code>. The applied denunciations are removed from the storage.</p><p>It returns the updated context, and all the balance updates, which includes slashes for the bakers, the stakers, and the rewards for the denouncers.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-For_RPC"><a href="#module-For_RPC" class="anchor"></a><code><span><span class="keyword">module</span> <a href="For_RPC/index.html">For_RPC</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
