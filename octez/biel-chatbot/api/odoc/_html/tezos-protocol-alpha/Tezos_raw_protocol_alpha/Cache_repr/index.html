<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cache_repr (tezos-protocol-alpha.Tezos_raw_protocol_alpha.Cache_repr)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-alpha</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_alpha</a> &#x00BB; Cache_repr</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_alpha.Cache_repr</span></code></h1><p>Frequently used data should be kept in memory and persisted along a chain of blocks. The caching mechanism allows the economic protocol to declare such data and to rely on a Least Recently Used strategy to keep the cache size under a fixed limit.</p><p>Take a look at <code>Environment_cache</code> and <code>Environment_context</code> for additional implementation details about the protocol cache.</p><p>The protocol has two main kinds of interaction with the cache:</p><p>1. It is responsible for setting up the cache with appropriate parameter values and callbacks. It must also compute cache nonces to give the shell enough information to properly synchronize the in-memory cache with the block contexts and protocol upgrades. A typical place where this happens is <a href="../Apply/index.html"><code>Apply</code></a>. This aspect must be implemented using <code>Cache.Admin</code>.</p><p>2. It can exploit the cache to retrieve, to insert, and to update cached values from the in-memory cache. The basic idea is to avoid recomputing values from scratch at each block when they are frequently used. <a href="../Script_cache/index.html"><code>Script_cache</code></a> is an example of such usage. This aspect must be implemented using <code>Cache.Interface</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-size"><a href="#type-size" class="anchor"></a><code><span><span class="keyword">type</span> size</span><span> = int</span></code></div><div class="spec-doc"><p>Size for subcaches and values of the cache.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-index"><a href="#type-index" class="anchor"></a><code><span><span class="keyword">type</span> index</span><span> = int</span></code></div><div class="spec-doc"><p>Index type to index caches.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-cache_nonce"><a href="#type-cache_nonce" class="anchor"></a><code><span><span class="keyword">type</span> cache_nonce</span></code></div><div class="spec-doc"><p>Type used to identifies the block that introduced new cache entries</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Admin"><a href="#module-Admin" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Admin/index.html">Admin</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The following module acts on the whole cache, not on a specific sub-cache, unlike <code>Interface</code>. It is used to administrate the protocol cache, e.g., to maintain the cache in a consistent state with respect to the chain. This module is typically used by low-level layers of the protocol and by the shell.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-namespace"><a href="#type-namespace" class="anchor"></a><code><span><span class="keyword">type</span> namespace</span><span> = <span class="keyword">private</span> string</span></code></div><div class="spec-doc"><p>A client uses a unique namespace (represented as a string without '@') to avoid collision with the keys of other clients.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_namespace"><a href="#val-create_namespace" class="anchor"></a><code><span><span class="keyword">val</span> create_namespace : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-namespace">namespace</a></span></code></div><div class="spec-doc"><p><code>create_namespace str</code> creates a valid namespace from <code>str</code></p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if <code>str</code> contains '@'</p></li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-identifier"><a href="#type-identifier" class="anchor"></a><code><span><span class="keyword">type</span> identifier</span><span> = string</span></code></div><div class="spec-doc"><p>A key is fully determined by a namespace and an identifier.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-CLIENT"><a href="#module-type-CLIENT" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-CLIENT/index.html">CLIENT</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>To use the cache, a client must implement the <code>CLIENT</code> interface.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-INTERFACE"><a href="#module-type-INTERFACE" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-INTERFACE/index.html">INTERFACE</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An <code>INTERFACE</code> to the subcache where keys live in a given <code>namespace</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_exn"><a href="#val-register_exn" class="anchor"></a><code><span><span class="keyword">val</span> register_exn : 
  <span><span>(<span class="keyword">module</span> <a href="module-type-CLIENT/index.html">CLIENT</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-CLIENT/index.html#type-cached_value">cached_value</a> = <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>(<span class="keyword">module</span> <a href="module-type-INTERFACE/index.html">INTERFACE</a>
  <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-INTERFACE/index.html#type-cached_value">cached_value</a> = <span class="type-var">'a</span>)</span></span></code></div><div class="spec-doc"><p><code>register_exn client</code> produces an <code>Interface</code> specific to a given <code>client</code>. This function can fail if <code>client</code> does not respect the invariant declared in the documentation of <a href="module-type-CLIENT/index.html"><code>CLIENT</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cache_nonce_from_block_header"><a href="#val-cache_nonce_from_block_header" class="anchor"></a><code><span><span class="keyword">val</span> cache_nonce_from_block_header : 
  <span><a href="../Block_header_repr/index.html#type-shell_header">Block_header_repr.shell_header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block_header_repr/index.html#type-contents">Block_header_repr.contents</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-cache_nonce">cache_nonce</a></span></code></div><div class="spec-doc"><p><code>cache_nonce_from_block_header shell_header contents</code> computes a <a href="#type-cache_nonce"><code>cache_nonce</code></a> from the <code>shell_header</code> and its <code>contents</code>.</p></div></div></div></body></html>
