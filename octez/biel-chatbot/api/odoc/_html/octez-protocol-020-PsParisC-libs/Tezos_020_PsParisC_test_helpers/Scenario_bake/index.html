<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Scenario_bake (octez-protocol-020-PsParisC-libs.Tezos_020_PsParisC_test_helpers.Scenario_bake)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-020-PsParisC-libs</a> &#x00BB; <a href="../index.html">Tezos_020_PsParisC_test_helpers</a> &#x00BB; Scenario_bake</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_020_PsParisC_test_helpers.Scenario_bake</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-apply_end_cycle"><a href="#val-apply_end_cycle" class="anchor"></a><code><span><span class="keyword">val</span> apply_end_cycle : 
  <span><a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Cycle/index.html#type-t">Tezos_020_PsParisC_test_helpers.State_account.Cycle.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../State/index.html#type-t">State.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Applies when baking the last block of a cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-apply_new_cycle"><a href="#val-apply_new_cycle" class="anchor"></a><code><span><span class="keyword">val</span> apply_new_cycle : 
  <span><a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Cycle/index.html#type-cycle">Tezos_020_PsParisC_test_helpers.State_account.Cycle.cycle</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../State/index.html#type-t">State.t</a></span></code></div><div class="spec-doc"><p>Applies when baking the first block of a cycle. Technically nothing special happens, but we need to update the unslashable unstakes since it's done lazily</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_all_balances"><a href="#val-check_all_balances" class="anchor"></a><code><span><span class="keyword">val</span> check_all_balances : 
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>After baking and applying rewards in state</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_misc"><a href="#val-check_misc" class="anchor"></a><code><span><span class="keyword">val</span> check_misc : 
  <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../State/index.html#type-t">State.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Misc checks at block end</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_issuance_rpc"><a href="#val-check_issuance_rpc" class="anchor"></a><code><span><span class="keyword">val</span> check_issuance_rpc : <span><a href="../Block/index.html#type-t">Block.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-attest_all_"><a href="#val-attest_all_" class="anchor"></a><code><span><span class="keyword">val</span> attest_all_ : 
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tztrace">Tezos_base.TzPervasives.Error_monad.tztrace</a>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-attest_all"><a href="#val-attest_all" class="anchor"></a><code><span><span class="keyword">val</span> attest_all : <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>, <a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake"><a href="#val-bake" class="anchor"></a><code><span><span class="keyword">val</span> bake : 
  <span><span class="optlabel">?baker</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake a block, with the given baker and the given operations.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until_next_cycle"><a href="#val-bake_until_next_cycle" class="anchor"></a><code><span><span class="keyword">val</span> bake_until_next_cycle : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake until a cycle is reached, using <code>bake</code> instead of <code>Block.bake</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bake_until_dawn_of_next_cycle"><a href="#val-bake_until_dawn_of_next_cycle" class="anchor"></a><code><span><span class="keyword">val</span> bake_until_dawn_of_next_cycle : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake all the remaining blocks of the current cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_block"><a href="#val-next_block" class="anchor"></a><code><span><span class="keyword">val</span> next_block : <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Bake a single block</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_block_with_baker"><a href="#val-next_block_with_baker" class="anchor"></a><code><span><span class="keyword">val</span> next_block_with_baker : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Bake a single block with a specific baker</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_cycle_"><a href="#val-next_cycle_" class="anchor"></a><code><span><span class="keyword">val</span> next_cycle_ : 
  <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Bake until the end of a cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-next_cycle"><a href="#val-next_cycle" class="anchor"></a><code><span><span class="keyword">val</span> next_cycle : <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Bake until the end of a cycle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_op"><a href="#val-exec_op" class="anchor"></a><code><span><span class="keyword">val</span> exec_op : 
  <span><span>(<span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span>(<a href="../State/index.html#type-t">State.t</a>
     * <span><a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/index.html#type-packed_operation">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.packed_operation</a> list</span>,
      <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span>
      <span class="xref-unresolved">Stdlib</span>.result</span>
      <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Block/index.html#type-t">Block.t</a> * <span class="type-var">'a</span>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Executes an operation: f should return a new state and a list of operations, which are then applied</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_cycles"><a href="#val-wait_n_cycles" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_cycles : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Waiting functions</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_blocks"><a href="#val-wait_n_blocks" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_blocks : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_cycle_f_es"><a href="#val-wait_cycle_f_es" class="anchor"></a><code><span><span class="keyword">val</span> wait_cycle_f_es : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>bool <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_cycle_f"><a href="#val-wait_cycle_f" class="anchor"></a><code><span><span class="keyword">val</span> wait_cycle_f : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Waits until <code>condition init_t current_t</code> is fulfilled. It is checked on the first block of every cycle. If it returns false, another cycle is baked, until it succeeds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_cycle_until"><a href="#val-wait_cycle_until" class="anchor"></a><code><span><span class="keyword">val</span> wait_cycle_until : 
  <span><span>[&lt; `AI_activation
  <span>| `AI_activation_with_votes</span>
  <span><span>| `And</span> of <span class="type-var">'a</span> * <span class="type-var">'a</span></span>
  <span>| `delegate_parameters_activation</span>
  <span>| `right_before_delegate_parameters_activation</span> ]</span> <span class="keyword">as</span> 'a <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Wait until we are in a cycle satisfying the given condition. Fails if AI_activation is requested and AI is not set to be activated in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_ai_activation"><a href="#val-wait_ai_activation" class="anchor"></a><code><span><span class="keyword">val</span> wait_ai_activation : 
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Wait until AI activates. Fails if AI is not set to be activated in the future.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_delegate_parameters_activation"><a href="#val-wait_delegate_parameters_activation" class="anchor"></a><code><span><span class="keyword">val</span> wait_delegate_parameters_activation : 
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>wait delegate_parameters_activation_delay cycles</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_cycles_f_es"><a href="#val-wait_n_cycles_f_es" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_cycles_f_es : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_n_cycles_f"><a href="#val-wait_n_cycles_f" class="anchor"></a><code><span><span class="keyword">val</span> wait_n_cycles_f : 
  <span><span>(<span><a href="../Scenario_base/index.html#type-t">Scenario_base.t</a> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>, <a href="../Scenario_base/index.html#type-t">Scenario_base.t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div></div></body></html>
