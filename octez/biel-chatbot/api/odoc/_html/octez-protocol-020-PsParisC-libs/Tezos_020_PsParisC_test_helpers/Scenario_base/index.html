<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Scenario_base (octez-protocol-020-PsParisC-libs.Tezos_020_PsParisC_test_helpers.Scenario_base)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-020-PsParisC-libs</a> &#x00BB; <a href="../index.html">Tezos_020_PsParisC_test_helpers</a> &#x00BB; Scenario_base</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_020_PsParisC_test_helpers.Scenario_base</span></code></h1><p>This module gathers the basic operations used in test scenarios. This includes starting a scenario, baking, checking and manipulating the state, and various wait functions</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Unexpected_error"><a href="#extension-decl-Unexpected_error" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> += </span></code><ol><li id="extension-Unexpected_error" class="def variant extension anchored"><a href="#extension-Unexpected_error" class="anchor"></a><code><span>| </span><span><span class="extension">Unexpected_error</span></span></code></li></ol></div><div class="spec-doc"><p>For <code>assert_failure</code>, when expected error does not match the actual error.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Unexpected_success"><a href="#extension-decl-Unexpected_success" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> += </span></code><ol><li id="extension-Unexpected_success" class="def variant extension anchored"><a href="#extension-Unexpected_success" class="anchor"></a><code><span>| </span><span><span class="extension">Unexpected_success</span></span></code></li></ol></div><div class="spec-doc"><p>For <code>assert_failure</code>, when scenario actually succeeds when expected to fail.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <a href="../Block/index.html#type-t">Block.t</a> * <a href="../State/index.html#type-t">State.t</a></span></code></div><div class="spec-doc"><p>Usual threaded state for the tests. Contains the current block, pending operations and the known <code>State.t</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log"><a href="#val-log" class="anchor"></a><code><span><span class="keyword">val</span> log : 
  <span><span class="optlabel">?level</span>:<span class="xref-unresolved">Tezt_core</span>.Cli.Logs.level <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_core</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span>)</span>
    <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_baker"><a href="#val-set_baker" class="anchor"></a><code><span><span class="keyword">val</span> set_baker : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Sets the de facto baker for all future blocks</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exclude_bakers"><a href="#val-exclude_bakers" class="anchor"></a><code><span><span class="keyword">val</span> exclude_bakers : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Exclude a list of delegates from baking</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unset_baking_policy"><a href="#val-unset_baking_policy" class="anchor"></a><code><span><span class="keyword">val</span> unset_baking_policy : <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Unsets the baking policy, it returns to default (<code>By_round 0</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-snapshot_balances"><a href="#val-snapshot_balances" class="anchor"></a><code><span><span class="keyword">val</span> snapshot_balances : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Creates a snapshot of the current balances for the given account names. Can be used to check that balances at point A and B in the execution of a test are the same (either nothing happened, or a succession of actions resulted in getting the same values as before</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_snapshot_balances"><a href="#val-check_snapshot_balances" class="anchor"></a><code><span><span class="keyword">val</span> check_snapshot_balances : 
  <span><span class="optlabel">?f</span>:
    <span>(<span><span class="label">name</span>:<a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">old_balance</span>:<a href="../State_account/index.html#type-balance">State_account.balance</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">new_balance</span>:<a href="../State_account/index.html#type-balance">State_account.balance</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check balances against a previously defined snapshot</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_current_rate"><a href="#val-save_current_rate" class="anchor"></a><code><span><span class="keyword">val</span> save_current_rate : <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Save the current issuance rate for future use</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_rate_evolution"><a href="#val-check_rate_evolution" class="anchor"></a><code><span><span class="keyword">val</span> check_rate_evolution : 
  <span><span>(<span><span class="xref-unresolved">Q</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Q</span>.t <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check that <code>f saved_rate current_rate</code> is true. <code>f</code> is typically a comparison function</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_failure_aux"><a href="#val-check_failure_aux" class="anchor"></a><code><span><span class="keyword">val</span> check_failure_aux : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?expected_error</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_fail_and_rollback"><a href="#val-check_fail_and_rollback" class="anchor"></a><code><span><span class="keyword">val</span> check_fail_and_rollback : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?expected_error</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-single_scenario">Scenario_dsl.single_scenario</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_failure"><a href="#val-assert_failure" class="anchor"></a><code><span><span class="keyword">val</span> assert_failure : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?expected_error</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Useful function to test expected failures: runs the given branch until it fails, then rollbacks to before execution. Fails if the given branch Succeeds</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_success"><a href="#val-assert_success" class="anchor"></a><code><span><span class="keyword">val</span> assert_success : 
  <span><span class="optlabel">?loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check a scenario does not fail, and rolls back to before the assert</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loop"><a href="#val-loop" class="anchor"></a><code><span><span class="keyword">val</span> loop : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Loop</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-loop_action"><a href="#val-loop_action" class="anchor"></a><code><span><span class="keyword">val</span> loop_action : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_balance_field"><a href="#val-check_balance_field" class="anchor"></a><code><span><span class="keyword">val</span> check_balance_field : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Bonds
  <span>| `Liquid</span>
  <span>| `Staked</span>
  <span>| `Total</span>
  <span>| `Unstaked_finalizable</span>
  <span>| `Unstaked_frozen_total</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Tez/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div><div class="spec-doc"><p>Check a specific balance field for a specific account is equal to a specific amount</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_balance_fields"><a href="#val-check_balance_fields" class="anchor"></a><code><span><span class="keyword">val</span> check_balance_fields : 
  <span><a href="../../../octez-libs/Tezos_base/TzPervasives/String/Map/index.html#type-key">Tezos_base.TzPervasives.String.Map.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">liquid</span>:<a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Tez/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">staked</span>:<a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Tez/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?unstaked_frozen_total</span>:<a href="../Tez_staking_helpers/Tez/index.html#type-t">Tezos_020_PsParisC_test_helpers.State_account.Tez.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <a href="#type-t">t</a>)</span> <a href="../Scenario_dsl/index.html#type-scenarios">Scenario_dsl.scenarios</a></span></span></code></div></div></div></body></html>
