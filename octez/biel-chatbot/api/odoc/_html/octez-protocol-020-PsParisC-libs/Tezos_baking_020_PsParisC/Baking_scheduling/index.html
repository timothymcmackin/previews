<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Baking_scheduling (octez-protocol-020-PsParisC-libs.Tezos_baking_020_PsParisC.Baking_scheduling)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-protocol-020-PsParisC-libs</a> &#x00BB; <a href="../index.html">Tezos_baking_020_PsParisC</a> &#x00BB; Baking_scheduling</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_baking_020_PsParisC.Baking_scheduling</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-loop_state"><a href="#type-loop_state" class="anchor"></a><code><span><span class="keyword">type</span> loop_state</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_loop_state"><a href="#val-create_loop_state" class="anchor"></a><code><span><span class="keyword">val</span> create_loop_state : 
  <span><span class="optlabel">?get_valid_blocks_stream</span>:<span><span><a href="../Baking_state/index.html#type-proposal">Baking_state.proposal</a> <span class="xref-unresolved">Lwt_stream</span>.t</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">heads_stream</span>:<span><a href="../Baking_state/index.html#type-proposal">Baking_state.proposal</a> <span class="xref-unresolved">Lwt_stream</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">forge_event_stream</span>:<span><a href="../Baking_state/index.html#type-forge_event">Baking_state.forge_event</a> <span class="xref-unresolved">Lwt_stream</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Operation_worker/index.html#type-t">Operation_worker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-loop_state">loop_state</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sleep_until"><a href="#val-sleep_until" class="anchor"></a><code><span><span class="keyword">val</span> sleep_until : <span><a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <span class="xref-unresolved">Lwt</span>.t</span> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-retry"><a href="#val-retry" class="anchor"></a><code><span><span class="keyword">val</span> retry : 
  <span><a href="../../Tezos_client_020_PsParisC/Protocol_client_context/class-type-full/index.html">Tezos_client_020_PsParisC.Protocol_client_context.full</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?max_delay</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">delay</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">factor</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">tries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?msg</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'b</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>retry ctxt ~delay ?max_delay ~factor ~tries ?msg f x</code> retries applying <code>f
    x</code> <code>tries</code> until it succeeds or returns an error different from <code>Connection_failed</code>, at most <code>tries</code> number of times. After each try it waits for a number of seconds, but not more than <code>max_delay</code>, if given. The wait time between tries is given by the initial <code>delay</code>, multiplied by <code>factor</code> at each subsequent try. At each failure, <code>msg</code> together with the current delay is printed using <code>ctxt#message</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_next_event"><a href="#val-wait_next_event" class="anchor"></a><code><span><span class="keyword">val</span> wait_next_event : 
  <span><span class="label">timeout</span>:<span><span>[ <span>`Timeout of <a href="../Baking_state/index.html#type-timeout_kind">Baking_state.timeout_kind</a></span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-loop_state">loop_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><a href="../Baking_state/index.html#type-event">Baking_state.event</a> option</span>,
    <span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-trace">Tezos_base.TzPervasives.trace</a></span>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>An event monitor using the streams in <code>loop_state</code> (to create promises) and a timeout promise <code>timeout</code>. The function reacts to a promise being fulfilled by firing an event <code>Baking_state.event</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-first_potential_round_at_next_level"><a href="#val-first_potential_round_at_next_level" class="anchor"></a><code><span><span class="keyword">val</span> first_potential_round_at_next_level : 
  <span><a href="../Baking_state/index.html#type-state">Baking_state.state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">earliest_round</span>:<a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Round/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Round.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Round/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Round.t</a>
   * <a href="../Baking_state/index.html#type-consensus_key_and_delegate">Baking_state.consensus_key_and_delegate</a>)</span>
    option</span></span></code></div><div class="spec-doc"><p>Returns the first round at the next level, at or after <code>earliest_round</code>, whose baking slot belongs to one of our own delegates; also returns the corresponding delegate. Or returns <code>None</code> if no such round exists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_next_potential_baking_time_at_next_level"><a href="#val-compute_next_potential_baking_time_at_next_level" class="anchor"></a><code><span><span class="keyword">val</span> compute_next_potential_baking_time_at_next_level : 
  <span><a href="../Baking_state/index.html#type-state">Baking_state.state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a>
   * <a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Round/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Round.t</a>)</span>
    option</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_next_timeout"><a href="#val-compute_next_timeout" class="anchor"></a><code><span><span class="keyword">val</span> compute_next_timeout : 
  <span><a href="../Baking_state/index.html#type-state">Baking_state.state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Baking_state/index.html#type-timeout_kind">Baking_state.timeout_kind</a> <span class="xref-unresolved">Lwt</span>.t</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_initial_state"><a href="#val-create_initial_state" class="anchor"></a><code><span><span class="keyword">val</span> create_initial_state : 
  <span><a href="../../Tezos_client_020_PsParisC/Protocol_client_context/class-type-full/index.html">Tezos_client_020_PsParisC.Protocol_client_context.full</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?synchronize</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">chain</span>:<a href="../../../octez-shell-libs/Tezos_shell_services/Chain_services/index.html#type-chain">Tezos_shell_services.Chain_services.chain</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Baking_configuration/index.html#type-t">Baking_configuration.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Operation_worker/index.html#type-t">Operation_worker.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">current_proposal</span>:<a href="../Baking_state/index.html#type-proposal">Baking_state.proposal</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?constants</span>:<a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Constants/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Constants.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Baking_state/index.html#type-consensus_key">Baking_state.consensus_key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Baking_state/index.html#type-state">Baking_state.state</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute_bootstrap_event"><a href="#val-compute_bootstrap_event" class="anchor"></a><code><span><span class="keyword">val</span> compute_bootstrap_event : 
  <span><a href="../Baking_state/index.html#type-state">Baking_state.state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Baking_state/index.html#type-event">Baking_state.event</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-automaton_loop"><a href="#val-automaton_loop" class="anchor"></a><code><span><span class="keyword">val</span> automaton_loop : 
  <span><span class="optlabel">?stop_on_event</span>:<span>(<span><a href="../Baking_state/index.html#type-event">Baking_state.event</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">config</span>:<a href="../Baking_configuration/index.html#type-t">Baking_configuration.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">on_error</span>:
    <span>(<span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(unit, <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-loop_state">loop_state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Baking_state/index.html#type-state">Baking_state.state</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Baking_state/index.html#type-event">Baking_state.event</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Baking_state/index.html#type-event">Baking_state.event</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><a href="../../Tezos_client_020_PsParisC/Protocol_client_context/class-type-full/index.html">Tezos_client_020_PsParisC.Protocol_client_context.full</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?canceler</span>:<span class="xref-unresolved">Lwt_canceler</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stop_on_event</span>:<span>(<span><a href="../Baking_state/index.html#type-event">Baking_state.event</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?on_error</span>:
    <span>(<span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tztrace">Tezos_base.TzPervasives.tztrace</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?constants</span>:<a href="../../../tezos-protocol-020-PsParisC/Tezos_raw_protocol_020_PsParisC/Alpha_context/Constants/index.html#type-t">Tezos_protocol_020_PsParisC.Protocol.Alpha_context.Constants.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">chain</span>:<a href="../../../octez-shell-libs/Tezos_shell_services/Chain_services/index.html#type-chain">Tezos_shell_services.Chain_services.chain</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Baking_configuration/index.html#type-t">Baking_configuration.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Baking_state/index.html#type-consensus_key">Baking_state.consensus_key</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div></div></body></html>
