<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Transport_layer (tezos-dal-node-lib.Tezos_dal_node_lib_gossipsub.Gossipsub.Transport_layer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezos-dal-node-lib</a> &#x00BB; <a href="../../index.html">Tezos_dal_node_lib_gossipsub</a> &#x00BB; <a href="../index.html">Gossipsub</a> &#x00BB; Transport_layer</nav><header class="odoc-preamble"><h1>Module <code><span>Gossipsub.Transport_layer</span></code></h1><p>The transport layer module exposes the needed primitives, interface and default parameters for the instantiation of the Octez-p2p library.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Interface"><a href="#module-Interface" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Interface/index.html">Interface</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../../Transport_layer_interface/index.html">Transport_layer_interface</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Default_parameters"><a href="#module-Default_parameters" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Default_parameters/index.html">Default_parameters</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../../Transport_layer_default_parameters/index.html">Transport_layer_default_parameters</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="label">network_name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">public_addr</span>:<a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">is_bootstrap_peer</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-shell-libs/Tezos_p2p/P2p/index.html#type-config">Tezos_p2p.P2p.config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_p2p_services/P2p_limits/index.html#type-t">Tezos_p2p_services.P2p_limits.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>create ~network_name ~is_bootstrap_peer ~public_addr config limits</code> creates a new instance of type <a href="#type-t"><code>t</code></a>. It is a wrapper on top of <code>P2p.create</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-activate"><a href="#val-activate" class="anchor"></a><code><span><span class="keyword">val</span> activate : 
  <span><span class="optlabel">?additional_points</span>:<span><a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>activate ?additional_points t</code> activates the given transport layer <code>t</code>. It is a wrapper on top of <code>P2p.activate</code>. If some <code>additional_points</code> are given, they are added to <code>t</code>'s known points.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timeout</span>:<span class="xref-unresolved">Ptime</span>.Span.t <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>connect t ?timeout point</code> initiates a connection to the point <code>point</code>. The promise returned by this function is resolved once the P2P handhshake successfully completes. If the <code>timeout</code> is set, an error is returned if the P2P handshake takes more than <code>timeout</code> to complete.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disconnect_point"><a href="#val-disconnect_point" class="anchor"></a><code><span><span class="keyword">val</span> disconnect_point : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?wait</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>disconnect_point t ?wait point</code> initiaties a disconnection to the point <code>point</code>. The promise returned by this function is fullfiled when the socket is closed on our side. If <code>wait</code> is <code>true</code>, we do not close the socket before having canceled all the current messages in the write buffer. Should not matter in practice.</p><p>Due to the following issue https://gitlab.com/tezos/tezos/-/issues/5319</p><p>it may occur that a discconnection takes several minutes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disconnect_peer"><a href="#val-disconnect_peer" class="anchor"></a><code><span><span class="keyword">val</span> disconnect_peer : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?wait</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_crypto/Crypto_box/Public_key_hash/index.html#type-t">Tezos_crypto.Crypto_box.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>disconnect_peer t ?wait point</code> initiaties a disconnection to the point <code>peer</code>. The promise returned by this function is fullfiled when the socket is closed on our side. If <code>wait</code> is <code>true</code>, we do not close the socket before having canceled all the current messages in the write buffer. Should not matter in practice.</p><p>Due to the following issue https://gitlab.com/tezos/tezos/-/issues/5319</p><p>it may occur that a discconnection takes several minutes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_points"><a href="#val-get_points" class="anchor"></a><code><span><span class="keyword">val</span> get_points : 
  <span><span class="optlabel">?connected</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a> list</span> <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_points ?connected t</code> returns a list of points. If <code>connected</code> is <code>true</code> (default), it returns only points we are currently connected. Otherwise, it returns a list of known points (points for which we were already successfully connected in the past.)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_points_info"><a href="#val-get_points_info" class="anchor"></a><code><span><span class="keyword">val</span> get_points_info : 
  <span><span class="optlabel">?connected</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a>
   * <a href="../../../../octez-libs/Tezos_base/P2p_point/Info/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Info.t</a>)</span>
    list</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_points_info ?connected t</code> returns a list of info for points. If <code>connected</code> is <code>true</code> (default), it returns only info for points we are currently connected. Otherwise, it returns a list of infos for known points (points for which we were already successfully connected in the past.)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_point_info"><a href="#val-get_point_info" class="anchor"></a><code><span><span class="keyword">val</span> get_point_info : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_base/P2p_point/Id/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../../octez-libs/Tezos_base/P2p_point/Info/index.html#type-t">Tezos_base.TzPervasives.P2p_point.Info.t</a> option</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_point_info t point</code> returns the info of the corresponding point if found.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_peers"><a href="#val-get_peers" class="anchor"></a><code><span><span class="keyword">val</span> get_peers : 
  <span><span class="optlabel">?connected</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../../octez-libs/Tezos_base/P2p_peer_id/index.html#type-t">Tezos_base.TzPervasives.P2p_peer.Id.t</a> list</span> <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_peers ?connected t</code> returns a list of peers. If <code>connected</code> is <code>true</code> (default), it returns only the peers we are connected to. Otherwise, it returns a list of known peers (peers for which we were already successfully connected in the past.)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_peers_info"><a href="#val-get_peers_info" class="anchor"></a><code><span><span class="keyword">val</span> get_peers_info : 
  <span><span class="optlabel">?connected</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<a href="../../../../octez-libs/Tezos_base/P2p_peer_id/index.html#type-t">Tezos_base.TzPervasives.P2p_peer.Id.t</a>
   * <a href="../../../../tezos-dal-node-services/Tezos_dal_node_services/Types/P2P/Peer/Info/index.html#type-t">Tezos_dal_node_services.Types.P2P.Peer.Info.t</a>)</span>
    list</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_peers_info ?connected t</code> returns a list of info for peers. If <code>connected</code> is <code>true</code> (default), it returns only info for peers we are currently connected. Otherwise, it returns a list of infos for known peers (peers for which we were already successfully connected in the past.)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_peer_info"><a href="#val-get_peer_info" class="anchor"></a><code><span><span class="keyword">val</span> get_peer_info : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_base/P2p_peer_id/index.html#type-t">Tezos_base.TzPervasives.P2p_peer.Id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../../tezos-dal-node-services/Tezos_dal_node_services/Types/P2P/Peer/Info/index.html#type-t">Tezos_dal_node_services.Types.P2P.Peer.Info.t</a> option</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_peer_info t peer</code> returns the info of the corresponding peer if found.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch_peer"><a href="#val-patch_peer" class="anchor"></a><code><span><span class="keyword">val</span> patch_peer : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_base/P2p_peer_id/index.html#type-t">Tezos_base.TzPervasives.P2p_peer.Id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ `Ban <span>| `Open</span> <span>| `Trust</span> ]</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../../tezos-dal-node-services/Tezos_dal_node_services/Types/P2P/Peer/Info/index.html#type-t">Tezos_dal_node_services.Types.P2P.Peer.Info.t</a> option</span>
    <a href="../../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>patch_peer t peer acl</code> patches the acl of the corresponding peer if found and returns the info. When <code>acl</code> is <code>None</code> this is equivalent to <code>get_peer_info</code>.</p></div></div></div></body></html>
