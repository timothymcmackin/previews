<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Value_size_hooks (tezos-dal-node-lib.Tezos_dal_node_lib.Value_size_hooks)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-dal-node-lib</a> &#x00BB; <a href="../index.html">Tezos_dal_node_lib</a> &#x00BB; Value_size_hooks</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_dal_node_lib.Value_size_hooks</span></code></h1><p>The <code>encoded_value_size</code> required by <code>Key_value_store.layout</code> is known when the daemon loads a protocol, after the store is initialized. We use the closures like <code>set_share_size</code> to perform delayed protocol-specific parameter passing.</p><p>Note that this mechanism is not sufficient to make the key-value store robust to dynamic changes in <code>encoded_value_size</code>. For instance, there could be concurrent writes for protocol P-1 and protocol P, if they define distinct <code>encoded_value_size</code> this will make it so that <code>P-1</code> uses the <code>encoded_value_size</code> of <code>P</code>.</p><p>A potential solution would have a function <code>Cryptobox.share_encoding : t -&gt;
    share encoding</code> with the property that the produced encodings are of <code>`Fixed</code> class. The <code>Key_value_store.t</code> type could be parameterized by an extra type parameter corresponding to some dynamic state (corresponding to the cryptobox in our use case), passed explicitly to the <code>write</code> and <code>read</code> functions.</p><p>Correcting this is left to future work.</p><p>TODO: https://gitlab.com/tezos/tezos/-/issues/6034</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-set_share_size"><a href="#val-set_share_size" class="anchor"></a><code><span><span class="keyword">val</span> set_share_size : <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_share_size size</code> sets the size of shard shares. It fails if the size was already set to a different value. This function must be called once, before the <code>layout</code> function of the KVS instance is used.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-share_size"><a href="#val-share_size" class="anchor"></a><code><span><span class="keyword">val</span> share_size : <span>unit <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the share size. It fails if <a href="#val-set_share_size"><code>set_share_size</code></a> has not been called before.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_number_of_slots"><a href="#val-set_number_of_slots" class="anchor"></a><code><span><span class="keyword">val</span> set_number_of_slots : <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_number_of_slots n</code> sets the number of slots to be used by the store. It fails if the size was already set to a different value. This function must be called once, before the <code>layout</code> function of the KVS instance is used.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-number_of_slots"><a href="#val-number_of_slots" class="anchor"></a><code><span><span class="keyword">val</span> number_of_slots : <span>unit <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the number of slots size. It fails if <a href="#val-set_number_of_slots"><code>set_number_of_slots</code></a> has not been called before.</p></div></div></div></body></html>
