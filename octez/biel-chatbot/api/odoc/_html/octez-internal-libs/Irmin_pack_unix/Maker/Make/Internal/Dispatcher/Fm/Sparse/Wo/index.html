<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wo (octez-internal-libs.Irmin_pack_unix.Maker.Make.Internal.Dispatcher.Fm.Sparse.Wo)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../../../../index.html">octez-internal-libs</a> &#x00BB; <a href="../../../../../../../index.html">Irmin_pack_unix</a> &#x00BB; <a href="../../../../../../index.html">Maker</a> &#x00BB; <a href="../../../../../index.html">Make</a> &#x00BB; <a href="../../../../index.html">Internal</a> &#x00BB; <a href="../../../index.html">Dispatcher</a> &#x00BB; <a href="../../index.html">Fm</a> &#x00BB; <a href="../index.html">Sparse</a> &#x00BB; Wo</nav><header class="odoc-preamble"><h1>Module <code><span>Sparse.Wo</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_wo"><a href="#val-open_wo" class="anchor"></a><code><span><span class="keyword">val</span> open_wo : 
  <span><span class="label">mapping_size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">mapping</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">data</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-t">t</a>, <span>[&gt; <a href="../index.html#type-open_error">open_error</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>open_wo ~mapping_size ~mapping ~data</code> returns a write-only instance of the sparse file.</p><p>Note: This is unsafe and is only used by the GC to mark the parent commits as dangling. One must ensure that no read-only instance is opened at the same time, as otherwise the writes would be observable by it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_exn"><a href="#val-write_exn" class="anchor"></a><code><span><span class="keyword">val</span> write_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">off</span>:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span><span class="label">len</span>:int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>write_exn t ~off ~len str</code> writes the first <code>len</code> bytes of <code>str</code> to <code>t</code> at the virtual offset <code>off</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fsync"><a href="#val-fsync" class="anchor"></a><code><span><span class="keyword">val</span> fsync : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span>[&gt; <a href="../../Io/index.html#type-write_error">Io.write_error</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>fsync t</code> persists to the file system the effects of previous writes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span>[&gt; <a href="../../Io/index.html#type-close_error">Io.close_error</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p>Close the underlying files.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_from_data"><a href="#val-create_from_data" class="anchor"></a><code><span><span class="keyword">val</span> create_from_data : 
  <span><span class="label">mapping</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dead_header_size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">size</span>:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">data</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="xref-unresolved">Optint</span>.Int63.t, <span>[&gt; <a href="../../Io/index.html#type-create_error">Io.create_error</a> <span>| <a href="../../Io/index.html#type-write_error">Io.write_error</a></span> <span>| <a href="../../Io/index.html#type-close_error">Io.close_error</a></span> ]</span>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>create_from_data ~mapping ~dead_header_size ~size ~data</code> initializes a new sparse file on disk from the existing file <code>data</code>, by creating the corresponding <code>mapping</code> file. The first <code>dead_header_size</code> bytes are ignored and the remaining <code>size</code> bytes of <code>data</code> are made available.</p><p>On success, returns the size of the <code>mapping</code> file to be stored in the control file for consistency checking on open.</p></div></div></div></body></html>
