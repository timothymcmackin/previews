<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tx_pool (octez-evm-node-libs.Evm_node_lib_dev.Tx_pool)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-evm-node-libs</a> &#x00BB; <a href="../index.html">Evm_node_lib_dev</a> &#x00BB; Tx_pool</nav><header class="odoc-preamble"><h1>Module <code><span>Evm_node_lib_dev.Tx_pool</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-mode"><a href="#type-mode" class="anchor"></a><code><span><span class="keyword">type</span> mode</span><span> = </span></code><ol><li id="type-mode.Proxy" class="def variant constructor anchored"><a href="#type-mode.Proxy" class="anchor"></a><code><span>| </span><span><span class="constructor">Proxy</span></span></code></li><li id="type-mode.Sequencer" class="def variant constructor anchored"><a href="#type-mode.Sequencer" class="anchor"></a><code><span>| </span><span><span class="constructor">Sequencer</span></span></code></li><li id="type-mode.Relay" class="def variant constructor anchored"><a href="#type-mode.Relay" class="anchor"></a><code><span>| </span><span><span class="constructor">Relay</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Relays the transactions when they are valid w.r.t. the local state.</p><span class="comment-delim">*)</span></div></li><li id="type-mode.Forward" class="def variant constructor anchored"><a href="#type-mode.Forward" class="anchor"></a><code><span>| </span><span><span class="constructor">Forward</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-mode.injector" class="def record field anchored"><a href="#type-mode.injector" class="anchor"></a><code><span>injector : <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-hash">Evm_node_lib_dev_encoding.Ethereum_types.hash</a>, string)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span>;</span></code></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Forwards the transactions without checking the transaction validity.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-parameters"><a href="#type-parameters" class="anchor"></a><code><span><span class="keyword">type</span> parameters</span><span> = </span><span>{</span></code><ol><li id="type-parameters.backend" class="def record field anchored"><a href="#type-parameters.backend" class="anchor"></a><code><span>backend : <span>(<span class="keyword">module</span> <a href="../Services_backend_sig/module-type-S/index.html">Services_backend_sig.S</a>)</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The backend RPC module.</p><span class="comment-delim">*)</span></div></li><li id="type-parameters.smart_rollup_address" class="def record field anchored"><a href="#type-parameters.smart_rollup_address" class="anchor"></a><code><span>smart_rollup_address : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The address of the smart rollup.</p><span class="comment-delim">*)</span></div></li><li id="type-parameters.mode" class="def record field anchored"><a href="#type-parameters.mode" class="anchor"></a><code><span>mode : <a href="#type-mode">mode</a>;</span></code></li><li id="type-parameters.tx_timeout_limit" class="def record field anchored"><a href="#type-parameters.tx_timeout_limit" class="anchor"></a><code><span>tx_timeout_limit : int64;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>TTL of a transaction inside the pool.</p><span class="comment-delim">*)</span></div></li><li id="type-parameters.tx_pool_addr_limit" class="def record field anchored"><a href="#type-parameters.tx_pool_addr_limit" class="anchor"></a><code><span>tx_pool_addr_limit : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Maximum allowed addresses inside the pool.</p><span class="comment-delim">*)</span></div></li><li id="type-parameters.tx_pool_tx_per_addr_limit" class="def record field anchored"><a href="#type-parameters.tx_pool_tx_per_addr_limit" class="anchor"></a><code><span>tx_pool_tx_per_addr_limit : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Maximum allowed transactions per address inside the pool.</p><span class="comment-delim">*)</span></div></li><li id="type-parameters.max_number_of_chunks" class="def record field anchored"><a href="#type-parameters.max_number_of_chunks" class="anchor"></a><code><span>max_number_of_chunks : <span>int option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Maximum allowed number of chunks to be sent (relevant for the sequencer).</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-start"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : <span><a href="#type-parameters">parameters</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>start parameters</code> starts the tx-pool</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span><span class="keyword">val</span> shutdown : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>shutdown ()</code> stops the tx-pool, waiting for the ongoing request to be processed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-txs_watcher"><a href="#val-txs_watcher" class="anchor"></a><code><span><span class="keyword">val</span> txs_watcher : 
  <span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/Subscription/index.html#type-output">Evm_node_lib_dev_encoding.Ethereum_types.Subscription.output</a>
    <span class="xref-unresolved">Lwt_watcher</span>.input</span></span></code></div><div class="spec-doc"><p>Watcher that gets notified each time a transaction is added to the pending state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : 
  <span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-transaction_object">Evm_node_lib_dev_encoding.Ethereum_types.transaction_object</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-hash">Evm_node_lib_dev_encoding.Ethereum_types.hash</a>, string)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>add transaction_object raw_tx</code> adds a eth transaction and its raw contents to the tx-pool.</p><p>The consistency between <code>transaction_object</code> and <code>raw_tx</code> is assumed by <code>add</code>. It is the responsibility of the caller to enforce it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-nonce"><a href="#val-nonce" class="anchor"></a><code><span><span class="keyword">val</span> nonce : 
  <span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/Address/index.html#type-t">Evm_node_lib_dev_encoding.Ethereum_types.Address.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-quantity">Evm_node_lib_dev_encoding.Ethereum_types.quantity</a>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>nonce address</code> returns the nonce of the user Returns the first gap in the tx-pool, or the nonce stored on the rollup if no transactions are in the pool.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_transactions"><a href="#val-pop_transactions" class="anchor"></a><code><span><span class="keyword">val</span> pop_transactions : 
  <span><span class="label">maximum_cumulative_size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(string * <a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-transaction_object">Evm_node_lib_dev_encoding.Ethereum_types.transaction_object</a>)</span> list</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pop_transactions maximum_cumulative_size</code> pops as much valid transactions as possible from the pool, until their cumulative size exceeds `maximum_cumulative_size`. Returns no transactions if the pool is locked.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_and_inject_transactions"><a href="#val-pop_and_inject_transactions" class="anchor"></a><code><span><span class="keyword">val</span> pop_and_inject_transactions : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pop_and_inject_transactions ()</code> pops the valid transactions from the pool using <a href="#val-pop_transactions"><code>pop_transactions</code></a> and injects them using <code>inject_raw_transactions</code> provided by <a href="#type-parameters.backend"><code>parameters.backend</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_and_inject_transactions_lazy"><a href="#val-pop_and_inject_transactions_lazy" class="anchor"></a><code><span><span class="keyword">val</span> pop_and_inject_transactions_lazy : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pop_and_inject_transactions_lazy ()</code> same as <code>pop_and_inject_transactions</code> but don't wait for the request to complete</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lock_transactions"><a href="#val-lock_transactions" class="anchor"></a><code><span><span class="keyword">val</span> lock_transactions : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>lock_transactions</code> locks the transactions in the pool, new transactions can be added but nothing can be retrieved with <a href="#val-pop_transactions"><code>pop_transactions</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unlock_transactions"><a href="#val-unlock_transactions" class="anchor"></a><code><span><span class="keyword">val</span> unlock_transactions : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>unlock_transactions</code> unlocks the transactions if it was locked by <a href="#val-lock_transactions"><code>lock_transactions</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_locked"><a href="#val-is_locked" class="anchor"></a><code><span><span class="keyword">val</span> is_locked : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>bool <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>is_locked</code> checks if the pools is locked.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-size_info"><a href="#val-size_info" class="anchor"></a><code><span><span class="keyword">val</span> size_info : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Metrics/Tx_pool/index.html#type-size_info">Metrics.Tx_pool.size_info</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_tx_pool_content"><a href="#val-get_tx_pool_content" class="anchor"></a><code><span><span class="keyword">val</span> get_tx_pool_content : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-txpool">Evm_node_lib_dev_encoding.Ethereum_types.txpool</a>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-hash">Evm_node_lib_dev_encoding.Ethereum_types.hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../Evm_node_lib_dev_encoding/Ethereum_types/index.html#type-transaction_object">Evm_node_lib_dev_encoding.Ethereum_types.transaction_object</a> option</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find tx_hash</code> look into the tx pool if a transaction with hash <code>tx_hash</code> exists and returns it's corresponding <code>Ethereum_types.transaction_object</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-clear_popped_transactions"><a href="#val-clear_popped_transactions" class="anchor"></a><code><span><span class="keyword">val</span> clear_popped_transactions : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div></div></body></html>
