<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Floating_block_store (octez-shell-libs.Tezos_store_unix.Floating_block_store)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">octez-shell-libs</a> &#x00BB; <a href="../index.html">Tezos_store_unix</a> &#x00BB; Floating_block_store</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_store_unix.Floating_block_store</span></code></h1><p>Persistent block store with arborescent history</p><p>The floating block store is an append-only store where blocks are stored arbitrarily. This structure possess an indexed map <code>Block_hash.t</code> -&gt; (offset × predecessors x resulting_context_hash) which points to its offset in the associated file along with an exponential list of predecessors block hashes (as implemented in <code>Block_store.compute_predecessors</code>) and the block's resulting context hash. The structure access/modification is protected by a mutex (<code>Lwt_idle_waiter</code>) and thus can be manipulated concurrently. Stored blocks may or may not contain metadata. The instance maintains an opened file descriptor. Therefore it must be properly closed or it might lead to a file descriptor leak.</p><p>Four different kind of instances are allowed to co-exist for an identical path: - RO, a read-only instance; - RW, a read-write instance - RO_TMP, RW_TMP, read-write instances; - Restore is a generic instance used to wrap leftover instances while fixing a crashed storage. See <a href="../Block_store/index.html"><code>Block_store</code></a>.</p></header><nav class="odoc-toc"><ul><li><a href="#invariants">Invariants</a></li><li><a href="#files-format">Files format</a></li></ul></nav><div class="odoc-content"><h2 id="invariants"><a href="#invariants" class="anchor"></a>Invariants</h2><p>This store is expected to respect the following invariant:</p><ul><li>Every block stored is correctly indexed.</li></ul><h2 id="files-format"><a href="#files-format" class="anchor"></a>Files format</h2><p>The floating block store is composed of the following files:</p><ul><li>file: /&lt;kind&gt;_floating_block_store, a list of <code>Block_repr.t</code>:</li></ul><p>| &lt;block&gt; * |</p><p>where &lt;kind&gt; is RO(_TMP), RW(_TMP) (see <code>Naming</code>) and &lt;block&gt;, a <code>Block_repr.t</code> value encoded using <code>Block_repr.encoding</code> (thus prefixed by the its size).</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type of the floating store.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-floating_kind"><a href="#type-floating_kind" class="anchor"></a><code><span><span class="keyword">type</span> floating_kind</span><span> = <a href="../../Tezos_store_shared/Naming/index.html#type-floating_kind">Tezos_store_shared.Naming.floating_kind</a></span><span> = </span></code><ol><li id="type-floating_kind.RO" class="def variant constructor anchored"><a href="#type-floating_kind.RO" class="anchor"></a><code><span>| </span><span><span class="constructor">RO</span></span></code></li><li id="type-floating_kind.RW" class="def variant constructor anchored"><a href="#type-floating_kind.RW" class="anchor"></a><code><span>| </span><span><span class="constructor">RW</span></span></code></li><li id="type-floating_kind.RW_TMP" class="def variant constructor anchored"><a href="#type-floating_kind.RW_TMP" class="anchor"></a><code><span>| </span><span><span class="constructor">RW_TMP</span></span></code></li><li id="type-floating_kind.RO_TMP" class="def variant constructor anchored"><a href="#type-floating_kind.RO_TMP" class="anchor"></a><code><span>| </span><span><span class="constructor">RO_TMP</span></span></code></li><li id="type-floating_kind.Restore" class="def variant constructor anchored"><a href="#type-floating_kind.Restore" class="anchor"></a><code><span>| </span><span><span class="constructor">Restore</span> <span class="keyword">of</span> <a href="#type-floating_kind">floating_kind</a></span></code></li></ol></div><div class="spec-doc"><p>The type for the kind of floating store opened.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-info"><a href="#type-info" class="anchor"></a><code><span><span class="keyword">type</span> info</span><span> = </span><span>{</span></code><ol><li id="type-info.predecessors" class="def record field anchored"><a href="#type-info.predecessors" class="anchor"></a><code><span>predecessors : <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> list</span>;</span></code></li><li id="type-info.resulting_context_hash" class="def record field anchored"><a href="#type-info.resulting_context_hash" class="anchor"></a><code><span>resulting_context_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Context_hash/index.html#type-t">Tezos_base.TzPervasives.Context_hash.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type for informations stored in floating store indexes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_floating_blocks_log_size"><a href="#val-default_floating_blocks_log_size" class="anchor"></a><code><span><span class="keyword">val</span> default_floating_blocks_log_size : int</span></code></div><div class="spec-doc"><p>The default value of the floating blocks cache size used by index library.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-floating_kind">floating_kind</a></span></code></div><div class="spec-doc"><p><code>kind floating_store</code> returns the floating store's kind.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mem floating_store hash</code> tests whether <code>hash</code> is stored in <code>floating_store</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-may_sync"><a href="#val-may_sync" class="anchor"></a><code><span><span class="keyword">val</span> may_sync : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>may_sync floating_store</code> updates a RO index instance to allow concurrent access to the value added by a RW instance. This operation is expected to be cheap (~10us) and has no effect on RW instances.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_info"><a href="#val-find_info" class="anchor"></a><code><span><span class="keyword">val</span> find_info : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-info">info</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_info floating_store block_hash</code> reads from the index the info of <code>block_hash</code> if the block is stored in <code>floating_store</code>, returns <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_predecessors"><a href="#val-find_predecessors" class="anchor"></a><code><span><span class="keyword">val</span> find_predecessors : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> list</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_predecessors floating_store block_hash</code> reads from the index the list of <code>block_hash</code>'s predecessors if the block is stored in <code>floating_store</code>, returns <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_resulting_context_hash"><a href="#val-find_resulting_context_hash" class="anchor"></a><code><span><span class="keyword">val</span> find_resulting_context_hash : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_crypto/Hashed/Context_hash/index.html#type-t">Tezos_base.TzPervasives.Context_hash.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_resulting_context_hash floating_store block_hash</code> reads from the index the resulting context hash if the block is stored in <code>floating_store</code>, returns <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_block"><a href="#val-read_block" class="anchor"></a><code><span><span class="keyword">val</span> read_block : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Tezos_store_shared/Block_repr/index.html#type-t">Tezos_store_shared.Block_repr.t</a> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block floating_store hash</code> reads from the file the block of <code>hash</code> if the block is stored in <code>floating_store</code>, returns <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_block_and_info"><a href="#val-read_block_and_info" class="anchor"></a><code><span><span class="keyword">val</span> read_block_and_info : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_store_shared/Block_repr/index.html#type-t">Tezos_store_shared.Block_repr.t</a> * <a href="#type-info">info</a>)</span> option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>read_block_and_info floating_store hash</code> same as <code>read_block</code> but also returns the block's info. Returns <code>None</code> if it fails to resolve the given <code>hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-append_block"><a href="#val-append_block" class="anchor"></a><code><span><span class="keyword">val</span> append_block : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?flush</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?log_metrics</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-info">info</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Tezos_store_shared/Block_repr/index.html#type-block">Tezos_store_shared.Block_repr.block</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>append_block floating_store ?flush ?log_metrics info block</code> stores the <code>block</code> in <code>floating_store</code> updating its index with the given <code>info</code> and flushing if <code>flush</code> is set to <code>true</code> (defaults to <code>true</code>). <code>log_metrics</code> enables logs of the amount of written bytes using the node's metrics.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-append_all"><a href="#val-append_all" class="anchor"></a><code><span><span class="keyword">val</span> append_all : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../Tezos_store_shared/Block_repr/index.html#type-t">Tezos_store_shared.Block_repr.t</a> * <a href="#type-info">info</a>)</span> <a href="../../../octez-libs/Tezos_error_monad/TzLwtreslib/Seq/index.html#type-t">Tezos_base.TzPervasives.Seq.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>append_all floating_store chunk</code> stores the <code>chunk</code> of (blocks x info) in <code>floating_store</code> updating its index accordingly.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_s_raw_fd"><a href="#val-iter_s_raw_fd" class="anchor"></a><code><span><span class="keyword">val</span> iter_s_raw_fd : 
  <span><span>(<span><a href="../../Tezos_store_shared/Block_repr/index.html#type-t">Tezos_store_shared.Block_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Lwt_unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>iter_s_raw_fd f fd</code> unsafe sequential iterator on a file descriptor <code>fd</code>. Applies <code>f</code> on every block encountered.</p><p><b>Warning</b>: should be used for internal use only (e.g. snapshots).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_left_s"><a href="#val-fold_left_s" class="anchor"></a><code><span><span class="keyword">val</span> fold_left_s : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
    <span><a href="../../Tezos_store_shared/Block_repr/index.html#type-block">Tezos_store_shared.Block_repr.block</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>fold_left_s f e floating_store</code> sequential fold left on the <code>floating_store</code> using <code>f</code> on every block and <code>e</code> as initial element. The function <code>f</code> is given the last read block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_left_with_info_s"><a href="#val-fold_left_with_info_s" class="anchor"></a><code><span><span class="keyword">val</span> fold_left_with_info_s : 
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>(<a href="../../Tezos_store_shared/Block_repr/index.html#type-block">Tezos_store_shared.Block_repr.block</a> * <a href="#type-info">info</a>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>fold_left_with_info_s f e floating_store</code> sequential fold left on the <code>floating_store</code> using <code>f</code> on every block and <code>e</code> as initial element. The function <code>f</code> is given the last read block along with its info.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_s"><a href="#val-iter_s" class="anchor"></a><code><span><span class="keyword">val</span> iter_s : 
  <span><span>(<span><a href="../../Tezos_store_shared/Block_repr/index.html#type-t">Tezos_store_shared.Block_repr.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>iter_s f floating_store</code> sequential iterator on the <code>floating_store</code>. Applies <code>f</code> on every block read.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_with_info_s"><a href="#val-iter_with_info_s" class="anchor"></a><code><span><span class="keyword">val</span> iter_with_info_s : 
  <span><span>(<span><span>(<a href="../../Tezos_store_shared/Block_repr/index.html#type-t">Tezos_store_shared.Block_repr.t</a> * <a href="#type-info">info</a>)</span> <span class="arrow">&#45;&gt;</span></span>
    <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>iter_with_info_s f floating_store</code> sequential iterator on the <code>floating_store</code>. Applies <code>f</code> on every block (and its info) read.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><span><span>[ `Chain_dir ]</span> <a href="../../Tezos_store_shared/Naming/index.html#type-directory">Tezos_store_shared.Naming.directory</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">readonly</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-floating_kind">floating_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>init ~chain_dir ~readonly kind</code> creates or load an existing floating store at path <code>chain_dir</code> with <code>kind</code>.</p><p><b>Warning</b> If <code>readonly</code> is not set, a <code>RO</code> instance is writable.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>close floating_store</code> closes <code>floating_store</code> by closing the index and the associated opened file descriptor.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete_files"><a href="#val-delete_files" class="anchor"></a><code><span><span class="keyword">val</span> delete_files : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>delete_files store</code> closes the <code>store</code> then deletes its content.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-swap"><a href="#val-swap" class="anchor"></a><code><span><span class="keyword">val</span> swap : <span><span class="label">src</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">dst</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>swap ~src ~dst</code> closes <code>src</code> and <code>dst</code> then overwrites <code>dst</code> files with <code>src</code>'s ones.</p><p><b>Warning</b> Non-atomic swap.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-append_floating_store"><a href="#val-append_floating_store" class="anchor"></a><code><span><span class="keyword">val</span> append_floating_store : 
  <span><span class="label">from</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">into</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>append_floating_store ~from ~into</code> takes two opened floating block stores and appends all blocks contained in <code>from</code> to <code>into</code>.</p></div></div><p>Integrity checks</p><div class="odoc-spec"><div class="spec value anchored" id="val-all_files_exists"><a href="#val-all_files_exists" class="anchor"></a><code><span><span class="keyword">val</span> all_files_exists : 
  <span><span><span>[ `Chain_dir ]</span> <a href="../../Tezos_store_shared/Naming/index.html#type-directory">Tezos_store_shared.Naming.directory</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-floating_kind">floating_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>all_files_exists ~chain_dir kind</code> checks that the files to the associated <code>kind</code> of floating store are present in the <code>chain_dir</code> directory.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fix_integrity"><a href="#val-fix_integrity" class="anchor"></a><code><span><span class="keyword">val</span> fix_integrity : 
  <span><span><span>[ `Chain_dir ]</span> <a href="../../Tezos_store_shared/Naming/index.html#type-directory">Tezos_store_shared.Naming.directory</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-floating_kind">floating_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>fix_integrity ~chain_dir kind error</code> fixes the integrity of the floating block stores by removing corrupted data and restoring a consistent state.</p></div></div></div></body></html>
