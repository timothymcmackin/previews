<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Process (octez-shell-libs.Tezos_p2p_test_common.Process)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-shell-libs</a> &#x00BB; <a href="../index.html">Tezos_p2p_test_common</a> &#x00BB; Process</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_p2p_test_common.Process</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#function-evaluation-in-a-detached-process">Function evaluation in a detached process</a><ul><li><a href="#working-with-list-of-detached-process">Working with list of detached process</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="function-evaluation-in-a-detached-process"><a href="#function-evaluation-in-a-detached-process" class="anchor"></a>Function evaluation in a detached process</h2><p>This library uses a process detached in a separated unix process to execute a given function, with bidirectional communication channels and transmission of the function result at the end of the execution.</p><p>The communication channels does not require a data encoding, but the data encoding can be given. In absence of data encoding the Marshal mecanism will be used. Be aware that extensible types, like error or exception cannot be safely exchanged between processes.</p><p>Flags for Marshal serialisation can be passed at the creation of the detached process.</p><div class="odoc-spec"><div class="spec exception anchored" id="exception-Exited"><a href="#exception-Exited" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Exited</span> <span class="keyword">of</span> int</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Channel"><a href="#module-Channel" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Channel/index.html">Channel</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Endpoint of a bidirectionnal channel.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('sent, 'received, 'result) t</span></span></code></div><div class="spec-doc"><p>Detached process.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-detach"><a href="#val-detach" class="anchor"></a><code><span><span class="keyword">val</span> detach : 
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?canceler</span>:<span class="xref-unresolved">Lwt_canceler</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?input_encoding</span>:<span><span class="type-var">'received</span> <a href="../../../octez-libs/Data_encoding/index.html#type-encoding">Tezos_base.TzPervasives.Data_encoding.encoding</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?output_encoding</span>:<span><span class="type-var">'sent</span> <a href="../../../octez-libs/Data_encoding/index.html#type-encoding">Tezos_base.TzPervasives.Data_encoding.encoding</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?value_encoding</span>:<span><span class="type-var">'result</span> <a href="../../../octez-libs/Data_encoding/index.html#type-encoding">Tezos_base.TzPervasives.Data_encoding.encoding</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?flags</span>:<span><span class="xref-unresolved">Stdlib</span>.Marshal.extern_flags list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span>(<span class="type-var">'sent</span>, <span class="type-var">'received</span>)</span> <a href="Channel/index.html#type-t">Channel.t</a></span> <span class="arrow">&#45;&gt;</span></span>
    <span><span><span class="type-var">'result</span> <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<span class="type-var">'sent</span>, <span class="type-var">'received</span>, <span class="type-var">'result</span>)</span> <a href="#type-t">t</a></span> <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Executing a function in a detached process. <code>prefix</code> will be used in detached process logs. On canceling of <code>canceler</code>, the detached process will be killed by SIGKILL.</p><p><code>input_encoding</code> and <code>output_encoding</code>, if provided, will be used to exchange values between the main process and the detached process <code>input_encoding</code> is for values received by the detached process. <code>output_encoding</code> is for values sent by the detached process.</p><p>In absence of data encoding the Marshal mecanism will be used. Be aware that extensible types, like error or exception cannot be safely exchanged between processes.</p><p><code>value_encoding</code> is for the encoding of the result of the detached function. The Error_monad encapsulation part of the value computed by the detached function will be safely encoded, even without encoding for the <code>'result</code> type. Ie if the detached function end with an error, the error will safely be serialized-deserialised.</p><p>If no encoding is given, the values will be serialized using the Marshal module, with the given <code>flags</code> (if any is provided).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-send"><a href="#val-send" class="anchor"></a><code><span><span class="keyword">val</span> send : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'received</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'received</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Sending a data to the detached process</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-receive"><a href="#val-receive" class="anchor"></a><code><span><span class="keyword">val</span> receive : 
  <span><span><span>(<span class="type-var">'sent</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'sent</span> <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Receiving a data from the detached process. This call is blocking.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_result"><a href="#val-wait_result" class="anchor"></a><code><span><span class="keyword">val</span> wait_result : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'result</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'result</span> <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Receiving the result of the detached function. This call is blocking.</p></div></div><h3 id="working-with-list-of-detached-process"><a href="#working-with-list-of-detached-process" class="anchor"></a>Working with list of detached process</h3><div class="odoc-spec"><div class="spec value anchored" id="val-wait_all_results"><a href="#val-wait_all_results" class="anchor"></a><code><span><span class="keyword">val</span> wait_all_results : 
  <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'c</span> list</span> <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Waiting for all the detached function to finish, unless one of the function return an error.</p><p>If all detached functions succesfully compute a value, return the list of values.</p><p>If at least one function end with en error, cancel all the unfinished process, and return the trace of errors of unsuccesful process.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_all"><a href="#val-wait_all" class="anchor"></a><code><span><span class="keyword">val</span> wait_all : 
  <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_error_monad/Error_monad/index.html#type-tzresult">Tezos_base.TzPervasives.Error_monad.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Waiting for all the detached function to finish, unless one of the function return an error.</p><p>If all detached functions succesfully compute a value, return unit.</p><p>If at least one function end with en error, cancel all the unfinished process, and fail with a message containing all the errors.</p></div></div></div></body></html>
