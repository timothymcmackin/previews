<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Storage_maintenance (octez-shell-libs.Tezos_shell_services.Storage_maintenance)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-shell-libs</a> &#x00BB; <a href="../index.html">Tezos_shell_services</a> &#x00BB; Storage_maintenance</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_shell_services.Storage_maintenance</span></code></h1><p>Storage maintenance configuration.</p><p>Storage maintenance aims to configure the internals of the storage maintenance procedure that aims to be run on regular basis.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-delay"><a href="#type-delay" class="anchor"></a><code><span><span class="keyword">type</span> delay</span><span> = </span></code><ol><li id="type-delay.Disabled" class="def variant constructor anchored"><a href="#type-delay.Disabled" class="anchor"></a><code><span>| </span><span><span class="constructor">Disabled</span></span></code></li><li id="type-delay.Custom" class="def variant constructor anchored"><a href="#type-delay.Custom" class="anchor"></a><code><span>| </span><span><span class="constructor">Custom</span> <span class="keyword">of</span> <span class="xref-unresolved">Stdlib</span>.Int32.t</span></code></li><li id="type-delay.Auto" class="def variant constructor anchored"><a href="#type-delay.Auto" class="anchor"></a><code><span>| </span><span><span class="constructor">Auto</span></span></code></li></ol></div><div class="spec-doc"><p>The type <code>delay</code> specifies whether or not a storage maintenance should be delayed or not. Setting it to <code>Disabled</code> will trigger the storage maintenance as soon as possible, that is, at the very beginning of a new cycle dawn. <code>Custom n</code> will trigger the storage maintenance n blocks after a new cycle dawn. <code>Auto</code> will trigger the storage maintenance after a delay that is determined automatically. For now, we enforce:</p><ul><li>an exclusion period: the early beginning of the cycle is not subject to storage maintenance -- it avoids triggering the maintenance shortly after a protocol activation or when the payouts are injected into the network</li><li>a trigger limit: the storage maintenance cannot be triggered after the second half of a cycle -- it avoids overlapping with the next cycle to come and increase too much the storage size For a given blocks_per_cycle, we have:</li><li>an exclusion period of 1/20th blocks_per_cycles</li><li>a trigger limit of 1/2 blocks_per_cycles</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delay_encoding"><a href="#val-delay_encoding" class="anchor"></a><code><span><span class="keyword">val</span> delay_encoding : <span><a href="#type-delay">delay</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_delay"><a href="#val-pp_delay" class="anchor"></a><code><span><span class="keyword">val</span> pp_delay : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-delay">delay</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_auto_delay"><a href="#val-default_auto_delay" class="anchor"></a><code><span><span class="keyword">val</span> default_auto_delay : <span><span class="label">blocks_per_cycle</span>:<span class="xref-unresolved">Stdlib</span>.Int32.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Int32.t</span></code></div><div class="spec-doc"><p><code>default_auto_delay ~blocks_per_cycle</code> returns a random number between <code>blocks_per_cycle / 20</code> and <code>blocks_per_cycle / 2</code>, in line with the <code>delay</code>'s description.</p></div></div></div></body></html>
