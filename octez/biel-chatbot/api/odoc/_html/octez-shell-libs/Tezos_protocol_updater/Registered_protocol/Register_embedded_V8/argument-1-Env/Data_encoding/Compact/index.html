<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Compact (octez-shell-libs.Tezos_protocol_updater.Registered_protocol.Register_embedded_V8.Env.Data_encoding.Compact)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../../../../index.html">octez-shell-libs</a> &#x00BB; <a href="../../../../../index.html">Tezos_protocol_updater</a> &#x00BB; <a href="../../../../index.html">Registered_protocol</a> &#x00BB; <a href="../../../index.html">Register_embedded_V8</a> &#x00BB; <a href="../../index.html">Env</a> &#x00BB; <a href="../index.html">Data_encoding</a> &#x00BB; Compact</nav><header class="odoc-preamble"><h1>Module <code><span>Data_encoding.Compact</span></code></h1><p>This module provides specialized encoding combinators that are implemented to reduce the size of the serialization result.</p><p>The main trick this module relies on is the notion of “shared tags”. In <code>Data_encoding</code>, the <code>union</code> combinator uses (at least) one byte every time it is used, to “tag” the output and distinguish between various disjunction cases. As a consequence, if <code>n</code> <code>union</code> are composed together to define one encoding, (at least) <code>n</code> bytes are being allocated. However, in practice, only few bits are used in each tags, which means the rest is “wasted.”</p><p>As an example, consider this type:</p><pre class="language-ocaml"><code>type t =
  | T1 of { f1 : int option; f2 : (int, bool) Either.t }
  | T2 of { f3: int }</code></pre><p>A value of <code>t</code> using the constructor <code>T1</code> will be serialized into a binary array of this form:</p><pre>      ┌────────┬─────────┬─────────────┬─────────┬─────────────┐
      │ tag(t) │ tag(f1) │ payload(f1) │ tag(f2) │ payload(f2) │
      └────────┴─────────┴─────────────┴─────────┴─────────────┘
        1 byte   1 byte    N bytes       1 byte    M bytes</pre><p>Where <code>tag(f)</code> is a value used by <code>Data_encoding</code> to distinguish between several encoding alternatives for <code>f</code>, and <code>payload(f)</code> is the resulting binary array.</p><p>For both <code>option</code> and <code>Either.t</code>, the tag of the encoding only uses one bit in practice. Which means that for <code>T1</code>, encoding the pair <code>(f1, f2)</code> needs two bits, but the default approach of <code>Data_encoding</code> uses two <i>bytes</i> instead. Similarly, to distinguish between <code>T1</code> and <code>T2</code> needs one bit, but the default approach is to use an additional tag (one additional <i>byte</i>).</p><p>This module provides an approach to tackle this issue, by allocating only one tag (<i>i.e.</i>, one byte) that is used to store the useful bits to distinguish between the disjunction cases. We call this tag the “shared tag” of the encoding. The bits of the shared tag describes precisely the layout of the encoded data.</p><p>For instance, considering a compact encoding for <code>t</code>, the third bit of the tag can be used to distinguish between <code>T1</code> and <code>T2</code>. In case the third bit is 0, the first bit of the tag determines the case of <code>option</code>, and the second the case of <code>Either.t</code>.</p><p>As a consequence the resulting binary array for the constructor <code>T1</code> is, using</p><ul><li><code>_</code> to represent meaningless bits,</li><li><code>0</code> and <code>1</code> to represent actual bit values,</li><li><code>e</code> to represent the bit used to distinguish the <code>Either</code> case of <code>f2</code>, and</li><li><code>o</code> to represent the bit used to distinguish the <code>Option</code> case of <code>f1</code>:</li></ul><pre>      ┌──────────┬─────────────┬─────────────┐
      │ _____0eo │ payload(f1) │ payload(f2) │
      └──────────┴─────────────┴─────────────┘
        1 byte     N bytes       M bytes</pre><p>while the resulting binary array for the constructor <code>T2</code> is</p><pre>      ┌──────────┬─────────────┐
      │ _____100 │ payload(f3) │
      └──────────┴─────────────┘
        1 byte     N bytes</pre></header><nav class="odoc-toc"><ul><li><a href="#combinators">Combinators</a><ul><li><a href="#base-types">Base types</a></li><li><a href="#conversion">Conversion</a></li><li><a href="#conjunctions">Conjunctions</a></li><li><a href="#disjunctions">Disjunctions</a></li></ul></li><li><a href="#custom">Custom</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = <span><span class="type-var">'a</span> <a href="../../../../../../../octez-libs/Data_encoding/V1/Encoding/Compact/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.Compact.t</a></span></span></code></div><div class="spec-doc"><p>The description of a compact encoding.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="optlabel">?tag_size</span>:<span>[ `Uint0 <span>| `Uint8</span> <span>| `Uint16</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Turn a compact encoding into a regular <a href="../index.html#type-t"><code>Data_encoding.t</code></a>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">tag_size</span> <p>controls the size of the tag used to discriminate the values. Note that in data-encoding, all the writes and reads are byte aligned so the tag must fit in either 0 (<code>`Uint0</code>), 1 (<code>`Uint8</code>), or 2 (<code>`Uint16</code>) bytes.</p><p>The default is <code>`Uint0</code>, i.e., no tag at all. This is can only represent values which use 0 bits of tags.</p><p>It is recommended to set the <code>tag_size</code> explicitly.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the shared tags cannot fit in <code>tag_size</code> space.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tag_bit_count"><a href="#val-tag_bit_count" class="anchor"></a><code><span><span class="keyword">val</span> tag_bit_count : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>tag_bit_count c</code> is the number of bits of tag that a compact encoding uses.</p></div></div><h2 id="combinators"><a href="#combinators" class="anchor"></a>Combinators</h2><p>Similarly to <code>Data_encoding</code>, we provide various combinators to compose compact encoding together.</p><h3 id="base-types"><a href="#base-types" class="anchor"></a>Base types</h3><div class="odoc-spec"><div class="spec type anchored" id="type-void"><a href="#type-void" class="anchor"></a><code><span><span class="keyword">type</span> void</span></code></div><div class="spec-doc"><p>A type with no inhabitant.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-void"><a href="#val-void" class="anchor"></a><code><span><span class="keyword">val</span> void : <span><a href="#type-void">void</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A compact encoding used to denote an impossible case inside of conjunction operators such as <code>union</code>.</p><p>Uses 0 bit of tag.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-refute"><a href="#val-refute" class="anchor"></a><code><span><span class="keyword">val</span> refute : <span><a href="#type-void">void</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>refute x</code> can be used to refute a branch of a <code>match</code> which exhibits a value of type <code>void</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unit"><a href="#val-unit" class="anchor"></a><code><span><span class="keyword">val</span> unit : <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A compact encoding of the singleton value <code>unit</code>, which has zero memory footprint.</p><p>Uses zero (0) bits of tag.</p><p>In JSON it is represented as the empty object <code>{}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-null"><a href="#val-null" class="anchor"></a><code><span><span class="keyword">val</span> null : <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A compact encoding of the singleton value <code>unit</code>, which has zero memory footprint.</p><p>Uses zero (0) bits of tag.</p><p>In JSON it is represented as <code>null</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Efficient encoding of boolean values. It uses one (1) bit in the shared tag, and zero bit in the payload.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-payload"><a href="#val-payload" class="anchor"></a><code><span><span class="keyword">val</span> payload : <span><span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>payload encoding</code> unconditionally uses <code>encoding</code> in the payload, and uses zero (0) bit in the shared tag.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-option"><a href="#val-option" class="anchor"></a><code><span><span class="keyword">val</span> option : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Uses one (1) bit in the tag to encode an option.</p></div></div><h3 id="conversion"><a href="#conversion" class="anchor"></a>Conversion</h3><div class="odoc-spec"><div class="spec value anchored" id="val-conv"><a href="#val-conv" class="anchor"></a><code><span><span class="keyword">val</span> conv : <span><span class="optlabel">?json</span>:<span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>conv ?json f g e</code> reuses the encoding <code>e</code> for type <code>b</code> to encode a type <code>a</code> using the isomorphism <code>(f, g)</code>. The optional argument allows to overwrite the encoding used for JSON, in place of the one computed by default.</p></div></div><h3 id="conjunctions"><a href="#conjunctions" class="anchor"></a>Conjunctions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-tup1"><a href="#val-tup1" class="anchor"></a><code><span><span class="keyword">val</span> tup1 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tup1 e</code> wraps the underlying encoding of <code>e</code> in a <code>tup1</code> (from the parent module). This is only useful in that, provided you use <code>make ~tag_size:`Uint0</code> to translate the returned compact encoding, it allows you to call <code>merge_tups</code> on it.</p><p>Uses as many bits of tag as <code>e</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup2"><a href="#val-tup2" class="anchor"></a><code><span><span class="keyword">val</span> tup2 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tup2 e1 e2</code> concatenates the shared tags and payloads of <code>e1</code> and <code>e2</code>.</p><p>Uses as many bits of tags as the sum of the tags used by its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup3"><a href="#val-tup3" class="anchor"></a><code><span><span class="keyword">val</span> tup3 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'c</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tup3 e1 e2 e3</code> concatenates the shared tags and payloads of <code>e1</code>, <code>e2</code>, and <code>e3</code>.</p><p>Uses as many bits of tags as the sum of the tags used by its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup4"><a href="#val-tup4" class="anchor"></a><code><span><span class="keyword">val</span> tup4 : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'c</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'d</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tup4 e1 e2 e3 e4</code> concatenates the shared tags and payloads of <code>e1</code>, <code>e2</code>, <code>e3</code> and <code>e4</code>.</p><p>Uses as many bits of tags as the sum of the tags used by its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup5"><a href="#val-tup5" class="anchor"></a><code><span><span class="keyword">val</span> tup5 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup6"><a href="#val-tup6" class="anchor"></a><code><span><span class="keyword">val</span> tup6 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup7"><a href="#val-tup7" class="anchor"></a><code><span><span class="keyword">val</span> tup7 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup8"><a href="#val-tup8" class="anchor"></a><code><span><span class="keyword">val</span> tup8 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f8</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup9"><a href="#val-tup9" class="anchor"></a><code><span><span class="keyword">val</span> tup9 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f8</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f9</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tup10"><a href="#val-tup10" class="anchor"></a><code><span><span class="keyword">val</span> tup10 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f8</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f9</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f10</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span> * <span class="type-var">'f10</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-field"><a href="#type-field" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a field</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-req"><a href="#val-req" class="anchor"></a><code><span><span class="keyword">val</span> req : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-field">field</a></span></span></code></div><div class="spec-doc"><p><code>req &quot;f&quot; compact</code> can be used in conjunction with <code>objN</code> to create compact encoding with more readable JSON encoding, as an alternative of <code>tupN</code>. The JSON output is a dictionary which contains the field <code>f</code> with a value encoded using <code>compact</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-opt"><a href="#val-opt" class="anchor"></a><code><span><span class="keyword">val</span> opt : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-field">field</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-req"><code>req</code></a>, but the field is optional.</p><p>An <code>objN</code> compact encoding uses as many bits of tags as its number of <code>opt</code> fields.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj1"><a href="#val-obj1" class="anchor"></a><code><span><span class="keyword">val</span> obj1 : <span><span><span class="type-var">'a</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>obj1</code> can be used in conjunction with <code>req</code> or <code>opt</code> to produce more readable JSON outputs.</p><p>Uses as many bits of tags as there are <code>opt</code> fields in its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj2"><a href="#val-obj2" class="anchor"></a><code><span><span class="keyword">val</span> obj2 : <span><span><span class="type-var">'a</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>An alternative to <code>tup2</code> which can be used in conjunction with <a href="#val-req"><code>req</code></a> and <a href="#val-opt"><code>opt</code></a> to produce more readable JSON outputs based on dictionary.</p><p>Uses as many bits of tags as there are <code>opt</code> fields in its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj3"><a href="#val-obj3" class="anchor"></a><code><span><span class="keyword">val</span> obj3 : <span><span><span class="type-var">'a</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'c</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>An alternative to <code>tup3</code> which can be used in conjunction with <a href="#val-req"><code>req</code></a> and <a href="#val-opt"><code>opt</code></a> to produce more readable JSON outputs based on dictionary.</p><p>Uses as many bits of tags as there are <code>opt</code> fields in its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj4"><a href="#val-obj4" class="anchor"></a><code><span><span class="keyword">val</span> obj4 : 
  <span><span><span class="type-var">'a</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'b</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'c</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'d</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>An alternative to <code>tup4</code> which can be used in conjunction with <a href="#val-req"><code>req</code></a> and <a href="#val-opt"><code>opt</code></a> to produce more readable JSON outputs based on dictionary.</p><p>Uses as many bits of tags as there are <code>opt</code> fields in its arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj5"><a href="#val-obj5" class="anchor"></a><code><span><span class="keyword">val</span> obj5 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj6"><a href="#val-obj6" class="anchor"></a><code><span><span class="keyword">val</span> obj6 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj7"><a href="#val-obj7" class="anchor"></a><code><span><span class="keyword">val</span> obj7 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj8"><a href="#val-obj8" class="anchor"></a><code><span><span class="keyword">val</span> obj8 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f8</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj9"><a href="#val-obj9" class="anchor"></a><code><span><span class="keyword">val</span> obj9 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f8</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f9</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-obj10"><a href="#val-obj10" class="anchor"></a><code><span><span class="keyword">val</span> obj10 : 
  <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f8</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f9</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'f10</span> <a href="#type-field">field</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span> * <span class="type-var">'f10</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span>int32 <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A compact encoding for <code>int32</code> values. It uses 2 bits in the shared tag, to determine how many bytes are used in the payload:</p><ul><li><code>00</code>: from 0 to 255, one byte.</li><li><code>01</code>: from 256 to 65,535, two bytes.</li><li><code>10</code>: from 65,536 to <code>Int32.max_int</code> and for negative values, four bytes.</li></ul><p>Note that by itself, this compact encoding is not necessarily more economical in space. However, in combination with other compact encodings (say, when you have two bits of tag to spare anyway) or given a very skewed distribution of values (say, when the vast majority of your values are in the 0–255 interval), then it can help you save some space.</p><p>Uses two (2) bits of tag.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span>int64 <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>A compact encoding for <code>int64</code> values. It uses 2 bits in the shared tag, to determine how many bytes are used in the payload:</p><ul><li><code>00</code>: from 0 to 255, one byte.</li><li><code>01</code>: from 256 to 65,535, two bytes.</li><li><code>10</code>: from 65,536 to 4,294,967,295 four bytes.</li><li><code>11</code>: from 4,294,967,295 and for negative values eight bytes.</li></ul><p>See <a href="#val-int32"><code>int32</code></a> for usage recommendations.</p><p>Uses two (2) bits of tag.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><span class="label">bits</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>list ~bits:n encoding</code> uses <code>n</code> bits in the shared tag to encode the size of small lists.</p><p>For instance, <code>list ~bits:2 encoding</code>,</p><ul><li><code>00</code>: the payload is empty, because it is the empty list</li><li><code>01</code>: the singleton list, whose element is encoded using <code>encoding</code>.</li><li><code>10</code>: a list of two elements encoded with <code>encoding</code></li><li><code>11</code>: a list of more than two elements, prefixed with its encoded size (i.e., the number of bytes it takes to represent the whole value) (which uses 4 bytes)</li></ul><p>With <code>~bits:3</code>, lists of 0 to 6 items are encoded with tags <code>000</code> to <code>110</code>, and lists of 7 or more are encoded with tag <code>111</code> and the length.</p><p>Uses <code>n</code> bits of tags.</p></div></div><h3 id="disjunctions"><a href="#disjunctions" class="anchor"></a>Disjunctions</h3><div class="odoc-spec"><div class="spec type anchored" id="type-case"><a href="#type-case" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a case</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-case"><a href="#val-case" class="anchor"></a><code><span><span class="keyword">val</span> case : 
  <span><span class="label">title</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?description</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-case">case</a></span></span></code></div><div class="spec-doc"><p>Usage: <code>case name encode decode encoding</code></p><p>Intended to be used inside a <code>union</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-union"><a href="#val-union" class="anchor"></a><code><span><span class="keyword">val</span> union : <span><span class="optlabel">?union_tag_bits</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?cases_tag_bits</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'a</span> <a href="#type-case">case</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>union cases</code> creates a new compact encoding to encompass a disjunction of cases.</p><p>The value uses some tag bits to distinguish the different cases of the union (see discussion of parameter <code>union_tag_bits</code>) and some tag bits (potentially 0) to distinguish the values within a case (see discussion of parameter <code>cases_tag_bits</code>).</p><p>E.g., Given <code>type t = A of bool | B of int option</code> and the encoding</p><pre>      let c =
        union [
          case &quot;A&quot; (function A b -&gt; Some b | _ -&gt; None) (fun b -&gt; A b) bool;
          case &quot;B&quot; (function B i -&gt; Some i | _ -&gt; None) (fun i -&gt; B b) (option (payload int));
      in
      make ~tag_size:`Uint8 c</pre><p>then a value can have either of the following 4 tags:</p><ul><li>0b00000000: case <code>A</code>, <code>false</code></li><li>0b00000001: case <code>A</code>, <code>true</code></li><li>0b00000010: case <code>B</code>, <code>Some</code> (a payload of 4 bytes follows)</li><li>0b00000011: case <code>B</code>, <code>None</code></li></ul><p>In other words, the second bit of this tag is used to discriminate the cases of the union, whilst the first bit is used to discriminate within each case.</p><p>Note that the compact union can be combined with more compact encoding before being passed to <code>make</code> in which case the two bits of tags will be combined with the tags of the other compact encodings. E.g., <code>make ~tag_size:`Uint8 (tup2 c c)</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">union_tag_bits</span> <p>is the number of bits used to distinguish the different cases of the union. For example, if the union has 4 cases (i.e., if <code>List.length cases = 4</code>) then you can use <code>~union_tag_bits:2</code>.</p><p>If not provided explicitly, <code>union_tag_bits</code> is inferred: it is set to the smallest value which can accommodate the provided <code>cases</code>.</p><p>It is recommended to set <code>union_tag_bits</code> explicitly.</p><p>You can over-provision the <code>union_tag_bits</code> if you expect the <code>cases</code> to grow in the future.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if the value passed for <code>union_tag_bits</code> is not sufficient to distinguish between the <code>cases</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">cases_tag_bits</span> <p>is the number of bits that each of the <code>cases</code> can use. This is only useful if the cases use more than 0 bits of tag.</p><p>It is recommended to set <code>cases_tag_bits</code> explicitly if you need the layout to be stable even if the <code>cases</code> or one of its element changes.</p><p>You can over-provision the <code>cases_tag_bits</code> if you expect one of the cases to change to use more bits of tag or if you expect that a new case using more tag bits will be added in the future.</p><p>E.g., passing <code>~cases_tag_bits:7</code> to the <code>union</code> in the example above will cause the values to be represented as follows:</p><ul><li>0b00000000: case <code>A</code>, <code>false</code></li><li>0b00000001: case <code>A</code>, <code>true</code></li><li>0b10000000: case <code>B</code>, <code>Some</code> (a payload of 4 bytes follows)</li><li>0b10000001: case <code>B</code>, <code>None</code></li></ul></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if one of the elements of <code>cases</code> needs more than <code>cases_tag_bits</code> bits of tag.</p><p>E.g., <code>union ~cases_tag_bits:0 [case &quot;Bool&quot; Option.some Fun.id bool]</code> raises <code>Invalid_argument</code> because <a href="#val-bool"><code>bool</code></a> uses one bit of tag which is more than <code>0</code>.</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if <code>cases</code> is empty.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-void_case"><a href="#val-void_case" class="anchor"></a><code><span><span class="keyword">val</span> void_case : <span><span class="label">title</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-case">case</a></span></span></code></div><div class="spec-doc"><p><code>void_case ~title</code> is an impossible case. It is provided so you can add unused tags within a union. E.g., <code>union [case _; void_case ~title:&quot;reserved-for-v04-compatibility&quot;; case _; case _]</code> uses two bits of tag for the discrimination of the union, but the tag <code>01</code> is unused (reserved for some version compatibility).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-or_int32"><a href="#val-or_int32" class="anchor"></a><code><span><span class="keyword">val</span> or_int32 : 
  <span><span class="label">int32_title</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">alt_title</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?alt_description</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../index.html#type-encoding">encoding</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(int32, <span class="type-var">'a</span>)</span> <a href="../../Either/index.html#type-t">Either.t</a></span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>or_int32 ~i32_title ~alt_title ?alt_description c</code> creates a new compact encoding for the disjunction of any type <code>a</code> (see <a href="#val-case"><code>case</code></a>) with <code>int32</code>. It uses the same number of bits as <a href="#val-int32"><code>int32</code></a>, that is 2, and uses the spare tag (<code>11</code>) within this size for values of type <code>a</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">i32_title</span> <p>is used as a prefix to each of the int32 cases' title.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">alt_title</span> <p>is used as the title of the alt case. (See <a href="#val-case"><code>case</code></a> and <a href="#val-union"><code>union</code></a> for details.)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">alt_description</span> <p>is used as the description of the alternate case. (See <a href="#val-case"><code>case</code></a> and <a href="#val-union"><code>union</code></a> for details.)</p></li></ul></div></div><h2 id="custom"><a href="#custom" class="anchor"></a>Custom</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Custom"><a href="#module-Custom" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Custom/index.html">Custom</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>This module can be used to write compact encoding for complex types without relying on the existing combinators.</p></div></div></div></body></html>
