<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conflict_map (octez-shell-libs.Tezos_shell.Prevalidation.Make.Proto.Plugin.Conflict_map)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../../index.html">octez-shell-libs</a> &#x00BB; <a href="../../../../../index.html">Tezos_shell</a> &#x00BB; <a href="../../../../index.html">Prevalidation</a> &#x00BB; <a href="../../../index.html">Make</a> &#x00BB; <a href="../../index.html">Proto</a> &#x00BB; <a href="../index.html">Plugin</a> &#x00BB; Conflict_map</nav><header class="odoc-preamble"><h1>Module <code><span>Plugin.Conflict_map</span></code></h1><p>The purpose of this module is to provide the <code>fee_needed_to_replace_by_fee</code> function. For this function to be correct, the caller must maintain the state of type <code>t</code> by calling <code>update</code> on each successfully validated operation and its induced replacements.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Internal state needed by <code>fee_needed_to_replace_by_fee</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Initial state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">new_operation</span>:<a href="../../index.html#type-operation">operation</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">replacements</span>:<span><a href="../../index.html#type-operation">operation</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Removes all the <code>replacements</code> from the state then adds <code>new_operation</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fee_needed_to_replace_by_fee"><a href="#val-fee_needed_to_replace_by_fee" class="anchor"></a><code><span><span class="keyword">val</span> fee_needed_to_replace_by_fee : 
  <span><a href="../index.html#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">candidate_op</span>:<a href="../../index.html#type-operation">operation</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">conflict_map</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int64 option</span></span></code></div><div class="spec-doc"><p>This function should be called when <a href="../../Mempool/index.html#val-add_operation"><code>Mempool.add_operation</code></a> has returned <code>Unchanged</code>. This means that the <code>candidate_op</code> has been rejected because there was a conflict with an pre-existing operation and the <a href="../index.html#val-conflict_handler"><code>conflict_handler</code></a> has returned <code>`Keep</code>. This function returns the minimal fee (in mutez) that <code>candidate_op</code> would need so that the <a href="../index.html#val-conflict_handler"><code>conflict_handler</code></a> would return <code>`Replace</code> instead. If no such fee exists, then the function returns <code>None</code>.</p></div></div></div></body></html>
