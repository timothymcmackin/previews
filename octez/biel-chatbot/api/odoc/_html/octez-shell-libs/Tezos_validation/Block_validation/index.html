<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Block_validation (octez-shell-libs.Tezos_validation.Block_validation)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-shell-libs</a> &#x00BB; <a href="../index.html">Tezos_validation</a> &#x00BB; Block_validation</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_validation.Block_validation</span></code></h1><p>This module is a proxy for the shell of the protocol (for the application part). The main function of this module is <code>apply</code> whichs calls the one of the protocol.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-operation"><a href="#type-operation" class="anchor"></a><code><span><span class="keyword">type</span> operation</span></code></div><div class="spec-doc"><p>This type is used to represent an operation contained in a block that we want to validate and/or apply.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mk_operation"><a href="#val-mk_operation" class="anchor"></a><code><span><span class="keyword">val</span> mk_operation : 
  <span><span class="optlabel">?known_valid_operation_set</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/Set/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Operation/index.html#type-t">Tezos_base.TzPervasives.Operation.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-operation">operation</a></span></code></div><div class="spec-doc"><p>Create an <code>operation</code> from the <code>Operation.t</code> by hashing it and by checking whether the protocol should check the operation's signature. The signature should always be checked unless the operation hash is already known in the <code>known_valid_operations_set</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-operation_encoding"><a href="#val-operation_encoding" class="anchor"></a><code><span><span class="keyword">val</span> operation_encoding : <span><a href="#type-operation">operation</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-validation_store"><a href="#type-validation_store" class="anchor"></a><code><span><span class="keyword">type</span> validation_store</span><span> = </span><span>{</span></code><ol><li id="type-validation_store.resulting_context_hash" class="def record field anchored"><a href="#type-validation_store.resulting_context_hash" class="anchor"></a><code><span>resulting_context_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Context_hash/index.html#type-t">Tezos_base.TzPervasives.Context_hash.t</a>;</span></code></li><li id="type-validation_store.timestamp" class="def record field anchored"><a href="#type-validation_store.timestamp" class="anchor"></a><code><span>timestamp : <a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a>;</span></code></li><li id="type-validation_store.message" class="def record field anchored"><a href="#type-validation_store.message" class="anchor"></a><code><span>message : <span>string option</span>;</span></code></li><li id="type-validation_store.max_operations_ttl" class="def record field anchored"><a href="#type-validation_store.max_operations_ttl" class="anchor"></a><code><span>max_operations_ttl : int;</span></code></li><li id="type-validation_store.last_finalized_block_level" class="def record field anchored"><a href="#type-validation_store.last_finalized_block_level" class="anchor"></a><code><span>last_finalized_block_level : <span class="xref-unresolved">Stdlib</span>.Int32.t;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Oldest block for which reorganizations can happen</p><span class="comment-delim">*)</span></div></li><li id="type-validation_store.last_preserved_block_level" class="def record field anchored"><a href="#type-validation_store.last_preserved_block_level" class="anchor"></a><code><span>last_preserved_block_level : <span class="xref-unresolved">Stdlib</span>.Int32.t;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-may_patch_protocol"><a href="#val-may_patch_protocol" class="anchor"></a><code><span><span class="keyword">val</span> may_patch_protocol : 
  <span><span class="label">user_activated_upgrades</span>:<a href="../../../octez-libs/Tezos_base/User_activated/index.html#type-upgrades">Tezos_base.TzPervasives.User_activated.upgrades</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">user_activated_protocol_overrides</span>:
    <a href="../../../octez-libs/Tezos_base/User_activated/index.html#type-protocol_overrides">Tezos_base.TzPervasives.User_activated.protocol_overrides</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:<span class="xref-unresolved">Stdlib</span>.Int32.t <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-proto-libs/Tezos_protocol_environment/index.html#type-validation_result">Tezos_protocol_environment.validation_result</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-proto-libs/Tezos_protocol_environment/index.html#type-validation_result">Tezos_protocol_environment.validation_result</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_testchain_status"><a href="#val-update_testchain_status" class="anchor"></a><code><span><span class="keyword">val</span> update_testchain_status : 
  <span><a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_proto_environment_version_increasing"><a href="#val-check_proto_environment_version_increasing" class="anchor"></a><code><span><span class="keyword">val</span> check_proto_environment_version_increasing : 
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Protocol/index.html#type-env_version">Tezos_base.TzPervasives.Protocol.env_version</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Protocol/index.html#type-env_version">Tezos_base.TzPervasives.Protocol.env_version</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>check_proto_environment_version_increasing hash before after</code> returns successfully if the environment version stays the same or increases from <code>before</code> to <code>after</code>. Otherwise, an <code>Invalid_protocol_environment_transition</code> error is returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_test_chain"><a href="#val-init_test_chain" class="anchor"></a><code><span><span class="keyword">val</span> init_test_chain : 
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Chain_id/index.html#type-t">Tezos_base.TzPervasives.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>init_test_chain</code> must only be called on a forking block.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-operation_metadata"><a href="#type-operation_metadata" class="anchor"></a><code><span><span class="keyword">type</span> operation_metadata</span><span> = </span></code><ol><li id="type-operation_metadata.Metadata" class="def variant constructor anchored"><a href="#type-operation_metadata.Metadata" class="anchor"></a><code><span>| </span><span><span class="constructor">Metadata</span> <span class="keyword">of</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/Bytes/index.html#type-t">Tezos_base.TzPervasives.Bytes.t</a></span></code></li><li id="type-operation_metadata.Too_large_metadata" class="def variant constructor anchored"><a href="#type-operation_metadata.Too_large_metadata" class="anchor"></a><code><span>| </span><span><span class="constructor">Too_large_metadata</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-operation_metadata_equal"><a href="#val-operation_metadata_equal" class="anchor"></a><code><span><span class="keyword">val</span> operation_metadata_equal : <span><a href="#type-operation_metadata">operation_metadata</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-operation_metadata">operation_metadata</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-operation_metadata_encoding"><a href="#val-operation_metadata_encoding" class="anchor"></a><code><span><span class="keyword">val</span> operation_metadata_encoding : 
  <span><a href="#type-operation_metadata">operation_metadata</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ops_metadata"><a href="#type-ops_metadata" class="anchor"></a><code><span><span class="keyword">type</span> ops_metadata</span><span> = </span></code><ol><li id="type-ops_metadata.No_metadata_hash" class="def variant constructor anchored"><a href="#type-ops_metadata.No_metadata_hash" class="anchor"></a><code><span>| </span><span><span class="constructor">No_metadata_hash</span> <span class="keyword">of</span> <span><span><a href="#type-operation_metadata">operation_metadata</a> list</span> list</span></span></code></li><li id="type-ops_metadata.Metadata_hash" class="def variant constructor anchored"><a href="#type-ops_metadata.Metadata_hash" class="anchor"></a><code><span>| </span><span><span class="constructor">Metadata_hash</span> <span class="keyword">of</span> <span><span><span>(<a href="#type-operation_metadata">operation_metadata</a>
                  * <a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_metadata_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_metadata_hash.t</a>)</span>
                   list</span>
                   list</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Shell_header_hash"><a href="#module-Shell_header_hash" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Shell_header_hash/index.html">Shell_header_hash</a></span><span> : <a href="../../../octez-libs/Tezos_crypto/Intfs/module-type-HASH/index.html">Tezos_crypto.Intfs.HASH</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-result"><a href="#type-result" class="anchor"></a><code><span><span class="keyword">type</span> result</span><span> = </span><span>{</span></code><ol><li id="type-result.shell_header_hash" class="def record field anchored"><a href="#type-result.shell_header_hash" class="anchor"></a><code><span>shell_header_hash : <a href="Shell_header_hash/index.html#type-t">Shell_header_hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This field is used as a (local) unique identifier for blocks in order to implement the preapply cache mechanism.</p><span class="comment-delim">*)</span></div></li><li id="type-result.validation_store" class="def record field anchored"><a href="#type-result.validation_store" class="anchor"></a><code><span>validation_store : <a href="#type-validation_store">validation_store</a>;</span></code></li><li id="type-result.block_metadata" class="def record field anchored"><a href="#type-result.block_metadata" class="anchor"></a><code><span>block_metadata : bytes * <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_metadata_hash/index.html#type-t">Tezos_base.TzPervasives.Block_metadata_hash.t</a> option</span>;</span></code></li><li id="type-result.ops_metadata" class="def record field anchored"><a href="#type-result.ops_metadata" class="anchor"></a><code><span>ops_metadata : <a href="#type-ops_metadata">ops_metadata</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-apply_result"><a href="#type-apply_result" class="anchor"></a><code><span><span class="keyword">type</span> apply_result</span><span> = </span><span>{</span></code><ol><li id="type-apply_result.result" class="def record field anchored"><a href="#type-apply_result.result" class="anchor"></a><code><span>result : <a href="#type-result">result</a>;</span></code></li><li id="type-apply_result.cache" class="def record field anchored"><a href="#type-apply_result.cache" class="anchor"></a><code><span>cache : <a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-cache">Tezos_protocol_environment.Context.cache</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-result_encoding"><a href="#val-result_encoding" class="anchor"></a><code><span><span class="keyword">val</span> result_encoding : <span><a href="#type-result">result</a> <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-preapply_result_encoding"><a href="#val-preapply_result_encoding" class="anchor"></a><code><span><span class="keyword">val</span> preapply_result_encoding : 
  <span><span>(<a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-shell_header">Tezos_base.TzPervasives.Block_header.shell_header</a>
   * <span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> <a href="../../Tezos_shell_services/Preapply_result/index.html#type-t">Tezos_shell_services.Preapply_result.t</a></span> list</span>)</span>
    <a href="../../../octez-libs/Data_encoding/index.html#type-t">Tezos_base.TzPervasives.Data_encoding.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_liveness"><a href="#val-check_liveness" class="anchor"></a><code><span><span class="keyword">val</span> check_liveness : 
  <span><span class="label">live_blocks</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/Set/index.html#type-t">Tezos_base.TzPervasives.Block_hash.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">live_operations</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/Set/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-operation">operation</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>check_liveness live_blocks live_operations hash ops</code> checks there is no duplicate operation and that is not out-of-date</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-apply_environment"><a href="#type-apply_environment" class="anchor"></a><code><span><span class="keyword">type</span> apply_environment</span><span> = </span><span>{</span></code><ol><li id="type-apply_environment.max_operations_ttl" class="def record field anchored"><a href="#type-apply_environment.max_operations_ttl" class="anchor"></a><code><span>max_operations_ttl : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>time to live of an operation</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.chain_id" class="def record field anchored"><a href="#type-apply_environment.chain_id" class="anchor"></a><code><span>chain_id : <a href="../../../octez-libs/Tezos_crypto/Hashed/Chain_id/index.html#type-t">Tezos_base.TzPervasives.Chain_id.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>chain_id of the current branch</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.predecessor_block_header" class="def record field anchored"><a href="#type-apply_environment.predecessor_block_header" class="anchor"></a><code><span>predecessor_block_header : <a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>header of the predecessor block being validated</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.predecessor_context" class="def record field anchored"><a href="#type-apply_environment.predecessor_context" class="anchor"></a><code><span>predecessor_context : <a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>context associated to the predecessor block</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.predecessor_resulting_context_hash" class="def record field anchored"><a href="#type-apply_environment.predecessor_resulting_context_hash" class="anchor"></a><code><span>predecessor_resulting_context_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Context_hash/index.html#type-t">Tezos_base.TzPervasives.Context_hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>predecessor block resulting context hash</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.predecessor_block_metadata_hash" class="def record field anchored"><a href="#type-apply_environment.predecessor_block_metadata_hash" class="anchor"></a><code><span>predecessor_block_metadata_hash : <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_metadata_hash/index.html#type-t">Tezos_base.TzPervasives.Block_metadata_hash.t</a>
                                    option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>hash of block header metadata of the predecessor block</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.predecessor_ops_metadata_hash" class="def record field anchored"><a href="#type-apply_environment.predecessor_ops_metadata_hash" class="anchor"></a><code><span>predecessor_ops_metadata_hash : <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_metadata_list_list_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_metadata_list_list_hash.t</a>
                                  option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>hash of operation metadata of the predecessor block</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.user_activated_upgrades" class="def record field anchored"><a href="#type-apply_environment.user_activated_upgrades" class="anchor"></a><code><span>user_activated_upgrades : <a href="../../../octez-libs/Tezos_base/User_activated/index.html#type-upgrades">Tezos_base.TzPervasives.User_activated.upgrades</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>user activated upgrades</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.user_activated_protocol_overrides" class="def record field anchored"><a href="#type-apply_environment.user_activated_protocol_overrides" class="anchor"></a><code><span>user_activated_protocol_overrides : <a href="../../../octez-libs/Tezos_base/User_activated/index.html#type-protocol_overrides">Tezos_base.TzPervasives.User_activated.protocol_overrides</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>user activated protocol overrides</p><span class="comment-delim">*)</span></div></li><li id="type-apply_environment.operation_metadata_size_limit" class="def record field anchored"><a href="#type-apply_environment.operation_metadata_size_limit" class="anchor"></a><code><span>operation_metadata_size_limit : <a href="../../Tezos_shell_services/Shell_limits/index.html#type-operation_metadata_size_limit">Tezos_shell_services.Shell_limits.operation_metadata_size_limit</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>size limit for operation metadata that should be written on disk</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-apply"><a href="#val-apply" class="anchor"></a><code><span><span class="keyword">val</span> apply : 
  <span><span class="optlabel">?simulate</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?cached_result</span>:<span>(<a href="#type-apply_result">apply_result</a> * <a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?should_validate</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-apply_environment">apply_environment</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-source_of_cache">Tezos_protocol_environment.Context.source_of_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-operation">operation</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-apply_result">apply_result</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>apply env header ops</code> gets the protocol <code>P</code> of the context of the predecessor block and calls successively: 1. <code>P.begin_application</code> 2. <code>P.apply</code> 3. <code>P.finalize_block</code></p><p><code>should_validate</code> when set (default), triggers the block validation before applying it, see <code>validate</code>. If it is set to <code>false</code> the given block must have been validated.</p><p>If <code>simulate</code> is true, the context resulting from the application is not committed to disk using `Context.commit`, only the commit hash is computed, using `Context.hash`. Set to false by default.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-validate"><a href="#val-validate" class="anchor"></a><code><span><span class="keyword">val</span> validate : 
  <span><span class="label">chain_id</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Chain_id/index.html#type-t">Tezos_base.TzPervasives.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_block_header</span>:<a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_context</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_resulting_context_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Context_hash/index.html#type-t">Tezos_base.TzPervasives.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-source_of_cache">Tezos_protocol_environment.Context.source_of_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-operation">operation</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>validate chain_id ~predecessor_block_header
    ~predecessor_block_hash ~predecessor_context
    ~predecessor_resulting_context_hash ~cache header ops</code> gets the protocol <code>P</code> of the context of the predecessor block and calls successively: 1. <code>P.begin_validate</code> 2. <code>P.validate_operation</code> 3. <code>P.finalize_validation</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-preapply"><a href="#val-preapply" class="anchor"></a><code><span><span class="keyword">val</span> preapply : 
  <span><span class="label">chain_id</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Chain_id/index.html#type-t">Tezos_base.TzPervasives.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">user_activated_upgrades</span>:<a href="../../../octez-libs/Tezos_base/User_activated/index.html#type-upgrades">Tezos_base.User_activated.upgrades</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">user_activated_protocol_overrides</span>:
    <a href="../../../octez-libs/Tezos_base/User_activated/index.html#type-protocol_overrides">Tezos_base.User_activated.protocol_overrides</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">operation_metadata_size_limit</span>:
    <a href="../../Tezos_shell_services/Shell_limits/index.html#type-operation_metadata_size_limit">Tezos_shell_services.Shell_limits.operation_metadata_size_limit</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">timestamp</span>:<a href="../../../octez-libs/Tezos_base/Time/Protocol/index.html#type-t">Tezos_base.TzPervasives.Time.Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">protocol_data</span>:bytes <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">live_blocks</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/Set/index.html#type-t">Tezos_base.TzPervasives.Block_hash.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">live_operations</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_hash/Set/index.html#type-t">Tezos_base.TzPervasives.Operation_hash.Set.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_context</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_resulting_context_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Context_hash/index.html#type-t">Tezos_base.TzPervasives.Context_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_shell_header</span>:<a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-shell_header">Tezos_base.TzPervasives.Block_header.shell_header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_max_operations_ttl</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_block_metadata_hash</span>:
    <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_metadata_hash/index.html#type-t">Tezos_base.TzPervasives.Block_metadata_hash.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_ops_metadata_hash</span>:
    <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_metadata_list_list_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_metadata_list_list_hash.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-source_of_cache">Tezos_protocol_environment.Context.source_of_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-operation">operation</a> list</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span>(<a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-shell_header">Tezos_base.TzPervasives.Block_header.shell_header</a>
    * <span><span><a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-error">Tezos_base.TzPervasives.error</a> <a href="../../Tezos_shell_services/Preapply_result/index.html#type-t">Tezos_shell_services.Preapply_result.t</a></span> list</span>)</span>
   * <span>(<a href="#type-apply_result">apply_result</a> * <a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a>)</span>)</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recompute_metadata"><a href="#val-recompute_metadata" class="anchor"></a><code><span><span class="keyword">val</span> recompute_metadata : 
  <span><span class="label">chain_id</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Chain_id/index.html#type-t">Tezos_base.TzPervasives.Chain_id.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_block_header</span>:<a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_context</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-t">Tezos_protocol_environment.Context.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_block_metadata_hash</span>:
    <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_metadata_hash/index.html#type-t">Tezos_base.TzPervasives.Block_metadata_hash.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor_ops_metadata_hash</span>:
    <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Operation_metadata_list_list_hash/index.html#type-t">Tezos_base.TzPervasives.Operation_metadata_list_list_hash.t</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">block_header</span>:<a href="../../../octez-libs/Tezos_base/Block_header/index.html#type-t">Tezos_base.TzPervasives.Block_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">operations</span>:
    <span><span><a href="#type-operation">operation</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-trace">Tezos_base.TzPervasives.trace</a></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-trace">Tezos_base.TzPervasives.trace</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cache</span>:<a href="../../../octez-proto-libs/Tezos_protocol_environment/Context/index.html#type-source_of_cache">Tezos_protocol_environment.Context.source_of_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span>(bytes * <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_metadata_hash/index.html#type-t">Tezos_base.TzPervasives.Block_metadata_hash.t</a> option</span>)</span>
   * <a href="#type-ops_metadata">ops_metadata</a>)</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Hypothesis: we assume that the given block has already been validated -- E.g. by calling <code>validate</code>.</p></div></div></div></body></html>
