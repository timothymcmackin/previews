<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>P2p_discovery (octez-shell-libs.Tezos_p2p.P2p_discovery)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-shell-libs</a> &#x00BB; <a href="../index.html">Tezos_p2p</a> &#x00BB; P2p_discovery</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_p2p.P2p_discovery</span></code></h1><p>Local peer discovery.</p><p>This module manages the discovery of local peers through UDP broadcasting. It is composed of two workers:</p><ul><li>The sender worker whose role is to broadcast discovery messages.</li><li>The answer worker whose role is to listen discovery messages and register new peers in the current pool. Discovery messages are composed of an arbitrary key, the listening port and the peer id of the current peer.</li></ul></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Type of a discovery worker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="label">listening_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">discovery_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">discovery_addr</span>:<span class="xref-unresolved">Ipaddr</span>.V4.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">trust_discovered_peers</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="../P2p_pool/index.html#type-t">P2p_pool.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_base/P2p_peer_id/Table/index.html#type-key">Tezos_base.TzPervasives.P2p_peer.Table.key</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ~listening_port ~discovery_port ~discovery_addr pool peer_id</code> returns a discovery worker registering local peers to the <code>pool</code> and broadcasting discovery messages with the <code>peer_id</code> and the <code>listening_port</code> through the address <code>discovery_addr:discovery_port</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-activate"><a href="#val-activate" class="anchor"></a><code><span><span class="keyword">val</span> activate : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wakeup"><a href="#val-wakeup" class="anchor"></a><code><span><span class="keyword">val</span> wakeup : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>wakeup t</code> sends a signal to the sender machine of <code>t</code>, asking it to immediately proceed to broadcasting.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span><span class="keyword">val</span> shutdown : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>shutdown t</code> returns when <code>t</code> has completed shutdown.</p></div></div></div></body></html>
