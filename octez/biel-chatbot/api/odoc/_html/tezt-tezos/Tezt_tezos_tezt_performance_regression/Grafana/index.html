<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Grafana (tezt-tezos.Tezt_tezos_tezt_performance_regression.Grafana)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos_tezt_performance_regression</a> &#x00BB; Grafana</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos_tezt_performance_regression.Grafana</span></code></h1><p>Create Grafana dashboards.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-config"><a href="#type-config" class="anchor"></a><code><span><span class="keyword">type</span> config</span><span> = </span><span>{</span></code><ol><li id="type-config.url" class="def record field anchored"><a href="#type-config.url" class="anchor"></a><code><span>url : <span class="xref-unresolved">Uri</span>.t;</span></code></li><li id="type-config.api_token" class="def record field anchored"><a href="#type-config.api_token" class="anchor"></a><code><span>api_token : <span>string option</span>;</span></code></li><li id="type-config.data_source" class="def record field anchored"><a href="#type-config.data_source" class="anchor"></a><code><span>data_source : string;</span></code></li><li id="type-config.timeout" class="def record field anchored"><a href="#type-config.timeout" class="anchor"></a><code><span>timeout : float;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Grafana configuration.</p><p><code>url</code> is the base URL of the Grafana API.</p><p><code>api_token</code> is the bearer token to use in the Authorization header. If not provided, it will try to connect without authenticating (insecure mode).</p><p><code>data_source</code> is the name of the InfluxDB data source configured in Grafana.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-config_of_json"><a href="#val-config_of_json" class="anchor"></a><code><span><span class="keyword">val</span> config_of_json : <span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p>Read a Grafana configuration from a JSON value.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-yaxis"><a href="#type-yaxis" class="anchor"></a><code><span><span class="keyword">type</span> yaxis</span><span> = </span><span>{</span></code><ol><li id="type-yaxis.format" class="def record field anchored"><a href="#type-yaxis.format" class="anchor"></a><code><span>format : string;</span></code></li><li id="type-yaxis.label" class="def record field anchored"><a href="#type-yaxis.label" class="anchor"></a><code><span>label : <span>string option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Y axes for Grafana panels.</p><p><code>format</code> is the unit of the axis. A typical example is <code>&quot;s&quot;</code>, meaning &quot;seconds&quot;. See Grafana documentation for other possible values.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-duration"><a href="#type-duration" class="anchor"></a><code><span><span class="keyword">type</span> duration</span><span> = </span></code><ol><li id="type-duration.Seconds" class="def variant constructor anchored"><a href="#type-duration.Seconds" class="anchor"></a><code><span>| </span><span><span class="constructor">Seconds</span> <span class="keyword">of</span> int</span></code></li><li id="type-duration.Minutes" class="def variant constructor anchored"><a href="#type-duration.Minutes" class="anchor"></a><code><span>| </span><span><span class="constructor">Minutes</span> <span class="keyword">of</span> int</span></code></li><li id="type-duration.Hours" class="def variant constructor anchored"><a href="#type-duration.Hours" class="anchor"></a><code><span>| </span><span><span class="constructor">Hours</span> <span class="keyword">of</span> int</span></code></li><li id="type-duration.Days" class="def variant constructor anchored"><a href="#type-duration.Days" class="anchor"></a><code><span>| </span><span><span class="constructor">Days</span> <span class="keyword">of</span> int</span></code></li><li id="type-duration.Weeks" class="def variant constructor anchored"><a href="#type-duration.Weeks" class="anchor"></a><code><span>| </span><span><span class="constructor">Weeks</span> <span class="keyword">of</span> int</span></code></li><li id="type-duration.Month" class="def variant constructor anchored"><a href="#type-duration.Month" class="anchor"></a><code><span>| </span><span><span class="constructor">Month</span> <span class="keyword">of</span> int</span></code></li><li id="type-duration.Years" class="def variant constructor anchored"><a href="#type-duration.Years" class="anchor"></a><code><span>| </span><span><span class="constructor">Years</span> <span class="keyword">of</span> int</span></code></li></ol></div><div class="spec-doc"><p>Represent a duration, used to express intervals for example.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-alias"><a href="#type-alias" class="anchor"></a><code><span><span class="keyword">type</span> alias</span><span> = string</span></code></div><div class="spec-doc"><p>The alias associated to a curve in the graph.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-graph"><a href="#type-graph" class="anchor"></a><code><span><span class="keyword">type</span> graph</span><span> = </span><span>{</span></code><ol><li id="type-graph.title" class="def record field anchored"><a href="#type-graph.title" class="anchor"></a><code><span>title : string;</span></code></li><li id="type-graph.description" class="def record field anchored"><a href="#type-graph.description" class="anchor"></a><code><span>description : string;</span></code></li><li id="type-graph.queries" class="def record field anchored"><a href="#type-graph.queries" class="anchor"></a><code><span>queries : <span><span>(<a href="../InfluxDB/index.html#type-select">InfluxDB.select</a> * <span><a href="#type-alias">alias</a> option</span>)</span> list</span>;</span></code></li><li id="type-graph.interval" class="def record field anchored"><a href="#type-graph.interval" class="anchor"></a><code><span>interval : <span><a href="#type-duration">duration</a> option</span>;</span></code></li><li id="type-graph.yaxis_1" class="def record field anchored"><a href="#type-graph.yaxis_1" class="anchor"></a><code><span>yaxis_1 : <span><a href="#type-yaxis">yaxis</a> option</span>;</span></code></li><li id="type-graph.yaxis_2" class="def record field anchored"><a href="#type-graph.yaxis_2" class="anchor"></a><code><span>yaxis_2 : <span><a href="#type-yaxis">yaxis</a> option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Grafana graph panels.</p><p>Queries should use <code>Grafana_time_filter</code> in their WHERE clause and <code>Grafana_interval</code> in a GROUP BY time clause to reduce the size of the query. If an <code>interval</code> is specified, it will represent the minimum accepted by <code>Grafana_interval</code> to draw the graph.</p><p>The GROUP BY time clause should usually also contain a FILL clause to make continuous graphs instead of bunches of dots.</p><p>Each query is optionally associated to an alias. This alias will be used to name the resulting curve in the graph key. If this alias is not given, Grafana will deduce it automatically from the query.</p><p>Example query: <code>
      InfluxDB.select
        [Function (MEAN, Field &quot;duration&quot;)]
        ~from:(Measurement &quot;rpc&quot;)
        ~where:Grafana_time_filter
        ~group_by:(Time {interval = Grafana_interval; tag = None; fill = None})
    </code></p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-panel"><a href="#type-panel" class="anchor"></a><code><span><span class="keyword">type</span> panel</span><span> = </span></code><ol><li id="type-panel.Row" class="def variant constructor anchored"><a href="#type-panel.Row" class="anchor"></a><code><span>| </span><span><span class="constructor">Row</span> <span class="keyword">of</span> string</span></code></li><li id="type-panel.Graph" class="def variant constructor anchored"><a href="#type-panel.Graph" class="anchor"></a><code><span>| </span><span><span class="constructor">Graph</span> <span class="keyword">of</span> <a href="#type-graph">graph</a></span></code></li></ol></div><div class="spec-doc"><p>Grafana panels.</p><p>Rows are horizontal separators between graphs, with a title.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-dashboard"><a href="#type-dashboard" class="anchor"></a><code><span><span class="keyword">type</span> dashboard</span><span> = </span><span>{</span></code><ol><li id="type-dashboard.uid" class="def record field anchored"><a href="#type-dashboard.uid" class="anchor"></a><code><span>uid : string;</span></code></li><li id="type-dashboard.title" class="def record field anchored"><a href="#type-dashboard.title" class="anchor"></a><code><span>title : string;</span></code></li><li id="type-dashboard.description" class="def record field anchored"><a href="#type-dashboard.description" class="anchor"></a><code><span>description : string;</span></code></li><li id="type-dashboard.panels" class="def record field anchored"><a href="#type-dashboard.panels" class="anchor"></a><code><span>panels : <span><a href="#type-panel">panel</a> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Grafana dashboards.</p><p><code>uid</code> is a unique identifier of your choosing. It will be used in the URL of the dashboard. It must be composed of between 1 and 128 alphanumeric characters, dashes, periods or underscores.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_dashboard"><a href="#val-update_dashboard" class="anchor"></a><code><span><span class="keyword">val</span> update_dashboard : <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-dashboard">dashboard</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Create or update a dashboard.</p><p>If the dashboard already exists, it is deleted first. All version history is lost.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_arg</code> <p>if the dashboard UID is invalid.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_dashboard_from_json"><a href="#val-update_dashboard_from_json" class="anchor"></a><code><span><span class="keyword">val</span> update_dashboard_from_json : 
  <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">json</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">uid</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Similar to update_dashboard, except it is provided as a raw JSON represented as a string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-simple_query"><a href="#val-simple_query" class="anchor"></a><code><span><span class="keyword">val</span> simple_query : 
  <span><span class="optlabel">?tags</span>:<span><span>(<a href="../InfluxDB/index.html#type-tag">InfluxDB.tag</a> * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">measurement</span>:<a href="../InfluxDB/index.html#type-measurement">InfluxDB.measurement</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">field</span>:<a href="../InfluxDB/index.html#type-field">InfluxDB.field</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="../InfluxDB/index.html#type-select">InfluxDB.select</a></span></code></div><div class="spec-doc"><p>Make a simple SELECT query for a graph panel.</p><p>Usage: <code>simple_query
             ~tags:[(&quot;tag1&quot;, &quot;value1&quot;), (&quot;tag2&quot;, &quot;value2&quot;)]
             ~measurement
             ~field
             ~test:test_title
             ()</code></p><p>Default <code>tags</code> is an empty list.</p><p>This returns the following query: <code>
      SELECT MEAN(field)
      FROM measurement
      WHERE $timeFilter AND test = test_title AND tag1 = value1 AND tag2 = value2
      GROUP BY time($__interval) fill(previous)
    </code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-simple_graph"><a href="#val-simple_graph" class="anchor"></a><code><span><span class="keyword">val</span> simple_graph : 
  <span><span class="optlabel">?title</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?description</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?yaxis_format</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?tags</span>:<span><span>(<a href="../InfluxDB/index.html#type-tag">InfluxDB.tag</a> * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?interval</span>:<a href="#type-duration">duration</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">measurement</span>:<a href="../InfluxDB/index.html#type-measurement">InfluxDB.measurement</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">field</span>:<a href="../InfluxDB/index.html#type-field">InfluxDB.field</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-panel">panel</a></span></code></div><div class="spec-doc"><p>Make a graph panel from a simple query.</p><p>Usage: <code>simple_graph ~measurement ~field ~test ()</code></p><p>The query is built using <a href="#val-simple_query"><code>simple_query</code></a>.</p><p>Default <code>title</code> is the measurement name. Default <code>description</code> is <code>&quot;&quot;</code>. Default <code>yaxis_format</code> is <code>s</code> (seconds). Default <code>tags</code> is an empty list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-graphs_per_tags"><a href="#val-graphs_per_tags" class="anchor"></a><code><span><span class="keyword">val</span> graphs_per_tags : 
  <span><span class="optlabel">?title</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?description</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?yaxis_format</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?interval</span>:<a href="#type-duration">duration</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">measurement</span>:<a href="../InfluxDB/index.html#type-measurement">InfluxDB.measurement</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">field</span>:<a href="../InfluxDB/index.html#type-field">InfluxDB.field</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">test</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">tags</span>:<span><span>(<a href="../InfluxDB/index.html#type-tag">InfluxDB.tag</a> * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-panel">panel</a></span></code></div><div class="spec-doc"><p>Make a graph panel that draws a curve per given tag.</p><p>Usage: <code>graphs_per_tags
             ~measurement
             ~field
             ~test:test_title
             ~tags:[(tag1, value1); (tag2, value2)]
             ()</code></p><p>This will draw a curve in the resulting graph for each one of the following request:</p><p><code>
      SELECT MEAN(field)
      FROM measurement
      WHERE $timeFilter AND test = test_title AND tag1 = value1
      GROUP BY time($__interval) fill(previous)
    </code></p><p><code>
      SELECT MEAN(field)
      FROM measurement
      WHERE $timeFilter AND test = test_name AND tag2 = value2
      GROUP BY time($__interval) fill(previous)
    </code></p><p>Default <code>title</code> is the measurement name. Default <code>description</code> is <code>&quot;&quot;</code>. Default <code>yaxis_format</code> is <code>s</code> (seconds). Default <code>tags</code> is an empty list.</p></div></div></div></body></html>
