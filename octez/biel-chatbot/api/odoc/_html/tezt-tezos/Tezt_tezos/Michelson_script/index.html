<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Michelson_script (tezt-tezos.Tezt_tezos.Michelson_script)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Michelson_script</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Michelson_script</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-version_range"><a href="#type-version_range" class="anchor"></a><code><span><span class="keyword">type</span> version_range</span><span> = </span><span>{</span></code><ol><li id="type-version_range.range_start" class="def record field anchored"><a href="#type-version_range.range_start" class="anchor"></a><code><span>range_start : int;</span></code></li><li id="type-version_range.range_end" class="def record field anchored"><a href="#type-version_range.range_end" class="anchor"></a><code><span>range_end : <span>int option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-in_range"><a href="#val-in_range" class="anchor"></a><code><span><span class="keyword">val</span> in_range : <span><a href="#type-version_range">version_range</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.prefix" class="def record field anchored"><a href="#type-t.prefix" class="anchor"></a><code><span>prefix : string;</span></code></li><li id="type-t.dirname" class="def record field anchored"><a href="#type-t.dirname" class="anchor"></a><code><span>dirname : <span>string list</span>;</span></code></li><li id="type-t.basename" class="def record field anchored"><a href="#type-t.basename" class="anchor"></a><code><span>basename : string;</span></code></li><li id="type-t.name" class="def record field anchored"><a href="#type-t.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-t.version_range" class="def record field anchored"><a href="#type-t.version_range" class="anchor"></a><code><span>version_range : <a href="#type-version_range">version_range</a>;</span></code></li><li id="type-t.extension" class="def record field anchored"><a href="#type-t.extension" class="anchor"></a><code><span>extension : string;</span></code></li><li id="type-t.depth" class="def record field anchored"><a href="#type-t.depth" class="anchor"></a><code><span>depth : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Represents a Michelson script on the filesystem. Documentation for each field:</p><ul><li><code>prefix</code> This is the path to the scripts directory, for instance: <code>michelson_scripts</code>.</li><li><code>dirname</code> This is the relative path under <code>prefix</code> that leads you to the actual script.</li><li><code>basename</code> This is the name of the file in which the script is stored. E.g: <code>foobar_001.tz</code>.</li><li><code>name</code> This is the logical name of the script. E.g: if basename = foobar_001.tz then name = foobar.</li><li><code>version_range</code> If the basename contains a version suffix <code>foobar_MMM(_NNN).tz</code>, then this value is <code>{range_start = MMM, (range_end = NNN)}</code>. If there is no version suffix, then this value is <code>{range_start = 000, range_end = None}</code>.</li><li><code>depth</code> Depth in the directory at which this script is stored. Should equal <code>List.length dirname</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_prefix"><a href="#val-default_prefix" class="anchor"></a><code><span><span class="keyword">val</span> default_prefix : string</span></code></div><div class="spec-doc"><p>This is the directory that will be used as the &quot;root&quot;, otherwise known as the &quot;prefix&quot;, where michelson scripts will be searched for.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Find a Michelson script file.</p><p>Usage: <code>find name protocol</code></p><p>This returns <code>PREFIX/NAME_MMM_NNN.tz</code> for the highest <code>MMM</code> and <code>NNN</code> such that <code>MMM &lt;= Protocol.number protocol &lt;= NNN</code> and such that this file exists. If no such file exists but <code>PREFIX/NAME_MMM.tz</code> or <code>PREFIX/NAME.tz</code> does, this returns the matching file instead. Else, this fails.</p><p>The intent is that:</p><ul><li>new scripts are added without a <code>_MMM</code> suffix;</li><li>if a script needs to be adapted for a new protocol, the file is duplicated and the new version is suffixed with <code>_MMM</code>;</li><li>if a script is no longer needed for future protocols, it can be disabled by attaching <code>_NNN</code> such that NNN is the last protocol which it is valid for.</li></ul><p><code>name</code> is a list of path items where all but the last one are subdirectories and the last one is the base filename without <code>_NNN.tz</code>.</p><p>For instance, assume the following files exist:</p><ul><li><code>michelson_scripts/foo/bar/baz.tz</code></li><li><code>michelson_scripts/foo/bar/baz_015.tz</code> Then <code>path [&quot;foo&quot;; &quot;bar&quot;; &quot;baz&quot;] Lima</code> returns: <code>michelson_scripts/foo/bar/baz_015.tz</code> while <code>path [&quot;foo&quot;; &quot;bar&quot;; &quot;baz&quot;] Kathmandu</code> returns: <code>michelson_scripts/foo/bar/baz.tz</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all"><a href="#val-find_all" class="anchor"></a><code><span><span class="keyword">val</span> find_all : <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p><code>find_all ?prefix ?maxdepth protocol</code> returns all Michelson scripts for a given protocol up to a maxdepth <code>maxdepth</code>. Setting <code>~maxdepth:1</code> is useful when you don't want to recurse into subdirectories.</p><p>For instance, assume the following files exist:</p><ul><li><code>prefix/a.tz</code></li><li><code>prefix/a_015.tz</code></li><li><code>prefix/a_016.tz</code></li><li><code>prefix/b/c.tz</code></li><li><code>prefix/b/c_015.tz</code></li><li><code>prefix/b/c_016.tz</code></li><li><code>prefix/d/e/f.tz</code></li><li><code>prefix/d/e/f_016.tz</code></li></ul><p>And assume <code>p</code> is a <code>Protocol.t</code> such that <code>Protocol.number p = 015</code>.</p><p><code>find_all p</code> returns:</p><ul><li><code>prefix/a_015.tz</code></li><li><code>prefix/b/c_015.tz</code></li><li><code>prefix/d/e/f.tz</code></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all_res"><a href="#val-find_all_res" class="anchor"></a><code><span><span class="keyword">val</span> find_all_res : 
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-t">t</a> list</span>, string * string)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all_in"><a href="#val-find_all_in" class="anchor"></a><code><span><span class="keyword">val</span> find_all_in : 
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p><code>find_all_in protocol dirs</code> returns all scripts in the folders <code>dirs</code> for the given protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all_legacy"><a href="#val-find_all_legacy" class="anchor"></a><code><span><span class="keyword">val</span> find_all_legacy : <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Returns all scripts in the <code>legacy</code> directory for the given protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all_well_typed"><a href="#val-find_all_well_typed" class="anchor"></a><code><span><span class="keyword">val</span> find_all_well_typed : 
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Returns all well typed scripts for the given protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all_ill_typed"><a href="#val-find_all_ill_typed" class="anchor"></a><code><span><span class="keyword">val</span> find_all_ill_typed : 
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Returns all ill typed scripts for the given protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_all_tzt_tests"><a href="#val-find_all_tzt_tests" class="anchor"></a><code><span><span class="keyword">val</span> find_all_tzt_tests : 
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?maxdepth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Returns all TZT tests from the reference test suite.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-path"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : <span><span class="optlabel">?no_prefix</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>The path to the script relative to <code>/</code> (the repo root).</p><p>If <code>?no_prefix</code> is true, the prefix is excluded from the output string. This is mostly useful for pretty printing in tests.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p>The logical name of the script. This includes the names of all the directories leading to the script as well as the basename of the script itself without any version information or extensions.</p><p>For instance, assume the following files exist:</p><ul><li>prefix/foo_123.tz</li><li>prefix/bar.tz</li><li>prefix/baz/quux.tz</li></ul><p>If each of those files is represented by a value <code>v</code> of type <code>t</code>, then calling <code>name v</code> on each <code>v</code> would result in the following:</p><ul><li><code>&quot;foo&quot;</code></li><li><code>&quot;bar&quot;</code></li><li><code>&quot;baz&quot;; &quot;quux&quot;</code></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name_s"><a href="#val-name_s" class="anchor"></a><code><span><span class="keyword">val</span> name_s : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>The logical name as a string. This is <code>name t |&gt; String.concat &quot;/&quot;</code>. This function is mostly used as a convenient pretty printer.</p><p>NOTE: <code>Filename.dir_sep</code> is _not_ used because <code>name</code> is not a path.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pretty_string"><a href="#val-pretty_string" class="anchor"></a><code><span><span class="keyword">val</span> pretty_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Pretty printer for <code>t</code>. This is mostly useful for debugging.</p></div></div></div></body></html>
