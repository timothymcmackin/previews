<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Operation_core (tezt-tezos.Tezt_tezos.Operation_core)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Operation_core</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Operation_core</span></code></h1><p>This module can be used to craft an operation without using client dedicated commands.</p></header><nav class="odoc-toc"><ul><li><a href="#overview">Overview</a><ul><li><a href="#manager-operations">Manager operations</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="overview"><a href="#overview" class="anchor"></a>Overview</h2><p>This module aims to replace the module <a href="../Operation_legacy/index.html"><code>Operation_legacy</code></a> to provide an interface which is more extensible. In other words, supporting a new operation should be easier using this interface.</p><p>An unsigned operation is represented by the datatype <a href="#type-t"><code>t</code></a>. <a href="#type-t"><code>t</code></a> is a wrapper around a JSON representation of an operation. Some meta information needs to be provided to sign this operation. <a href="#type-t"><code>t</code></a> is not signed a priori to ease writing tests with bad signatures.</p><p>This module also provides two functions to ease the injection of an operation: <a href="#val-inject"><code>inject</code></a> which should be called when the injection is expected to succeed, and <code>inject_with_error</code> when the injection is expected to fail.</p><p>Anyone is free to add support for new operations.</p><h3 id="manager-operations"><a href="#manager-operations" class="anchor"></a>Manager operations</h3><p>Manager operations represent most of the operations used by the tests. Those operations contain several parameters (see <a href="Manager/index.html#val-make"><code>Manager.make</code></a>) and can be batched. Wrapper like <a href="Manager/index.html#val-inject"><code>Manager.inject</code></a> and <code>Manager.inject_with_error</code> are provided to ease the writing of tests.</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The abstract representation of an unsigned operation.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-operation"><a href="#type-operation" class="anchor"></a><code><span><span class="keyword">type</span> operation</span><span> := <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-consensus_kind"><a href="#type-consensus_kind" class="anchor"></a><code><span><span class="keyword">type</span> consensus_kind</span><span> = </span></code><ol><li id="type-consensus_kind.Attestation" class="def variant constructor anchored"><a href="#type-consensus_kind.Attestation" class="anchor"></a><code><span>| </span><span><span class="constructor">Attestation</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-consensus_kind.with_dal" class="def record field anchored"><a href="#type-consensus_kind.with_dal" class="anchor"></a><code><span>with_dal : bool;</span></code></li></ol><code><span>}</span></code></li><li id="type-consensus_kind.Preattestation" class="def variant constructor anchored"><a href="#type-consensus_kind.Preattestation" class="anchor"></a><code><span>| </span><span><span class="constructor">Preattestation</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-kind"><a href="#type-kind" class="anchor"></a><code><span><span class="keyword">type</span> kind</span><span> = </span></code><ol><li id="type-kind.Consensus" class="def variant constructor anchored"><a href="#type-kind.Consensus" class="anchor"></a><code><span>| </span><span><span class="constructor">Consensus</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-kind.kind" class="def record field anchored"><a href="#type-kind.kind" class="anchor"></a><code><span>kind : <a href="#type-consensus_kind">consensus_kind</a>;</span></code></li><li id="type-kind.chain_id" class="def record field anchored"><a href="#type-kind.chain_id" class="anchor"></a><code><span>chain_id : string;</span></code></li></ol><code><span>}</span></code></li><li id="type-kind.Anonymous" class="def variant constructor anchored"><a href="#type-kind.Anonymous" class="anchor"></a><code><span>| </span><span><span class="constructor">Anonymous</span></span></code></li><li id="type-kind.Voting" class="def variant constructor anchored"><a href="#type-kind.Voting" class="anchor"></a><code><span>| </span><span><span class="constructor">Voting</span></span></code></li><li id="type-kind.Manager" class="def variant constructor anchored"><a href="#type-kind.Manager" class="anchor"></a><code><span>| </span><span><span class="constructor">Manager</span></span></code></li></ol></div><div class="spec-doc"><p>The kind is necessary because it determines the watermark of an operation which is necessary for signing an operation. This type aims to be extended when other kinds of operations are added into this module.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="label">branch</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signer</span>:<a href="../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">kind</span>:<a href="#type-kind">kind</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.u <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make ~branch ?signer ~kind json client</code> builds the representation of an unsigned operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-json"><a href="#val-json" class="anchor"></a><code><span><span class="keyword">val</span> json : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Tezt_wrapper</span>.JSON.u</span></code></div><div class="spec-doc"><p><code>json t</code> gives the json representation of an unsigned operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hex"><a href="#val-hex" class="anchor"></a><code><span><span class="keyword">val</span> hex : 
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Hex</span>.t <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>hex ?(protocol=None) ?(signature=None) t client</code> computes the binary representation of an operation as a hexadecimal string. If <code>protocol</code> is given, the binary representation is computed using the encoding of operation from the <code>protocol</code>. Otherwise, a call to the <code>forge_operations</code> RPC is done to compute the binary representation. If <code>signature</code> is given, the hexadecimal represents the signed version of the operation. <code>client</code> is used to construct the binary representation of <code>t</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">protocol</span> <p>controls whether the encoding of a protocol should be used to compute the binary representation of the operation rather than calling the <code>forge_operations</code> RPC to compute it.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">signature</span> <p>controls whether a signature should be attached to the operation.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sign"><a href="#val-sign" class="anchor"></a><code><span><span class="keyword">val</span> sign : 
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>sign t client</code> signs the raw representation of operation <code>t</code> by its signer (see <a href="#val-make"><code>make</code></a>). <code>client</code> is used to construct the binary representation of <code>t</code>. Note that if no signer have been given to <code>t</code> the function returns <code>Tezos_crypto.Signature.zero</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>[ <span>`OpHash of string</span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>hash t client</code> returns the hash of the operation</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-byte_size"><a href="#val-byte_size" class="anchor"></a><code><span><span class="keyword">val</span> byte_size : 
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the size (in bytes) of the operation.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">protocol</span> <p>Allows using the operation encoding rather than using the <code>forge_operations</code> RPC to compute the hexadecimal representation of the operation.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">signature</span> <p>Allows to manually set the signature of the operation. When omitted, the operation is correctly signed using <a href="#val-sign"><code>sign</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject"><a href="#val-inject" class="anchor"></a><code><span><span class="keyword">val</span> inject : 
  <span><span class="optlabel">?dont_wait</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?request</span>:<span>[ `Inject <span>| `Notify</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?error</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`OpHash of string</span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>inject dont_wait ?(request=`Inject) ?(force=false) ?(signature=None)
   ?(error=None) t</code> injects an operation into the node. The node is extracted from the <code>Client</code>. If a node cannot be extracted, the injection fails. If the injection succeeds, the hash of the operation is returned.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">dont_wait</span> <p>If <code>true</code>, the operation is injected without waiting on some node event. Making <code>request</code> ignore. Default is <code>false</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">request</span> <p>If <code>`Inject</code>, we do not wait the <code>prevalidator</code> to classify the operation. This can create some flakyness in the test but is needed to test corner cases. If <code>`Notify</code>, the function waits for the prevalidator to classify the operation. However, the nodes need to activate the debug events for the prevalidator.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">force</span> <p>If <code>true</code>, the function succeeds even though the operation was classified with an error and was not propagated by the prevalidator. If <code>false</code>, the call fails if the prevalidator classified the operation with an error.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">protocol</span> <p>Allow using the operation encoding rather than using the <code>forge_operations</code> RPC to compute the hexadecimal representation of the operations.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">signature</span> <p>Allows to give manually the signature of the operation. The operation is signed when the signature is omitted.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">error</span> <p>If the injection is expecting to fail, allows to specify the expected error.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-spawn_inject"><a href="#val-spawn_inject" class="anchor"></a><code><span><span class="keyword">val</span> spawn_inject : 
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <a href="../Runnable/index.html#type-process">Runnable.process</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <code>inject</code>, but do not wait for the process to exit.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject_and_capture1_stderr"><a href="#val-inject_and_capture1_stderr" class="anchor"></a><code><span><span class="keyword">val</span> inject_and_capture1_stderr : 
  <span><span class="label">rex</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Run <code>spawn_inject</code> then capture one group on stderr with <code>rex</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject_and_capture2_stderr"><a href="#val-inject_and_capture2_stderr" class="anchor"></a><code><span><span class="keyword">val</span> inject_and_capture2_stderr : 
  <span><span class="label">rex</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * string)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Run <code>spawn_inject</code> then capture two groups on stderr with <code>rex</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject_operations"><a href="#val-inject_operations" class="anchor"></a><code><span><span class="keyword">val</span> inject_operations : 
  <span><span class="optlabel">?protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?request</span>:<span>[ `Inject <span>| `Notify</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?error</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?use_tmp_file</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ <span>`OpHash of string</span> ]</span> list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>inject_operations ?protocol ?request ?force ?error ?use_tmp_file ops
    client</code> is similar as <code>inject</code> for a list of operations. This function calls the RPC <a href="../RPC/index.html#val-post_private_injection_operations"><code>RPC.post_private_injection_operations</code></a> which is faster than calling the RPC used by <a href="#val-inject"><code>inject</code></a> several times. Note that this function should be used mainly when the time for injecting operations matters.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">use_tmp_file</span> <p>see <a href="../RPC/index.html#val-post_private_injection_operations"><code>RPC.post_private_injection_operations</code></a> for more information.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_run_operation_input"><a href="#val-make_run_operation_input" class="anchor"></a><code><span><span class="keyword">val</span> make_run_operation_input : 
  <span><span class="optlabel">?chain_id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.u <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Craft a json representing the full operation, in a format that is compatible with the <code>run_operation</code> RPC (<a href="../RPC/index.html#val-post_chain_block_helpers_scripts_run_operation"><code>RPC.post_chain_block_helpers_scripts_run_operation</code></a>).</p><p>This json contains many more fields than the one produced by the <a href="#val-json"><code>json</code></a> function above.</p><p>The operation is signed with <a href="../../../octez-libs/Tezos_crypto/Signature/index.html#val-zero"><code>Tezos_crypto.Signature.zero</code></a>, because the <code>run_operation</code> RPC skips signature checks anyway.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">chain_id</span> <p>Allows to manually provide the <code>chain_id</code>. If omitted, the <code>chain_id</code> is retrieved via RPC using the provided <code>client</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">client</span> <p>The <a href="../Client/index.html#type-t"><code>Client.t</code></a> argument is used to retrieve the <code>chain_id</code> when it is not provided.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_preapply_operation_input"><a href="#val-make_preapply_operation_input" class="anchor"></a><code><span><span class="keyword">val</span> make_preapply_operation_input : 
  <span><span class="label">protocol</span>:<a href="../Protocol/index.html#type-t">Protocol.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">signature</span>:<a href="../../../octez-libs/Tezos_crypto/Signature/index.html#type-t">Tezos_crypto.Signature.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Tezt_wrapper</span>.JSON.u</span></code></div><div class="spec-doc"><p>Craft a json representing the full operation, in a format that is compatible with the <code>preapply/operations</code> RPC (<a href="../RPC/index.html#val-post_chain_block_helpers_preapply_operations"><code>RPC.post_chain_block_helpers_preapply_operations</code></a>).</p><p>This json contains many more fields than the one produced by the <a href="#val-json"><code>json</code></a> function above.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Consensus"><a href="#module-Consensus" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Consensus/index.html">Consensus</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Anonymous"><a href="#module-Anonymous" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Anonymous/index.html">Anonymous</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Voting"><a href="#module-Voting" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Voting/index.html">Voting</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Voting operations (validation pass <code>1</code>): <code>proposals</code> and <code>ballot</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Manager"><a href="#module-Manager" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Manager/index.html">Manager</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><p>Regular expressions for specific error messages.</p><p>Can be used as e.g.</p><ul><li>the <code>error</code> argument of <a href="#val-inject"><code>inject</code></a></li><li>the <code>rex</code> argument of <a href="#val-inject_and_capture2_stderr"><code>inject_and_capture2_stderr</code></a></li><li>the <code>msg</code> argument of <code>Process.check_error</code>.</li></ul><div class="odoc-spec"><div class="spec value anchored" id="val-gas_limit_exceeded"><a href="#val-gas_limit_exceeded" class="anchor"></a><code><span><span class="keyword">val</span> gas_limit_exceeded : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the client message for the <code>Operation_quota_exceeded</code> protocol error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-conflict_error_with_needed_fee"><a href="#val-conflict_error_with_needed_fee" class="anchor"></a><code><span><span class="keyword">val</span> conflict_error_with_needed_fee : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Operation_conflict {new_hash; needed_fee_in_mutez = Some fee}</code> from <code>src/lib_shell_services/validation_errors</code>.</p><p>Captures <code>new_hash</code> and <code>fee</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-conflict_error_no_possible_fee"><a href="#val-conflict_error_no_possible_fee" class="anchor"></a><code><span><span class="keyword">val</span> conflict_error_no_possible_fee : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Operation_conflict {new_hash; needed_fee_in_mutez = None}</code> from <code>src/lib_shell_services/validation_errors</code>.</p><p>Captures <code>new_hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rejected_by_full_mempool_with_needed_fee"><a href="#val-rejected_by_full_mempool_with_needed_fee" class="anchor"></a><code><span><span class="keyword">val</span> rejected_by_full_mempool_with_needed_fee : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Rejected_by_full_mempool {hash; needed_fee_in_mutez = Some fee}</code> from <code>src/lib_shell_services/validation_errors</code>.</p><p>Captures <code>hash</code> and <code>fee</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rejected_by_full_mempool_no_possible_fee"><a href="#val-rejected_by_full_mempool_no_possible_fee" class="anchor"></a><code><span><span class="keyword">val</span> rejected_by_full_mempool_no_possible_fee : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Rejected_by_full_mempool {hash; needed_fee_in_mutez = None}</code> from <code>src/lib_shell_services/validation_errors</code>.</p><p>Captures <code>hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dal_data_availibility_attester_not_in_committee"><a href="#val-dal_data_availibility_attester_not_in_committee" class="anchor"></a><code><span><span class="keyword">val</span> dal_data_availibility_attester_not_in_committee : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Dal_data_availibility_attester_not_in_committee {attester; level; slot}</code> from <code>src/proto_alpha/lib_protocol/dal_errors_repr</code>.</p><p>Captures <code>attester</code>, <code>level</code>, and <code>slot</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject_error_check_recommended_fee"><a href="#val-inject_error_check_recommended_fee" class="anchor"></a><code><span><span class="keyword">val</span> inject_error_check_recommended_fee : 
  <span><span class="label">loc</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">rex</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">expected_fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Calls <a href="#val-inject_and_capture2_stderr"><code>inject_and_capture2_stderr</code></a> and checks that the second captured group is <code>expected_fee</code>.</p><p>Intended to be used with <a href="#val-conflict_error_with_needed_fee"><code>conflict_error_with_needed_fee</code></a> or <a href="#val-rejected_by_full_mempool_with_needed_fee"><code>rejected_by_full_mempool_with_needed_fee</code></a> as <code>rex</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-already_denounced"><a href="#val-already_denounced" class="anchor"></a><code><span><span class="keyword">val</span> already_denounced : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Already_denounced {kind; delegate; level}</code> from <code>src/proto_xxx/lib_protocol/validate_errors</code>.</p><p>Captures <code>delegate</code>, <code>level</code>, <code>kind</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-outdated_denunciation"><a href="#val-outdated_denunciation" class="anchor"></a><code><span><span class="keyword">val</span> outdated_denunciation : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message produced by <code>Outdated_denunciation {kind; level; last_cycle}</code> from <code>src/proto_xxx/lib_protocol/validate_errors</code>.</p><p>Captures <code>kind</code>, <code>last_cycle</code>, <code>level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-injection_error_unknown_branch"><a href="#val-injection_error_unknown_branch" class="anchor"></a><code><span><span class="keyword">val</span> injection_error_unknown_branch : <span class="xref-unresolved">Tezt_wrapper</span>.Base.rex</span></code></div><div class="spec-doc"><p>Matches the message <code>Operation %a is branched on either:</code> from <code>src/lib_shell/prevalidator.ml</code>.</p><p>Captures <code>hash</code>.</p></div></div></div></body></html>
