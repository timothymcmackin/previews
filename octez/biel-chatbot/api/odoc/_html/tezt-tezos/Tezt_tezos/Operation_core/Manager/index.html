<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Manager (tezt-tezos.Tezt_tezos.Operation_core.Manager)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezt-tezos</a> &#x00BB; <a href="../../index.html">Tezt_tezos</a> &#x00BB; <a href="../index.html">Operation_core</a> &#x00BB; Manager</nav><header class="odoc-preamble"><h1>Module <code><span>Operation_core.Manager</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-payload"><a href="#type-payload" class="anchor"></a><code><span><span class="keyword">type</span> payload</span></code></div><div class="spec-doc"><p>Payload of a manager operation. This excludes generic parameters common to all manager operations. See <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reveal"><a href="#val-reveal" class="anchor"></a><code><span><span class="keyword">val</span> reveal : <span><a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p>Build a public key revelation.</p><p>The <code>Account.key</code> argument has no default value because it will typically be a fresh account.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-transfer"><a href="#val-transfer" class="anchor"></a><code><span><span class="keyword">val</span> transfer : <span><span class="optlabel">?dest</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?amount</span>:int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p><code>transfer ?(dest=Constant.bootstrap2) ~amount:1_000_000 ()</code> builds a transfer operation. Note that the amount is expressed in mutez.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-origination"><a href="#val-origination" class="anchor"></a><code><span><span class="keyword">val</span> origination : 
  <span><span class="optlabel">?init_balance</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">code</span>:<span class="xref-unresolved">Tezt_wrapper</span>.JSON.u <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">init_storage</span>:<span class="xref-unresolved">Tezt_wrapper</span>.JSON.u <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p><code>origination ?(init_balance=0) ~code ~init_storage ()</code> builds an origination operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-call"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : 
  <span><span class="optlabel">?dest</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?amount</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?entrypoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?arg</span>:<span class="xref-unresolved">Tezt_wrapper</span>.JSON.u <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p><code>call ~dest ~amount:0 ~entrypoint ~arg ()</code> builds a smart contract call operation to the <code>entrypoint</code> with the provided Michelson argument <code>arg</code>. Note that the amount is expressed in mutez.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dal_publish_commitment"><a href="#val-dal_publish_commitment" class="anchor"></a><code><span><span class="keyword">val</span> dal_publish_commitment : 
  <span><span class="label">index</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">commitment</span>:<a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-commitment">Tezos_crypto_dal.Cryptobox.commitment</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">proof</span>:<a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-commitment_proof">Tezos_crypto_dal.Cryptobox.commitment_proof</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p><code>dal_publish_commitment ~level ~index ~header</code> builds an operation for the data-availability layer that publishes a slot.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delegation"><a href="#val-delegation" class="anchor"></a><code><span><span class="keyword">val</span> delegation : <span><span class="optlabel">?delegate</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p><code>delegation ?(delegate=Constant.bootstrap2) ()</code> builds a delegation operation.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sc_rollup_proof"><a href="#type-sc_rollup_proof" class="anchor"></a><code><span><span class="keyword">type</span> sc_rollup_proof</span><span> = <span class="xref-unresolved">Tezt_wrapper</span>.JSON.u</span></code></div><div class="spec-doc"><p>The sc_rollup_proof structure is complex to be written by hand during tests and should likely be generated by a PVM. We expose it as a JSON value.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sc_rollup_dissection_chunk"><a href="#type-sc_rollup_dissection_chunk" class="anchor"></a><code><span><span class="keyword">type</span> sc_rollup_dissection_chunk</span><span> = </span><span>{</span></code><ol><li id="type-sc_rollup_dissection_chunk.state_hash" class="def record field anchored"><a href="#type-sc_rollup_dissection_chunk.state_hash" class="anchor"></a><code><span>state_hash : <span>string option</span>;</span></code></li><li id="type-sc_rollup_dissection_chunk.tick" class="def record field anchored"><a href="#type-sc_rollup_dissection_chunk.tick" class="anchor"></a><code><span>tick : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A section of a proof is make of a state hash, if any, and of a tick.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sc_rollup_game_refutation_step"><a href="#type-sc_rollup_game_refutation_step" class="anchor"></a><code><span><span class="keyword">type</span> sc_rollup_game_refutation_step</span><span> = </span></code><ol><li id="type-sc_rollup_game_refutation_step.Proof" class="def variant constructor anchored"><a href="#type-sc_rollup_game_refutation_step.Proof" class="anchor"></a><code><span>| </span><span><span class="constructor">Proof</span> <span class="keyword">of</span> <a href="#type-sc_rollup_proof">sc_rollup_proof</a></span></code></li><li id="type-sc_rollup_game_refutation_step.Dissection" class="def variant constructor anchored"><a href="#type-sc_rollup_game_refutation_step.Dissection" class="anchor"></a><code><span>| </span><span><span class="constructor">Dissection</span> <span class="keyword">of</span> <span><a href="#type-sc_rollup_dissection_chunk">sc_rollup_dissection_chunk</a> list</span></span></code></li></ol></div><div class="spec-doc"><p>A refutation step is either a dissection or a proof.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sc_rollup_refutation"><a href="#type-sc_rollup_refutation" class="anchor"></a><code><span><span class="keyword">type</span> sc_rollup_refutation</span><span> = </span></code><ol><li id="type-sc_rollup_refutation.Start" class="def variant constructor anchored"><a href="#type-sc_rollup_refutation.Start" class="anchor"></a><code><span>| </span><span><span class="constructor">Start</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-sc_rollup_refutation.player_commitment_hash" class="def record field anchored"><a href="#type-sc_rollup_refutation.player_commitment_hash" class="anchor"></a><code><span>player_commitment_hash : string;</span></code></li><li id="type-sc_rollup_refutation.opponent_commitment_hash" class="def record field anchored"><a href="#type-sc_rollup_refutation.opponent_commitment_hash" class="anchor"></a><code><span>opponent_commitment_hash : string;</span></code></li></ol><code><span>}</span></code></li><li id="type-sc_rollup_refutation.Move" class="def variant constructor anchored"><a href="#type-sc_rollup_refutation.Move" class="anchor"></a><code><span>| </span><span><span class="constructor">Move</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-sc_rollup_refutation.choice_tick" class="def record field anchored"><a href="#type-sc_rollup_refutation.choice_tick" class="anchor"></a><code><span>choice_tick : int;</span></code></li><li id="type-sc_rollup_refutation.refutation_step" class="def record field anchored"><a href="#type-sc_rollup_refutation.refutation_step" class="anchor"></a><code><span>refutation_step : <a href="#type-sc_rollup_game_refutation_step">sc_rollup_game_refutation_step</a>;</span></code></li></ol><code><span>}</span></code></li></ol></div><div class="spec-doc"><p>An sc_rollup_refutation is the information submitted by players during a (refutation) game.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sc_rollup_refute"><a href="#val-sc_rollup_refute" class="anchor"></a><code><span><span class="keyword">val</span> sc_rollup_refute : 
  <span><span class="label">refutation</span>:<a href="#type-sc_rollup_refutation">sc_rollup_refutation</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">sc_rollup</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">opponent</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-payload">payload</a></span></code></div><div class="spec-doc"><p><code>sc_rollup_refute ?refutation ~rollup ~oppenent</code> builds an Sc rollup refutation manager operation payload. The refutation is <code>None</code> in case of initialization or some game refutation step (either a dissection or a proof) otherwise. <code>sc_rollup</code> is the Sc rollup's address and <code>opponent</code> the public key hash of the staker who published the commitment we are about to refute.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A representation of a manager operation. This includes generic parameters common to all manager operations. See <a href="#val-make"><code>make</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : 
  <span><span class="optlabel">?source</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?counter</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?gas_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?storage_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-payload">payload</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make</code> builds a manager operation from a payload and generic parameters common to all the manager operations. The default values of the generic parameters are set depending on the payload. Those default values ensure that the operation can be executed correctly. Have a look at the definition of this function to know the default value for each operation payload.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_batch"><a href="#val-make_batch" class="anchor"></a><code><span><span class="keyword">val</span> make_batch : 
  <span><span class="optlabel">?source</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?gas_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?storage_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">counter</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-payload">payload</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p><code>make_batch</code> builds a batch of manager operations from a list of payloads and an initial counter. This function calls <a href="#val-make"><code>make</code></a> on all the payloads incrementing the initial <code>counter</code> for each operation except for the first one. The function does not fail if the list of <code>payload</code> is empty.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_next_counter"><a href="#val-get_next_counter" class="anchor"></a><code><span><span class="keyword">val</span> get_next_counter : <span><span class="optlabel">?source</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_next_counter ~source client</code> returns the next valid counter value for <code>source</code> expected by the protocol for a manager operation where the source is <code>source</code>. If the <code>source</code> is not provided, the same one as <a href="#val-make"><code>make</code></a> is used.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-json"><a href="#val-json" class="anchor"></a><code><span><span class="keyword">val</span> json : <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.u <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>json t</code> gives the json representation of a manager operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-operation"><a href="#val-operation" class="anchor"></a><code><span><span class="keyword">val</span> operation : 
  <span><span class="optlabel">?branch</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signer</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-operation">operation</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>operation ?branch t client</code> constructs an operation from a manager operation. <code>branch</code> can be used to set manually the branch. <code>client</code> can be used to get some meta information such as the <code>counter</code> for the operation.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject"><a href="#val-inject" class="anchor"></a><code><span><span class="keyword">val</span> inject : 
  <span><span class="optlabel">?dont_wait</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?request</span>:<span>[ `Inject <span>| `Notify</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?branch</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signer</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?error</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`OpHash of string</span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>A wrapper for <a href="#val-inject"><code>inject</code></a> with manager operations. The client is used to get all the data that was not provided if it can be recovered via RPCs. Mainly those are the <code>branch</code> and the <code>counter</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_branch"><a href="#val-get_branch" class="anchor"></a><code><span><span class="keyword">val</span> get_branch : <span><span class="optlabel">?chain</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?offset</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>A wrapper for <a href="../../RPC/index.html#val-get_chain_block_hash"><code>RPC.get_chain_block_hash</code></a> with an offset for the block.</p><p><code>offset</code> defaults to <code>2</code>, to pick the latested finalized branch with Tenderbake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mk_single_transfer"><a href="#val-mk_single_transfer" class="anchor"></a><code><span><span class="keyword">val</span> mk_single_transfer : 
  <span><span class="optlabel">?source</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?counter</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?gas_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?storage_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dest</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?amount</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?branch</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signer</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-operation">operation</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>A wrapper for <a href="#val-operation"><code>operation</code></a> on a list consisting in a single <a href="#val-transfer"><code>transfer</code></a>. See both functions for details and default values of arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inject_single_transfer"><a href="#val-inject_single_transfer" class="anchor"></a><code><span><span class="keyword">val</span> inject_single_transfer : 
  <span><span class="optlabel">?source</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?counter</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?gas_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?storage_limit</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dest</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?amount</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?request</span>:<span>[&lt; `Arrived <span>| `Flush</span> <span>| `Inject</span> <span>| `Notify</span> Inject ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?branch</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signer</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?error</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`OpHash of string</span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>A wrapper for <a href="#val-inject"><code>inject</code></a>ing a batch consisting in a single transfer. See <a href="#val-transfer"><code>transfer</code></a>, <a href="#val-make_batch"><code>make_batch</code></a>, and <a href="#val-inject"><code>inject</code></a> for the descriptions and default values of the arguments.</p></div></div></div></body></html>
