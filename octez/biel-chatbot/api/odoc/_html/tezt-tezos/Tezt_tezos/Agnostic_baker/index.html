<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Agnostic_baker (tezt-tezos.Tezt_tezos.Agnostic_baker)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Agnostic_baker</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Agnostic_baker</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>An agnostic baker instance</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>See <code>Daemon.Make.name</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-terminate"><a href="#val-terminate" class="anchor"></a><code><span><span class="keyword">val</span> terminate : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGTERM and wait for the process to terminate.</p><p>Default <code>timeout</code> is 30 seconds, after which SIGKILL is sent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kill"><a href="#val-kill" class="anchor"></a><code><span><span class="keyword">val</span> kill : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGKILL and wait for the process to terminate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stop"><a href="#val-stop" class="anchor"></a><code><span><span class="keyword">val</span> stop : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGSTOP to the process.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-continue"><a href="#val-continue" class="anchor"></a><code><span><span class="keyword">val</span> continue : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGCONT to the process.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_events"><a href="#val-log_events" class="anchor"></a><code><span><span class="keyword">val</span> log_events : <span><span class="optlabel">?max_length</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>See <code>Daemon.Make.log_events</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for"><a href="#val-wait_for" class="anchor"></a><code><span><span class="keyword">val</span> wait_for : 
  <span><span class="optlabel">?where</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>See <code>Daemon.Make.wait_for</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for_ready"><a href="#val-wait_for_ready" class="anchor"></a><code><span><span class="keyword">val</span> wait_for_ready : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until the agnostic baker is ready.</p><p>More precisely, wait until a &quot;Agnostic Baker started&quot; event occurs. If this event alreay happened, return immediately.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="optlabel">?event_level</span>:<a href="../Daemon/Level/index.html#type-default_level">Daemon.Level.default_level</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_sections_levels</span>:<span><span>(string * <a href="../Daemon/Level/index.html#type-level">Daemon.Level.level</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Spawn <code>octez-agnostic-baker run</code>.</p><p>The resulting promise is fulfilled as soon as the agnostic baker has been spawned. It continues running in the background.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-liquidity_baking_vote"><a href="#type-liquidity_baking_vote" class="anchor"></a><code><span><span class="keyword">type</span> liquidity_baking_vote</span><span> = </span></code><ol><li id="type-liquidity_baking_vote.Off" class="def variant constructor anchored"><a href="#type-liquidity_baking_vote.Off" class="anchor"></a><code><span>| </span><span><span class="constructor">Off</span></span></code></li><li id="type-liquidity_baking_vote.On" class="def variant constructor anchored"><a href="#type-liquidity_baking_vote.On" class="anchor"></a><code><span>| </span><span><span class="constructor">On</span></span></code></li><li id="type-liquidity_baking_vote.Pass" class="def variant constructor anchored"><a href="#type-liquidity_baking_vote.Pass" class="anchor"></a><code><span>| </span><span><span class="constructor">Pass</span></span></code></li></ol></div><div class="spec-doc"><p>Liquidity baking vote values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-liquidity_baking_vote_to_string"><a href="#val-liquidity_baking_vote_to_string" class="anchor"></a><code><span><span class="keyword">val</span> liquidity_baking_vote_to_string : <span><a href="#type-liquidity_baking_vote">liquidity_baking_vote</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Returns the string representation of a <code>liquidity_baking_vote</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?delegates</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?remote_mode</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?liquidity_baking_toggle_vote</span>:<span><a href="#type-liquidity_baking_vote">liquidity_baking_vote</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a agnostic baker.</p><p>This function just creates a value of type <code>t</code>, it does not call <a href="#val-run"><code>run</code></a>.</p><p><code>path</code> provides the path to the agnostic baker binary, the default being the one derived from the <code>protocol</code>.</p><p>The standard output and standard error output of the agnostic baker will be logged with prefix <code>name</code> and color <code>color</code>.</p><p>Default <code>event_pipe</code> is a temporary file whose name is derived from <code>name</code>. It will be created as a named pipe so that agnostic baker events can be received.</p><p>The <code>Node.t</code> parameter is the node used by the agnostic baker. The agnostic baker is configured to use the node's data dir.</p><p>The <code>Client.t</code> parameter is the client used by the agnostic baker. The agnostic baker is configured to use the client's base directory.</p><p>If <code>runner</code> is specified, the agnostic baker will be spawned on this runner using SSH.</p><p><code>delegates</code> is a list of account aliases (see <code>Account.key.alias</code>), e.g., bootstrap accounts (see <code>Constant.bootstrap_keys</code>), delegated to this agnostic baker. This defaults to the empty list, which is a shortcut for &quot;every known account&quot;.</p><p><code>liquidity_baking_toggle_vote</code> is passed to the agnostic baker daemon through the flags <code>--liquidity-baking-toggle-vote</code>. If <code>--liquidity-baking-toggle-vote</code> is <code>None</code>, then <code>--liquidity-baking-toggle-vote</code> is not passed. If it is <code>Some x</code> then <code>--liquidity-baking-toggle-vote x</code> is passed. The default value is <code>Some Pass</code>.</p><p>If <code>remote_mode</code> is specified, the agnostic baker will run in RPC-only mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_from_uris"><a href="#val-create_from_uris" class="anchor"></a><code><span><span class="keyword">val</span> create_from_uris : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?delegates</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?remote_mode</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?liquidity_baking_toggle_vote</span>:<span><a href="#type-liquidity_baking_vote">liquidity_baking_vote</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">base_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">node_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">node_rpc_endpoint</span>:<a href="../Endpoint/index.html#type-t">Endpoint.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Similar to <a href="#val-create"><code>create</code></a>, but nodes RPCs addresses, wallet base directory and L1 data directory are directly provided instead of a <code>Client.t</code>, a <code>Node.t</code> and optionally a <a href="../Dal_node/index.html#type-t"><code>Dal_node.t</code></a>.</p><p>The <code>node_data_dir</code> parameter provides the (local) node's data directory used for baking.</p><p>The <code>node_rpc_endpoint</code> parameter provides the (local) node's RPC server endpoint to which the agnostic baker will connect to.</p><p>The <code>base_dir</code> parameter contains needed information about the wallets used by the agnostic baker.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_level</span>:<a href="../Daemon/Level/index.html#type-default_level">Daemon.Level.default_level</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_sections_levels</span>:<span><span>(string * <a href="../Daemon/Level/index.html#type-level">Daemon.Level.level</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?delegates</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?remote_mode</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?liquidity_baking_toggle_vote</span>:<span><a href="#type-liquidity_baking_vote">liquidity_baking_vote</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Initialize an agnositc baker.</p><p>This creates agnostic baker, waits for it to be ready, and then returns it.</p><p>As the agnostic baker usually relies on a node, we first wait for the node to be ready and then, run the agnostic baker.</p><p>The path to the agnostic baker binary is chosen from the <code>protocol</code>.</p><p>The standard output and standard error output of the agnostic baker will be logged with prefix <code>name</code> and color <code>color</code>.</p><p>Default <code>event_pipe</code> is a temporary file whose name is derived from <code>name</code>. It will be created as a named pipe so that agnostic baker events can be received.</p><p>The <code>Node.t</code> parameter is the node used by the agnostic baker. The agnostic baker is configured to use the node's data dir.</p><p>The <code>Client.t</code> parameter is the client used by the agnostic baker. The agnostic baker is configured to use the client's base directory.</p><p>If <code>runner</code> is specified, the agnostic baker will be spawned on this runner using SSH.</p><p><code>delegates</code> is a list of account aliases (see <code>Account.key.alias</code>), e.g., bootstrap accounts (see <code>Constant.bootstrap_keys</code>), delegated to this agnostic baker. This defaults to the empty list, which is a shortcut for &quot;every known account&quot;.</p><p>If <code>remote_mode</code> is specified, the agnostic baker will run in RPC-only mode.</p></div></div></div></body></html>
