<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dal_node (tezt-tezos.Tezt_tezos.Dal_node)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Dal_node</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Dal_node</span></code></h1><p>Spawn Data-availability-layer (DAL) nodes and control them</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>DAL Node state</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-history_mode"><a href="#type-history_mode" class="anchor"></a><code><span><span class="keyword">type</span> history_mode</span><span> = </span></code><ol><li id="type-history_mode.Full" class="def variant constructor anchored"><a href="#type-history_mode.Full" class="anchor"></a><code><span>| </span><span><span class="constructor">Full</span></span></code></li><li id="type-history_mode.Auto" class="def variant constructor anchored"><a href="#type-history_mode.Auto" class="anchor"></a><code><span>| </span><span><span class="constructor">Auto</span></span></code></li><li id="type-history_mode.Custom" class="def variant constructor anchored"><a href="#type-history_mode.Custom" class="anchor"></a><code><span>| </span><span><span class="constructor">Custom</span> <span class="keyword">of</span> int</span></code></li></ol></div><div class="spec-doc"><p>Period for the shards to be kept in the storage <code>Full</code> : never delete <code>Auto</code> : period depending on the node profile <code>Custom (i)</code> : keeps the shards during <code>i</code> blocks</p></div></div><p>Creates a DAL node</p><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?listen_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?public_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metrics_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">node</span>:<a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_from_endpoint"><a href="#val-create_from_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> create_from_endpoint : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?listen_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?public_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metrics_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">l1_node_endpoint</span>:<a href="../Endpoint/index.html#type-t">Endpoint.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name of an dal node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_host"><a href="#val-rpc_host" class="anchor"></a><code><span><span class="keyword">val</span> rpc_host : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the RPC host given as <code>--rpc-addr</code> to an dal node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_port"><a href="#val-rpc_port" class="anchor"></a><code><span><span class="keyword">val</span> rpc_port : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the RPC port given as <code>--rpc-addr</code> to an dal node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_endpoint"><a href="#val-rpc_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> rpc_endpoint : <span><span class="optlabel">?local</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return the endpoint of the DAL node's RPC server, i.e., http://rpc_host:rpc_port. If <code>local</code> is given (<code>false</code> by default), then <code>Constant.default_host</code> is used (it overrides <code>rpc-addr</code> or the <code>runner</code> argument).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-listen_addr"><a href="#val-listen_addr" class="anchor"></a><code><span><span class="keyword">val</span> listen_addr : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the node's point pair &quot;address:port&quot; given as <code>--net-addr</code> to a dal node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metrics_addr"><a href="#val-metrics_addr" class="anchor"></a><code><span><span class="keyword">val</span> metrics_addr : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the node's metrics server point pair &quot;address:port&quot; given as <code>--metrics-addr</code> to a dal node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metrics_port"><a href="#val-metrics_port" class="anchor"></a><code><span><span class="keyword">val</span> metrics_port : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-data_dir"><a href="#val-data_dir" class="anchor"></a><code><span><span class="keyword">val</span> data_dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the data-dir of an dal node.</p></div></div><p><code>run ?wait_ready ?env ?event_level node</code> launches the given dal node where env is a map of environment variable.</p><p>If <code>wait_ready</code> is <code>true</code>, the promise waits for the dal node to be ready. <code>true</code> by default.</p><p><code>event_level</code> allows to determine the printed levels. By default, it is set to <code>`Debug</code> by default.</p><div class="odoc-spec"><div class="spec value anchored" id="val-identity_file"><a href="#val-identity_file" class="anchor"></a><code><span><span class="keyword">val</span> identity_file : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the identity file of a dal node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="optlabel">?wait_ready</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span>string <span class="xref-unresolved">Tezt_wrapper</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_level</span>:<a href="../Daemon/Level/index.html#type-default_level">Daemon.Level.default_level</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-terminate"><a href="#val-terminate" class="anchor"></a><code><span><span class="keyword">val</span> terminate : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGTERM and wait for the process to terminate.</p><p>Default <code>timeout</code> is 30 seconds, after which SIGKILL is sent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kill"><a href="#val-kill" class="anchor"></a><code><span><span class="keyword">val</span> kill : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGKILL and wait for the process to terminate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stop"><a href="#val-stop" class="anchor"></a><code><span><span class="keyword">val</span> stop : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGSTOP to a daemon. Do not wait for the process to terminate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_events"><a href="#val-log_events" class="anchor"></a><code><span><span class="keyword">val</span> log_events : <span><span class="optlabel">?max_length</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Shows in stdout every events sent by the node</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for"><a href="#val-wait_for" class="anchor"></a><code><span><span class="keyword">val</span> wait_for : 
  <span><span class="optlabel">?where</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>See <code>Daemon.Make.wait_for</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_running_not_ready"><a href="#val-is_running_not_ready" class="anchor"></a><code><span><span class="keyword">val</span> is_running_not_ready : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_running_not_ready dal_node</code> returns true if the given node is running but its status is not ready</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.process_status <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a node terminates and return its status. If the node is not running, make the test fail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_config"><a href="#val-init_config" class="anchor"></a><code><span><span class="keyword">val</span> init_config : 
  <span><span class="optlabel">?expected_pow</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?peers</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?attester_profiles</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?producer_profiles</span>:<span>int list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?observer_profiles</span>:<span>int list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?bootstrap_profile</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?history_mode</span>:<a href="#type-history_mode">history_mode</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Run <code>octez-dal-node config init</code>.</p><p><code>expected_pow</code> allows to change the PoW difficulty. Default value is 0.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Config_file"><a href="#module-Config_file" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Config_file/index.html">Config_file</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>DAL node configuration files.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_identity"><a href="#val-read_identity" class="anchor"></a><code><span><span class="keyword">val</span> read_identity : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Read the peer id from the node's identity file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-as_rpc_endpoint"><a href="#val-as_rpc_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> as_rpc_endpoint : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Endpoint/index.html#type-t">Endpoint.t</a></span></code></div><div class="spec-doc"><p>Expose the RPC server address of this node as a foreign endpoint.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for_connections"><a href="#val-wait_for_connections" class="anchor"></a><code><span><span class="keyword">val</span> wait_for_connections : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait for a node to receive a given number of connections.</p><p><code>wait_for_connections node n</code> waits until <code>node</code> receives <code>n</code> <code>&quot;new_connection.v0&quot;</code> events.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for_ready"><a href="#val-wait_for_ready" class="anchor"></a><code><span><span class="keyword">val</span> wait_for_ready : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until the node is ready.</p><p>More precisely, wait until a <code>dal_node_is_ready</code> event occurs. If such an event already occurred, return immediately.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for_disconnection"><a href="#val-wait_for_disconnection" class="anchor"></a><code><span><span class="keyword">val</span> wait_for_disconnection : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">peer_id</span>:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait for a node to receive a disconnection for some peer_id.</p><p><code>wait_for_disconnection node peer_id</code> waits until <code>node</code> receives a <code>&quot;disconnected.v0&quot;</code> event from the given peer id.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-runner"><a href="#val-runner" class="anchor"></a><code><span><span class="keyword">val</span> runner : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Tezt_wrapper</span>.Runner.t option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-point_str"><a href="#val-point_str" class="anchor"></a><code><span><span class="keyword">val</span> point_str : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load_last_finalized_processed_level"><a href="#val-load_last_finalized_processed_level" class="anchor"></a><code><span><span class="keyword">val</span> load_last_finalized_processed_level : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int option</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Load and return the current value of the last finalized level processed by the crawler and stored in store/last_processed_level KVS file. The function returns <code>None</code> in case of error (e.g. file not found, file locked, ...).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-debug_print_store_schemas"><a href="#val-debug_print_store_schemas" class="anchor"></a><code><span><span class="keyword">val</span> debug_print_store_schemas : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?hooks</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Process_hooks.t <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>debug_print_store_schemas ?path ?hooks ()</code> calls <code>path debug
    print store schemas</code> where:</p><ul><li><code>path</code> is the provided executable path (defaults to <code>Constant.octez_dal_node</code>),</li><li><code>hooks</code> are attached to the process (defaults to <code>None</code>).</li></ul></div></div></div></body></html>
