<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sc_rollup_node (tezt-tezos.Tezt_tezos.Sc_rollup_node)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Sc_rollup_node</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Sc_rollup_node</span></code></h1><p>Spawn smart-contract rollup nodes and control them.</p></header><div class="odoc-content"><p>This module follows the same conventions as in <a href="../Node/index.html"><code>Node</code></a>. We write <code>sc node</code> to refer to <code>smart-contract rollup node</code>.</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Smart contract rollup node states.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-purpose"><a href="#type-purpose" class="anchor"></a><code><span><span class="keyword">type</span> purpose</span><span> = </span></code><ol><li id="type-purpose.Operating" class="def variant constructor anchored"><a href="#type-purpose.Operating" class="anchor"></a><code><span>| </span><span><span class="constructor">Operating</span></span></code></li><li id="type-purpose.Batching" class="def variant constructor anchored"><a href="#type-purpose.Batching" class="anchor"></a><code><span>| </span><span><span class="constructor">Batching</span></span></code></li><li id="type-purpose.Cementing" class="def variant constructor anchored"><a href="#type-purpose.Cementing" class="anchor"></a><code><span>| </span><span><span class="constructor">Cementing</span></span></code></li><li id="type-purpose.Recovering" class="def variant constructor anchored"><a href="#type-purpose.Recovering" class="anchor"></a><code><span>| </span><span><span class="constructor">Recovering</span></span></code></li><li id="type-purpose.Executing_outbox" class="def variant constructor anchored"><a href="#type-purpose.Executing_outbox" class="anchor"></a><code><span>| </span><span><span class="constructor">Executing_outbox</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-operation_kind"><a href="#type-operation_kind" class="anchor"></a><code><span><span class="keyword">type</span> operation_kind</span><span> = </span></code><ol><li id="type-operation_kind.Publish" class="def variant constructor anchored"><a href="#type-operation_kind.Publish" class="anchor"></a><code><span>| </span><span><span class="constructor">Publish</span></span></code></li><li id="type-operation_kind.Add_messages" class="def variant constructor anchored"><a href="#type-operation_kind.Add_messages" class="anchor"></a><code><span>| </span><span><span class="constructor">Add_messages</span></span></code></li><li id="type-operation_kind.Cement" class="def variant constructor anchored"><a href="#type-operation_kind.Cement" class="anchor"></a><code><span>| </span><span><span class="constructor">Cement</span></span></code></li><li id="type-operation_kind.Timeout" class="def variant constructor anchored"><a href="#type-operation_kind.Timeout" class="anchor"></a><code><span>| </span><span><span class="constructor">Timeout</span></span></code></li><li id="type-operation_kind.Refute" class="def variant constructor anchored"><a href="#type-operation_kind.Refute" class="anchor"></a><code><span>| </span><span><span class="constructor">Refute</span></span></code></li><li id="type-operation_kind.Recover" class="def variant constructor anchored"><a href="#type-operation_kind.Recover" class="anchor"></a><code><span>| </span><span><span class="constructor">Recover</span></span></code></li><li id="type-operation_kind.Execute_outbox_message" class="def variant constructor anchored"><a href="#type-operation_kind.Execute_outbox_message" class="anchor"></a><code><span>| </span><span><span class="constructor">Execute_outbox_message</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-mode"><a href="#type-mode" class="anchor"></a><code><span><span class="keyword">type</span> mode</span><span> = </span></code><ol><li id="type-mode.Batcher" class="def variant constructor anchored"><a href="#type-mode.Batcher" class="anchor"></a><code><span>| </span><span><span class="constructor">Batcher</span></span></code></li><li id="type-mode.Custom" class="def variant constructor anchored"><a href="#type-mode.Custom" class="anchor"></a><code><span>| </span><span><span class="constructor">Custom</span> <span class="keyword">of</span> <span><a href="#type-operation_kind">operation_kind</a> list</span></span></code></li><li id="type-mode.Maintenance" class="def variant constructor anchored"><a href="#type-mode.Maintenance" class="anchor"></a><code><span>| </span><span><span class="constructor">Maintenance</span></span></code></li><li id="type-mode.Observer" class="def variant constructor anchored"><a href="#type-mode.Observer" class="anchor"></a><code><span>| </span><span><span class="constructor">Observer</span></span></code></li><li id="type-mode.Operator" class="def variant constructor anchored"><a href="#type-mode.Operator" class="anchor"></a><code><span>| </span><span><span class="constructor">Operator</span></span></code></li><li id="type-mode.Accuser" class="def variant constructor anchored"><a href="#type-mode.Accuser" class="anchor"></a><code><span>| </span><span><span class="constructor">Accuser</span></span></code></li><li id="type-mode.Bailout" class="def variant constructor anchored"><a href="#type-mode.Bailout" class="anchor"></a><code><span>| </span><span><span class="constructor">Bailout</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-history_mode"><a href="#type-history_mode" class="anchor"></a><code><span><span class="keyword">type</span> history_mode</span><span> = </span></code><ol><li id="type-history_mode.Archive" class="def variant constructor anchored"><a href="#type-history_mode.Archive" class="anchor"></a><code><span>| </span><span><span class="constructor">Archive</span></span></code></li><li id="type-history_mode.Full" class="def variant constructor anchored"><a href="#type-history_mode.Full" class="anchor"></a><code><span>| </span><span><span class="constructor">Full</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-argument"><a href="#type-argument" class="anchor"></a><code><span><span class="keyword">type</span> argument</span><span> = </span></code><ol><li id="type-argument.Data_dir" class="def variant constructor anchored"><a href="#type-argument.Data_dir" class="anchor"></a><code><span>| </span><span><span class="constructor">Data_dir</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Rpc_addr" class="def variant constructor anchored"><a href="#type-argument.Rpc_addr" class="anchor"></a><code><span>| </span><span><span class="constructor">Rpc_addr</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Rpc_port" class="def variant constructor anchored"><a href="#type-argument.Rpc_port" class="anchor"></a><code><span>| </span><span><span class="constructor">Rpc_port</span> <span class="keyword">of</span> int</span></code></li><li id="type-argument.Log_kernel_debug" class="def variant constructor anchored"><a href="#type-argument.Log_kernel_debug" class="anchor"></a><code><span>| </span><span><span class="constructor">Log_kernel_debug</span></span></code></li><li id="type-argument.Log_kernel_debug_file" class="def variant constructor anchored"><a href="#type-argument.Log_kernel_debug_file" class="anchor"></a><code><span>| </span><span><span class="constructor">Log_kernel_debug_file</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Metrics_addr" class="def variant constructor anchored"><a href="#type-argument.Metrics_addr" class="anchor"></a><code><span>| </span><span><span class="constructor">Metrics_addr</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Injector_attempts" class="def variant constructor anchored"><a href="#type-argument.Injector_attempts" class="anchor"></a><code><span>| </span><span><span class="constructor">Injector_attempts</span> <span class="keyword">of</span> int</span></code></li><li id="type-argument.Boot_sector_file" class="def variant constructor anchored"><a href="#type-argument.Boot_sector_file" class="anchor"></a><code><span>| </span><span><span class="constructor">Boot_sector_file</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Loser_mode" class="def variant constructor anchored"><a href="#type-argument.Loser_mode" class="anchor"></a><code><span>| </span><span><span class="constructor">Loser_mode</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.No_degraded" class="def variant constructor anchored"><a href="#type-argument.No_degraded" class="anchor"></a><code><span>| </span><span><span class="constructor">No_degraded</span></span></code></li><li id="type-argument.Gc_frequency" class="def variant constructor anchored"><a href="#type-argument.Gc_frequency" class="anchor"></a><code><span>| </span><span><span class="constructor">Gc_frequency</span> <span class="keyword">of</span> int</span></code></li><li id="type-argument.History_mode" class="def variant constructor anchored"><a href="#type-argument.History_mode" class="anchor"></a><code><span>| </span><span><span class="constructor">History_mode</span> <span class="keyword">of</span> <a href="#type-history_mode">history_mode</a></span></code></li><li id="type-argument.Dal_node" class="def variant constructor anchored"><a href="#type-argument.Dal_node" class="anchor"></a><code><span>| </span><span><span class="constructor">Dal_node</span> <span class="keyword">of</span> <a href="../Dal_node/index.html#type-t">Dal_node.t</a></span></code></li><li id="type-argument.Mode" class="def variant constructor anchored"><a href="#type-argument.Mode" class="anchor"></a><code><span>| </span><span><span class="constructor">Mode</span> <span class="keyword">of</span> <a href="#type-mode">mode</a></span></code></li><li id="type-argument.Rollup" class="def variant constructor anchored"><a href="#type-argument.Rollup" class="anchor"></a><code><span>| </span><span><span class="constructor">Rollup</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Pre_images_endpoint" class="def variant constructor anchored"><a href="#type-argument.Pre_images_endpoint" class="anchor"></a><code><span>| </span><span><span class="constructor">Pre_images_endpoint</span> <span class="keyword">of</span> string</span></code></li><li id="type-argument.Apply_unsafe_patches" class="def variant constructor anchored"><a href="#type-argument.Apply_unsafe_patches" class="anchor"></a><code><span>| </span><span><span class="constructor">Apply_unsafe_patches</span></span></code></li><li id="type-argument.Injector_retention_period" class="def variant constructor anchored"><a href="#type-argument.Injector_retention_period" class="anchor"></a><code><span>| </span><span><span class="constructor">Injector_retention_period</span> <span class="keyword">of</span> int</span></code></li><li id="type-argument.Acl_allow_all" class="def variant constructor anchored"><a href="#type-argument.Acl_allow_all" class="anchor"></a><code><span>| </span><span><span class="constructor">Acl_allow_all</span></span></code></li></ol></div><div class="spec-doc"><p>Octez smart rollup node command-line arguments.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-event"><a href="#type-event" class="anchor"></a><code><span><span class="keyword">type</span> event</span><span> = </span><span>{</span></code><ol><li id="type-event.name" class="def record field anchored"><a href="#type-event.name" class="anchor"></a><code><span>name : string;</span></code></li><li id="type-event.value" class="def record field anchored"><a href="#type-event.value" class="anchor"></a><code><span>value : <span class="xref-unresolved">Tezt_wrapper</span>.JSON.t;</span></code></li><li id="type-event.timestamp" class="def record field anchored"><a href="#type-event.timestamp" class="anchor"></a><code><span>timestamp : float;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mode_of_string"><a href="#val-mode_of_string" class="anchor"></a><code><span><span class="keyword">val</span> mode_of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-mode">mode</a></span></code></div><div class="spec-doc"><p>Returns the associated <a href="#type-mode"><code>mode</code></a>, fails if the mode is not valid.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_history_mode"><a href="#val-string_of_history_mode" class="anchor"></a><code><span><span class="keyword">val</span> string_of_history_mode : <span><a href="#type-history_mode">history_mode</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Returns the string representation of an history mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">base_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metrics_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metrics_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?operators</span>:<span><span>(<a href="#type-purpose">purpose</a> * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?default_operator</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dal_node</span>:<a href="../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?loser_mode</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_degraded</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?gc_frequency</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?history_mode</span>:<a href="#type-history_mode">history_mode</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?password_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-mode">mode</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a smart contract rollup node.</p><p>A smart contract rollup node is associated to a tezos node passed as argument.</p><p>The standard output and standard error output of the sc node will be logged with prefix <code>name</code> and color <code>color</code>.</p><p>Default <code>data_dir</code> is a temporary directory which is always the same for each <code>name</code>.</p><p><code>dal_node</code> is a node node from the data availability layer the rollup should be connected to.</p><p>Default <code>event_pipe</code> is a temporary file whose name is derived from <code>name</code>. It will be created as a named pipe so that sc node events can be received.</p><p>Default values for <code>net_port</code> or <code>rpc_port</code> are chosen automatically with values starting from 17384 (configurable with `--starting-port`). They are used by <code>config_init</code> and by functions from the <code>Client</code> module. They are not used by <code>run</code>, so if you do not call <code>config_init</code> or generate the configuration file through some other means, your sc node will not listen.</p><p><code>history_mode</code> is <code>full</code> by default to make the rollup runs the GC, and the <code>gc_frequency</code> is <code>1</code> by default to make it runs on every occasion during tests.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_with_endpoint"><a href="#val-create_with_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> create_with_endpoint : 
  <span><span class="optlabel">?runner</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Runner.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">base_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metrics_addr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metrics_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?operators</span>:<span><span>(<a href="#type-purpose">purpose</a> * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?default_operator</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?dal_node</span>:<a href="../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?loser_mode</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_degraded</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?gc_frequency</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?history_mode</span>:<a href="#type-history_mode">history_mode</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?password_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-mode">mode</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Client/index.html#type-endpoint">Client.endpoint</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Do not assume we are running the rollup node against a local octez node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_in_stdin"><a href="#val-write_in_stdin" class="anchor"></a><code><span><span class="keyword">val</span> write_in_stdin : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>write_in_stdin rollup_node str</code> write str into the stdin of the rollup node process.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name of an sc node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-color"><a href="#val-color" class="anchor"></a><code><span><span class="keyword">val</span> color : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t</span></code></div><div class="spec-doc"><p>Get the color of the logs of a smart rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_host"><a href="#val-rpc_host" class="anchor"></a><code><span><span class="keyword">val</span> rpc_host : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the RPC host given as <code>--rpc-addr</code> to an sc node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_port"><a href="#val-rpc_port" class="anchor"></a><code><span><span class="keyword">val</span> rpc_port : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the RPC port given as <code>--rpc-addr</code> to an sc node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_endpoint"><a href="#val-rpc_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> rpc_endpoint : <span><span class="optlabel">?local</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return the endpoint of the sc node, i.e., http://rpc_host:rpc_port.</p><p>If <code>local</code> is given (<code>false</code> by default), then <code>Constant.default_host</code> is used (it overrides <code>rpc-addr</code> or the <code>runner</code> argument).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-endpoint"><a href="#val-endpoint" class="anchor"></a><code><span><span class="keyword">val</span> endpoint : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>An alias for <code>rpc_endpoint</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-data_dir"><a href="#val-data_dir" class="anchor"></a><code><span><span class="keyword">val</span> data_dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the data-dir of an sc node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-base_dir"><a href="#val-base_dir" class="anchor"></a><code><span><span class="keyword">val</span> base_dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the base-dir of an sc node</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-metrics"><a href="#val-metrics" class="anchor"></a><code><span><span class="keyword">val</span> metrics : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string * int</span></code></div><div class="spec-doc"><p>Get the metrics address and port of a node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_purpose"><a href="#val-string_of_purpose" class="anchor"></a><code><span><span class="keyword">val</span> string_of_purpose : <span><a href="#type-purpose">purpose</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_error"><a href="#val-check_error" class="anchor"></a><code><span><span class="keyword">val</span> check_error : 
  <span><span class="optlabel">?exit_code</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?msg</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until an sc node terminates and check its status.</p><p>If the sc node is not running, or if the process returns an exit code which is not <code>exit_code</code>, or if <code>msg</code> does not match the stderr output, fail the test.</p><p>If <code>exit_code</code> is not specified, any non-zero code is accepted. If no <code>msg</code> is given, the stderr is ignored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="optlabel">?env</span>:<span>string <span class="xref-unresolved">Tezt_wrapper</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?endpoint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?legacy</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?restart</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?mode</span>:<a href="#type-mode">mode</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_level</span>:<a href="../Daemon/Level/index.html#type-default_level">Daemon.Level.default_level</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_sections_levels</span>:<span><span>(string * <a href="../Daemon/Level/index.html#type-level">Daemon.Level.level</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?wait_ready</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?password_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-argument">argument</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>run ?endpoint ?event_level ?event_sections_levels ?loser_mode ?allow_degraded
    ?wait_ready node rollup_address arguments </code> launches the given smart contract rollup node for the rollup at <code>rollup_address</code> with the given extra arguments. <code>event_level</code> and <code>event_sections_levels</code> allow to select which events we want the node to emit (see <a href="../Daemon/index.html"><code>Daemon</code></a>). <code>legacy</code> (by default <code>false</code>) must be set if we want to use the legacy <code>run</code> command of the node (which requires a config file to exist). If <code>wait_ready</code> is <code>false</code>, tezt does not wait for the node to be ready. If <code>restart</code> is <code>true</code>, it will stop and restart the node if it is already running.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.process_status <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a node terminates and return its status. If the node is not running, make the test fail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-process"><a href="#val-process" class="anchor"></a><code><span><span class="keyword">val</span> process : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Tezt_wrapper</span>.Process.t option</span></span></code></div><div class="spec-doc"><p>Returns <code>None</code> if node is already terminated or returns the node process if it still running.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-terminate"><a href="#val-terminate" class="anchor"></a><code><span><span class="keyword">val</span> terminate : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGTERM and wait for the process to terminate.</p><p>Default <code>timeout</code> is 30 seconds, after which SIGKILL is sent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kill"><a href="#val-kill" class="anchor"></a><code><span><span class="keyword">val</span> kill : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGKILL and wait for the process to terminate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-config_init"><a href="#val-config_init" class="anchor"></a><code><span><span class="keyword">val</span> config_init : <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Initialize the rollup node configuration file with <code>octez-sc-rollup-node-alpha config init</code>. Returns the name of the resulting configuration file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-spawn_config_init"><a href="#val-spawn_config_init" class="anchor"></a><code><span><span class="keyword">val</span> spawn_config_init : <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Tezt_wrapper</span>.Process.t</span></code></div><div class="spec-doc"><p>Initialize the rollup node configuration file with <code>octez-sc-rollup-node-alpha config init</code> and return the corresponding process.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Config_file"><a href="#module-Config_file" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Config_file/index.html">Config_file</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Sc node configuration files.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unsafe_pvm_patch"><a href="#type-unsafe_pvm_patch" class="anchor"></a><code><span><span class="keyword">type</span> unsafe_pvm_patch</span><span> = </span></code><ol><li id="type-unsafe_pvm_patch.Increase_max_nb_ticks" class="def variant constructor anchored"><a href="#type-unsafe_pvm_patch.Increase_max_nb_ticks" class="anchor"></a><code><span>| </span><span><span class="constructor">Increase_max_nb_ticks</span> <span class="keyword">of</span> int</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch_config_unsafe_pvm_patches"><a href="#val-patch_config_unsafe_pvm_patches" class="anchor"></a><code><span><span class="keyword">val</span> patch_config_unsafe_pvm_patches : 
  <span><span><a href="#type-unsafe_pvm_patch">unsafe_pvm_patch</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Tezt_wrapper</span>.JSON.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch_config_execute_outbox"><a href="#val-patch_config_execute_outbox" class="anchor"></a><code><span><span class="keyword">val</span> patch_config_execute_outbox : <span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Tezt_wrapper</span>.JSON.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-patch_durable_storage"><a href="#val-patch_durable_storage" class="anchor"></a><code><span><span class="keyword">val</span> patch_durable_storage : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">key</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">value</span>:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for_ready"><a href="#val-wait_for_ready" class="anchor"></a><code><span><span class="keyword">val</span> wait_for_ready : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until the sc node is ready.</p><p>More precisely, wait until a <code>node_is_ready</code> event occurs. If such an event already occurred, return immediately.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for_level"><a href="#val-wait_for_level" class="anchor"></a><code><span><span class="keyword">val</span> wait_for_level : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until the layer 1 of the sc node is synchronized with some given tezos level.</p><p>More precisely, wait until a <code>new_head</code> event with a large enough level occurs. If such an event already occurred, return immediately.</p><p>If <code>timeout</code> is provided, stop waiting if <code>timeout</code> seconds have passed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-unsafe_wait_sync"><a href="#val-unsafe_wait_sync" class="anchor"></a><code><span><span class="keyword">val</span> unsafe_wait_sync : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Unbounded variant of <code>wait_for_sync</code>. Do not use in a Tezt tests, as it has been proven time and again that it is a source of waste of CI time when a test is buggy or flaky.</p><p>This variant of <code>wait_for_sync</code> should not be used in sandboxes, as it has been witnessed time and time again that these tests are more subject to race conditions when setting up rollup infrastructure. On open testnets like weeklynet and dailynet, this does not happen because of the large block time.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_sync"><a href="#val-wait_sync" class="anchor"></a><code><span><span class="keyword">val</span> wait_sync : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span>int <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until the layer 1 of the sc node is synchronized with its underlying l1 node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for"><a href="#val-wait_for" class="anchor"></a><code><span><span class="keyword">val</span> wait_for : 
  <span><span class="optlabel">?where</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>wait_for ?where sc_node event_name filter</code> waits for the SCORU node <code>sc_node</code> to emit an event named <code>name</code> (usually this is the name the event is declared with, concatenated with <code>&quot;.v0&quot;</code>). <code>wait_for</code> continues to wait until an event which satisfies the <code>filter</code> (i.e. for which the function returns <code>Some _</code>) is produced, in which case the result of the filter is returned. <code>where</code>, if present, should describe the constraint that <code>filter</code> applies.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_event"><a href="#val-on_event" class="anchor"></a><code><span><span class="keyword">val</span> on_event : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-event">event</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Add a callback to be called whenever the daemon emits an event.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-change_node_and_restart"><a href="#val-change_node_and_restart" class="anchor"></a><code><span><span class="keyword">val</span> change_node_and_restart : 
  <span><span class="optlabel">?event_level</span>:<a href="../Daemon/Level/index.html#type-default_level">Daemon.Level.default_level</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Stops the rollup node and restart it, connected to another Tezos Layer 1 node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-change_node_mode"><a href="#val-change_node_mode" class="anchor"></a><code><span><span class="keyword">val</span> change_node_mode : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-mode">mode</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change the rollup mode. This does not terminate nor restart the node. Change will take effect when the node is run/restart.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-change_operators"><a href="#val-change_operators" class="anchor"></a><code><span><span class="keyword">val</span> change_operators : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="#type-purpose">purpose</a> * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change the rollup node operators. This does not terminate nor restart the node. Change will take effect when the node is run/restart.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dump_durable_storage"><a href="#val-dump_durable_storage" class="anchor"></a><code><span><span class="keyword">val</span> dump_durable_storage : 
  <span><span class="label">sc_rollup_node</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">dump</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?block</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>dump_durable_storage ~sc_rollup_node ~dump ?string ()</code> writes to <code>dump</code> the current state of the WASM PVM from <code>sc_rollup_node</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-export_snapshot"><a href="#val-export_snapshot" class="anchor"></a><code><span><span class="keyword">val</span> export_snapshot : 
  <span><span class="optlabel">?compress_on_the_fly</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?compact</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <a href="../Runnable/index.html#type-process">Runnable.process</a></span></span></code></div><div class="spec-doc"><p><code>export_snapshot ?compress_on_the_fly ?compact rollup_node dir</code> creates a snapshot of the rollup node in directory <code>dir</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-import_snapshot"><a href="#val-import_snapshot" class="anchor"></a><code><span><span class="keyword">val</span> import_snapshot : 
  <span><span class="optlabel">?apply_unsafe_patches</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?no_check</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">snapshot_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../Runnable/index.html#type-process">Runnable.process</a></span></span></code></div><div class="spec-doc"><p><code>import_snapshot ?apply_unsafe_patches ?force rollup_node
    ~snapshot_file</code> imports the snapshot <code>snapshot_file</code> in the rollup node <code>rollup_node</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-as_rpc_endpoint"><a href="#val-as_rpc_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> as_rpc_endpoint : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Endpoint/index.html#type-t">Endpoint.t</a></span></code></div><div class="spec-doc"><p>Expose the RPC server address of this node as a foreign endpoint.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-RPC"><a href="#module-RPC" class="anchor"></a><code><span><span class="keyword">module</span> <a href="RPC/index.html">RPC</a></span><span> : <a href="../RPC_core/module-type-CALLERS/index.html">RPC_core.CALLERS</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../RPC_core/module-type-CALLERS/index.html#type-uri_provider">uri_provider</a> := <a href="#type-t">t</a></span></span></code></div></div></div></body></html>
