<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dac_node (tezt-tezos.Tezt_tezos.Dac_node)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Dac_node</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Dac_node</span></code></h1><p>Spawn Data-availability-committee (DAC) nodes and control them.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>DAC Node state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_coordinator"><a href="#val-create_coordinator" class="anchor"></a><code><span><span class="keyword">val</span> create_coordinator : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_v1_api</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">committee_members</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">node</span>:<a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Creates a DAC node to run in coordinator mode registered with the specified committee members.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_coordinator_with_endpoint"><a href="#val-create_coordinator_with_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> create_coordinator_with_endpoint : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_v1_api</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">committee_members</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">endpoint</span>:<a href="../Client/index.html#type-endpoint">Client.endpoint</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-create_coordinator"><code>create_coordinator</code></a>, but do not assume the endpoint is a node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_committee_member"><a href="#val-create_committee_member" class="anchor"></a><code><span><span class="keyword">val</span> create_committee_member : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_v1_api</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">address</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">node</span>:<a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Creates a DAC node to run in committee_member mode, using the specified address, coordinator rpc host and port.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_committee_member_with_endpoint"><a href="#val-create_committee_member_with_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> create_committee_member_with_endpoint : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_v1_api</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">address</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">endpoint</span>:<a href="../Client/index.html#type-endpoint">Client.endpoint</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Same as <a href="#val-create_committee_member"><code>create_committee_member</code></a>, but do not assume the endpoint is a node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_observer"><a href="#val-create_observer" class="anchor"></a><code><span><span class="keyword">val</span> create_observer : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timeout</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_v1_api</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">committee_member_rpcs</span>:<span><span>(string * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">node</span>:<a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Creates a DAC node to run in observer mode, using the specified coordinator rpc host and port and set the committee member endpoints to <code>committee_member_rpcs</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_observer_with_endpoint"><a href="#val-create_observer_with_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> create_observer_with_endpoint : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?color</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Log.Color.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_pipe</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reveal_data_dir</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_host</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?coordinator_rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timeout</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allow_v1_api</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">committee_member_rpcs</span>:<span><span>(string * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">endpoint</span>:<a href="../Client/index.html#type-endpoint">Client.endpoint</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">client</span>:<a href="../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Same as <code>create_obsever</code>, but do not assume the endpoint is a node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the name of an dac node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mode"><a href="#val-mode" class="anchor"></a><code><span><span class="keyword">val</span> mode : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the mode in which a dac node is configured to run. Returned values can be either &quot;Coordinator&quot;, &quot;Commitee_member&quot; or &quot;Observer&quot;.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_host"><a href="#val-rpc_host" class="anchor"></a><code><span><span class="keyword">val</span> rpc_host : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the RPC host given as <code>--rpc-addr</code> to an dac node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rpc_port"><a href="#val-rpc_port" class="anchor"></a><code><span><span class="keyword">val</span> rpc_port : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Get the RPC port given as <code>--rpc-addr</code> to an dac node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-endpoint"><a href="#val-endpoint" class="anchor"></a><code><span><span class="keyword">val</span> endpoint : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return the endpoint of the dac node, i.e., http://rpc_host:rpc_port.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-data_dir"><a href="#val-data_dir" class="anchor"></a><code><span><span class="keyword">val</span> data_dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the data-dir of an dac node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reveal_data_dir"><a href="#val-reveal_data_dir" class="anchor"></a><code><span><span class="keyword">val</span> reveal_data_dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the reveal-data-dir of an dac node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-allow_v1_api"><a href="#val-allow_v1_api" class="anchor"></a><code><span><span class="keyword">val</span> allow_v1_api : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>allow_v1_api dac_node</code> is <code>true</code> if current node allows running <code>V1</code> API.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ls_reveal_data_dir"><a href="#val-ls_reveal_data_dir" class="anchor"></a><code><span><span class="keyword">val</span> ls_reveal_data_dir : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Calls <code>ls</code> on reveal data dir.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : 
  <span><span class="optlabel">?wait_ready</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span>string <span class="xref-unresolved">Tezt_wrapper</span>.Base.String_map.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>run ?wait_ready ?env node</code> launches the given dac node where env is a map of environment variable.</p><p>If <code>wait_ready</code> is <code>true</code>, the promise waits for the dac node to be ready. <code>true</code> by default.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-terminate"><a href="#val-terminate" class="anchor"></a><code><span><span class="keyword">val</span> terminate : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGTERM and wait for the process to terminate.</p><p>Default <code>timeout</code> is 30 seconds, after which SIGKILL is sent.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kill"><a href="#val-kill" class="anchor"></a><code><span><span class="keyword">val</span> kill : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Send SIGKILL and wait for the process to terminate.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_events"><a href="#val-log_events" class="anchor"></a><code><span><span class="keyword">val</span> log_events : <span><span class="optlabel">?max_length</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Shows in stdout every events sent by the node</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_for"><a href="#val-wait_for" class="anchor"></a><code><span><span class="keyword">val</span> wait_for : 
  <span><span class="optlabel">?where</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Tezt_wrapper</span>.JSON.t <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>See <code>Daemon.Make.wait_for</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_running_not_ready"><a href="#val-is_running_not_ready" class="anchor"></a><code><span><span class="keyword">val</span> is_running_not_ready : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_running_not_ready dac_node</code> returns true if the given node is running but its status is not ready</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.process_status <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait until a node terminates and return its status. If the node is not running, make the test fail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_config"><a href="#val-init_config" class="anchor"></a><code><span><span class="keyword">val</span> init_config : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Run <code>octez-dac-node init-config</code>. Returns the name of the resulting configuration file.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Config_file"><a href="#module-Config_file" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Config_file/index.html">Config_file</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>C node configuration files.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_sleeping_node"><a href="#val-with_sleeping_node" class="anchor"></a><code><span><span class="keyword">val</span> with_sleeping_node : 
  <span><span class="optlabel">?rpc_port</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_address</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">timeout</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(string * int)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>with_sleeping_node</code> creates and runs an embedded node that sleeps for <code>timeout</code> seconds upon receiving any request then returns &quot;ok&quot;. It is used to test timeout capabilities of clients.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-as_rpc_endpoint"><a href="#val-as_rpc_endpoint" class="anchor"></a><code><span><span class="keyword">val</span> as_rpc_endpoint : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Endpoint/index.html#type-t">Endpoint.t</a></span></code></div><div class="spec-doc"><p>Expose the RPC server address of this node as a foreign endpoint.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-RPC"><a href="#module-RPC" class="anchor"></a><code><span><span class="keyword">module</span> <a href="RPC/index.html">RPC</a></span><span> : <a href="../RPC_core/module-type-CALLERS/index.html">RPC_core.CALLERS</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../RPC_core/module-type-CALLERS/index.html#type-uri_provider">uri_provider</a> := <a href="#type-t">t</a></span></span></code></div></div></div></body></html>
