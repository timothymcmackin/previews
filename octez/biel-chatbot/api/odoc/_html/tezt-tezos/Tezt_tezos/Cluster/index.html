<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cluster (tezt-tezos.Tezt_tezos.Cluster)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezt-tezos</a> &#x00BB; <a href="../index.html">Tezt_tezos</a> &#x00BB; Cluster</nav><header class="odoc-preamble"><h1>Module <code><span>Tezt_tezos.Cluster</span></code></h1><p>Set up networks involving large amount of nodes.</p></header><nav class="odoc-toc"><ul><li><a href="#batch-node-creation">Batch Node Creation</a></li><li><a href="#topologies">Topologies</a></li><li><a href="#meta-topologies">Meta-Topologies</a></li><li><a href="#running">Running</a></li></ul></nav><div class="odoc-content"><p>The applications of this module range from running small cliques to complex network topologies involving as many nodes as your computer can handle.</p><p>The general approach is to create some nodes, then declare connections using functions such as <code>connect</code>, <code>clique</code>, <code>ring</code> or <code>star</code>, and finally start all nodes with <code>start</code>.</p><p>For instance, here is how to create a star topology, with a center node connected to 5 other nodes: <code>
      let center = Node.create [] in
      let other_star_nodes = Cluster.create 5 [] in
      Cluster.star center other_star_nodes;
    </code> Here is how to connect the center node of this star to a clique of 4 other nodes: <code>
      let clique_nodes = Cluster.create 4 [] in
      Cluster.clique clique_nodes;
      Cluster.connect [center] clique_nodes;
    </code> Finally, here is how to start the network: <code>
      Cluster.start (clique_nodes @ center :: other_star_nodes)
    </code></p><h3 id="batch-node-creation"><a href="#batch-node-creation" class="anchor"></a>Batch Node Creation</h3><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?path</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rpc_external</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Node/index.html#type-argument">Node.argument</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Node/index.html#type-t">Node.t</a> list</span></span></code></div><div class="spec-doc"><p>Create several nodes.</p><p>Usage: <code>create count ?rpc_external arguments</code></p><p>Create <code>count</code> nodes (using <code>Node.create</code>) sharing the same <code>?rpc_external</code> and <code>arguments</code>. Each node is named <code>name ^ &quot;.&quot; ^ i</code> where <code>i</code> is the index of the node in the resulting list, starting from 1.</p></div></div><h3 id="topologies"><a href="#topologies" class="anchor"></a>Topologies</h3><div class="odoc-spec"><div class="spec value anchored" id="val-symmetric_add_peer"><a href="#val-symmetric_add_peer" class="anchor"></a><code><span><span class="keyword">val</span> symmetric_add_peer : <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect two nodes together.</p><p>Usage: <code>symmetric_add_peer a b</code></p><p>Same as <code>Node.add_peer a b; Node.add_peer b a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect all nodes of a cluster to all nodes of another cluster.</p><p>Usage: <code>connect a b</code></p><p>Add all nodes of <code>b</code> as <code>--peer</code> arguments to all nodes of <code>a</code>, and all nodes of <code>a</code> as <code>--peer</code> arguments to all nodes of <code>b</code>. This is a generalization of <code>symmetric_add_peer</code> for lists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-clique"><a href="#val-clique" class="anchor"></a><code><span><span class="keyword">val</span> clique : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect all nodes of a cluster together.</p><p>For a cluster <code>node1; node2; ...; nodeN</code>, this adds:</p><ul><li><code>node2; ...; nodeN</code> as <code>--peer</code>s to <code>node1</code> and vice-versa;</li><li><code>node3; ...; nodeN</code> as <code>--peer</code>s to <code>node2</code> and vice-versa;</li><li>etc.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ring"><a href="#val-ring" class="anchor"></a><code><span><span class="keyword">val</span> ring : <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect nodes to form a ring.</p><p>For a cluster <code>node1; node2; ...; nodeN</code>, this adds:</p><ul><li><code>node2</code> as <code>--peer</code> to <code>node1</code> and vice-versa;</li><li><code>node3</code> as <code>--peer</code> to <code>node2</code> and vice-versa;</li><li>...</li><li>and finally <code>node1</code> as <code>--peer</code> to <code>nodeN</code> and vice-versa.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-star"><a href="#val-star" class="anchor"></a><code><span><span class="keyword">val</span> star : <span><a href="../Node/index.html#type-t">Node.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Connect nodes to form a star.</p><p>Usage: <code>star center other_nodes</code></p><p>Add all <code>other_nodes</code> as <code>--peer</code>s to <code>center</code> and vice-versa.</p></div></div><h3 id="meta-topologies"><a href="#meta-topologies" class="anchor"></a>Meta-Topologies</h3><p>The following functions are similar to the above functions that create topologies, except that they are parameterized by:</p><ul><li><code>'a</code>, the type of nodes (usually <code>Node.t</code>);</li><li>a connection function to create arrows in the graph.</li></ul><p>All non-meta functions are actually instances of their corresponding meta functions with <code>'a = Node.t</code> and <code>symmetric_add_peer</code> as the connection function. For instance, <code>clique</code> is the same as <code>meta_clique symmetric_add_peer</code>.</p><p>Here are examples of other useful instantiations:</p><ul><li>use <code>Node.add_peer</code> as the connection function, to create one-way arrows instead of summetry ones (not very useful if nodes are in private mode);</li><li>use <code>connect</code> as the connection function to connect clusters together (<code>'a</code> is then <code>Node.t list</code>).</li></ul><div class="odoc-spec"><div class="spec value anchored" id="val-meta_connect"><a href="#val-meta_connect" class="anchor"></a><code><span><span class="keyword">val</span> meta_connect : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-connect"><code>connect</code></a>.</p><p>For each <code>a</code> in the first list and <code>b</code> in the second list, this calls the connection function on <code>a</code> and <code>b</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-meta_clique"><a href="#val-meta_clique" class="anchor"></a><code><span><span class="keyword">val</span> meta_clique : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-clique"><code>clique</code></a>.</p><p>For each pair <code>a, b</code> where <code>a</code> and <code>b</code> are part of the list and <code>a</code> is before <code>b</code> in the list, this calls the connection function on <code>a</code> and <code>b</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-meta_clique_lwt"><a href="#val-meta_clique_lwt" class="anchor"></a><code><span><span class="keyword">val</span> meta_clique_lwt : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Lwt-version of <a href="#val-meta_clique"><code>meta_clique</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-meta_ring"><a href="#val-meta_ring" class="anchor"></a><code><span><span class="keyword">val</span> meta_ring : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-ring"><code>ring</code></a>.</p><p>For a list <code>x1; x2; ...; xN</code>, this calls the connection function on the following pairs: <code>x1, x2</code>, <code>x2, x3</code>, ..., <code>x(N-1), xN</code>, and <code>xN, x1</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-meta_star"><a href="#val-meta_star" class="anchor"></a><code><span><span class="keyword">val</span> meta_star : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Meta-version of <a href="#val-star"><code>star</code></a>.</p><p>Usage: <code>star f center outer</code></p><p>This calls <code>f center x</code> for all <code>x</code> in <code>outer</code>.</p></div></div><h3 id="running"><a href="#running" class="anchor"></a>Running</h3><div class="odoc-spec"><div class="spec value anchored" id="val-start"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : 
  <span><span class="optlabel">?public</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_level</span>:<a href="../Daemon/Level/index.html#type-default_level">Daemon.Level.default_level</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?event_sections_levels</span>:<span><span>(string * <a href="../Daemon/Level/index.html#type-level">Daemon.Level.level</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?wait_connections</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Node/index.html#type-t">Node.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Start a cluster of nodes.</p><p>This runs <code>Node.identity_generate</code>, <code>Node.config_init</code>, <code>Node.run</code> and <code>Node.wait_for_ready</code> for all nodes. This is similar to iterating <code>Node.init</code> except that the node are already created.</p><p>If <code>public</code> is <code>false</code> (which is the default), nodes are started with <code>--private_mode</code>. Set <code>public</code> to <code>true</code> to allow the topology to change over time. If you need some nodes to be in private mode, and some nodes not to, set <code>public</code> to <code>true</code>, and give the <code>Private_mode</code> argument to <code>Cluster.create</code> and/or <code>Node.create</code>.</p><p>If <code>?wait_connections</code> is set, the function will return only after all nodes in the topology are connected to their expected number of neighbors.</p></div></div></div></body></html>
