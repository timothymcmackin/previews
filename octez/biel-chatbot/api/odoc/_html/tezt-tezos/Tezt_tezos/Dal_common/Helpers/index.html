<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Helpers (tezt-tezos.Tezt_tezos.Dal_common.Helpers)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">tezt-tezos</a> &#x00BB; <a href="../../index.html">Tezt_tezos</a> &#x00BB; <a href="../index.html">Dal_common</a> &#x00BB; Helpers</nav><header class="odoc-preamble"><h1>Module <code><span>Dal_common.Helpers</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-endpoint"><a href="#val-endpoint" class="anchor"></a><code><span><span class="keyword">val</span> endpoint : <span><a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-slot"><a href="#type-slot" class="anchor"></a><code><span><span class="keyword">type</span> slot</span></code></div><div class="spec-doc"><p>Abstract version of a slot to deal with messages content which are smaller than the expected size of a slot.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_slot"><a href="#val-make_slot" class="anchor"></a><code><span><span class="keyword">val</span> make_slot : <span><span class="optlabel">?padding</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span class="label">slot_size</span>:int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-slot">slot</a></span></code></div><div class="spec-doc"><p><code>make_slot ?paddming ~slot_size content</code> produces a slot. If <code>padding=true</code> (which is the default), then the content is padded to reach the expected size given by <code>slot_size</code> (which is usually obtained from <a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-parameters"><code>Cryptobox.parameters</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-content_of_slot"><a href="#val-content_of_slot" class="anchor"></a><code><span><span class="keyword">val</span> content_of_slot : <span><a href="#type-slot">slot</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>content_of_slot slot</code> retrieves the original content of a slot by removing the padding.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-slot_of_pages"><a href="#val-slot_of_pages" class="anchor"></a><code><span><span class="keyword">val</span> slot_of_pages : <span><span class="label">slot_size</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-slot">slot</a></span></code></div><div class="spec-doc"><p><code>slot_of_pages ~slot_size pages</code> produces a slot from a list of pages. The length of the result is checked against the given <code>slot_size</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_cryptobox"><a href="#val-make_cryptobox" class="anchor"></a><code><span><span class="keyword">val</span> make_cryptobox : 
  <span><span class="optlabel">?on_error</span>:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-t">Cryptobox.t</a> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-parameters">Cryptobox.parameters</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-t">Cryptobox.t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-publish_commitment"><a href="#val-publish_commitment" class="anchor"></a><code><span><span class="keyword">val</span> publish_commitment : 
  <span><span class="optlabel">?dont_wait</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?counter</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?source</span>:<a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?error</span>:<span class="xref-unresolved">Tezt_wrapper</span>.Base.rex <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">index</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">commitment</span>:<a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-commitment">Cryptobox.commitment</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">proof</span>:<a href="../../../../octez-libs/Tezos_crypto_dal/Cryptobox/index.html#type-commitment_proof">Cryptobox.commitment_proof</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`OpHash of string</span> ]</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><p>This function builds a slot with the given content, and makes the given DAL node to compute and store the corresponding commitment and shards by calling relevant RPCs. It returns the commitment and its proof.</p><div class="odoc-spec"><div class="spec value anchored" id="val-store_slot"><a href="#val-store_slot" class="anchor"></a><code><span><span class="keyword">val</span> store_slot : 
  <span><a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">slot_index</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-slot">slot</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * string)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-store_slot_uri"><a href="#val-store_slot_uri" class="anchor"></a><code><span><span class="keyword">val</span> store_slot_uri : 
  <span><a href="../../Endpoint/index.html#type-t">Endpoint.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">slot_index</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-slot">slot</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * string)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-publish_and_store_slot"><a href="#val-publish_and_store_slot" class="anchor"></a><code><span><span class="keyword">val</span> publish_and_store_slot : 
  <span><span class="optlabel">?dont_wait</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?counter</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fee</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Client/index.html#type-t">Client.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Account/index.html#type-key">Account.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">index</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-slot">slot</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_cryptobox_error"><a href="#val-pp_cryptobox_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_cryptobox_error : 
  <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`Fail of string</span>
  <span><span>| `Invalid_degree_strictly_less_than_expected</span> of <span class="type-var">'a</span></span>
  <span>| `Invalid_page</span>
  <span><span>| `Invalid_shard_length</span> of string</span>
  <span><span>| `Not_enough_shards</span> of string</span>
  <span>| `Page_index_out_of_range</span>
  <span>| `Page_length_mismatch</span>
  <span><span>| `Shard_index_out_of_range</span> of string</span>
  <span><span>| `Slot_wrong_size</span> of string</span>
  <span>| `Shard_length_mismatch</span>
  <span>| `Prover_SRS_not_loaded</span>
  <span>| `Invalid_shard</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_new_connection_event"><a href="#val-check_new_connection_event" class="anchor"></a><code><span><span class="keyword">val</span> check_new_connection_event : 
  <span><span class="label">main_node</span>:<a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?other_peer_id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">other_node</span>:<a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">is_trusted</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait for a connection event between <code>main_node</code> and <code>other_node</code>. The optional argument <code>other_peer_id</code> can be used to ignore the connection events which are not between these two nodes. When this optional argument is given, it must be the peer of <code>other_node</code>; this assumption is checked by this function after the reception of the connection event.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_disconnection_event"><a href="#val-check_disconnection_event" class="anchor"></a><code><span><span class="keyword">val</span> check_disconnection_event : <span><a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">peer_id</span>:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Wait for a disconnection from the given peer id.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect_nodes_via_p2p"><a href="#val-connect_nodes_via_p2p" class="anchor"></a><code><span><span class="keyword">val</span> connect_nodes_via_p2p : 
  <span><span class="optlabel">?init_config</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../Dal_node/index.html#type-t">Dal_node.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Connect <code>dal_node1</code> and <code>dal_node2</code> using the bootstrap peer mechanism. <code>dal_node2</code> will use <code>dal_node1</code> as a bootstrap peer. For this to work, <code>dal_node1</code> must already be running. If <code>init_config</code> (false by default) is set to true, <code>Dal_node.init_config</code> will be performed for <code>dal_node2</code> with <code>dal_node1</code> as peer</p></div></div></div></body></html>
