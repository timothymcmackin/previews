<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Node_context (octez-smart-rollup-node-lib.Octez_smart_rollup_node.Node_context)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">octez-smart-rollup-node-lib</a> &#x00BB; <a href="../index.html">Octez_smart_rollup_node</a> &#x00BB; Node_context</nav><header class="odoc-preamble"><h1>Module <code><span>Octez_smart_rollup_node.Node_context</span></code></h1><p>This module describes the execution context of the node.</p></header><nav class="odoc-toc"><ul><li><a href="#abstraction-over-store">Abstraction over store</a><ul><li><a href="#layer-2-blocks">Layer 2 blocks</a></li><li><a href="#commitments">Commitments</a></li><li><a href="#inboxes">Inboxes</a></li><li><a href="#outbox-messages">Outbox messages</a></li><li><a href="#protocol">Protocol</a></li><li><a href="#dal">DAL</a></li></ul></li><li><a href="#helpers">Helpers</a></li><li><a href="#synchronization-tracking">Synchronization tracking</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-lcc"><a href="#type-lcc" class="anchor"></a><code><span><span class="keyword">type</span> lcc</span><span> = </span><span>{</span></code><ol><li id="type-lcc.commitment" class="def record field anchored"><a href="#type-lcc.commitment" class="anchor"></a><code><span>commitment : <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a>;</span></code></li><li id="type-lcc.level" class="def record field anchored"><a href="#type-lcc.level" class="anchor"></a><code><span>level : int32;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-genesis_info"><a href="#type-genesis_info" class="anchor"></a><code><span><span class="keyword">type</span> genesis_info</span><span> = <a href="../../../octez-l2-libs/Octez_smart_rollup/Metadata/index.html#type-genesis_info">Octez_smart_rollup.Metadata.genesis_info</a></span><span> = </span><span>{</span></code><ol><li id="type-genesis_info.level" class="def record field anchored"><a href="#type-genesis_info.level" class="anchor"></a><code><span>level : int32;</span></code></li><li id="type-genesis_info.commitment_hash" class="def record field anchored"><a href="#type-genesis_info.commitment_hash" class="anchor"></a><code><span>commitment_hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-store"><a href="#type-store" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a store</span></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&lt; `Read <span>| `Write</span> Read ]</span></span></code></div><div class="spec-doc"><p>Abstract type for store to force access through this module.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Node_store"><a href="#module-Node_store" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Node_store/index.html">Node_store</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Exposed functions to manipulate Node_context store outside of this module</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-debug_logger"><a href="#type-debug_logger" class="anchor"></a><code><span><span class="keyword">type</span> debug_logger</span><span> = <span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-current_protocol"><a href="#type-current_protocol" class="anchor"></a><code><span><span class="keyword">type</span> current_protocol</span><span> = </span><span>{</span></code><ol><li id="type-current_protocol.hash" class="def record field anchored"><a href="#type-current_protocol.hash" class="anchor"></a><code><span>hash : <a href="../../../octez-libs/Tezos_crypto/Hashed/Protocol_hash/index.html#type-t">Tezos_base.TzPervasives.Protocol_hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Hash of the current protocol.</p><span class="comment-delim">*)</span></div></li><li id="type-current_protocol.proto_level" class="def record field anchored"><a href="#type-current_protocol.proto_level" class="anchor"></a><code><span>proto_level : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Protocol supported by this rollup node (represented as a protocol level).</p><span class="comment-delim">*)</span></div></li><li id="type-current_protocol.constants" class="def record field anchored"><a href="#type-current_protocol.constants" class="anchor"></a><code><span>constants : <a href="../../../octez-l2-libs/Octez_smart_rollup/Rollup_constants/index.html#type-protocol_constants">Octez_smart_rollup.Rollup_constants.protocol_constants</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Protocol constants retrieved from the Tezos node.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-last_whitelist_update"><a href="#type-last_whitelist_update" class="anchor"></a><code><span><span class="keyword">type</span> last_whitelist_update</span><span> = </span><span>{</span></code><ol><li id="type-last_whitelist_update.message_index" class="def record field anchored"><a href="#type-last_whitelist_update.message_index" class="anchor"></a><code><span>message_index : int;</span></code></li><li id="type-last_whitelist_update.outbox_level" class="def record field anchored"><a href="#type-last_whitelist_update.outbox_level" class="anchor"></a><code><span>outbox_level : <span class="xref-unresolved">Stdlib</span>.Int32.t;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-private_info"><a href="#type-private_info" class="anchor"></a><code><span><span class="keyword">type</span> private_info</span><span> = </span><span>{</span></code><ol><li id="type-private_info.last_whitelist_update" class="def record field anchored"><a href="#type-private_info.last_whitelist_update" class="anchor"></a><code><span>last_whitelist_update : <a href="#type-last_whitelist_update">last_whitelist_update</a>;</span></code></li><li id="type-private_info.last_outbox_level_searched" class="def record field anchored"><a href="#type-private_info.last_outbox_level_searched" class="anchor"></a><code><span>last_outbox_level_searched : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>If the rollup is private then the last search outbox level when looking at whitelist update to execute. This is to reduce the folding call at each cementation. If the rollup is public then it's None.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-sync_info"><a href="#type-sync_info" class="anchor"></a><code><span><span class="keyword">type</span> sync_info</span><span> = </span><span>{</span></code><ol><li id="type-sync_info.on_synchronized" class="def record field anchored"><a href="#type-sync_info.on_synchronized" class="anchor"></a><code><span>on_synchronized : <span>unit <span class="xref-unresolved">Lwt_condition</span>.t</span>;</span></code></li><li id="type-sync_info.processed_level" class="def record field anchored"><a href="#type-sync_info.processed_level" class="anchor"></a><code><span><span class="keyword">mutable</span> processed_level : int32;</span></code></li><li id="type-sync_info.sync_level_input" class="def record field anchored"><a href="#type-sync_info.sync_level_input" class="anchor"></a><code><span>sync_level_input : <span>int32 <span class="xref-unresolved">Lwt_watcher</span>.input</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = </span><span>{</span></code><ol><li id="type-t.config" class="def record field anchored"><a href="#type-t.config" class="anchor"></a><code><span>config : <a href="../Configuration/index.html#type-t">Configuration.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Inlined configuration for the rollup node.</p><span class="comment-delim">*)</span></div></li><li id="type-t.cctxt" class="def record field anchored"><a href="#type-t.cctxt" class="anchor"></a><code><span>cctxt : <a href="../../../octez-shell-libs/Tezos_client_base/Client_context/class-type-full/index.html">Tezos_client_base.Client_context.full</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Client context used by the rollup node.</p><span class="comment-delim">*)</span></div></li><li id="type-t.degraded" class="def record field anchored"><a href="#type-t.degraded" class="anchor"></a><code><span>degraded : <span><span>(<span class="type-var">'a</span>, bool)</span> <a href="../Reference/index.html#type-t">Reference.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Track if node running in degraded mode.</p><span class="comment-delim">*)</span></div></li><li id="type-t.dal_cctxt" class="def record field anchored"><a href="#type-t.dal_cctxt" class="anchor"></a><code><span>dal_cctxt : <span><a href="../../../tezos-dal-node-lib/Tezos_dal_node_lib/Dal_node_client/index.html#type-cctxt">Tezos_dal_node_lib.Dal_node_client.cctxt</a> option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>DAL client context to query the dal node, if the rollup node supports the DAL.</p><span class="comment-delim">*)</span></div></li><li id="type-t.data_dir" class="def record field anchored"><a href="#type-t.data_dir" class="anchor"></a><code><span>data_dir : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Node data dir.</p><span class="comment-delim">*)</span></div></li><li id="type-t.l1_ctxt" class="def record field anchored"><a href="#type-t.l1_ctxt" class="anchor"></a><code><span>l1_ctxt : <a href="../Layer1/index.html#type-t">Layer1.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Layer 1 context to fetch blocks and monitor heads, etc.</p><span class="comment-delim">*)</span></div></li><li id="type-t.genesis_info" class="def record field anchored"><a href="#type-t.genesis_info" class="anchor"></a><code><span>genesis_info : <a href="#type-genesis_info">genesis_info</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Origination information of the smart rollup.</p><span class="comment-delim">*)</span></div></li><li id="type-t.injector_retention_period" class="def record field anchored"><a href="#type-t.injector_retention_period" class="anchor"></a><code><span>injector_retention_period : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Number of blocks the injector will keep information about included operations.</p><span class="comment-delim">*)</span></div></li><li id="type-t.block_finality_time" class="def record field anchored"><a href="#type-t.block_finality_time" class="anchor"></a><code><span>block_finality_time : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Deterministic block finality time for the layer 1 protocol.</p><span class="comment-delim">*)</span></div></li><li id="type-t.kind" class="def record field anchored"><a href="#type-t.kind" class="anchor"></a><code><span>kind : <a href="../../../octez-l2-libs/Octez_smart_rollup/Kind/index.html#type-t">Octez_smart_rollup.Kind.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Kind of the smart rollup.</p><span class="comment-delim">*)</span></div></li><li id="type-t.unsafe_patches" class="def record field anchored"><a href="#type-t.unsafe_patches" class="anchor"></a><code><span>unsafe_patches : <a href="../Pvm_patches/index.html#type-t">Pvm_patches.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Patches to apply to the PVM.</p><span class="comment-delim">*)</span></div></li><li id="type-t.lockfile" class="def record field anchored"><a href="#type-t.lockfile" class="anchor"></a><code><span>lockfile : <span class="xref-unresolved">Lwt_unix</span>.file_descr;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>A lock file acquired when the node starts.</p><span class="comment-delim">*)</span></div></li><li id="type-t.store" class="def record field anchored"><a href="#type-t.store" class="anchor"></a><code><span>store : <span><span class="type-var">'a</span> <a href="#type-store">store</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The store for the persistent storage.</p><span class="comment-delim">*)</span></div></li><li id="type-t.context" class="def record field anchored"><a href="#type-t.context" class="anchor"></a><code><span>context : <span><span class="type-var">'a</span> <a href="../../../octez-l2-libs/Tezos_layer2_store/Context/index.html#type-t">Tezos_layer2_store.Context.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The persistent context for the rollup node.</p><span class="comment-delim">*)</span></div></li><li id="type-t.lcc" class="def record field anchored"><a href="#type-t.lcc" class="anchor"></a><code><span>lcc : <span><span>(<span class="type-var">'a</span>, <a href="#type-lcc">lcc</a>)</span> <a href="../Reference/index.html#type-t">Reference.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Last cemented commitment on L1 (independently of synchronized status of rollup node) and its level.</p><span class="comment-delim">*)</span></div></li><li id="type-t.lpc" class="def record field anchored"><a href="#type-t.lpc" class="anchor"></a><code><span>lpc : <span><span>(<span class="type-var">'a</span>, <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a> option</span>)</span> <a href="../Reference/index.html#type-t">Reference.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>The last published commitment on L1, i.e. commitment that the operator is staked on (even if the rollup node is not synchronized).</p><span class="comment-delim">*)</span></div></li><li id="type-t.private_info" class="def record field anchored"><a href="#type-t.private_info" class="anchor"></a><code><span>private_info : <span><span>(<span class="type-var">'a</span>, <span><a href="#type-private_info">private_info</a> option</span>)</span> <a href="../Reference/index.html#type-t">Reference.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>contains information for the rollup when it's private.</p><span class="comment-delim">*)</span></div></li><li id="type-t.kernel_debug_logger" class="def record field anchored"><a href="#type-t.kernel_debug_logger" class="anchor"></a><code><span>kernel_debug_logger : <a href="#type-debug_logger">debug_logger</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Logger used for writing <code>kernel_debug</code> messages</p><span class="comment-delim">*)</span></div></li><li id="type-t.finaliser" class="def record field anchored"><a href="#type-t.finaliser" class="anchor"></a><code><span>finaliser : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Aggregation of finalisers to run when the node context closes</p><span class="comment-delim">*)</span></div></li><li id="type-t.current_protocol" class="def record field anchored"><a href="#type-t.current_protocol" class="anchor"></a><code><span>current_protocol : <span><a href="#type-current_protocol">current_protocol</a> <a href="../Reference/index.html#type-rw">Reference.rw</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Information about the current protocol. This value is changed in place on protocol upgrades.</p><span class="comment-delim">*)</span></div></li><li id="type-t.global_block_watcher" class="def record field anchored"><a href="#type-t.global_block_watcher" class="anchor"></a><code><span>global_block_watcher : <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> <span class="xref-unresolved">Lwt_watcher</span>.input</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Watcher for the L2 chain, which enables RPC services to access a stream of L2 blocks.</p><span class="comment-delim">*)</span></div></li><li id="type-t.sync" class="def record field anchored"><a href="#type-t.sync" class="anchor"></a><code><span>sync : <a href="#type-sync_info">sync_info</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Synchronization status with respect to the L1 node.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-rw"><a href="#type-rw" class="anchor"></a><code><span><span class="keyword">type</span> rw</span><span> = <span><span>[ `Read <span>| `Write</span> ]</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Read/write node context <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ro"><a href="#type-ro" class="anchor"></a><code><span><span class="keyword">type</span> ro</span><span> = <span><span>[ `Read ]</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Read only node context <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_operator"><a href="#val-get_operator" class="anchor"></a><code><span><span class="keyword">val</span> get_operator : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Purpose/index.html#type-t">Purpose.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Purpose/index.html#type-operator">Purpose.operator</a></span> option</span></span></code></div><div class="spec-doc"><p><code>get_operator cctxt purpose</code> returns the public key hash for the operator who has purpose <code>purpose</code>, if any.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_operator"><a href="#val-is_operator" class="anchor"></a><code><span><span class="keyword">val</span> is_operator : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../octez-libs/Tezos_crypto/Signature/Public_key_hash/index.html#type-t">Tezos_crypto.Signature.Public_key_hash.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_operator cctxt pkh</code> returns <code>true</code> if the public key hash <code>pkh</code> is an operator for the node (for any purpose).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_accuser"><a href="#val-is_accuser" class="anchor"></a><code><span><span class="keyword">val</span> is_accuser : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_accuser node_ctxt</code> returns <code>true</code> if the rollup node runs in accuser mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_bailout"><a href="#val-is_bailout" class="anchor"></a><code><span><span class="keyword">val</span> is_bailout : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_bailout node_ctxt</code> returns <code>true</code> if the rollup node runs in bailout mode.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_loser"><a href="#val-is_loser" class="anchor"></a><code><span><span class="keyword">val</span> is_loser : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_loser node_ctxt</code> returns <code>true</code> if the rollup node runs has some failures planned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-can_inject"><a href="#val-can_inject" class="anchor"></a><code><span><span class="keyword">val</span> can_inject : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Operation_kind/index.html#type-t">Octez_smart_rollup.Operation_kind.t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>can_inject config op_kind</code> determines if a given operation kind can be injected based on the configuration settings.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_op_in_whitelist_or_bailout_mode"><a href="#val-check_op_in_whitelist_or_bailout_mode" class="anchor"></a><code><span><span class="keyword">val</span> check_op_in_whitelist_or_bailout_mode : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_crypto/Signature/Public_key_hash/index.html#type-t">Tezos_crypto.Signature.Public_key_hash.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>check_op_in_whitelist_or_bailout_mode node_ctxt whitelist</code> Checks when the rollup node is operating to determine if the operator is in the whitelist or if the rollup node is in bailout mode. Bailout mode does not publish any commitments but still defends previously committed one.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_fee_parameter"><a href="#val-get_fee_parameter" class="anchor"></a><code><span><span class="keyword">val</span> get_fee_parameter : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Operation_kind/index.html#type-t">Octez_smart_rollup.Operation_kind.t</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../octez-injector/Octez_injector/Injector_common/index.html#type-fee_parameter">Octez_injector.Injector_common.fee_parameter</a></span></code></div><div class="spec-doc"><p><code>get_fee_parameter cctxt purpose</code> returns the fee parameter to inject an operation for a given <code>purpose</code>. If no specific fee parameters were configured for this purpose, returns the default fee parameter for this purpose.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-global_lockfile_path"><a href="#val-global_lockfile_path" class="anchor"></a><code><span><span class="keyword">val</span> global_lockfile_path : <span><span class="label">data_dir</span>:string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>The path for the lockfile used when starting and running the node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-processing_lockfile_path"><a href="#val-processing_lockfile_path" class="anchor"></a><code><span><span class="keyword">val</span> processing_lockfile_path : <span><span class="label">data_dir</span>:string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>The path for the lockfile used in block processing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gc_lockfile_path"><a href="#val-gc_lockfile_path" class="anchor"></a><code><span><span class="keyword">val</span> gc_lockfile_path : <span><span class="label">data_dir</span>:string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>The path for the lockfile used in garbage collection.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-checkout_context"><a href="#val-checkout_context" class="anchor"></a><code><span><span class="keyword">val</span> checkout_context : 
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> <a href="../../../octez-l2-libs/Tezos_layer2_store/Context/index.html#type-t">Tezos_layer2_store.Context.t</a></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>checkout_context node_ctxt block_hash</code> returns the context at block <code>block_hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dal_supported"><a href="#val-dal_supported" class="anchor"></a><code><span><span class="keyword">val</span> dal_supported : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Returns <code>true</code> if the rollup node supports the DAL and if DAL is enabled for the current protocol.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-readonly"><a href="#val-readonly" class="anchor"></a><code><span><span class="keyword">val</span> readonly : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-ro">ro</a></span></code></div><div class="spec-doc"><p><code>readonly node_ctxt</code> returns a read only version of the node context <code>node_ctxt</code>.</p></div></div><h3 id="abstraction-over-store"><a href="#abstraction-over-store" class="anchor"></a>Abstraction over store</h3><div class="odoc-spec"><div class="spec value anchored" id="val-get_history_mode"><a href="#val-get_history_mode" class="anchor"></a><code><span><span class="keyword">val</span> get_history_mode : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Configuration/index.html#type-history_mode">Configuration.history_mode</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_history_mode t</code> returns the current history mode for the rollup node.</p></div></div><h4 id="layer-2-blocks"><a href="#layer-2-blocks" class="anchor"></a>Layer 2 blocks</h4><div class="odoc-spec"><div class="spec value anchored" id="val-is_processed"><a href="#val-is_processed" class="anchor"></a><code><span><span class="keyword">val</span> is_processed : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>bool <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>is_processed store hash</code> returns <code>true</code> if the block with <code>hash</code> has already been processed by the daemon.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_l2_block"><a href="#val-get_l2_block" class="anchor"></a><code><span><span class="keyword">val</span> get_l2_block : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_l2_block t hash</code> returns the Layer 2 block known by the rollup node for Layer 1 block <code>hash</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_l2_block"><a href="#val-find_l2_block" class="anchor"></a><code><span><span class="keyword">val</span> find_l2_block : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_l2_block"><code>get_l2_block</code></a> but returns <code>None</code> when the Layer 2 block is not available.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_l2_block_by_level"><a href="#val-get_l2_block_by_level" class="anchor"></a><code><span><span class="keyword">val</span> get_l2_block_by_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_l2_block"><code>get_l2_block</code></a> but retrieves the Layer 2 block by its level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_l2_block_by_level"><a href="#val-find_l2_block_by_level" class="anchor"></a><code><span><span class="keyword">val</span> find_l2_block_by_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_l2_block_by_level"><code>get_l2_block_by_level</code></a> but returns <code>None</code> when the Layer 2 block is not available.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_full_l2_block"><a href="#val-get_full_l2_block" class="anchor"></a><code><span><span class="keyword">val</span> get_full_l2_block : 
  <span><span class="optlabel">?get_outbox_messages</span>:
    <span>(<span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../../../octez-l2-libs/Tezos_layer2_store/Context/index.html#type-pvmstate">Tezos_layer2_store.Context.pvmstate</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="label">outbox_level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>(int * <a href="../../../octez-l2-libs/Octez_smart_rollup/Outbox_message/index.html#type-summary">Octez_smart_rollup.Outbox_message.summary</a>)</span> list</span> <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-full">Octez_smart_rollup.Sc_rollup_block.full</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_full_l2_block ?get_outbox_messages node_ctxt hash</code> returns the full L2 block for L1 block hash <code>hash</code>. The result contains the L2 block and its content (inbox, messages, commitment). If a function to retrieve outbox messages is provided, the result also contains the outbox for this block.</p><p>NOTE: When given, <code>get_outbox_messages</code> is always instantiated with the appropriate <code>Pvm_plugin.get_outbox_messages</code> function which is dependent on the protocol. Passing this function around allows to break a dependency cycle between <a href="#"><code>Node_context</code></a> and <a href="../Protocol_plugins/index.html"><code>Protocol_plugins</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_level"><a href="#val-save_level" class="anchor"></a><code><span><span class="keyword">val</span> save_level : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-head">Layer1.head</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_level t head</code> registers the correspondences <code>head.level |-&gt;
    head.hash</code> in the store.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_l2_block"><a href="#val-save_l2_block" class="anchor"></a><code><span><span class="keyword">val</span> save_l2_block : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_l2_block t l2_block</code> remembers that the <code>l2_block</code> is processed. The system should not have to come back to it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_l2_head"><a href="#val-set_l2_head" class="anchor"></a><code><span><span class="keyword">val</span> set_l2_head : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_l2_head t l2_block</code> sets <code>l2_block</code> as the new head of the L2 chain.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-last_processed_head_opt"><a href="#val-last_processed_head_opt" class="anchor"></a><code><span><span class="keyword">val</span> last_processed_head_opt : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>last_processed_head_opt store</code> returns the last processed head if it exists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_finalized"><a href="#val-set_finalized" class="anchor"></a><code><span><span class="keyword">val</span> set_finalized : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>mark_finalized_head store hash level</code> remembers that the block with <code>hash</code> at <code>level</code> is finalized. By construction, every block whose level is smaller than <code>level</code> is also finalized.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_finalized_level"><a href="#val-get_finalized_level" class="anchor"></a><code><span><span class="keyword">val</span> get_finalized_level : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int32 <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_finalized_level t</code> returns the last finalized level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_finalized_head_opt"><a href="#val-get_finalized_head_opt" class="anchor"></a><code><span><span class="keyword">val</span> get_finalized_head_opt : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_finalized_head_opt store</code> returns the last finalized head if it exists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash_of_level"><a href="#val-hash_of_level" class="anchor"></a><code><span><span class="keyword">val</span> hash_of_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>hash_of_level node_ctxt level</code> returns the current block hash for a given <code>level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-hash_of_level_opt"><a href="#val-hash_of_level_opt" class="anchor"></a><code><span><span class="keyword">val</span> hash_of_level_opt : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>hash_of_level_opt</code> is like <a href="#val-hash_of_level"><code>hash_of_level</code></a> but returns <code>None</code> if the <code>level</code> is not known.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-level_of_hash"><a href="#val-level_of_hash" class="anchor"></a><code><span><span class="keyword">val</span> level_of_hash : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>int32 <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>level_of_hash node_ctxt hash</code> returns the level for Tezos block hash <code>hash</code> if it is known by the Tezos Layer 1 node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-header_of_hash"><a href="#val-header_of_hash" class="anchor"></a><code><span><span class="keyword">val</span> header_of_hash : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Layer1/index.html#type-header">Layer1.header</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the block header for a given hash using the L1 node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_predecessor_opt"><a href="#val-get_predecessor_opt" class="anchor"></a><code><span><span class="keyword">val</span> get_predecessor_opt : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-head">Layer1.head</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Layer1/index.html#type-head">Layer1.head</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_predecessor_opt state head</code> returns the predecessor of block <code>head</code>, when <code>head</code> is not the genesis block.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_predecessor"><a href="#val-get_predecessor" class="anchor"></a><code><span><span class="keyword">val</span> get_predecessor : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-head">Layer1.head</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Layer1/index.html#type-head">Layer1.head</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_predecessor state head</code> returns the predecessor block of <code>head</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_predecessor_header"><a href="#val-get_predecessor_header" class="anchor"></a><code><span><span class="keyword">val</span> get_predecessor_header : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-header">Layer1.header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Layer1/index.html#type-header">Layer1.header</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_predecessor"><code>get_predecessor</code></a> with headers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_tezos_reorg_for_new_head"><a href="#val-get_tezos_reorg_for_new_head" class="anchor"></a><code><span><span class="keyword">val</span> get_tezos_reorg_for_new_head : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ <span>`Head of <a href="../Layer1/index.html#type-head">Layer1.head</a></span> <span><span>| `Level</span> of int32</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-head">Layer1.head</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../Layer1/index.html#type-head">Layer1.head</a> <a href="../../../octez-crawler/Octez_crawler/Reorg/index.html#type-t">Octez_crawler.Reorg.t</a></span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_tezos_reorg_for_new_head node_ctxt old_head new_head</code> returns the L1 reorganization between <code>old_head</code> and <code>new_head</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-block_with_tick"><a href="#val-block_with_tick" class="anchor"></a><code><span><span class="keyword">val</span> block_with_tick : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?min_level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">max_level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Sc_rollup_block/index.html#type-t">Octez_smart_rollup.Sc_rollup_block.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>block_with_tick store ?min_level ~max_level tick</code> returns <code>Some b</code> where <code>b</code> is the last layer 2 block which contains the <code>tick</code> before <code>max_level</code>. If no such block exists (the tick happened after <code>max_level</code>, or we are too late), the function returns <code>None</code>. Fails if the tick happened before <code>min_level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tick_offset_of_commitment_period"><a href="#val-tick_offset_of_commitment_period" class="anchor"></a><code><span><span class="keyword">val</span> tick_offset_of_commitment_period : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Z</span>.t <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>tick_offset_of_commitment_period node_ctxt commtient</code> returns the global initial tick (since genesis) of the PVM for the state at the beginning of the commitment period that <code>commitment</code> concludes.</p></div></div><h4 id="commitments"><a href="#commitments" class="anchor"></a>Commitments</h4><div class="odoc-spec"><div class="spec value anchored" id="val-get_commitment"><a href="#val-get_commitment" class="anchor"></a><code><span><span class="keyword">val</span> get_commitment : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_commitment t hash</code> returns the commitment with <code>hash</code> stored by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_commitment"><a href="#val-find_commitment" class="anchor"></a><code><span><span class="keyword">val</span> find_commitment : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_commitment"><code>get_commitment</code></a> but returns <code>None</code> if this commitment hash is not known by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commitment_exists"><a href="#val-commitment_exists" class="anchor"></a><code><span><span class="keyword">val</span> commitment_exists : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>bool <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>commitment_exists t hash</code> returns <code>true</code> if the commitment with <code>hash</code> is known (i.e. stored) by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_commitment"><a href="#val-save_commitment" class="anchor"></a><code><span><span class="keyword">val</span> save_commitment : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_commitment t commitment</code> saves a commitment in the store an returns is hash.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commitment_published_at_level"><a href="#val-commitment_published_at_level" class="anchor"></a><code><span><span class="keyword">val</span> commitment_published_at_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup_node_store/Store/Commitments_published_at_levels/index.html#type-publication_levels">Octez_smart_rollup_node_store.Store.Commitments_published_at_levels.publication_levels</a>
    option</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>commitment_published_at_level t hash</code> returns the levels at which the commitment was first published and the one at which it was included by in a Layer 1 block. It returns <code>None</code> if the commitment is not known by the rollup node or if it was never published by the rollup node (and included on L1).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_commitment_published_at_level"><a href="#val-set_commitment_published_at_level" class="anchor"></a><code><span><span class="keyword">val</span> set_commitment_published_at_level : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup_node_store/Store/Commitments_published_at_levels/index.html#type-publication_levels">Octez_smart_rollup_node_store.Store.Commitments_published_at_levels.publication_levels</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_commitment_published_at_level t hash levels</code> saves the publication/inclusion information for a commitment with <code>hash</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-commitment_source"><a href="#type-commitment_source" class="anchor"></a><code><span><span class="keyword">type</span> commitment_source</span><span> = </span></code><ol><li id="type-commitment_source.Anyone" class="def variant constructor anchored"><a href="#type-commitment_source.Anyone" class="anchor"></a><code><span>| </span><span><span class="constructor">Anyone</span></span></code></li><li id="type-commitment_source.Us" class="def variant constructor anchored"><a href="#type-commitment_source.Us" class="anchor"></a><code><span>| </span><span><span class="constructor">Us</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commitment_was_published"><a href="#val-commitment_was_published" class="anchor"></a><code><span><span class="keyword">val</span> commitment_was_published : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">source</span>:<a href="#type-commitment_source">commitment_source</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Smart_rollup_commitment_hash/index.html#type-t">Octez_smart_rollup.Commitment.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>bool <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>commitment_was_published t hash</code> returns <code>true</code> if the commitment is known as being already published on L1. The <code>source</code> indicates if we want to know the publication status for commitments we published ourselves <code>`Us</code> or that <code>`Anyone</code> published.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_lcc"><a href="#val-set_lcc" class="anchor"></a><code><span><span class="keyword">val</span> set_lcc : <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-lcc">lcc</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>set_lcc t lcc</code> saves the LCC both on disk and in the node context. It's written in the context iff <code>lcc</code> is is younger than its current value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_published_commitment"><a href="#val-register_published_commitment" class="anchor"></a><code><span><span class="keyword">val</span> register_published_commitment : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Commitment/index.html#type-t">Octez_smart_rollup.Commitment.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">first_published_at_level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">published_by_us</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>register_published_commitment t c ~first_published_at_level ~level
    ~published_by_us</code> saves the publishing information for commitment <code>c</code> both on disk and in the node context. We remember the first publication level and the level the commitment was published by us.</p></div></div><h4 id="inboxes"><a href="#inboxes" class="anchor"></a>Inboxes</h4><div class="odoc-spec"><div class="spec value anchored" id="val-get_inbox"><a href="#val-get_inbox" class="anchor"></a><code><span><span class="keyword">val</span> get_inbox : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox_hash/index.html#type-t">Octez_smart_rollup.Inbox.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_inbox t inbox_hash</code> retrieves the inbox whose hash is <code>inbox_hash</code> from the rollup node's storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_inbox"><a href="#val-find_inbox" class="anchor"></a><code><span><span class="keyword">val</span> find_inbox : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox_hash/index.html#type-t">Octez_smart_rollup.Inbox.Hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_inbox"><code>get_inbox</code></a> but returns <code>None</code> if this inbox is not known.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_inbox"><a href="#val-save_inbox" class="anchor"></a><code><span><span class="keyword">val</span> save_inbox : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox_hash/index.html#type-t">Octez_smart_rollup.Inbox.Hash.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_inbox t inbox</code> remembers the <code>inbox</code> in the storage. It is associated to its hash which is returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-inbox_of_head"><a href="#val-inbox_of_head" class="anchor"></a><code><span><span class="keyword">val</span> inbox_of_head : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-head">Layer1.head</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>inbox_of_head node_ctxt block</code> returns the latest inbox at the given <code>block</code>. This function always returns <code>inbox</code> for all levels at and after the rollup genesis. NOTE: It requires the L2 block for <code>block.hash</code> to have been saved.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_inbox_by_block_hash"><a href="#val-get_inbox_by_block_hash" class="anchor"></a><code><span><span class="keyword">val</span> get_inbox_by_block_hash : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Inbox/index.html#type-t">Octez_smart_rollup.Inbox.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-get_inbox"><code>get_inbox</code></a> but uses the Layer 1 block hash for this inbox instead.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_messages"><a href="#val-find_messages" class="anchor"></a><code><span><span class="keyword">val</span> find_messages : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Octez_smart_rollup.Merkelized_payload_hashes_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>string list</span> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns messages for a payload hash, including protocol messages.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_messages"><a href="#val-get_messages" class="anchor"></a><code><span><span class="keyword">val</span> get_messages : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Octez_smart_rollup.Merkelized_payload_hashes_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>string list</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-find_messages"><code>find_messages</code></a> but fails if not messages are stored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_num_messages"><a href="#val-get_num_messages" class="anchor"></a><code><span><span class="keyword">val</span> get_num_messages : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Octez_smart_rollup.Merkelized_payload_hashes_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>int <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_num_messages t witness_hash</code> retrieves the number of messages for the inbox witness <code>witness_hash</code> stored by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_messages"><a href="#val-save_messages" class="anchor"></a><code><span><span class="keyword">val</span> save_messages : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Merkelized_payload_hashes_hash/index.html#type-t">Octez_smart_rollup.Merkelized_payload_hashes_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_messages t payloads_hash ~level messages</code> associates the list of <code>messages</code> to the <code>payloads_hash</code>. The payload hash must be computed by calling, e.g. <code>Sc_rollup.Inbox.add_all_messages</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-proto_info"><a href="#type-proto_info" class="anchor"></a><code><span><span class="keyword">type</span> proto_info</span><span> = </span><span>{</span></code><ol><li id="type-proto_info.proto_level" class="def record field anchored"><a href="#type-proto_info.proto_level" class="anchor"></a><code><span>proto_level : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Protocol level for operations of block (can be different from L1 header value in the case of a migration block).</p><span class="comment-delim">*)</span></div></li><li id="type-proto_info.first_level_of_protocol" class="def record field anchored"><a href="#type-proto_info.first_level_of_protocol" class="anchor"></a><code><span>first_level_of_protocol : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>true</code> if the level is the first of the protocol.</p><span class="comment-delim">*)</span></div></li><li id="type-proto_info.protocol" class="def record field anchored"><a href="#type-proto_info.protocol" class="anchor"></a><code><span>protocol : <a href="../../../octez-libs/Tezos_crypto/Hashed/Protocol_hash/index.html#type-t">Tezos_base.TzPervasives.Protocol_hash.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Hash of the <em>current</em> protocol for this level.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Return values for <a href="#val-protocol_of_level"><code>protocol_of_level</code></a>.</p></div></div><h4 id="outbox-messages"><a href="#outbox-messages" class="anchor"></a>Outbox messages</h4><div class="odoc-spec"><div class="spec value anchored" id="val-set_outbox_message_executed"><a href="#val-set_outbox_message_executed" class="anchor"></a><code><span><span class="keyword">val</span> set_outbox_message_executed : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">outbox_level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">index</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Marks the outbox message at index for a given outbox level as executed in the persistent storage.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_outbox_messages"><a href="#val-register_outbox_messages" class="anchor"></a><code><span><span class="keyword">val</span> register_outbox_messages : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">outbox_level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">indexes</span>:<span>int list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>register_outbox_messages node_ctxt ~outbox_level ~indexes</code> registers the messages indexes for the <code>outbox_level</code>. If messages were already registered for this level, they are overwritten. Messages marked as executed are preserved.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_executable_pending_outbox_messages"><a href="#val-get_executable_pending_outbox_messages" class="anchor"></a><code><span><span class="keyword">val</span> get_executable_pending_outbox_messages : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(int32 * <span>int list</span>)</span> list</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the pending messages (i.e. unexecuted) that can now be executed. The returned list contains outbox levels and indexes for each level (in order).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_unexecutable_pending_outbox_messages"><a href="#val-get_unexecutable_pending_outbox_messages" class="anchor"></a><code><span><span class="keyword">val</span> get_unexecutable_pending_outbox_messages : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(int32 * <span>int list</span>)</span> list</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the pending messages (i.e. unexecuted) that cannot be executed yet. The returned list contains outbox levels and indexes for each level (in order).</p></div></div><h4 id="protocol"><a href="#protocol" class="anchor"></a>Protocol</h4><div class="odoc-spec"><div class="spec value anchored" id="val-protocol_of_level_with_store"><a href="#val-protocol_of_level_with_store" class="anchor"></a><code><span><span class="keyword">val</span> protocol_of_level_with_store : 
  <span><span><span class="type-var">_</span> <a href="../../../octez-l2-libs/Octez_smart_rollup_node_store/Store/index.html#type-t">Octez_smart_rollup_node_store.Store.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-proto_info">proto_info</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>protocol_of_level_with_store store level</code> returns the protocol of block level <code>level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-protocol_of_level"><a href="#val-protocol_of_level" class="anchor"></a><code><span><span class="keyword">val</span> protocol_of_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-proto_info">proto_info</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>protocol_of_level t level</code> returns the protocol of block level <code>level</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-last_seen_protocol"><a href="#val-last_seen_protocol" class="anchor"></a><code><span><span class="keyword">val</span> last_seen_protocol : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-libs/Tezos_crypto/Hashed/Protocol_hash/index.html#type-t">Tezos_base.TzPervasives.Protocol_hash.t</a> option</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the last protocol seen by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-protocol_activation_level"><a href="#val-protocol_activation_level" class="anchor"></a><code><span><span class="keyword">val</span> protocol_activation_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Protocol_hash/index.html#type-t">Tezos_base.TzPervasives.Protocol_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup_node_store/Store/Protocols/index.html#type-level">Octez_smart_rollup_node_store.Store.Protocols.level</a>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Returns the activation level of a protocol or fails if the protocol was never seen by the rollup node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_protocol_info"><a href="#val-save_protocol_info" class="anchor"></a><code><span><span class="keyword">val</span> save_protocol_info : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Layer1/index.html#type-header">Layer1.header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">predecessor</span>:<a href="../Layer1/index.html#type-header">Layer1.header</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_protocol_info t block ~predecessor</code> saves to disk the protocol information associated to the <code>block</code>, if there is a protocol change between <code>block</code> and <code>predecessor</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_protocols_from_l1"><a href="#val-save_protocols_from_l1" class="anchor"></a><code><span><span class="keyword">val</span> save_protocols_from_l1 : <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Save the protocol activation levels from L1 if possible.</p></div></div><h4 id="dal"><a href="#dal" class="anchor"></a>DAL</h4><div class="odoc-spec"><div class="spec value anchored" id="val-get_slot_header"><a href="#val-get_slot_header" class="anchor"></a><code><span><span class="keyword">val</span> get_slot_header : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">published_in_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_index/index.html#type-t">Octez_smart_rollup.Dal.Slot_index.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_header/index.html#type-t">Octez_smart_rollup.Dal.Slot_header.t</a> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_slot_header t ~published_in_block_hash slot_index</code> returns the slot header for the <code>slot_index</code> that was published in the provided block hash on Layer 1.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_all_slot_headers"><a href="#val-get_all_slot_headers" class="anchor"></a><code><span><span class="keyword">val</span> get_all_slot_headers : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">published_in_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_header/index.html#type-t">Octez_smart_rollup.Dal.Slot_header.t</a> list</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_all_slot_headers t ~published_in_block_hash</code> returns the slot headers for all the slots that were published in the provided block hash on Layer 1.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_slot_indexes"><a href="#val-get_slot_indexes" class="anchor"></a><code><span><span class="keyword">val</span> get_slot_indexes : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">published_in_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_index/index.html#type-t">Octez_smart_rollup.Dal.Slot_index.t</a> list</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_slot_indexes t ~published_in_block_hash</code> returns the slot indexes whose headers were published in the provided block hash on Layer 1.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_slot_header"><a href="#val-save_slot_header" class="anchor"></a><code><span><span class="keyword">val</span> save_slot_header : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">published_in_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_header/index.html#type-t">Octez_smart_rollup.Dal.Slot_header.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_slot_header t ~published_in_block_hash header</code> saves the <code>header</code> as being published for its index in the provided block hash on Layer 1.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_slot_status"><a href="#val-find_slot_status" class="anchor"></a><code><span><span class="keyword">val</span> find_slot_status : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">confirmed_in_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_index/index.html#type-t">Octez_smart_rollup.Dal.Slot_index.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>[ `Unconfirmed <span>| `Confirmed</span> ]</span> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>find_slot_status t ~confirmed_in_block_hash index</code> returns <code>None</code> if the slot's block is not processed yet, <code>Some `Unconfirmed</code> if the slot was not confirmed and <code>Some `Confirmed</code> if the slot is confirmed and the associated pages are available.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_slots_statuses"><a href="#val-list_slots_statuses" class="anchor"></a><code><span><span class="keyword">val</span> list_slots_statuses : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">confirmed_in_block_hash</span>:<a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_index/index.html#type-t">Octez_smart_rollup.Dal.Slot_index.t</a> * <span>[ `Confirmed <span>| `Unconfirmed</span> ]</span>)</span> list</span>
    <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>list_slots_statuses t ~confirmed_in_block_hash</code> lists the list of slots indices with their respective statuses that are saved for the given <code>confirmed_in_block_hash</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_slot_status"><a href="#val-save_slot_status" class="anchor"></a><code><span><span class="keyword">val</span> save_slot_status : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-libs/Tezos_crypto/Hashed/Block_hash/index.html#type-t">Tezos_base.TzPervasives.Block_hash.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../octez-l2-libs/Octez_smart_rollup/Dal/Slot_index/index.html#type-t">Octez_smart_rollup.Dal.Slot_index.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Confirmed <span>| `Unconfirmed</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>save_slot_status node_ctxt hash slot_index status</code> saves in <code>node_ctxt.store</code> that <code>slot_index</code> has status <code>status</code> in the block with hash in <code>node_ctxt.store</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gc"><a href="#val-gc" class="anchor"></a><code><span><span class="keyword">val</span> gc : 
  <span><span class="optlabel">?wait_finished</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[&gt; `Write ]</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">level</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>gc ?wait_finished ?force node_ctxt level</code> triggers garbage collection for the node in accordance with <code>node_ctxt.config.gc_parameters</code>. Upon completion, all data for L2 levels lower than <code>level</code> will be removed. If <code>wait_finished</code> is <code>true</code>, the call blocks until the GC completes, otherwise it is run asynchronously. When <code>force = true</code>, a GC is triggered independently of <code>node_ctxt.config.gc_parameters</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cancel_gc"><a href="#val-cancel_gc" class="anchor"></a><code><span><span class="keyword">val</span> cancel_gc : <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>cancel_gc t</code> stops any currently ongoing GC. It returns <code>true</code> if a GC was canceled.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-gc_level"><a href="#type-gc_level" class="anchor"></a><code><span><span class="keyword">type</span> gc_level</span><span> = </span><span>{</span></code><ol><li id="type-gc_level.gc_triggered_at" class="def record field anchored"><a href="#type-gc_level.gc_triggered_at" class="anchor"></a><code><span>gc_triggered_at : int32;</span></code></li><li id="type-gc_level.gc_target" class="def record field anchored"><a href="#type-gc_level.gc_target" class="anchor"></a><code><span>gc_target : int32;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_gc_info"><a href="#val-get_gc_info" class="anchor"></a><code><span><span class="keyword">val</span> get_gc_info : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Started <span>| `Successful</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><a href="#type-gc_level">gc_level</a> option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>get_gc_info node_ctxt step</code> returns information about the garbage collected levels. If <code>step</code> is <code>`Started</code>, it returns information for the last started GC and if it's <code>`Successful</code>, it returns information for the last successful GC.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-first_available_level"><a href="#val-first_available_level" class="anchor"></a><code><span><span class="keyword">val</span> first_available_level : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int32 <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>The first non garbage collected level available in the node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_level_available"><a href="#val-check_level_available" class="anchor"></a><code><span><span class="keyword">val</span> check_level_available : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>check_level_available node_ctxt level</code> resolves with an error if the <code>level</code> is before the first non garbage collected level.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-splitting_period"><a href="#val-splitting_period" class="anchor"></a><code><span><span class="keyword">val</span> splitting_period : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>The splitting period for the context, as defined in the configuration or challenge window / 5.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_last_context_split_level"><a href="#val-get_last_context_split_level" class="anchor"></a><code><span><span class="keyword">val</span> get_last_context_split_level : 
  <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>int32 option</span> <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_context_split_level"><a href="#val-save_context_split_level" class="anchor"></a><code><span><span class="keyword">val</span> save_context_split_level : 
  <span><a href="#type-rw">rw</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="../../../octez-libs/Tezos_base/TzPervasives/index.html#type-tzresult">Tezos_base.TzPervasives.tzresult</a></span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div><h3 id="helpers"><a href="#helpers" class="anchor"></a>Helpers</h3><div class="odoc-spec"><div class="spec value anchored" id="val-make_kernel_logger"><a href="#val-make_kernel_logger" class="anchor"></a><code><span><span class="keyword">val</span> make_kernel_logger : 
  <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?log_kernel_debug_file</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> * <span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span>)</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>make_kernel_logger event ?log_kernel_debug_file logs_dir</code> returns two functions <code>kernel_debug_logger</code> and <code>finaliser</code>, to be used in the node context. <code>kernel_debug_logger</code> writes kernel logs to <code>logs_dir/log_kernel_debug_file</code> and emits them with the <code>event</code>.</p></div></div><h3 id="synchronization-tracking"><a href="#synchronization-tracking" class="anchor"></a>Synchronization tracking</h3><div class="odoc-spec"><div class="spec value anchored" id="val-is_synchronized"><a href="#val-is_synchronized" class="anchor"></a><code><span><span class="keyword">val</span> is_synchronized : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_synchronized node_ctxt</code> returns <code>true</code> iff the rollup node has processed the latest available L1 head.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait_synchronized"><a href="#val-wait_synchronized" class="anchor"></a><code><span><span class="keyword">val</span> wait_synchronized : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>wait_synchronized node_ctxt</code> is a promise that resolves when the rollup node whose state is <code>node_ctxt</code> is synchronized with L1. If the node is already synchronized, it resolves immediately.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
