<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Script_interpreter_logging (tezos-protocol-014-PtKathma.Tezos_raw_protocol_014_PtKathma.Script_interpreter_logging)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tezos-protocol-014-PtKathma</a> &#x00BB; <a href="../index.html">Tezos_raw_protocol_014_PtKathma</a> &#x00BB; Script_interpreter_logging</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_raw_protocol_014_PtKathma.Script_interpreter_logging</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-ex_init_stack_ty"><a href="#type-ex_init_stack_ty" class="anchor"></a><code><span><span class="keyword">type</span> <span>('r, 'f) ex_init_stack_ty</span></span><span> = </span></code><ol><li id="type-ex_init_stack_ty.Ex_init_stack_ty" class="def variant constructor anchored"><a href="#type-ex_init_stack_ty.Ex_init_stack_ty" class="anchor"></a><code><span>| </span><span><span class="constructor">Ex_init_stack_ty</span> : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'s</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span>
  * <span><span>(<span class="type-var">'a</span>, <span class="type-var">'s</span>, <span class="type-var">'r</span>, <span class="type-var">'f</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'r</span>, <span class="type-var">'f</span>)</span> <a href="#type-ex_init_stack_ty">ex_init_stack_ty</a></span></span></code></li></ol></div><div class="spec-doc"><p>An existential container for an instruction paired with its initial stack type. This is used internally to pack together execution branches with different initial stack types but the same final stack type (which we want to compute).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_kinstr"><a href="#val-log_kinstr" class="anchor"></a><code><span><span class="keyword">val</span> log_kinstr : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span></span></code></div><div class="spec-doc"><p><code>log_kinstr logger sty instr</code> returns <code>instr</code> prefixed by an <code>ILog</code> instruction to log the first instruction in <code>instr</code>. Note that <code>logger</code> value is only available when logging is enables, so the type system protects us from calling this by mistake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_entry"><a href="#val-log_entry" class="anchor"></a><code><span><span class="keyword">val</span> log_entry : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Local_gas_counter/index.html#type-outdated_context">Local_gas_counter.outdated_context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Local_gas_counter/index.html#type-local_gas_counter">Local_gas_counter.local_gas_counter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>log_entry logger ctxt gas instr sty accu stack</code> simply calls <code>logger.log_entry</code> function with the appropriate arguments. Note that <code>logger</code> value is only available when logging is enables, so the type system protects us from calling this by mistake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_exit"><a href="#val-log_exit" class="anchor"></a><code><span><span class="keyword">val</span> log_exit : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Local_gas_counter/index.html#type-outdated_context">Local_gas_counter.outdated_context</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Local_gas_counter/index.html#type-local_gas_counter">Local_gas_counter.local_gas_counter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Alpha_context/Script/index.html#type-location">Alpha_context.Script.location</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>, <span class="type-var">'e</span>, <span class="type-var">'f</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'g</span>, <span class="type-var">'h</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'g</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'h</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>log_exit logger ctxt gas loc instr sty accu stack</code> simply calls <code>logger.log_exit</code> function with the appropriate arguments. Note that <code>logger</code> value is only available when logging is enables, so the type system protects us from calling this by mistake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_control"><a href="#val-log_control" class="anchor"></a><code><span><span class="keyword">val</span> log_control : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-continuation">Script_typed_ir.continuation</a></span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>log_control logger continuation</code> simply calls <code>logger.log_control</code> function with the appropriate arguments. Note that <code>logger</code> value is only available when logging is enables, so the type system protects us from calling this by mistake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-instrument_cont"><a href="#val-instrument_cont" class="anchor"></a><code><span><span class="keyword">val</span> instrument_cont : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_interpreter_defs/index.html#type-cont_instrumentation">Script_interpreter_defs.cont_instrumentation</a></span></span></code></div><div class="spec-doc"><p><code>instrument_cont logger sty</code> creates a function instrumenting continuations starting from the stack type described by <code>sty</code>. Instrumentation consists in wrapping inner continuations in <code>KLog</code> continuation so that logging continues.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_next_continuation"><a href="#val-log_next_continuation" class="anchor"></a><code><span><span class="keyword">val</span> log_next_continuation : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-continuation">Script_typed_ir.continuation</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-continuation">Script_typed_ir.continuation</a></span>
    <a href="../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>log_next_continuation logger sty cont</code> instruments the next continuation in <code>cont</code> with <code>KLog</code> continuations to ensure logging.</p><p>This instrumentation has a performance cost, but importantly, it is only ever paid when logging is enabled. Otherwise, the possibility to instrument the script is costless. Note also that <code>logger</code> value is only available when logging is enabled, so the type system protects us from calling this by mistake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_next_kinstr"><a href="#val-log_next_kinstr" class="anchor"></a><code><span><span class="keyword">val</span> log_next_kinstr : 
  <span><a href="../Script_typed_ir/index.html#type-logger">Script_typed_ir.logger</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span>
    <a href="../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p><code>log_next_kinstr logger sty instr</code> instruments the next instruction in <code>instr</code> with <code>ILog</code> instructions to make sure it will be logged. This instrumentation has a performance cost, but importantly, it is only ever paid when logging is enabled. Otherwise, the possibility to instrument the script is costless. Note also that <code>logger</code> value is only available when logging is enables, so the type system protects us from calling this by mistake.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kinstr_final_stack_type"><a href="#val-kinstr_final_stack_type" class="anchor"></a><code><span><span class="keyword">val</span> kinstr_final_stack_type : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-kinstr">Script_typed_ir.kinstr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> option</span>
    <a href="../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-branched_final_stack_type"><a href="#val-branched_final_stack_type" class="anchor"></a><code><span><span class="keyword">val</span> branched_final_stack_type : 
  <span><span><span><span>(<span class="type-var">'r</span>, <span class="type-var">'f</span>)</span> <a href="#type-ex_init_stack_ty">ex_init_stack_ty</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span>(<span class="type-var">'r</span>, <span class="type-var">'f</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> option</span>
    <a href="../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dipn_stack_ty"><a href="#val-dipn_stack_ty" class="anchor"></a><code><span><span class="keyword">val</span> dipn_stack_ty : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'s</span>, <span class="type-var">'e</span>, <span class="type-var">'z</span>, <span class="type-var">'c</span>, <span class="type-var">'u</span>, <span class="type-var">'d</span>, <span class="type-var">'w</span>)</span>
    <a href="../Script_typed_ir/index.html#type-stack_prefix_preservation_witness">Script_typed_ir.stack_prefix_preservation_witness</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'u</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span class="type-var">'s</span>)</span> <a href="../Script_typed_ir/index.html#type-stack_ty">Script_typed_ir.stack_ty</a></span></span></code></div><div class="spec-doc"><p><code>dipn_stack_ty witness stack_ty</code> returns the type of the stack on which instructions inside dipped block will be operating.</p></div></div></div></body></html>
