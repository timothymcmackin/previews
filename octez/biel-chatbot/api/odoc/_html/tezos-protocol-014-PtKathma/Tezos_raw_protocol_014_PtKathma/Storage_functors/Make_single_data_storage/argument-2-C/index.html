<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>C (tezos-protocol-014-PtKathma.Tezos_raw_protocol_014_PtKathma.Storage_functors.Make_single_data_storage.C)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">tezos-protocol-014-PtKathma</a> &#x00BB; <a href="../../../index.html">Tezos_raw_protocol_014_PtKathma</a> &#x00BB; <a href="../../index.html">Storage_functors</a> &#x00BB; <a href="../index.html">Make_single_data_storage</a> &#x00BB; C</nav><header class="odoc-preamble"><h1>Parameter <code><span>Make_single_data_storage.C</span></code></h1></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../Raw_context_intf/module-type-VIEW/index.html">Raw_context_intf.VIEW</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-VIEW/index.html#type-key">key</a> := <a href="../../../Raw_context/index.html#type-key">Raw_context.key</a></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-VIEW/index.html#type-value">value</a> := <a href="../../../Raw_context/index.html#type-value">Raw_context.value</a></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-VIEW/index.html#type-tree">tree</a> := <a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for context views.</p></div></div><h3 id="getters"><a href="#getters" class="anchor"></a>Getters</h3><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>mem t k</code> is an Lwt promise that resolves to <code>true</code> iff <code>k</code> is bound to a value in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem_tree"><a href="#val-mem_tree" class="anchor"></a><code><span><span class="keyword">val</span> mem_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bool <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>mem_tree t k</code> is like <a href="#val-mem"><code>mem</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Raw_context/index.html#type-value">Raw_context.value</a>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get t k</code> is an Lwt promise that resolves to <code>Ok v</code> if <code>k</code> is bound to the value <code>v</code> in <code>t</code> and <code>Storage_ErrorMissing_key</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_tree"><a href="#val-get_tree" class="anchor"></a><code><span><span class="keyword">val</span> get_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_tree</code> is like <a href="#val-get"><code>get</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Raw_context/index.html#type-value">Raw_context.value</a> option</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find t k</code> is an Lwt promise that resolves to <code>Some v</code> if <code>k</code> is bound to the value <code>v</code> in <code>t</code> and <code>None</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_tree"><a href="#val-find_tree" class="anchor"></a><code><span><span class="keyword">val</span> find_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> option</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_tree t k</code> is like <a href="#val-find"><code>find</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?offset</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?length</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a>)</span> list</span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>list t key</code> is the list of files and sub-nodes stored under <code>k</code> in <code>t</code>. The result order is not specified but is stable.</p><p><code>offset</code> and <code>length</code> are used for pagination.</p></div></div><h3 id="setters"><a href="#setters" class="anchor"></a>Setters</h3><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-value">Raw_context.value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>init t k v</code> is an Lwt promise that resolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is unbound in <code>t</code>;</li><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>It is <code>Storage_errorExisting_key</code> if <code>k</code> is already bound in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init_tree"><a href="#val-init_tree" class="anchor"></a><code><span><span class="keyword">val</span> init_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>init_tree</code> is like <a href="#val-init"><code>init</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-value">Raw_context.value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>update t k v</code> is an Lwt promise that resolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is bound in <code>t</code>;</li><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>It is <code>Storage_errorMissing_key</code> if <code>k</code> is not already bound in <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update_tree"><a href="#val-update_tree" class="anchor"></a><code><span><span class="keyword">val</span> update_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>update_tree</code> is like <a href="#val-update"><code>update</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-value">Raw_context.value</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is bound to <code>v</code> in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul><p>If <code>k</code> was already bound in <code>t</code> to a value that is physically equal to <code>v</code>, the result of the function is a promise that resolves to <code>t</code>. Otherwise, the previous binding of <code>k</code> in <code>t</code> disappears.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_tree"><a href="#val-add_tree" class="anchor"></a><code><span><span class="keyword">val</span> add_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add_tree</code> is like <a href="#val-add"><code>add</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove t k v</code> is an Lwt promise that resolves to <code>c</code> such that:</p><ul><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_existing"><a href="#val-remove_existing" class="anchor"></a><code><span><span class="keyword">val</span> remove_existing : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove_existing t k v</code> is an Lwt promise that resolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is bound in <code>t</code> to a value;</li><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_existing_tree"><a href="#val-remove_existing_tree" class="anchor"></a><code><span><span class="keyword">val</span> remove_existing_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove_existing_tree t k v</code> is an Lwt promise that reolves to <code>Ok c</code> if:</p><ul><li><code>k</code> is bound in <code>t</code> to a tree;</li><li><code>k</code> is unbound in <code>c</code>;</li><li>and <code>c</code> is similar to <code>t</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_or_remove"><a href="#val-add_or_remove" class="anchor"></a><code><span><span class="keyword">val</span> add_or_remove : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Raw_context/index.html#type-value">Raw_context.value</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add_or_remove t k v</code> is:</p><ul><li><code>add t k x</code> if <code>v</code> is <code>Some x</code>;</li><li><code>remove t k</code> otherwise.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_or_remove_tree"><a href="#val-add_or_remove_tree" class="anchor"></a><code><span><span class="keyword">val</span> add_or_remove_tree : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>add_or_remove_tree t k v</code> is:</p><ul><li><code>add_tree t k x</code> if <code>v</code> is <code>Some x</code>;</li><li><code>remove t k</code> otherwise.</li></ul></div></div><h3 id="folds"><a href="#folds" class="anchor"></a>Folds</h3><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span class="optlabel">?depth</span>:<a href="../../../Raw_context_intf/index.html#type-depth">Raw_context_intf.depth</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">order</span>:<span>[ `Sorted <span>| `Undefined</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">init</span>:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">f</span>:
    <span>(<span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
      <span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
      <span><span class="type-var">'a</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>fold ?depth t root ~order ~init ~f</code> recursively folds over the trees and values of <code>t</code>. The <code>f</code> callbacks are called with a key relative to <code>root</code>. <code>f</code> is never called with an empty key for values; i.e., folding over a value is a no-op.</p><p>The depth is 0-indexed. If <code>depth</code> is set (by default it is not), then <code>f</code> is only called when the conditions described by the parameter is true:</p><ul><li><code>Eq d</code> folds over nodes and values of depth exactly <code>d</code>.</li><li><code>Lt d</code> folds over nodes and values of depth strictly less than <code>d</code>.</li><li><code>Le d</code> folds over nodes and values of depth less than or equal to <code>d</code>.</li><li><code>Gt d</code> folds over nodes and values of depth strictly more than <code>d</code>.</li><li><code>Ge d</code> folds over nodes and values of depth more than or equal to <code>d</code>.</li></ul><p>If <code>order</code> is <code>`Sorted</code> (the default), the elements are traversed in lexicographic order of their keys. For large nodes, it is memory-consuming, use <code>`Undefined</code> for a more memory efficient <code>fold</code>.</p></div></div><h3 id="hash-configurations"><a href="#hash-configurations" class="anchor"></a>Hash configurations</h3><div class="odoc-spec"><div class="spec value anchored" id="val-config"><a href="#val-config" class="anchor"></a><code><span><span class="keyword">val</span> config : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../Raw_context_intf/index.html#type-config">Raw_context_intf.config</a></span></code></div><div class="spec-doc"><p><code>config t</code> is <code>t</code>'s hash configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-length"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>length t key</code> is an Lwt promise that resolves to the number of files and sub-nodes stored under <code>k</code> in <code>t</code>.</p><p>It is equivalent to <code>list t k &gt;|= List.length</code> but has a constant-time complexity.</p><p>Most of the time, this function does not perform any I/O as the length is cached in the tree. It may perform one read to load the root node of the tree in case it has not been loaded already. The initial constant is the same between <code>list</code> and <code>length</code>. They both perform the same kind of I/O reads. While <code>list</code> usually performs a linear number of reads, <code>length</code> does at most one.</p></div></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-Tree"><a href="#module-Tree" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tree/index.html">Tree</a></span><span> : 
  <a href="../../../Raw_context_intf/module-type-TREE/index.html">Raw_context_intf.TREE</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-TREE/index.html#type-t">t</a> := <a href="#type-t">t</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-TREE/index.html#type-key">key</a> := <a href="../../../Raw_context/index.html#type-key">Raw_context.key</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-TREE/index.html#type-value">value</a> := <a href="../../../Raw_context/index.html#type-value">Raw_context.value</a></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../Raw_context_intf/module-type-TREE/index.html#type-tree">tree</a> := <a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a></span></span></code></div><div class="spec-doc"><p><code>Tree</code> provides immutable, in-memory partial mirror of the context, with lazy reads and delayed writes. The trees are Merkle trees that carry the same hash as the part of the context they mirror.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Proof"><a href="#module-Proof" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Proof/index.html">Proof</a></span><span> : <a href="../../../Raw_context_intf/module-type-PROOF/index.html">Raw_context_intf.PROOF</a></span></code></div><div class="spec-doc"><p>Proofs are compact representations of trees which can be shared between peers.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-verifier"><a href="#type-verifier" class="anchor"></a><code><span><span class="keyword">type</span> <span>('proof, 'result) verifier</span></span><span> :=
  <span><span class="type-var">'proof</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> <span class="arrow">&#45;&gt;</span></span>
    <span><span>(<a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> * <span class="type-var">'result</span>)</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="../../../Raw_context/index.html#type-tree">Raw_context.tree</a> * <span class="type-var">'result</span>,
    <span>[ <span>`Proof_mismatch of string</span>
    <span><span>| `Stream_too_long</span> of string</span>
    <span><span>| `Stream_too_short</span> of string</span> ]</span>)</span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Pervasives/index.html#type-result">Tezos_protocol_environment_014_PtKathma.Pervasives.result</a></span>
    <a href="../../../../Tezos_protocol_environment_014_PtKathma/Lwt/index.html#type-t">Tezos_protocol_environment_014_PtKathma.Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>verify p f</code> runs <code>f</code> in checking mode. <code>f</code> is a function that takes a tree as input and returns a new version of the tree and a result. <code>p</code> is a proof, that is a minimal representation of the tree that contains what <code>f</code> should be expecting.</p><p>Therefore, contrary to trees found in a storage, the contents of the trees passed to <code>f</code> may not be available. For this reason, looking up a value at some <code>path</code> can now produce three distinct outcomes:</p><ul><li>A value <code>v</code> is present in the proof <code>p</code> and returned : <code>find tree path</code> is a promise returning <code>Some v</code>;</li><li><code>path</code> is known to have no value in <code>tree</code> : <code>find tree path</code> is a promise returning <code>None</code>; and</li><li><code>path</code> is known to have a value in <code>tree</code> but <code>p</code> does not provide it because <code>f</code> should not need it: <code>verify</code> returns an error classifying <code>path</code> as an invalid path (see below).</li></ul><p>The same semantics apply to all operations on the tree <code>t</code> passed to <code>f</code> and on all operations on the trees built from <code>f</code>.</p><p>The generated tree is the tree after <code>f</code> has completed. That tree is disconnected from any storage (i.e. <code>index</code>). It is possible to run operations on it as long as they don't require loading shallowed subtrees.</p><p>The result is <code>Error (`Msg _)</code> if the proof is rejected:</p><ul><li>For tree proofs: when <code>p.before</code> is different from the hash of <code>p.state</code>;</li><li>For tree and stream proofs: when <code>p.after</code> is different from the hash of <code>f p.state</code>;</li><li>For tree proofs: when <code>f p.state</code> tries to access invalid paths in <code>p.state</code>;</li><li>For stream proofs: when the proof is not consumed in the exact same order it was produced;</li><li>For stream proofs: when the proof is too short or not empty once <code>f</code> is done.</li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if the proof version is invalid or incompatible with the verifier.</p></li></ul></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-tree_proof"><a href="#type-tree_proof" class="anchor"></a><code><span><span class="keyword">type</span> tree_proof</span><span> := <span><a href="Proof/index.html#type-tree">Proof.tree</a> <a href="Proof/index.html#type-t">Proof.t</a></span></span></code></div><div class="spec-doc"><p>The type for tree proofs.</p><p>Guarantee that the given computation performs exactly the same state operations as the generating computation, *in some order*.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_tree_proof"><a href="#val-verify_tree_proof" class="anchor"></a><code><span><span class="keyword">val</span> verify_tree_proof : <span><span>(<a href="#type-tree_proof">tree_proof</a>, <span class="type-var">'a</span>)</span> <a href="#type-verifier">verifier</a></span></span></code></div><div class="spec-doc"><p><code>verify_tree_proof</code> is the verifier of tree proofs.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-stream_proof"><a href="#type-stream_proof" class="anchor"></a><code><span><span class="keyword">type</span> stream_proof</span><span> := <span><a href="Proof/index.html#type-stream">Proof.stream</a> <a href="Proof/index.html#type-t">Proof.t</a></span></span></code></div><div class="spec-doc"><p>The type for stream proofs.</p><p>Guarantee that the given computation performs exactly the same state operations as the generating computation, in the exact same order.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_stream_proof"><a href="#val-verify_stream_proof" class="anchor"></a><code><span><span class="keyword">val</span> verify_stream_proof : <span><span>(<a href="#type-stream_proof">stream_proof</a>, <span class="type-var">'a</span>)</span> <a href="#type-verifier">verifier</a></span></span></code></div><div class="spec-doc"><p><code>verify_stream</code> is the verifier of stream proofs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal_config"><a href="#val-equal_config" class="anchor"></a><code><span><span class="keyword">val</span> equal_config : <span><a href="../../../Raw_context_intf/index.html#type-config">Raw_context_intf.config</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../Raw_context_intf/index.html#type-config">Raw_context_intf.config</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>The equality function for context configurations. If two context have the same configuration, they will generate the same context hashes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-project"><a href="#val-project" class="anchor"></a><code><span><span class="keyword">val</span> project : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../Raw_context/index.html#type-root">Raw_context.root</a></span></code></div><div class="spec-doc"><p>Internally used in <a href="../../index.html"><code>Storage_functors</code></a> to escape from a view.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-absolute_key"><a href="#val-absolute_key" class="anchor"></a><code><span><span class="keyword">val</span> absolute_key : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../Raw_context/index.html#type-key">Raw_context.key</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../Raw_context/index.html#type-key">Raw_context.key</a></span></code></div><div class="spec-doc"><p>Internally used in <a href="../../index.html"><code>Storage_functors</code></a> to retrieve a full key from partial key relative a view.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Block_quota_exceeded"><a href="#extension-decl-Block_quota_exceeded" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-error">Tezos_protocol_environment_014_PtKathma.Error_monad.error</a> += </span></code><ol><li id="extension-Block_quota_exceeded" class="def variant extension anchored"><a href="#extension-Block_quota_exceeded" class="anchor"></a><code><span>| </span><span><span class="extension">Block_quota_exceeded</span></span></code></li></ol></div><div class="spec-doc"><p>Raised if block gas quota is exhausted during gas consumption.</p></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Operation_quota_exceeded"><a href="#extension-decl-Operation_quota_exceeded" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-error">Tezos_protocol_environment_014_PtKathma.Error_monad.error</a> += </span></code><ol><li id="extension-Operation_quota_exceeded" class="def variant extension anchored"><a href="#extension-Operation_quota_exceeded" class="anchor"></a><code><span>| </span><span><span class="extension">Operation_quota_exceeded</span></span></code></li></ol></div><div class="spec-doc"><p>Raised if operation gas quota is exhausted during gas consumption.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-consume_gas"><a href="#val-consume_gas" class="anchor"></a><code><span><span class="keyword">val</span> consume_gas : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Gas_limit_repr/index.html#type-cost">Gas_limit_repr.cost</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Internally used in <a href="../../index.html"><code>Storage_functors</code></a> to consume gas from within a view. May raise <a href="#extension-Block_quota_exceeded"><code>Block_quota_exceeded</code></a> or <a href="#extension-Operation_quota_exceeded"><code>Operation_quota_exceeded</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check_enough_gas"><a href="#val-check_enough_gas" class="anchor"></a><code><span><span class="keyword">val</span> check_enough_gas : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../Gas_limit_repr/index.html#type-cost">Gas_limit_repr.cost</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="../../../../Tezos_protocol_environment_014_PtKathma/Error_monad/index.html#type-tzresult">Tezos_protocol_environment_014_PtKathma.Error_monad.tzresult</a></span></span></code></div><div class="spec-doc"><p>Check if consume_gas will fail</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-description"><a href="#val-description" class="anchor"></a><code><span><span class="keyword">val</span> description : <span><a href="#type-t">t</a> <a href="../../../Storage_description/index.html#type-t">Storage_description.t</a></span></span></code></div></div></div></body></html>
