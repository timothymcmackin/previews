"use strict";(self.webpackChunketherlink_docs=self.webpackChunketherlink_docs||[]).push([[23703],{92135:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>h});var o=t(85893),s=t(11151);const r={title:"Running an Etherlink Smart Rollup node"},i=void 0,a={id:"network/smart-rollup-nodes",title:"Running an Etherlink Smart Rollup node",description:"Etherlink uses Smart Rollup nodes as a bridge between the EVM transactions on the EVM nodes and Tezos layer 1.",source:"@site/docs/network/smart-rollup-nodes.md",sourceDirName:"network",slug:"/network/smart-rollup-nodes",permalink:"/previews/etherlink/connection-buttons/network/smart-rollup-nodes",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1732109739e3,frontMatter:{title:"Running an Etherlink Smart Rollup node"},sidebar:"documentationSidebar",previous:{title:"Fee structure",permalink:"/previews/etherlink/connection-buttons/network/fees"},next:{title:"Running an Etherlink EVM node",permalink:"/previews/etherlink/connection-buttons/network/evm-nodes"}},l={},h=[{value:"System requirements",id:"system-requirements",level:2},{value:"Modes",id:"modes",level:2},{value:"References",id:"references",level:2},{value:"Starting the Smart Rollup node in observer mode",id:"starting-the-smart-rollup-node-in-observer-mode",level:2},{value:"Converting the Smart Rollup node to maintenance mode",id:"converting-the-smart-rollup-node-to-maintenance-mode",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Etherlink uses Smart Rollup nodes as a bridge between the EVM transactions on the EVM nodes and Tezos layer 1.\nPublic Smart Rollup nodes for Etherlink are not yet available, so you must run your own if you want to participate in the Etherlink network."}),"\n",(0,o.jsxs)(n.p,{children:["The Smart Rollup node runs the ",(0,o.jsx)(n.em,{children:"kernel"}),", which is a Rust program compiled in WASM implementing the semantics of Etherlink blocks and transactions."]}),"\n",(0,o.jsxs)(n.p,{children:["To start, the node uses the ",(0,o.jsx)(n.em,{children:"installer kernel"}),", which is a compressed version of the kernel that provides only enough information to install the original kernel.\nThe data for the original kernel is stored in separate files called ",(0,o.jsx)(n.em,{children:"preimages"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"You can run the Smart Rollup node starting from Etherlink genesis or from a snapshot of a recent Etherlink state."}),"\n",(0,o.jsx)(n.h2,{id:"system-requirements",children:"System requirements"}),"\n",(0,o.jsx)(n.p,{children:"Running an Etherlink Smart Rollup node on Etherlink Mainnet requires a computer with 500GB of disk space and at least 16GB RAM."}),"\n",(0,o.jsx)(n.h2,{id:"modes",children:"Modes"}),"\n",(0,o.jsxs)(n.p,{children:["Running the Smart Rollup node in operator or maintenance mode is the best way to participate in Etherlink because in these modes the node posts commitments about Etherlink's state to layer 1.\nThese commitments validate Etherlink's state and ensure that Etherlink is processing blocks and transactions honestly according to its kernel.\nAs described in ",(0,o.jsx)(n.a,{href:"https://docs.tezos.com/architecture/smart-rollups",children:"Smart Rollups"})," on docs.tezos.com, one honest node is enough to ensure that Etherlink is running correctly, but adding more nodes strengthens its security and allows users to verify for themselves that Etherlink is running as intended."]}),"\n",(0,o.jsx)(n.p,{children:"The best way to run a node that can post commitments is to start with a node in observer mode, verify that it works, and convert it to maintenance mode.\nMaintenance mode is similar to operator mode but it does not require settings for batching operations, which are required only for sequencer nodes."}),"\n",(0,o.jsxs)(n.p,{children:["For more information on modes, see ",(0,o.jsx)(n.a,{href:"https://tezos.gitlab.io/shell/smart_rollup_node.html",children:"Smart Rollup node"})," in the Octez documentation."]}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsxs)(n.p,{children:["Make sure that you understand the interaction between different nodes as described in ",(0,o.jsx)(n.a,{href:"/network/architecture",children:"Etherlink architecture"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["For more information about Smart Rollup nodes in general, see ",(0,o.jsx)(n.a,{href:"https://docs.tezos.com/architecture/smart-rollups",children:"Smart Rollups"})," on docs.tezos.com and ",(0,o.jsx)(n.a,{href:"https://tezos.gitlab.io/shell/smart_rollup_node.html",children:"Smart Rollup Node"})," in the Octez documentation."]}),"\n",(0,o.jsx)(n.h2,{id:"starting-the-smart-rollup-node-in-observer-mode",children:"Starting the Smart Rollup node in observer mode"}),"\n",(0,o.jsx)(n.p,{children:"You can start the Smart Rollup node in observer mode to bootstrap it and make sure that it works before you change to maintenance mode."}),"\n",(0,o.jsx)(n.p,{children:"To bootstrap a Smart Rollup node from a snapshot, you need a node that has the full history from the time the snapshot was taken to the current level.\nUsually this means connecting to an archive node, but if the snapshot is recent, it can work with a rolling node that keeps enough history.\nAfter the node has started, you can switch to a rolling node."}),"\n",(0,o.jsx)(n.p,{children:"Follow these steps to start the node in observer mode:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Get a built version of the Smart Rollup node binary, named ",(0,o.jsx)(n.code,{children:"octez-smart-rollup-node"}),".\nThe best place to get the most recent binary files to use with Etherlink is ",(0,o.jsx)(n.a,{href:"https://gitlab.com/tezos/tezos/-/releases",children:"https://gitlab.com/tezos/tezos/-/releases"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Initialize the local context of the node, which is where it stores local data:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Set the environment variable ",(0,o.jsx)(n.code,{children:"SR_DATA_DIR"})," to the directory where the node should store its local data.\nThe default value is ",(0,o.jsx)(n.code,{children:"$HOME/.tezos-smart-rollup-node"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Initialize the local context by running this command and passing the address of the Etherlink Smart Rollup and the preimages endpoint.\nYou can get this information on the ",(0,o.jsx)(n.a,{href:"/get-started/network-information",children:"Network information"})," page."]}),"\n",(0,o.jsx)(n.p,{children:"For example, this command initializes the context for Etherlink Mainnet:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node init observer config for sr1Ghq66tYK9y3r8CC1Tf8i8m5nxh8nTvZEf \\\n  with operators --data-dir $SR_DATA_DIR \\\n  --pre-images-endpoint https://snapshots.eu.tzinit.org/etherlink-mainnet/wasm_2_0_0\n"})}),"\n",(0,o.jsx)(n.p,{children:"For Etherlink testnet, use this command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node init observer config for sr18wx6ezkeRjt1SZSeZ2UQzQN3Uc3YLMLqg \\\n  with operators --data-dir $SR_DATA_DIR \\\n  --pre-images-endpoint https://snapshots.eu.tzinit.org/etherlink-ghostnet/wasm_2_0_0\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This command generates a minimal configuration file (",(0,o.jsx)(n.code,{children:"config.json"}),") in the local data folder:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{ "smart-rollup-address": "sr1Ghq66tYK9y3r8CC1Tf8i8m5nxh8nTvZEf",\n  "smart-rollup-node-operator": {}, "fee-parameters": {}, "mode": "observer",\n  "pre-images-endpoint":\n    "https://snapshots.eu.tzinit.org/etherlink-mainnet/wasm_2_0_0" }\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This configuration uses the preimages that the Tezos Foundation hosts on a file server on a so-called \"preimages endpoint\".\nIt's safe to use these preimages because the node verifies them.\nIf you don't want to use third-party preimages, you can build the kernel yourself and move the contents of the ",(0,o.jsx)(n.code,{children:"wasm_2_0_0/"})," directory to the local data directory; see ",(0,o.jsx)(n.a,{href:"/network/building-kernel",children:"Building the Etherlink kernel"}),".\nHowever, in this case, you must manually update this directory with the preimages of every kernel voted by the community and deployed on Etherlink after that."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"To speed up the setup process by loading a snapshot, follow these steps:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Download the latest snapshot.\nMainnet snapshots are available at ",(0,o.jsx)(n.a,{href:"https://snapshots.eu.tzinit.org/etherlink-mainnet",children:"https://snapshots.eu.tzinit.org/etherlink-mainnet"})," and Testnet snapshots are available at ",(0,o.jsx)(n.a,{href:"https://snapshots.eu.tzinit.org/etherlink-ghostnet",children:"https://snapshots.eu.tzinit.org/etherlink-ghostnet"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For example, this command downloads the latest snapshot for Etherlink mainnet:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"wget https://snapshots.eu.tzinit.org/etherlink-mainnet/eth-mainnet.full\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Load the snapshot by running the ",(0,o.jsx)(n.code,{children:"snapshot import"})," command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node --endpoint https://rpc.tzkt.io/mainnet \\\n  snapshot import eth-mainnet.full \\\n  --data-dir $SR_DATA_DIR\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Start the Smart Rollup node in observer mode with the ",(0,o.jsx)(n.code,{children:"run"})," command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node --endpoint https://rpc.tzkt.io/mainnet run \\\n  --data-dir $SR_DATA_DIR\n"})}),"\n",(0,o.jsx)(n.p,{children:"If you did not load a snapshot, the process of starting the node from genesis can take a long time because it must process every block."}),"\n",(0,o.jsx)(n.p,{children:"If you loaded a snapshot, the node must process every block that has been created since the snapshot was taken, which takes time depending on the age of the snapshot."}),"\n",(0,o.jsxs)(n.p,{children:["By default, the node runs in archive mode.\nTo run in full mode, which stores only the minimal data since the genesis required to reconstruct the ledger state, pass the argument ",(0,o.jsx)(n.code,{children:"--history-mode full"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify that the Smart Rollup node is running by querying it.\nFor example, this query gets the health of the node:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl -s http://localhost:8932/health\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Now the Smart Rollup node is running and tracking the state of Etherlink by receiving information from layer 1."}),"\n",(0,o.jsx)(n.h2,{id:"converting-the-smart-rollup-node-to-maintenance-mode",children:"Converting the Smart Rollup node to maintenance mode"}),"\n",(0,o.jsx)(n.p,{children:"Converting the observer node to maintenance mode requires these prerequisites:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Your own Tezos layer 1 node running in any mode."}),"\n",(0,o.jsxs)(n.admonition,{title:"Use a private layer 1 node",type:"warning",children:[(0,o.jsx)(n.p,{children:"To run the Smart Rollup node in a mode that posts commitments, including maintenance mode and operator mode, you must connect it to a layer 1 node that you control.\nUsing a public layer 1 node as the basis for a Smart Rollup node in maintenance or operator mode exposes the Smart Rollup node to security risks.\nFor example, a malicious layer 1 node can expose the Smart Rollup node to an incorrect branch, which can cause the Smart Rollup node to post invalid commitments and lose tez when other node operators computing from the correct branch refute them."}),(0,o.jsx)(n.p,{children:"As these steps describe, it is safe to bootstrap a node in observer mode by connecting it to a public node, connect it to a layer 1 node that you control, and then switch to maintenance or operator mode."})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["An account with at least 10,000 liquid (unstaked) tez, referred to as the ",(0,o.jsx)(n.em,{children:"operator account"}),".\nYou can use the same account that you use for a layer 1 baker, but for better security, you can use a different account and delegate its tez to the layer 1 account."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"An account with a small amount of liquid tez for cementing and outbox operations."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Follow these steps to convert a Smart Rollup node from observer mode to maintenance mode:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Set up the two accounts in the Octez client."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Stop the Smart Rollup node."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Restart the node with the layer 1 node that you control, represented in this example by the variable ",(0,o.jsx)(n.code,{children:"$MY_LAYER_1_NODE"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node --endpoint $MY_LAYER_1_NODE run \\\n  --data-dir $SR_DATA_DIR\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify that the node continues to run as expected in observer mode."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Stop the node."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Re-initialize the node for maintenance mode by running the ",(0,o.jsx)(n.code,{children:"init maintenance config"})," command and passing the addresses or Octez aliases of the accounts.\nThis example uses ",(0,o.jsx)(n.code,{children:"$OPERATOR_ACCOUNT"})," for the account with 10,000 liquid tez and ",(0,o.jsx)(n.code,{children:"$SECONDARY_ACCOUNT"})," for the other account:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node init maintenance config for sr1Ghq66tYK9y3r8CC1Tf8i8m5nxh8nTvZEf \\\n  with operators \\\n  operating:$OPERATOR_ACCOUNT \\\n  cementing:$SECONDARY_ACCOUNT \\\n  executing_outbox:$SECONDARY_ACCOUNT \\\n  --history-mode archive \\\n  --rpc-addr 0.0.0.0 \\\n  --data-dir $SR_DATA_DIR \\\n  --pre-images-endpoint https://snapshots.eu.tzinit.org/etherlink-mainnet/wasm_2_0_0\n"})}),"\n",(0,o.jsx)(n.p,{children:"This command generates updates the configuration file to contain the addresses of the accounts that post operations to layer 1, including the node's commitments."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Restart the node, again with the layer 1 node that you control:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"octez-smart-rollup-node --endpoint $MY_LAYER_1_NODE run \\\n  --data-dir $SR_DATA_DIR\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Verify that the Smart Rollup node is running by querying it.\nFor example, this query gets the health of the node:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl -s http://localhost:8932/health\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Now that you have a Smart Rollup node configured for Etherlink, you can run an Etherlink EVM node, as described in ",(0,o.jsx)(n.a,{href:"/network/evm-nodes",children:"Running an Etherlink EVM node"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>i});var o=t(67294);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);