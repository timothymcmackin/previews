"use strict";(self.webpackChunketherlink_docs=self.webpackChunketherlink_docs||[]).push([[8710],{8710:(e,r,t)=>{t.d(r,{autoConnectWC:()=>V,connectWC:()=>Y});var n=t(71352),a=t(62027),o=t(96070),s=t(35280);class i extends a.G{constructor({body:e,error:r,url:t}){super("RPC Request failed.",{cause:r,details:r.message,metaMessages:[`URL: ${(0,s.Gr)(t)}`,`Request body: ${(0,o.P)(e)}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=r.code}}class c extends a.G{constructor(e,{code:r,docsPath:t,metaMessages:n,shortMessage:a}){super(a,{cause:e,docsPath:t,metaMessages:n||e?.metaMessages}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.code=e instanceof i?e.code:r??-1}}class l extends c{constructor(e,r){super(e,r),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderRpcError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=r.data}}class d extends c{constructor(e){super(e,{code:d.code,shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ParseRpcError"})}}Object.defineProperty(d,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class u extends c{constructor(e){super(e,{code:u.code,shortMessage:"JSON is not a valid request object."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidRequestRpcError"})}}Object.defineProperty(u,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class p extends c{constructor(e){super(e,{code:p.code,shortMessage:"The method does not exist / is not available."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"MethodNotFoundRpcError"})}}Object.defineProperty(p,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class h extends c{constructor(e){super(e,{code:h.code,shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join("\n")}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParamsRpcError"})}}Object.defineProperty(h,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class b extends c{constructor(e){super(e,{code:b.code,shortMessage:"An internal error was received."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InternalRpcError"})}}Object.defineProperty(b,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class m extends c{constructor(e){super(e,{code:m.code,shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join("\n")}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidInputRpcError"})}}Object.defineProperty(m,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class f extends c{constructor(e){super(e,{code:f.code,shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}}Object.defineProperty(f,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class g extends c{constructor(e){super(e,{code:g.code,shortMessage:"Requested resource not available."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceUnavailableRpcError"})}}Object.defineProperty(g,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class w extends c{constructor(e){super(e,{code:w.code,shortMessage:"Transaction creation failed."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionRejectedRpcError"})}}Object.defineProperty(w,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class v extends c{constructor(e){super(e,{code:v.code,shortMessage:"Method is not implemented."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"MethodNotSupportedRpcError"})}}Object.defineProperty(v,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class y extends c{constructor(e){super(e,{code:y.code,shortMessage:"Request exceeds defined limit."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"LimitExceededRpcError"})}}Object.defineProperty(y,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class P extends c{constructor(e){super(e,{code:P.code,shortMessage:"Version of JSON-RPC protocol is not supported."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"JsonRpcVersionUnsupportedError"})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class O extends l{constructor(e){super(e,{code:O.code,shortMessage:"User rejected the request."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UserRejectedRequestError"})}}Object.defineProperty(O,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class C extends l{constructor(e){super(e,{code:C.code,shortMessage:"The requested method and/or account has not been authorized by the user."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnauthorizedProviderError"})}}Object.defineProperty(C,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class j extends l{constructor(e){super(e,{code:j.code,shortMessage:"The Provider does not support the requested method."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnsupportedProviderMethodError"})}}Object.defineProperty(j,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class M extends l{constructor(e){super(e,{code:M.code,shortMessage:"The Provider is disconnected from all chains."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderDisconnectedError"})}}Object.defineProperty(M,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class E extends l{constructor(e){super(e,{code:E.code,shortMessage:"The Provider is not connected to the requested chain."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ChainDisconnectedError"})}}Object.defineProperty(E,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class R extends l{constructor(e){super(e,{code:R.code,shortMessage:"An error occurred when attempting to switch chain."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SwitchChainError"})}}Object.defineProperty(R,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});var I=t(95810),q=t(75403),x=t(12138),T=t(98356),N=t(2129),U=t(75814),_=t(4159),S=t(26485),D=t(16525),L=t(19908),k=t(8103);const J="wallet_addEthereumChain",A=!0,G={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function Y(e,r,t,n,a){const o=await X(e,t,a),s=e.walletConnect;let{onDisplayUri:i}=s||{};if(!i&&a&&"walletConnect"!==t){const e=await(0,x.d)(t);i=r=>{const t=e.mobile.native||e.mobile.universal;if(!t)throw new Error("No app url found for wallet connect to redirect to.");const n=(0,L.P)(t,r).redirect;a(n)}}i&&o.events.addListener("display_uri",i);const{rpcMap:c,chainsToRequest:l}=Q({client:e.client,chain:e.chain,optionalChains:e.walletConnect?.optionalChains});o.session&&await o.connect({...s?.pairingTopic?{pairingTopic:s?.pairingTopic}:{},optionalChains:l,chains:e.chain?[e.chain.id]:l.length>0?[l[0]]:[1],rpcMap:c}),H(l,n);const d=(await o.enable())[0];if(!d)throw new Error("No accounts found on provider.");const u=(0,U.J)(o.chainId),p=e.chain&&e.chain.id===u?e.chain:(0,I.XY)(u);if(e){const r={optionalChains:e.walletConnect?.optionalChains,chain:e.chain,pairingTopic:e.walletConnect?.pairingTopic};n&&(0,D.j$)(n,t,r)}return s?.onDisplayUri&&o.events.removeListener("display_uri",s.onDisplayUri),F(d,p,o,r,n)}async function V(e,r,t,n,a){const o=n?await(0,D.Zx)(n,t):null,s=await X(o?{chain:o.chain,client:e.client,walletConnect:{pairingTopic:o.pairingTopic,optionalChains:o.optionalChains}}:{client:e.client,walletConnect:{}},t,a,!0),i=s.accounts[0];if(!i)throw new Error("No accounts found on provider.");const c=(0,U.J)(s.chainId);return F(i,e.chain&&e.chain.id===c?e.chain:(0,I.XY)(c),s,r,n)}async function X(e,r,n,a=!1){const o=await(0,x.d)(r),s=e.walletConnect,{EthereumProvider:i,OPTIONAL_EVENTS:c,OPTIONAL_METHODS:l}=await t.e(15878).then(t.bind(t,15878)),{rpcMap:d,chainsToRequest:u}=Q({client:e.client,chain:e.chain,optionalChains:e.walletConnect?.optionalChains}),p=await i.init({showQrModal:void 0===s?.showQrModal?!n&&A:s.showQrModal,projectId:s?.projectId||k.O,optionalMethods:l,optionalEvents:c,optionalChains:u,chains:e.chain?[e.chain.id]:u.length>0?[u[0]]:[1],metadata:{name:s?.appMetadata?.name||(0,N.f)().name,description:s?.appMetadata?.description||(0,N.f)().description,url:s?.appMetadata?.url||(0,N.f)().url,icons:[s?.appMetadata?.logoUrl||(0,N.f)().logoUrl]},rpcMap:d,qrModalOptions:s?.qrModalOptions,disableProviderPing:!0});if(p.events.setMaxListeners(Number.POSITIVE_INFINITY),a||p.session&&await p.disconnect(),"walletConnect"!==r){function h(){const e=p.session?.peer?.metadata?.redirect?.native||o.mobile.native||o.mobile.universal;n&&e&&n(e)}p.signer.client.on("session_request_sent",h),p.events.addListener("disconnect",(()=>{p.signer.client.off("session_request_sent",h)}))}return p}function $(e,r){return{address:(0,_.Kn)(r),async sendTransaction(r){return{transactionHash:await e.request({method:"eth_sendTransaction",params:[{gas:r.gas?(0,q.eC)(r.gas):void 0,value:r.value?(0,q.eC)(r.value):void 0,from:this.address,to:r.to,data:r.data}]})}},async signMessage({message:r}){const t="string"==typeof r?(0,q.$G)(r):r.raw instanceof Uint8Array?(0,q.dg)(r.raw):r.raw;return e.request({method:"personal_sign",params:[t,this.address]})},async signTypedData(r){const t=(0,S.t)(r),{domain:a,message:o,primaryType:s}=t,i={EIP712Domain:(0,n.cj)({domain:a}),...t.types};(0,n.iC)({domain:a,message:o,primaryType:s,types:i});const c=(0,n.H6)({domain:a??{},message:o,primaryType:s,types:i});return await e.request({method:"eth_signTypedData_v4",params:[this.address,c]})}}}function F(e,r,t,n,a){const o=$(t,e);async function s(){t.removeListener("accountsChanged",c),t.removeListener("chainChanged",l),t.removeListener("disconnect",i),await t.disconnect()}function i(){H([],a),a?.removeItem(G.lastUsedChainId),s(),n.emit("disconnect",void 0)}function c(e){if(e[0]){const r=$(t,(0,_.Kn)(e[0]));n.emit("accountChanged",r),n.emit("accountsChanged",e)}else i()}function l(e){const r=(0,I.XY)((0,U.J)(e));n.emit("chainChanged",r),a?.setItem(G.lastUsedChainId,String(e))}return t.on("accountsChanged",c),t.on("chainChanged",l),t.on("disconnect",i),t.on("session_delete",i),[o,r,s,e=>async function(e,r,t){const n=r.id;try{const a=function(e){const r=e.session?.namespaces[k.A]?.chains?.map((e=>Number.parseInt(e.split(":")[1]||"")));return r??[]}(e),o=function(e){return e.session?.namespaces[k.A]?.methods||[]}(e);if(!a.includes(n)&&o.includes(J)){const a=await(0,I.ZN)(r),o=[...new Set([...r.blockExplorers?.map((e=>e.url))||[],...a.explorers?.map((e=>e.url))||[]])];await e.request({method:J,params:[{chainId:(0,q.eC)(a.chainId),chainName:a.name,nativeCurrency:a.nativeCurrency,rpcUrls:(0,T.w)(a),blockExplorerUrls:o.length>0?o:void 0}]});const s=await async function(e){const r=await e.getItem(G.requestedChains);return r?JSON.parse(r):[]}(t);s.push(n),H(s,t)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:(0,q.eC)(n)}]})}catch(a){if(/user rejected request/i.test("string"==typeof a?a:a?.message))throw new O(a);throw new R(a)}}(t,e,a)]}function H(e,r){r?.setItem(G.requestedChains,JSON.stringify(e))}function Q(e){const r={};e.chain&&(r[e.chain.id]=(0,I.GO)({chain:e.chain,client:e.client}));const t=(e?.optionalChains||[]).slice(0,10);for(const o of t)r[o.id]=(0,I.GO)({chain:o,client:e.client});const n=t.map((e=>e.id))||[],a=e.chain?[e.chain.id,...n]:n.length>0?n:[1];return e.chain||0!==t.length||(r[1]=(0,I.XY)(1).rpc),{rpcMap:r,chainsToRequest:a}}}}]);