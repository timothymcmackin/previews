"use strict";(self.webpackChunketherlink_docs=self.webpackChunketherlink_docs||[]).push([[40865,11223],{11223:(t,e,n)=>{function a(t){return`0x${t.reduce(((t,e)=>t+e.replace("0x","")),"")}`}n.r(e),n.d(e,{concatHex:()=>a})},40865:(t,e,n)=>{n.r(e),n.d(e,{connectSmartWallet:()=>Ot,disconnectSmartWallet:()=>Tt,isSmartWallet:()=>Gt,personalAccountToSmartAccountMap:()=>Pt});var a=n(85946);const r=2n**96n-1n;var s=n(95810),i=n(57621),o=n(26182);const c="0xdd62ed3e",u=[{type:"address",name:"owner"},{type:"address",name:"spender"}],d=[{type:"uint256"}];var p=n(98445),y=n(47537),m=n(7529),l=n(98511),f=n(75403);function h(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${t} of type ${typeof t}`);return t instanceof Uint8Array?BigInt((0,f.dg)(t)):BigInt(t)}var g=n(11223),v=n(83159),w=n(11692);const b=50000n,x=t=>{const e=function(t){const{gas:e,nonce:n,to:a,from:r,value:s,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:c,paymasterInput:u,gasPerPubdata:d,data:p}=t;return{txType:113n,from:BigInt(r),to:a?BigInt(a):0n,gasLimit:e??0n,gasPerPubdataByteLimit:d??b,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,paymaster:c?BigInt(c):0n,nonce:n?BigInt(n):0n,value:s??0n,data:p||"0x0",factoryDeps:[],paymasterInput:u||"0x"}}(t);return{domain:{name:"zkSync",version:"2",chainId:t.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:e}};async function A(t){const{account:e,eip712Transaction:n,chainId:a}=t,r=x(n),s=await e.signTypedData({...r});return function(t){const{chainId:e,gas:n,nonce:a,to:r,from:s,value:i,maxFeePerGas:o,maxPriorityFeePerGas:c,customSignature:u,factoryDeps:d,paymaster:p,paymasterInput:y,gasPerPubdata:l,data:h}=t,v=[a?(0,f.NC)(a):"0x",c?(0,f.NC)(c):"0x",o?(0,f.NC)(o):"0x",n?(0,f.NC)(n):"0x",r??"0x",i?(0,f.NC)(i):"0x",h??"0x0",(0,f.NC)(e),(0,f.NC)(""),(0,f.NC)(""),(0,f.NC)(e),s??"0x",l?(0,f.NC)(l):(0,f.NC)(b),d??[],u??"0x",p&&y?[p,y]:[]];return(0,g.concatHex)(["0x71",(0,m.LV)(v)])}({...n,chainId:a,customSignature:s})}async function G(t){const{account:e,transaction:n}=t;let[a,r,s,i,o,c,u]=await Promise.all([(0,w.encode)(n),(0,v.q)(n.to),(0,v.q)(n.value),(0,v.q)(n.gas),(0,v.q)(n.maxFeePerGas),(0,v.q)(n.maxPriorityFeePerGas),(0,v.q)(n.eip712).then((t=>t?.gasPerPubdata))]);if(!i||!o||!c){const t=(0,l.getRpcClient)(n),d=await t({method:"zks_estimateFee",params:[{from:e.address,to:r,data:a,value:s?(0,f.eC)(s):void 0}]});i=h(d.gas_limit);o=2n*h(d.max_fee_per_gas),c=h(d.max_priority_fee_per_gas)||1n,u=h(d.gas_per_pubdata_limit)}return{...await(0,y.n)({transaction:{...n,gas:i,maxFeePerGas:o,maxPriorityFeePerGas:c},from:e.address}),...n.eip712,gasPerPubdata:u,from:e.address}}var P=n(4159),C=n(26485),O=n(16327),T=n(57412),I=n(39135),B=n(97123);const U=B.r;var L=n(66238),M=n(78398),N=n(80522);const D="/docs/contract/decodeEventLog";function $({param:t,value:e}){if("string"===t.type||"bytes"===t.type||"tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/))return e;return((0,M.r)([t],e)||[])[0]}function _({abi:t,eventName:e,logs:n,strict:a=!0}){return n.map((n=>{try{const r=function(t){const{abi:e,data:n,strict:a,topics:r}=t,s=a??!0,[i,...o]=r;if(!i)throw new T.FM({docsPath:D});const c=e.find((t=>"event"===t.type&&i===U((0,N.t)(t))));if(!c||!("name"in c)||"event"!==c.type)throw new T.lC(i,{docsPath:D});const{name:u,inputs:d}=c,p=d?.some((t=>!("name"in t&&t.name)));let y=p?[]:{};const m=d.filter((t=>"indexed"in t&&t.indexed));for(let h=0;h<m.length;h++){const t=m[h],e=o[h];if(!e)throw new T.Gy({abiItem:c,param:t});y[p?h:t.name||h]=$({param:t,value:e})}const l=d.filter((t=>!("indexed"in t&&t.indexed)));if(l.length>0)if(n&&"0x"!==n)try{const t=(0,M.r)(l,n);if(t)if(p)y=[...y,...t];else for(let e=0;e<l.length;e++)y[l[e].name]=t[e]}catch(f){if(s){if(f instanceof T.xB||f instanceof L.lQ)throw new T.SM({abiItem:c,data:n,params:l,size:(0,I.d)(n)});throw f}}else if(s)throw new T.SM({abiItem:c,data:"0x",params:l,size:0});return{eventName:u,args:Object.values(y).length>0?y:void 0}}({...n,abi:t,strict:a});return e&&!e.includes(r.eventName)?null:{...r,...n}}catch(r){let t,e;if(r instanceof T.lC)return null;if(r instanceof T.SM||r instanceof T.Gy){if(a)return null;t=r.abiItem.name,e=r.abiItem.inputs?.some((t=>!("name"in t&&t.name)))}return{...n,args:e?[]:{},eventName:t}}})).filter(Boolean)}var E=n(38766),F=n(62027);class S extends F.G{constructor(t){super(`Filter type "${t}" is not supported.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"FilterTypeNotSupportedError"})}}var k=n(11187),H=n(91734),j=n(45444),V=n(15102),q=n(49321),R=n(58034);function W(t,e){const n=typeof t,a=e.type;switch(a){case"address":return(0,q.U)(t,{strict:!1});case"bool":return"boolean"===n;case"function":case"string":return"string"===n;default:return"tuple"===a&&"components"in e?Object.values(e.components).every(((e,n)=>W(Object.values(t)[n],e))):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?"number"===n||"bigint"===n:/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?"string"===n||t instanceof Uint8Array:!!/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)&&(Array.isArray(t)&&t.every((t=>W(t,{...e,type:a.replace(/(\[[0-9]{0,}\])$/,"")}))))}}function z(t,e,n){for(const a in t){const r=t[a],s=e[a];if("tuple"===r.type&&"tuple"===s.type&&"components"in r&&"components"in s)return z(r.components,s.components,n[a]);const i=[r.type,s.type];if(!(!i.includes("address")||!i.includes("bytes20"))||(i.includes("address")&&i.includes("string")||!(!i.includes("address")||!i.includes("bytes")))&&(0,q.U)(n[a],{strict:!1}))return i}}const J="/docs/contract/encodeEventTopics";function K(t){const{abi:e,eventName:n,args:a}=t;let r=e[0];if(n){const t=function(t){const{abi:e,args:n=[],name:a}=t,r=(0,V.v)(a,{strict:!1}),s=e.filter((t=>r?"function"===t.type?(0,R.C)(t)===a:"event"===t.type&&U(t)===a:"name"in t&&t.name===a));if(0===s.length)return;if(1===s.length)return s[0];let i;for(const o of s)if("inputs"in o)if(n&&0!==n.length){if(o.inputs&&0!==o.inputs.length&&o.inputs.length===n.length&&n.every(((t,e)=>{const n="inputs"in o&&o.inputs[e];return!!n&&W(t,n)}))){if(i&&"inputs"in i&&i.inputs){const t=z(o.inputs,i.inputs,n);if(t)throw new T.S4({abiItem:o,type:t[0]},{abiItem:i,type:t[1]})}i=o}}else if(!o.inputs||0===o.inputs.length)return o;return i||s[0]}({abi:e,name:n});if(!t)throw new T.mv(n,{docsPath:J});r=t}if("event"!==r.type)throw new T.mv(void 0,{docsPath:J});const s=(0,N.t)(r),i=U(s);let o=[];if(a&&"inputs"in r){const t=r.inputs?.filter((t=>"indexed"in t&&t.indexed)),e=Array.isArray(a)?a:Object.values(a).length>0?t?.map((t=>a[t.name]))??[]:[];e.length>0&&(o=t?.map(((t,n)=>Array.isArray(e[n])?e[n].map(((a,r)=>X({param:t,value:e[n][r]}))):e[n]?X({param:t,value:e[n]}):null))??[])}return[i,...o]}function X({param:t,value:e}){if("string"===t.type||"bytes"===t.type)return(0,H.w)((0,k.O0)(e));if("tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/))throw new S(t.type);return(0,j.E)([t],[e])}function Q(t={}){return function(t){const{signature:e}=t;let n;var a;return n=(a=e)&&"object"==typeof a&&"type"in a&&"event"===a.type?e:(0,E.s)(e),{abiEvent:n,hash:(0,B.r)(n),topics:K({abi:[n],args:t.filters})}}({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}var Y=n(99910),Z=n(75100);var tt=n(49329),et=n(52749);const nt=()=>{const t=BigInt(Math.floor(4294967296*Math.random())),e=BigInt(Math.floor(4294967296*Math.random())),n=BigInt(Math.floor(4294967296*Math.random())),a=BigInt(Math.floor(4294967296*Math.random())),r=BigInt(Math.floor(4294967296*Math.random())),s=BigInt(Math.floor(4294967296*Math.random()));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|s};function at(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,(0,et.v)(e)?e:(0,f.NC)(e)])))}var rt=n(25108);async function st(t){const e=await ot({...t,operation:"eth_estimateUserOperationGas",params:[at(t.userOp),t.options.entrypointAddress??tt.Ex]});return{preVerificationGas:(0,f.y_)(e.preVerificationGas),verificationGas:(0,f.y_)(e.verificationGas),verificationGasLimit:(0,f.y_)(e.verificationGasLimit),callGasLimit:(0,f.y_)(e.callGasLimit)+tt.X_}}async function it(t){const e=await async function(t){const e=await ot({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(!e)return;return function(t){const{receipt:e}=t,n={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:n,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}(e)}(t);if(e){if(!1===e.success){const t=function(t){const{logs:e,events:n,strict:a}=t;return _({logs:e,abi:n.map((t=>t.abiEvent)),strict:a})}({events:[Q()],logs:e.logs}),n=t[0]?.args?.revertReason;if(!n)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const a=(0,O.p)({data:n});throw new Error(`UserOp failed with reason: '${a.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function ot(t){const{options:e,operation:n,params:a}=t;tt.eM&&rt.debug(`>>> sending ${n} with payload:`,a);const r=e.bundlerUrl??(0,tt.Rg)(e.chain),s=(0,Y.NX)(e.client),i=await s(r,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,Z.P)({jsonrpc:"2.0",id:1,method:n,params:a})}),o=await i.json();if(!i.ok||o.error){let t=o.error||i.statusText;"object"==typeof t&&(t=JSON.stringify(t));const e=o.code||"UNKNOWN";throw new Error(`${n} error: ${t}\nStatus: ${i.status}\nCode: ${e}`)}return tt.eM&&rt.debug(`<<< ${n} result:`,o),o.result}var ct=n(21690);function ut(t){const{accountContract:e,transaction:n,executeOverride:a}=t;return a?a(e,n):(0,ct.A)({contract:e,method:"function execute(address, uint256, bytes)",params:[n.to||"",n.value||0n,n.data||"0x"]})}var dt=n(57040);const pt="0x35567e1a",yt=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],mt=[{type:"uint256",name:"nonce"}];var lt=n(19500),ft=n(39430),ht=n(60689),gt=n(24951),vt=n(96378),wt=n(25108);async function bt(t){const{userOp:e,paymasterOverride:n,client:a,chain:r,entrypointAddress:s}=t;if(n)return n(e);const i=(0,tt.K9)(r),o=s??tt.Ex,c=(0,Y.NX)(a),u=await c(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[at(e),o]})}),d=await u.json();if(!u.ok){const t=d.error||u.statusText,e=d.code||"UNKNOWN";throw new Error(`Paymaster error: ${t}\nStatus: ${u.status}\nCode: ${e}`)}if(tt.eM&&wt.debug("Paymaster result:",d),d.result)return"string"==typeof d.result?{paymasterAndData:d.result}:{paymasterAndData:d.result.paymasterAndData,verificationGasLimit:d.result.verificationGasLimit?(0,f.y_)(d.result.verificationGasLimit):void 0,preVerificationGas:d.result.preVerificationGas?(0,f.y_)(d.result.preVerificationGas):void 0,callGasLimit:d.result.callGasLimit?(0,f.y_)(d.result.callGasLimit):void 0};const p=d.error?.message||d.error||u.statusText||"unknown error";throw new Error(`Paymaster error from ${i}: ${p}`)}async function xt(t){const{transaction:e,accountContract:n,factoryContract:a,adminAddress:r,overrides:s,sponsorGas:c}=t,u=e.chain,d=e.client,p=await(0,ht.isContractDeployed)(n)?"0x":await async function(t){const{factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:r}=t,s=function(t){const{adminAddress:e,factoryContract:n,createAccountOverride:a,accountSalt:r}=t;return a?a(n):(0,ct.A)({contract:n,method:"function createAccount(address, bytes) returns (address)",params:[e,(0,f.$G)(r??"")]})}({factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:r});return(0,dt.zo)([e.address,await(0,w.encode)(s)])}({factoryContract:a,adminAddress:r,accountSalt:s?.accountSalt,createAccountOverride:s?.createAccount}),y=await(0,w.encode)(e),m={client:d,chain:u,entrypointAddress:s?.entrypointAddress};let{maxFeePerGas:l,maxPriorityFeePerGas:h}=e;const g=s?.bundlerUrl??(0,tt.Rg)(u);if((0,Y.Rm)(g)){const t=await async function(t){const e=await ot({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:(0,f.y_)(e.maxPriorityFeePerGas),maxFeePerGas:(0,f.y_)(e.maxFeePerGas)}}({options:m});l=t.maxFeePerGas,h=t.maxPriorityFeePerGas}else{const[t,e]=await Promise.all([(0,v.q)(l),(0,v.q)(h)]);if(t&&e)l=t,h=e;else{const n=await(0,lt.E)(d,u);h=e??n.maxPriorityFeePerGas??0n,l=t??n.maxFeePerGas??0n}}const b=await async function(t){const{accountContract:e,chain:n,client:a,entrypointAddress:r,getNonceOverride:s}=t;if(s)return s(e);return async function(t){return(0,o.readContract)({contract:t.contract,method:[pt,yt,mt],params:[t.sender,t.key]})}({contract:(0,i.u)({address:r||tt.Ex,chain:n,client:a}),key:nt(),sender:e.address})}({accountContract:n,chain:u,client:d,entrypointAddress:s?.entrypointAddress,getNonceOverride:s?.getAccountNonce}),x={sender:n.address,nonce:b,initCode:p,callData:y,maxFeePerGas:l,maxPriorityFeePerGas:h,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:tt.Ld};if(c){const t=await bt({userOp:x,chain:u,client:d,entrypointAddress:s?.entrypointAddress,paymasterOverride:s?.paymaster}),e=t.paymasterAndData;if(e&&"0x"!==e&&(x.paymasterAndData=e),t.callGasLimit&&t.verificationGasLimit&&t.preVerificationGas)x.callGasLimit=t.callGasLimit,x.verificationGasLimit=t.verificationGasLimit,x.preVerificationGas=t.preVerificationGas;else{const t=await st({userOp:x,options:m});if(x.callGasLimit=t.callGasLimit,x.verificationGasLimit=t.verificationGasLimit,x.preVerificationGas=t.preVerificationGas,e&&"0x"!==e){const t=await bt({userOp:x,chain:u,client:d,entrypointAddress:s?.entrypointAddress,paymasterOverride:s?.paymaster});t.paymasterAndData&&"0x"!==t.paymasterAndData&&(x.paymasterAndData=t.paymasterAndData)}}}else{const t=await st({userOp:x,options:m});x.callGasLimit=t.callGasLimit,x.verificationGasLimit=t.verificationGasLimit,x.preVerificationGas=t.preVerificationGas}return{...x,signature:"0x"}}async function At(t){const{userOp:e,chain:n,entrypointAddress:a,adminAccount:r}=t,s=function(t){const{userOp:e,entryPoint:n,chainId:a}=t,r=(0,vt.w)(e.initCode),s=(0,vt.w)(e.callData),i=(0,vt.w)(e.paymasterAndData),o=(0,ft.encodeAbiParameters)([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,r,s,e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,i]),c=(0,ft.encodeAbiParameters)([{type:"bytes32"},{type:"address"},{type:"uint256"}],[(0,vt.w)(o),n,BigInt(a)]);return(0,vt.w)(c)}({userOp:e,entryPoint:a||tt.Ex,chainId:n.id});if(r.signMessage){const t=await r.signMessage({message:{raw:(0,gt.nr)(s)}});return{...e,signature:t}}throw new Error("signMessage not implemented in signingAccount")}function Gt(t){return"smart"===t.id}const Pt=new WeakMap,Ct=new WeakMap;async function Ot(t,e,s){const{personalAccount:m,client:l,chain:h}=e;if(!m)throw new Error("Personal wallet does not have an account");const v=s,w=v.factoryAddress??tt.mV,b=h??v.chain,x="gasless"in v?v.gasless:v.sponsorGas;if(function(t){return 324===t.id||300===t.id||302===t.id}(b))return[It({creationOptions:s,connectionOptions:e,chain:b,sponsorGas:x}),b];const A=(0,i.u)({client:l,address:w,chain:b}),G=await async function(t){const{factoryContract:e,predictAddressOverride:n,adminAddress:a,accountSalt:r,accountAddress:s}=t;if(n)return n(e);if(s)return s;if(!a)throw new Error("Account address is required to predict the smart wallet address.");const i=(0,f.$G)(r??"");return(0,o.readContract)({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[a,i]})}({factoryContract:A,adminAddress:m.address,predictAddressOverride:v.overrides?.predictAddress,accountSalt:v.overrides?.accountSalt,accountAddress:v.overrides?.accountAddress}).then((t=>t)).catch((t=>{throw new Error(`Failed to get account address with factory contract ${A.address} on chain ID ${b.id}. Are you on the right chain?`,{cause:t})})),O=(0,i.u)({client:l,address:G,chain:b}),T=await async function(t){const{accountContract:e}=t,s={address:(0,P.Kn)(e.address),async sendTransaction(n){const a=t.overrides?.erc20Paymaster;let s;if(a){await async function(t){const{accountContract:e,erc20Paymaster:n,options:a}=t,s=n.token,m=(0,i.u)({address:s,chain:e.chain,client:e.client}),l=await async function(t){return(0,o.readContract)({contract:t.contract,method:[c,u,d],params:[t.owner,t.spender]})}({contract:m,owner:e.address,spender:n.address});if(l>0n)return;const f=(0,p.d)({contract:m,spender:n.address,amountWei:r-1n}),h=await(0,y.n)({transaction:f,from:e.address}),g=ut({accountContract:e,transaction:h,executeOverride:a.overrides?.execute});await Ut({executeTx:g,options:{...a,overrides:{...a.overrides,erc20Paymaster:void 0}}})}({accountContract:e,erc20Paymaster:a,options:t});const n=async()=>({paymasterAndData:(0,g.concatHex)([a.address,a?.token])});s=t.overrides?.paymaster||n}return Ut({executeTx:ut({accountContract:e,transaction:n,executeOverride:t.overrides?.execute}),options:{...t,overrides:{...t.overrides,paymaster:s}}})},async sendBatchTransaction(n){const a=function(t){const{accountContract:e,transactions:n,executeBatchOverride:a}=t;return a?a(e,n):(0,ct.A)({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[n.map((t=>t.to||"")),n.map((t=>t.value||0n)),n.map((t=>t.data||"0x"))]})}({accountContract:e,transactions:n,executeBatchOverride:t.overrides?.executeBatch});return Ut({executeTx:a,options:t})},async signMessage({message:a}){const[{isContractDeployed:r},{readContract:i},{encodeAbiParameters:o},{hashMessage:c},{checkContractWalletSignature:u}]=await Promise.all([Promise.resolve().then(n.bind(n,60689)),Promise.resolve().then(n.bind(n,26182)),Promise.resolve().then(n.bind(n,39430)),n.e(31445).then(n.bind(n,31445)),n.e(46675).then(n.bind(n,46675))]);await r(e)||await Bt({options:t,account:s,accountContract:e});const d=c(a);let p,y=!1;try{await i({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[d]}),y=!0}catch(m){}if(y){const n=o([{type:"bytes32"}],[d]);p=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else p=await t.personalAccount.signMessage({message:a});if(await u({contract:e,message:a,signature:p}))return p;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(r){const i=(0,C.t)(r),[{isContractDeployed:o},{readContract:c},{encodeAbiParameters:u},{checkContractWalletSignedTypedData:d}]=await Promise.all([Promise.resolve().then(n.bind(n,60689)),Promise.resolve().then(n.bind(n,26182)),Promise.resolve().then(n.bind(n,39430)),n.e(50228).then(n.bind(n,50228))]);if(i.domain?.verifyingContract?.toLowerCase()===e.address?.toLowerCase())return t.personalAccount.signTypedData(i);await o(e)||await Bt({options:t,account:s,accountContract:e});const p=(0,a.Jv)(i);let y,m=!1;try{await c({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),m=!0}catch(l){}if(m){const n=u([{type:"bytes32"}],[p]);y=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else y=await t.personalAccount.signTypedData(i);if(await d({contract:e,data:i,signature:y}))return y;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},onTransactionRequested:async e=>t.personalAccount.onTransactionRequested?.(e)};return s}({...v,chain:b,sponsorGas:x,personalAccount:m,accountContract:O,factoryContract:A,client:l});return Pt.set(m,t),Ct.set(t,m),[T,b]}async function Tt(t){const e=Ct.get(t);e&&(Pt.delete(e),Ct.delete(t))}function It(t){const{creationOptions:e,connectionOptions:n,chain:a}=t,r={address:n.personalAccount.address,async sendTransaction(i){const o={data:i.data,to:i.to??void 0,value:i.value??0n,chain:(0,s.XY)(i.chainId),client:n.client};let c=await G({account:r,transaction:o});if(t.sponsorGas){const t=await async function(t){const e=await ot({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}({options:{client:n.client,chain:a,bundlerUrl:e.overrides?.bundlerUrl,entrypointAddress:e.overrides?.entrypointAddress},transaction:c});c={...c,...t}}const u=await A({account:r,chainId:a.id,eip712Transaction:c}),d=await async function(t){return{transactionHash:(await ot({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}({options:{client:n.client,chain:a,bundlerUrl:e.overrides?.bundlerUrl,entrypointAddress:e.overrides?.entrypointAddress},transaction:c,signedTransaction:u});return{transactionHash:d.transactionHash,client:n.client,chain:a}},signMessage:async({message:t})=>n.personalAccount.signMessage({message:t}),async signTypedData(t){const e=(0,C.t)(t);return n.personalAccount.signTypedData(e)},onTransactionRequested:async t=>n.personalAccount.onTransactionRequested?.(t)};return r}async function Bt(t){const{options:e,account:a,accountContract:r}=t,[{sendTransaction:s},{prepareTransaction:i}]=await Promise.all([Promise.resolve().then(n.bind(n,75888)),Promise.resolve().then(n.bind(n,71316))]),o=i({client:e.client,chain:e.chain,to:r.address,value:0n,gas:50000n});return await s({transaction:o,account:a})}async function Ut(t){const{executeTx:e,options:n}=t,a=await xt({transaction:e,factoryContract:n.factoryContract,accountContract:n.accountContract,adminAddress:n.personalAccount.address,sponsorGas:n.sponsorGas,overrides:n.overrides}),r=await At({chain:n.chain,adminAccount:n.personalAccount,entrypointAddress:n.overrides?.entrypointAddress,userOp:a}),s=await async function(t){return ot({...t,operation:"eth_sendUserOperation",params:[at(t.userOp),t.options.entrypointAddress??tt.Ex]})}({options:n,userOp:r}),i=await async function(t){const e=t.timeoutMs||12e4,n=t.intervalMs||1e3,a=Date.now()+e;for(;Date.now()<a;){const e=await it(t);if(e)return e;await new Promise((t=>setTimeout(t,n)))}throw new Error("Timeout waiting for userOp to be mined")}({...n,userOpHash:s});return{client:n.client,chain:n.chain,transactionHash:i.transactionHash}}},7529:(t,e,n)=>{n.d(e,{LV:()=>o});var a=n(62027),r=n(11221),s=n(11187),i=n(92106);function o(t,e="hex"){const n=c(t),a=(0,r.q)(new Uint8Array(n.length));return n.encode(a),"hex"===e?(0,i.ci)(a.bytes):a.bytes}function c(t){return Array.isArray(t)?function(t){const e=t.reduce(((t,e)=>t+e.length),0),n=u(e);return{length:e<=55?1+e:1+n+e,encode(a){e<=55?a.pushByte(192+e):(a.pushByte(247+n),1===n?a.pushUint8(e):2===n?a.pushUint16(e):3===n?a.pushUint24(e):a.pushUint32(e));for(const{encode:e}of t)e(a)}}}(t.map((t=>c(t)))):function(t){const e="string"==typeof t?(0,s.nr)(t):t,n=u(e.length),a=1===e.length&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length;return{length:a,encode(t){1===e.length&&e[0]<128?t.pushBytes(e):e.length<=55?(t.pushByte(128+e.length),t.pushBytes(e)):(t.pushByte(183+n),1===n?t.pushUint8(e.length):2===n?t.pushUint16(e.length):3===n?t.pushUint24(e.length):t.pushUint32(e.length),t.pushBytes(e))}}}(t)}function u(t){if(t<256)return 1;if(t<65536)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new a.G("Length is too large.")}},85946:(t,e,n)=>{n.d(e,{Jv:()=>c});var a=n(45444),r=n(57040),s=n(92106),i=n(91734),o=n(71352);function c(t){const{domain:e={},message:n,primaryType:a}=t,s={EIP712Domain:(0,o.cj)({domain:e}),...t.types};(0,o.iC)({domain:e,message:n,primaryType:a,types:s});const c=["0x1901"];return e&&c.push(function({domain:t,types:e}){return u({data:t,primaryType:"EIP712Domain",types:e})}({domain:e,types:s})),"EIP712Domain"!==a&&c.push(u({data:n,primaryType:a,types:s})),(0,i.w)((0,r.zo)(c))}function u({data:t,primaryType:e,types:n}){const a=d({data:t,primaryType:e,types:n});return(0,i.w)(a)}function d({data:t,primaryType:e,types:n}){const r=[{type:"bytes32"}],s=[p({primaryType:e,types:n})];for(const a of n[e]){const[e,i]=m({types:n,name:a.name,type:a.type,value:t[a.name]});r.push(e),s.push(i)}return(0,a.E)(r,s)}function p({primaryType:t,types:e}){const n=(0,s.NC)(function({primaryType:t,types:e}){let n="";const a=y({primaryType:t,types:e});a.delete(t);const r=[t,...Array.from(a).sort()];for(const s of r)n+=`${s}(${e[s].map((({name:t,type:e})=>`${e} ${t}`)).join(",")})`;return n}({primaryType:t,types:e}));return(0,i.w)(n)}function y({primaryType:t,types:e},n=new Set){const a=t.match(/^\w*/u),r=a?.[0];if(n.has(r)||void 0===e[r])return n;n.add(r);for(const s of e[r])y({primaryType:s.type,types:e},n);return n}function m({types:t,name:e,type:n,value:r}){if(void 0!==t[n])return[{type:"bytes32"},(0,i.w)(d({data:r,primaryType:n,types:t}))];if("bytes"===n){return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},(0,i.w)(r)]}if("string"===n)return[{type:"bytes32"},(0,i.w)((0,s.NC)(r))];if(n.lastIndexOf("]")===n.length-1){const s=n.slice(0,n.lastIndexOf("[")),o=r.map((n=>m({name:e,type:s,types:t,value:n})));return[{type:"bytes32"},(0,i.w)((0,a.E)(o.map((([t])=>t)),o.map((([,t])=>t))))]}return[{type:n},r]}}}]);