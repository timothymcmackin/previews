import{_ as s,c as i,o as t,aj as e}from"./chunks/framework.BHElM6wE.js";const n="/previews/smartpy/casting-scenarios/img/tutorials/pinata-key-permissions.png",h="/previews/smartpy/casting-scenarios/img/tutorials/created-pinata-key.png",p="/previews/smartpy/casting-scenarios/img/tutorials/pinata-pinned-file.png",y=JSON.parse('{"title":"Part 3: Adding metadata","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/fa2-fungible/adding-metadata.md","filePath":"tutorials/fa2-fungible/adding-metadata.md"}'),l={name:"tutorials/fa2-fungible/adding-metadata.md"};function o(r,a,d,k,c,g){return t(),i("div",null,a[0]||(a[0]=[e('<h1 id="part-3-adding-metadata" tabindex="-1">Part 3: Adding metadata <a class="header-anchor" href="#part-3-adding-metadata" aria-label="Permalink to &quot;Part 3: Adding metadata&quot;">​</a></h1><p>In this part, you configure the metadata for the contract.</p><p>Contract metadata provides details about the contract itself, including its name, description, and what standards it follows. This information lets off-chain applications like wallets and block explorers show information about the contract. Contracts can also store other information in metadata, including the code for off-chain views and information about error messages.</p><p>Contracts that manage tokens also store metadata about those tokens, including descriptions of the tokens and links to preview media.</p><p>Generally, contracts store their metadata and token metadata off-chain and include only a link to it in their storage. Storing the metadata off-chain saves space and makes it easier for off-chain applications to access it.</p><h2 id="storing-metadata-with-ipfs" tabindex="-1">Storing metadata with IPFS <a class="header-anchor" href="#storing-metadata-with-ipfs" aria-label="Permalink to &quot;Storing metadata with IPFS&quot;">​</a></h2><p>Many contracts store metadata with the InterPlanetary File System (IPFS) protocol. This protocol stores files in a decentralized peer-to-peer network and indexes them by their hash. That way, users can access media by its hash, and the hash allows them to verify that the files have not changed. As long as one IPFS user has a copy of the data, they can re-upload it to IPFS with the same hash so it is seamlessly available again.</p><p>Therefore, uploading data to IPFS doesn&#39;t mean that it will be available forever; at least one user must keep a copy of it. Instructing an IPFS node to keep a copy of a file is called <em>pinning</em> the file. SmartPy provides a function that uploads data to IPFS via the Pinata service and instructs Pinata to pin it.</p><h2 id="tutorial-contract" tabindex="-1">Tutorial contract <a class="header-anchor" href="#tutorial-contract" aria-label="Permalink to &quot;Tutorial contract&quot;">​</a></h2><p>The completed contract that you create in this part is at <a href="https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_3_complete.py" target="_blank" rel="noreferrer">part_3_complete.py</a>.</p><h2 id="getting-a-pinata-api-key" tabindex="-1">Getting a Pinata API key <a class="header-anchor" href="#getting-a-pinata-api-key" aria-label="Permalink to &quot;Getting a Pinata API key&quot;">​</a></h2><p>SmartPy test scenarios can upload files to IPFS with <a href="https://www.pinata.cloud/" target="_blank" rel="noreferrer">Pinata</a>, so to follow this part of the tutorial, you need a free account on <a href="https://www.pinata.cloud" target="_blank" rel="noreferrer">https://www.pinata.cloud</a> and an API key.</p><p>Follow these steps to create a Pinata API key:</p><ol><li><p>Create a free Pinata account at <a href="https://app.pinata.cloud/developers/api-keys" target="_blank" rel="noreferrer">https://app.pinata.cloud/developers/api-keys</a>.</p></li><li><p>Go to the API Keys tab and click <strong>New Key</strong>.</p></li><li><p>On the Create New API Key page, expand API Endpoint Access and enable the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pinFileToIPFS</span></span></code></span> permission, as in this picture:</p><p><img src="'+n+'" alt="Selecting the permissions for the Pinata key" width="300px"></p></li><li><p>In the <strong>Key Name</strong> field, give the key a name, such as &quot;My Key.&quot;</p></li><li><p>Click <strong>Create Key</strong>.</p><p>The API Key Info window shows the API key and secret, which you must copy immediately, because it is not shown again.</p></li><li><p>Copy the API Key and API Secret fields and save the values on your computer. You need these values in the next section.</p><p>You can see the new API key on the API Keys tab:</p><p><img src="'+h+`" alt="The new Pinata API key in the Pinata web app"></p></li></ol><h2 id="uploading-metadata" tabindex="-1">Uploading metadata <a class="header-anchor" href="#uploading-metadata" aria-label="Permalink to &quot;Uploading metadata&quot;">​</a></h2><p>The SmartPy <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sp.pin_on_ipfs</span></span></code></span> function uploads metadata to IPFS via your Pinata account and &quot;pins&quot; it to ensure that it remains available until you remove it. In this section, you add code to use this function to upload and pin contract metadata to IPFS when the test scenario runs. It is still advisable to save a local copy of your metadata, just as you would with any upload service.</p><ol><li><p>After the code that instantiates the contract in the test scenario, use the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sp.create_tzip16_metadata</span></span></code></span> function to create a metadata object that is compatible with the <a href="https://gitlab.com/tezos/tzip/-/blob/master/proposals/tzip-16/tzip-16.md" target="_blank" rel="noreferrer">TZIP-16</a> standard for contract metadata:</p><div class="language-smartpy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">smartpy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build contract metadata content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contract_metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sp.create_tzip16_metadata(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My FA2 fungible token contract&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This is an FA2 fungible token contract using SmartPy.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    license_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CC-BY-SA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    license_details</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Creative Commons Attribution Share Alike license 4.0 https://creativecommons.org/licenses/by/4.0/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    interfaces</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TZIP-012&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TZIP-016&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    authors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SmartPy &lt;https://smartpy.io/#contact&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    homepage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://smartpy.io/ide?template=fa2_lib_fungible.py&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Optionally, upload the source code to IPFS and add the URI here</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    source_uri</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    offchain_views</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contract.get_offchain_views(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>This code must come after you create the contract but before you add the contract to the scenario because it uses the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contract.get_offchain_views</span></span></code></span> function to retrieve the contract&#39;s off-chain views. Off-chain views are stored in metadata, not in the contract code or storage.</p></li><li><p>Optional: Edit the metadata fields with information about your contract.</p></li><li><p>Add permission information to the metadata with this code:</p><div class="language-smartpy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">smartpy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add the info specific to FA2 permissions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contract_metadata[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;permissions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # The operator policy chosen:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # owner-or-operator-transfer is the default.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;operator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;owner-or-operator-transfer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Those two options should always have these values.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # It means that the contract doesn&#39;t use the hook mechanism.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;receiver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;owner-no-hook&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;sender&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;owner-no-hook&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This metadata describes who is allowed to transfer tokens. The permissions in this code allow token owners and operators to transfer tokens. For more information about operators, see <a href="https://docs.tezos.com/architecture/tokens/FA2" target="_blank" rel="noreferrer">FA2 tokens</a> on docs.tezos.com.</p></li><li><p>Pin the metadata to IPFS and get its URI with this code:</p><div class="language-smartpy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">smartpy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Upload the metadata to IPFS and get its URI</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metadata_uri </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sp.pin_on_ipfs(contract_metadata, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">secret_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div></li><li><p>Update the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span></span></code></span> values in the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sp.pin_on_ipfs</span></span></code></span> function with your Pinata API key and secret key. You can also put them in the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PINATA_KEY</span></span></code></span> and <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PINATA_SECRET</span></span></code></span> environment variables and remove the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api_key</span></span></code></span> and <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secret_key</span></span></code></span> parameters from the function call.</p></li><li><p>Create the contract metadata and add it to the contract with this code:</p><div class="language-smartpy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">smartpy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create the metadata big map based on the IPFS URI</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contract_metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sp.scenario_utils.metadata_of_url(metadata_uri)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Update the scenario instance with the new metadata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contract.data.metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> contract_metadata</span></span></code></pre></div><p>This code creates a big map that has a single entry that points to the metadata URI.</p></li><li><p>Run the <span class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">python fa2_fungible.py</span></span></code></span> command to compile and test your contract. Now, SmartPy uploads the metadata as part of the compilation process.</p></li><li><p>In your Pinata account, verify that the metadata file uploaded correctly. By default, the file is named &quot;No name set&quot; and looks like this in your Pinata files:</p><p><img src="`+p+'" alt="The uploaded file on Pinata"></p><p>You can click this file to see it and verify that the name and description at the top of the file match the name and description of your contract. The rest of the file is the code of off-chain views that the FA2 library adds automatically.</p></li></ol><p>The completed contract is at <a href="https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_3_complete.py" target="_blank" rel="noreferrer">part_3_complete.py</a>.</p><p>Now when you deploy the completed contract, wallets and block explorers can show information about it.</p><p>Continue to <a href="/previews/smartpy/casting-scenarios/tutorials/fa2-fungible/customizing-operations">Part 4: Customizing operations</a>.</p>',20)]))}const m=s(l,[["render",o]]);export{y as __pageData,m as default};
