"use strict";(self.webpackChunkjstz_docs=self.webpackChunkjstz_docs||[]).push([[5157],{3023:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var s=n(6540);const r={},a=s.createContext(r);function o(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:t},e.children)}},7405:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"architecture/oracle","title":"Enshrined oracle","description":"This feature is under development and unstable.","source":"@site/architecture/oracle.md","sourceDirName":"architecture","slug":"/architecture/oracle","permalink":"/previews/jstz/custom-bash-formatter/architecture/oracle","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Enshrined oracle"},"sidebar":"documentationSidebar","previous":{"title":"Networks","permalink":"/previews/jstz/custom-bash-formatter/architecture/networks"},"next":{"title":"Smart functions","permalink":"/previews/jstz/custom-bash-formatter/functions/overview"}}');var r=n(4848),a=n(3023);const o={title:"Enshrined oracle"},i=void 0,c={},l=[{value:"How the oracle works",id:"how-the-oracle-works",level:2},{value:"Limitations",id:"limitations",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsx)(t.p,{children:"This feature is under development and unstable.\nImplementation details might change."})}),"\n",(0,r.jsxs)(t.p,{children:["For technical reasons, Web3 programs such as smart contracts and smart functions cannot access off-chain data directly, including calling external APIs.\nThey must use programs called oracles to get data that is not available to them on the chain.\nFor more information about oracles in general, see ",(0,r.jsx)(t.a,{href:"https://docs.tezos.com/smart-contracts/oracles",children:"Oracles"})," on docs.tezos.com."]}),"\n",(0,r.jsxs)(t.p,{children:["For information about calling the oracle from a smart function,see ",(0,r.jsx)(t.a,{href:"/functions/apis",children:"Calling external APIs"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Jstz provides a built-in, or ",(0,r.jsx)(t.em,{children:"enshrined"}),", oracle to provide off-chain data to smart functions in a deterministic, secure, and soon trust-minimal way.\nYou can imagine this oracle as a proxy gateway for network-accessible APIs.\nSmart functions can call the oracle with an ordinary HTTP request and the oracle retrieves the data and returns it to the smart function.\nThis process has a 20 second timeout.\nIf it fails to get the data, such as if the endpoint is unreachable, the oracle returns a 502 Bad Gateway error."]}),"\n",(0,r.jsxs)(t.p,{children:["Oracle calls take full advantage of Jstz's asynchronous nature; smart functions awaiting pending oracle calls do not block the Jstz chain or other calls to the same smart function.\nAs with asynchronous JavaScript, awaiting an async call suspends the smart function, allowing other operations to call the same smart function in the interim.\nAs described in ",(0,r.jsx)(t.a,{href:"/functions/overview",children:"Smart functions"}),", the state of a running smart function is isolated and atomic, so other smart function calls are not aware of the suspended smart function's uncommitted state until it completes running and commits its changes to the key-value store and ledger."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["The Jstz oracle's design was influenced by ",(0,r.jsx)(t.a,{href:"https://www.town-crier.org/dev/",children:"Town Crier"})," oracles.\nHowever, unlike Town Crier, it is directly integrated into the Jstz protocol and exposed through Fetch API."]})}),"\n",(0,r.jsx)(t.h2,{id:"how-the-oracle-works",children:"How the oracle works"}),"\n",(0,r.jsx)(t.p,{children:"Calling the oracle involves these general steps:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["A smart function sends a ",(0,r.jsx)(t.code,{children:"fetch"})," request to the on-chain component of the oracle and suspends to await the promise."]}),"\n",(0,r.jsx)(t.li,{children:"The oracle publishes the request."}),"\n",(0,r.jsxs)(t.li,{children:["The off-chain oracle node receives the request and executes it as usual for a ",(0,r.jsx)(t.code,{children:"fetch"})," request."]}),"\n",(0,r.jsxs)(t.li,{children:["When it receives the response, the off-chain oracle node signs it to authenticate it and injects it into Jstz as a specific operation type known as an ",(0,r.jsx)(t.code,{children:"OracleResponseOperation"})," operation."]}),"\n",(0,r.jsx)(t.li,{children:"Jstz receives the operation, verifies the signature, and returns a Response object to the smart function."}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.code,{children:"fetch"})," request promise resolves with the Response object and the smart function resumes operation."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsx)(t.p,{children:"The oracle is under active development and is changing rapidly.\nAt this time it lacks some features that are necessary to be a truly trustless, decentralized web3 platform.\nHere are some notes about limitations and how it may change to work better as a web3 tool:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The oracle node does not run in a ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Trusted_execution_environment",children:"trusted execution environment"})," yet, but support for it is planned, which will reduce the trust required around the correctness of the response."]}),"\n",(0,r.jsx)(t.li,{children:"Support is planned for private requests that will allow smart functions to access authenticated endpoints like those requiring API tokens."}),"\n",(0,r.jsx)(t.li,{children:"For now there is only a single centralized oracle node operator."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Additional details that are subject to change:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Smart functions cannot call the oracle during or after they read from or write to the key-value store.\nThey must make oracle calls first and wait for its promise to be resolved before accessing the key-value store.\nIf the oracle detects that the smart function has accessed the key-value store before sending the request, it returns a rejected promise."}),"\n",(0,r.jsx)(t.li,{children:"Similarly, smart functions cannot send or receive tez or call other smart functions before or during an oracle call."}),"\n",(0,r.jsx)(t.li,{children:"Oracle calls are free today but will consume gas (transaction fees) in the future based on factors such as the size of the request and response.\nSimilarly, a smart function consumes no gas while suspended but may in the future."}),"\n",(0,r.jsx)(t.li,{children:"The cap on the size of an API response is approximately 10MiB."}),"\n",(0,r.jsx)(t.li,{children:"Oracle calls cannot currently be cancelled."}),"\n",(0,r.jsx)(t.li,{children:"TTL for requests is 20 seconds."}),"\n",(0,r.jsx)(t.li,{children:"Requests that require a long-lived, persistent, or keep-alive connection are not supported."}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);