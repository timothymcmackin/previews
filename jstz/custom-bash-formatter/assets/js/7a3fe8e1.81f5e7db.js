"use strict";(self.webpackChunkjstz_docs=self.webpackChunkjstz_docs||[]).push([[5629],{3023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(6540);const r={},a=s.createContext(r);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:n},e.children)}},6805:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"functions/apis","title":"Calling external APIs","description":"This feature is under development and unstable.","source":"@site/functions/apis.md","sourceDirName":"functions","slug":"/functions/apis","permalink":"/previews/jstz/custom-bash-formatter/functions/apis","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Calling external APIs"},"sidebar":"documentationSidebar","previous":{"title":"Calling other smart functions","permalink":"/previews/jstz/custom-bash-formatter/functions/calling"},"next":{"title":"Managing tokens","permalink":"/previews/jstz/custom-bash-formatter/functions/tokens"}}');var r=t(4848),a=t(3023);const o={title:"Calling external APIs"},i=void 0,c={},l=[];function h(e){const n={a:"a",admonition:"admonition",code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"This feature is under development and unstable.\nImplementation details might change."})}),"\n",(0,r.jsxs)(n.p,{children:["As described in ",(0,r.jsx)(n.a,{href:"/architecture/oracle",children:"Enshrined oracle"}),", smart functions cannot call external APIs directly and must instead use the oracle.\nThe oracle acts as a proxy gateway for network-accessible APIs."]}),"\n",(0,r.jsxs)(n.p,{children:["Smart functions can make API requests through ordinary HTTP and HTTPS calls via the ",(0,r.jsx)(n.code,{children:"fetch"})," API and Jstz automatically routes these requests through the oracle."]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.a,{href:"/architecture/oracle#limitations",children:"limitations"})," for the oracle before using it."]}),(0,r.jsx)(n.p,{children:"One important limitation is that smart functions can call the oracle only from a clean transaction context.\nThis means that smart functions cannot call the oracle after they have initiated any of these operations:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reading from or writing to the key-value store"}),"\n",(0,r.jsx)(n.li,{children:"Sending tez"}),"\n",(0,r.jsx)(n.li,{children:"Calling other smart functions"}),"\n"]}),(0,r.jsxs)(n.p,{children:["The smart function must make oracle calls before attempting any of these operations, or else the oracle rejects the ",(0,r.jsx)(n.code,{children:"fetch"})," promise.\nThey also cannot initiate any of these operations while awaiting a response from the oracle."]})]}),"\n",(0,r.jsxs)(n.p,{children:["To call an external API via the oracle, make a ",(0,r.jsx)(n.code,{children:"fetch"})," request as usual, as in ",(0,r.jsx)(n.a,{href:"https://github.com/jstz-dev/jstz/blob/main/examples/oracle_basic.js",children:(0,r.jsx)(n.code,{children:"oracle_basic"})})," example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const handler = async () => {\n  console.log("Fetching uuid4");\n  try {\n    const responsePromise = fetch("http://httpbin.org/uuid");\n    console.log("Running something else while waiting");\n    const response = await responsePromise;\n    if (!response.ok) {\n      throw new Error(`HTTP error! Status: ${response.status}`);\n    }\n    const { uuid } = await response.json();\n    console.log("UUID:", uuid);\n    return new Response(uuid);\n  } catch (error) {\n    console.error("Failed to fetch UUID:", error.message);\n  }\n};\n\nexport default handler;\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Jstz automatically sends this request to the oracle and returns a response within 20 seconds or rejects the promise that the ",(0,r.jsx)(n.code,{children:"fetch"})," API returns."]}),"\n",(0,r.jsxs)(n.p,{children:["For an example, see the ",(0,r.jsx)(n.a,{href:"https://github.com/jstz-dev/jstz/blob/main/examples/oracle_basic.js",children:(0,r.jsx)(n.code,{children:"oracle_basic"})})," example."]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);