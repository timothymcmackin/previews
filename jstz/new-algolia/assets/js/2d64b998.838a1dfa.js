"use strict";(self.webpackChunkjstz_docs=self.webpackChunkjstz_docs||[]).push([[539],{2327:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"api/smart_function","title":"SmartFunction","description":"The SmartFunction namespace provides an API to create and calljstz smart functions.","source":"@site/api/smart_function.md","sourceDirName":"api","slug":"/api/smart_function","permalink":"/previews/jstz/new-algolia/api/smart_function","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"SmartFunction","sidebar_label":"SmartFunction"},"sidebar":"documentationSidebar","previous":{"title":"KV","permalink":"/previews/jstz/new-algolia/api/kv"},"next":{"title":"Ledger","permalink":"/previews/jstz/new-algolia/api/ledger"}}');var r=t(4848),c=t(3023);const i={title:"SmartFunction",sidebar_label:"SmartFunction"},o=void 0,a={},d=[{value:"Quick Start",id:"quick-start",level:2},{value:"Instance Methods",id:"instance-methods",level:2},{value:"<code>SmartFunction.call(request: Request): Promise&lt;Response&gt;</code>",id:"smartfunctioncallrequest-request-promiseresponse",level:3},{value:"<code>SmartFunction.create(code : string): Promise&lt;Address&gt;</code>",id:"smartfunctioncreatecode--string-promiseaddress",level:3}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"SmartFunction"})," namespace provides an API to create and call",(0,r.jsx)(n.code,{children:"jstz"})," smart functions.\nNew smart functions can be created with the ",(0,r.jsx)(n.code,{children:"SmartFunction.create()"})," method\nand ",(0,r.jsx)(n.code,{children:"SmartFunction.call()"})," is used for calling other smart functions."]}),"\n",(0,r.jsxs)(n.p,{children:["All operations on ",(0,r.jsx)(n.code,{children:"SmartFunction"})," are asynchronous."]}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsxs)(n.p,{children:["We may deploy a new smart function programmatically by calling ",(0,r.jsx)(n.code,{children:"SmartFunction.create()"})," with a single ",(0,r.jsx)(n.code,{children:"string"})," argument.\nThe smart function code must be valid ECMAScript. TypeScript is not supported when deploying functions using\n",(0,r.jsx)(n.code,{children:"SmartFunction.create"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const newSmartFunction = SmartFunction.create(\n  "export default handler () => new Response()",\n);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This will deploy a new smart function with the code ",(0,r.jsx)(n.code,{children:"export default handler () => new Response()"}),",\nreturning a ",(0,r.jsx)(n.em,{children:"promise"})," which will resolve to the address of the new function."]}),"\n",(0,r.jsxs)(n.p,{children:["Once a smart function is deployed we may call it from another smart function using the\n",(0,r.jsx)(n.code,{children:"SmartFunction.call()"})," method. To call a smart function we create a new ",(0,r.jsx)(n.a,{href:"/previews/jstz/new-algolia/api/request",children:"Request"})," object with\nscheme ",(0,r.jsx)(n.code,{children:"tezos"})," and the address as the hostname."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'async function handler(_: Request): Promise<Response> {\n  const newAddress = await SmartFunction.create(\n    "export default handler () => new Response()",\n  );\n  return SmartFunction.call(new Request(`jstz://${newAddress}`));\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"instance-methods",children:"Instance Methods"}),"\n",(0,r.jsx)(n.h3,{id:"smartfunctioncallrequest-request-promiseresponse",children:(0,r.jsx)(n.code,{children:"SmartFunction.call(request: Request): Promise<Response>"})}),"\n",(0,r.jsxs)(n.p,{children:["Calls a ",(0,r.jsx)(n.code,{children:"jstz"})," smart function with the given request, returning a promise that resolves to an\nHTTP ",(0,r.jsx)(n.a,{href:"/previews/jstz/new-algolia/api/response",children:(0,r.jsx)(n.code,{children:"Response"})})," object."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"request"})," parameter is a HTTP ",(0,r.jsx)(n.a,{href:"/previews/jstz/new-algolia/api/request",children:(0,r.jsx)(n.code,{children:"Request"})})," object.\nThe URL scheme ",(0,r.jsx)(n.em,{children:"must"})," be ",(0,r.jsx)(n.code,{children:"tezos"})," and the host ",(0,r.jsx)(n.em,{children:"must"})," be the address of a deployed ",(0,r.jsx)(n.code,{children:"jstz"})," smart function.\nThe ",(0,r.jsx)(n.code,{children:"Referer"})," header ",(0,r.jsx)(n.em,{children:"must"})," not be set."]}),"\n",(0,r.jsx)(n.h3,{id:"smartfunctioncreatecode--string-promiseaddress",children:(0,r.jsx)(n.code,{children:"SmartFunction.create(code : string): Promise<Address>"})}),"\n",(0,r.jsxs)(n.p,{children:["Creates and deploys a new ",(0,r.jsx)(n.code,{children:"jstz"})," smart function with the given code, returning a promise that resolves to the address of the newly deployed smart function."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"code"})," must be a ",(0,r.jsx)(n.code,{children:"string"})," containing an ECMAscript module.\nThe module ",(0,r.jsx)(n.em,{children:"must"})," define a default export of type ",(0,r.jsx)(n.code,{children:"(request: Request) => Response | Promise<Response>"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},3023:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const r={},c=s.createContext(r);function i(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);