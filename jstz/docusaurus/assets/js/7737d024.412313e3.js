"use strict";(self.webpackChunkjstz_docs=self.webpackChunkjstz_docs||[]).push([[509],{3023:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(6540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},6642:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"quick_start","title":"\ud83d\ude80 Quick start","description":"This guide will instruct you in writing, deploying, and using your first Jstz smart function in under 10 minutes.","source":"@site/quick_start.md","sourceDirName":".","slug":"/quick_start","permalink":"/previews/jstz/docusaurus/quick_start","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\ud83d\ude80 Quick start","sidebar_label":"Quick start"},"sidebar":"documentationSidebar","previous":{"title":"Installation","permalink":"/previews/jstz/docusaurus/installation"},"next":{"title":"CLI","permalink":"/previews/jstz/docusaurus/cli"}}');var r=t(4848),i=t(3023);const a={title:"\ud83d\ude80 Quick start",sidebar_label:"Quick start"},o=void 0,c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"What is Jstz?",id:"what-is-jstz",level:2},{value:"1. A sample smart function",id:"1-a-sample-smart-function",level:2},{value:"2. Deploying the smart function",id:"deploying-the-smart-function",level:2},{value:"3. Calling the smart function",id:"3-calling-the-smart-function",level:2},{value:"4. Interacting with the smart function in Node.JS",id:"4-interacting-with-the-smart-function-in-nodejs",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["This guide will instruct you in writing, deploying, and using your first Jstz ",(0,r.jsx)(n.em,{children:"smart function"})," in under 10 minutes."]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.p,{children:["Before you begin, ensure that you have ",(0,r.jsx)(n.a,{href:"/previews/jstz/docusaurus/installation",children:"installed Jstz"}),", Node.JS, ",(0,r.jsx)(n.code,{children:"npm"}),", and Docker."]}),"\n",(0,r.jsx)(n.p,{children:"To verify your installation, run this command to check the version of Jstz:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"jstz --version\n"})}),"\n",(0,r.jsxs)(n.p,{children:["It will also help to have a basic familiarity with ",(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=zQnBQ4tB3ZA",children:"Typescript"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"what-is-jstz",children:"What is Jstz?"}),"\n",(0,r.jsxs)(n.p,{children:["Jstz allows you to deploy ",(0,r.jsx)(n.em,{children:"smart functions"}),", which are JavaScript applications that behave like ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Serverless_computing",children:"serverless applications"}),", small applications that run only when called and do not have a persistent presence in memory on any specific server.\nJstz smart functions run on the Tezos blockchain via ",(0,r.jsx)(n.a,{href:"https://docs.tezos.com/architecture/smart-rollups",children:"Smart Rollup"})," technology.\nRunning on Tezos provides smart functions with many of the same advantages as ",(0,r.jsx)(n.a,{href:"https://docs.tezos.com/smart-contracts",children:"smart contracts on Tezos"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Smart functions are persistent, transparent, and immutable, which allows users to trust that they will stay available and will not change how they behave or be shut down"}),"\n",(0,r.jsx)(n.li,{children:"Smart functions are censorship-resistant, because they are deployed on distributed Jstz Smart Rollup nodes and therefore no one can block calls to them"}),"\n",(0,r.jsx)(n.li,{children:"Smart functions have no long-term hosting cost; they incur a cost only when called"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Also, because smart functions run on a Tezos Smart Rollup instead of directly on Tezos, they have the additional benefits of low gas cost and reduced latency that Tezos layer 2 provides."}),"\n",(0,r.jsx)(n.h2,{id:"1-a-sample-smart-function",children:"1. A sample smart function"}),"\n",(0,r.jsx)(n.p,{children:"Like smart contracts, you compile and deploy smart functions and then they cannot be changed.\nHowever, smart functions behave more like web applications because they accept requests and return responses in a way similar to ordinary web-based HTTP requests."}),"\n",(0,r.jsxs)(n.p,{children:["The sample smart function in the ",(0,r.jsx)(n.code,{children:"get-tez"})," folder of the Jstz repository stores tez and sends 1 tez (the primary cryptocurrency token of the Tezos chain and therefore the primary token of Jstz) to requesters who ask politely.\nIts code is written in ordinary TypeScript:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// <src="examples/get-tez/index.ts">\n\n// 1 tez = 1 million mutez\nconst ONE_TEZ = 1000000;\n\n// Maximum amount of tez a requester can receive\nconst MAX_TEZ = 10000;\n\n// Get the amount of tez that the smart function has sent to an address\nconst getReceivedTez = (requester: Address): number => {\n  let receivedTez: number | null = Kv.get(`received/${requester}`);\n  receivedTez = receivedTez === null ? 0 : receivedTez;\n  console.debug(`Requestor already received ${receivedTez} tez`);\n  return receivedTez;\n};\n\n// Update the record of the amount of tez that an address has received\nconst setReceivedTez = (requester: Address, received: number): void => {\n  Kv.set(`received/${requester}`, received);\n};\n\n// Log the message that the user sent\nconst addPoliteMessage = (requester: Address, message: string): void => {\n  let length: number | null = Kv.get(`messages/${requester}/length`);\n  if (length === null) {\n    length = 0;\n  }\n  Kv.set(`messages/${requester}/${length}`, message);\n  Kv.set(`messages/${requester}/length`, length + 1);\n};\n\n// Main function: handle calls to the smart function\nconst handler = async (request: Request): Promise<Response> => {\n  // Extract the requester\'s address and message from the request\n  const requester = request.headers.get("Referer") as Address;\n  const { message } = await request.json();\n\n  console.log(`${requester} says: ${message}`);\n\n  // Check if the requester is polite, and decline the request if not\n  if (!message.toLowerCase().includes("please")) {\n    return new Response(\n      JSON.stringify("Sorry, I only fulfill polite requests"),\n    );\n  }\n\n  // If the requester already received too much tez, decline the request\n  const receivedTez = getReceivedTez(requester);\n  if (receivedTez >= MAX_TEZ) {\n    return new Response(\n      JSON.stringify("Sorry, you already received too much tez"),\n    );\n  }\n\n  // Process the request and send the 1 tez = 1 million mutez to the requester if you can\n  if (Ledger.balance(Ledger.selfAddress) > ONE_TEZ) {\n    console.log(\n      `Transferring 1 tez from ${Ledger.selfAddress} to ${requester}...`,\n    );\n    Ledger.transfer(requester, ONE_TEZ);\n  } else {\n    return new Response(\n      JSON.stringify("Sorry, I don\'t have enough tez to fulfill your request"),\n    );\n  }\n\n  // Log the updates\n  setReceivedTez(requester, receivedTez + 1);\n  addPoliteMessage(requester, message);\n\n  return new Response(\n    JSON.stringify("Thank you for your polite request. You received 1 tez!"),\n  );\n};\n\nexport default handler;\n'})}),"\n",(0,r.jsx)(n.p,{children:"This smart function consists of:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"A few utility functions that read and write data with the Jstz key-value store.\nEach time a smart function is called, it runs in a new environment and therefore must store any persistent data in the key-value store.\nIn this case, the smart function records how much tez it has sent to each address and also logs the messages that users send to it."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.code,{children:"handler"})," function."]}),"\n",(0,r.jsxs)(n.p,{children:["The handler function is the sole entrypoint of a Jstz smart function; it is what runs when a client calls the smart function.\nThe handler function receives a Jstz ",(0,r.jsx)(n.a,{href:"/api/request",children:"request"})," object that includes the address of the account that called it in its ",(0,r.jsx)(n.code,{children:"Referer"})," header and an optional request body.\nIt must return a Jstz ",(0,r.jsx)(n.a,{href:"/api/response",children:"response"})," object.\nIn this way, smart functions behave much like conventional web server handlers or cloud functions."]}),"\n",(0,r.jsx)(n.p,{children:"In this case, the handler runs this logic:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"It gets the address that sent the request and the message from the request body."}),"\n",(0,r.jsx)(n.li,{children:'It verifies that the message was polite, in this case that it included the word "please."'}),"\n",(0,r.jsx)(n.li,{children:"It checks to see if the account has already received the maximum amount of tez from it."}),"\n",(0,r.jsxs)(n.li,{children:["It verifies that it has at least one tez in its account.\nThe smart function's tez balance is in the Jstz persistent ledger of tez balances of all accounts, which the smart function can access with the ",(0,r.jsx)(n.a,{href:"/previews/jstz/docusaurus/api/ledger",children:(0,r.jsx)(n.code,{children:"Ledger"})})," API."]}),"\n",(0,r.jsx)(n.li,{children:"It sends one tez to the requester with the Ledger API."}),"\n",(0,r.jsx)(n.li,{children:"It updates its information in the key-value store, including the message that the requester sent and the new total amount of tez that the requester has received."}),"\n",(0,r.jsx)(n.li,{children:"It returns a text message to the requester."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["An ",(0,r.jsx)(n.code,{children:"export default"})," statement."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"export default"})," is JavaScript syntax required for defining an ECMAScript module.\nSmart functions ",(0,r.jsx)(n.em,{children:"must"})," have a default export of a function that has the following type:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"type Handler = (req: Request) => Response | Promise<Response>;\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deploying-the-smart-function",children:"2. Deploying the smart function"}),"\n",(0,r.jsx)(n.p,{children:"Follow these instructions to deploy the sample smart function to a local sandbox:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Clone the Jstz repository and navigate to the ",(0,r.jsx)(n.code,{children:"get-tez"})," example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"git clone https://github.com/jstz-dev/jstz.git && cd jstz/examples/get-tez\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You may see an error that says ",(0,r.jsx)(n.code,{children:".envrc is blocked."}),"\nYou can ignore this error because it refers to setting up a development environment to build Jstz locally."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Install the dependencies for the smart function:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"npm install\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Start the local sandbox in a Docker container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"jstz sandbox --container start\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If you see an error that says that the configuration file is improperly configured, delete the ",(0,r.jsx)(n.code,{children:"~/.jstz/"})," folder and try to start the sandbox again."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"--detach"})," (",(0,r.jsx)(n.code,{children:"-d"}),") flag starts the sandbox in the background, allowing you to continue working in the same terminal.\nYou can stop or reset the sandbox with the commands ",(0,r.jsx)(n.code,{children:"jstz sandbox --container stop"})," or ",(0,r.jsx)(n.code,{children:"jstz sandbox --container restart"}),", but the state of the sandbox is not persistent."]})}),"\n",(0,r.jsx)(n.p,{children:"When the sandbox starts, it shows the bootstrap accounts and their balances on Tezos layer 1, which you can use to fund smart functions and user accounts in Jstz:"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Open a new terminal window, go to the ",(0,r.jsx)(n.code,{children:"jstz/examples/get-tez"})," folder, and run this command to compile and deploy the smart function to the sandbox:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"npm run build\njstz deploy dist/index.js -n dev\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If this is your first time deploying a smart function, the ",(0,r.jsx)(n.code,{children:"deploy"})," command prompts you to create a Jstz account.\nYou can use any local name and passphrase for the account.\nLater, you can create accounts with the ",(0,r.jsx)(n.code,{children:"jstz account create"})," and switch accounts with the ",(0,r.jsx)(n.code,{children:"jstz login"})," and ",(0,r.jsx)(n.code,{children:"jstz account"})," commands."]}),"\n",(0,r.jsxs)(n.p,{children:["Upon successful deployment, Jstz assigns the smart function a unique ",(0,r.jsx)(n.code,{children:"KT1"})," address.\nThis address is its identifier, similar to an IP address or a smart contract address."]}),"\n",(0,r.jsxs)(n.p,{children:["In the example above, the smart function was deployed to the address ",(0,r.jsx)(n.code,{children:"KT1FZuQ4SDP7ahLRyybtNnNxNnRskBGyAXVw"}),".\nNow the smart function is accessible through a URL of the format ",(0,r.jsx)(n.code,{children:"jstz://KT1FZuQ4SDP7ahLRyybtNnNxNnRskBGyAXVw/"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"After you deploy the smart function, you cannot delete it or change it."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Fund the smart function by running this command, using your smart function address for the ",(0,r.jsx)(n.code,{children:"<ADDRESS>"})," variable:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"jstz bridge deposit --from bootstrap1 --to <ADDRESS> --amount 1000 -n dev\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This command bridges tez from a layer 1 bootstrap account to a Jstz account.\nLike Tezos smart contracts, Jstz smart functions are a type of account and can store and transfer tez.\nFor more information about bridging to Jstz, see ",(0,r.jsx)(n.a,{href:"/architecture/bridge",children:"Asset Bridge"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-calling-the-smart-function",children:"3. Calling the smart function"}),"\n",(0,r.jsx)(n.p,{children:"After a successful deployment, you can call the smart function in a way similar to sending an HTTP request."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Ask the smart function for tez in an impolite way by running this command, with your smart function's address:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'jstz run jstz://<ADDRESS>/ --data \'{"message":"Give me tez now."}\' -n dev\n'})}),"\n",(0,r.jsx)(n.p,{children:'The smart function returns the message "Sorry, I only fulfill polite requests."'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Ask the smart function politely by running this command, which includes the word "please" in the message:'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'jstz run jstz://<ADDRESS>/ --data \'{"message":"Please, give me some tez."}\' -n dev\n'})}),"\n",(0,r.jsx)(n.p,{children:'The function returns the message "Thank you for your polite request. You received 1 tez!"'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Check your balance by running this command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"jstz account balance -n dev\n"})}),"\n",(0,r.jsx)(n.p,{children:"The response is the current balance of the currently logged in account, including the 1 tez that the smart function sent."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Get your user account address by running this command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"jstz whoami\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Like Tezos accounts, Jstz user account start with ",(0,r.jsx)(n.code,{children:"tz1"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Check the key-value store for the smart function to see that it recorded your tez and messages by running this command, with your user account address in place of the variable ",(0,r.jsx)(n.code,{children:"<USER_ADDRESS>"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'jstz kv get -a <ADDRESS> -n dev "received/<USER_ADDRESS>"\n'})}),"\n",(0,r.jsx)(n.p,{children:"The response is the amount of tez that the smart function has sent to your user account.\nNote that the key-value storage for a smart function is visible to all accounts, but only the smart function itself can write to its key-value store."}),"\n",(0,r.jsx)(n.p,{children:"You can also see the messages that you have sent to the smart function in the key-value store by looking them up by index, as in this example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'jstz kv get -a <ADDRESS> -n dev "messages/<USER_ADDRESS>/0"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Congratulations! \ud83c\udf89 You have now successfully deployed and crafted a Jstz request to run your first smart function."}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["For debugging, you can listen to the log of a smart function with the command ",(0,r.jsx)(n.code,{children:"jstz logs trace"})," which behaves like the Linux command ",(0,r.jsx)(n.code,{children:"tail -f"}),"."]}),(0,r.jsxs)(n.p,{children:["You can also send a request and view the log messages generated from that request by adding the ",(0,r.jsx)(n.code,{children:"--trace"})," flag to the ",(0,r.jsx)(n.code,{children:"jstz run"})," command."]})]}),"\n",(0,r.jsx)(n.h2,{id:"4-interacting-with-the-smart-function-in-nodejs",children:"4. Interacting with the smart function in Node.JS"}),"\n",(0,r.jsxs)(n.p,{children:["As an example of how an off-chain application can interact with a smart function, the folder ",(0,r.jsx)(n.code,{children:"examples/show-tez"})," is a CLI application written in Node.JS that accesses the smart function that you just deployed.\nFollow these steps to build and run this application:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Build the ",(0,r.jsx)(n.code,{children:"show-tez"})," example from within the ",(0,r.jsx)(n.code,{children:"jstz/examples/show-tez"})," folder:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"# git clone https://github.com/jstz-dev/jstz\ncd jstz/examples/show-tez\nnpm install\nnpm run build\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Ensure that you are logged in to Jstz.\nYou can verify that you are logged in by running the command ",(0,r.jsx)(n.code,{children:"jstz whoami"}),".\nTo log in, run the command ",(0,r.jsx)(n.code,{children:"jstz login <ALIAS>"}),", where ",(0,r.jsx)(n.code,{children:"<ALIAS>"})," is the alias of your Jstz account."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Deploy the CLI application and pass the address of the ",(0,r.jsx)(n.code,{children:"get-tez"})," smart function that you deployed in ",(0,r.jsx)(n.a,{href:"#deploying-the-smart-function",children:"Deploying the smart function"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"node dist/bundle.js <ADDRESS>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The app shows the message ",(0,r.jsx)(n.code,{children:'Please ask for tez politely. Type "show" to see past messages. Ctrl+C to quit'}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The CLI accepts two commands.\nIf you input the text ",(0,r.jsx)(n.code,{children:"show"}),", it prints the history of commands.\nIf you input any other text, it sends that text as a request to the smart function, as in the command you ran earlier: ",(0,r.jsx)(n.code,{children:'jstz run jstz://<ADDRESS>/ --data \'{"message":"Please, give me some tez."}\' -n dev'}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Send a request that includes the word "please" and see that the smart function sends you one tez.'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Try other requests and the ",(0,r.jsx)(n.code,{children:"show"})," command, as in this example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'# Example\n$ node dist/bundle.js KT1FZuQ4SDP7ahLRyybtNnNxNnRskBGyAXVw\n\ud83e\udd16: Please ask for tez politely. Type "show" to see past messages. Ctrl+C to quit\nPlease give me some tez\n\ud83e\udd16: Thank you for your polite request. You received 1 tez!\nI want tez now!\n\ud83e\udd16: Sorry, I only fulfill polite requests\nOk, sorry, please give me a little more\n\ud83e\udd16: Thank you for your polite request. You received 1 tez!\nShow # <- show history\n[0] Please, give me some tez.\n[1] Please give me some tez\n[2] Ok, sorry, please give me a little more\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"When you are finished, press Ctrl+C to stop the CLI program."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Check your balance with the ",(0,r.jsx)(n.code,{children:"jstz account balance -n dev"})," command."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The complete code of the CLI application is in the file ",(0,r.jsx)(n.code,{children:"examples/show-tez/src/index.ts"}),".\nHere are some details about how the CLI application works with the smart function:"]}),"\n",(0,r.jsx)(n.p,{children:"It imports the Jstz client library, client library types, and the signing library, which signs Jstz transactions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import { Jstz } from "@jstz-dev/jstz-client";\nimport JstzType from "@jstz-dev/jstz-client";\n...\nimport * as signer from "jstz_sdk"; // <- signing library\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"The signing library is a temporary solution while we build out the secure signing interface.\nEssentially, it is a WASM program directly compiled from the core Jstz Rust code.\nAlthough it is semantically correct, do not use this library in production because it involves copying users' secret keys, which is not secure."})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"buildRequest"})," function constructs a ",(0,r.jsx)(n.code,{children:"RunFunction"})," operation that calls the smart function by its ",(0,r.jsx)(n.code,{children:"jstz://<ADDRESS>"})," URL."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'function buildRequest(\n  contractAddress: string,\n  message: string,\n): JstzType.Operation.RunFunction {\n  return {\n    _type: "RunFunction",\n    body: Array.from(\n      encoder.encode(\n        JSON.stringify({\n          message: message,\n        }),\n      ),\n    ),\n    gas_limit: 55000,\n    headers: {},\n    method: "GET",\n    uri: `jstz://${contractAddress}`,\n  };\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"main"})," function controls the behavior of the CLI application.\nIt starts the command-line terminal with the ",(0,r.jsx)(n.code,{children:"readline.createInterface"})," function and processes each message from the user."]}),"\n",(0,r.jsxs)(n.p,{children:["When it receives the message ",(0,r.jsx)(n.code,{children:"show"}),", it uses the Jstz client API to get the messages from the smart function's key-value store:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'if (input.toLocaleLowerCase() === "show") {\n  // If the user sends "show," print their messages from the contract\'s key-value store\n  const length: number = Number.parseInt(\n    // Get the total number of messages sent by the user account\n    await jstzClient.accounts.getKv(contractAddress, {\n      key: `messages/${address}/length`,\n    }),\n  );\n  // Print each message\n  for (let index = 0; index < length; index++) {\n    const message = await jstzClient.accounts.getKv(contractAddress, {\n      key: `messages/${address}/${index}`,\n    });\n    console.log(`[${index}]`, message);\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"When it receives any other message, it follows these steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["It uses the ",(0,r.jsx)(n.code,{children:"buildRequest"})," function to create a Jstz."]}),"\n",(0,r.jsx)(n.li,{children:"It gets the account nonce, which is a unique value that prevents a transaction from being duplicated."}),"\n",(0,r.jsx)(n.li,{children:"It signs the operation with the user's secret key and nonce."}),"\n",(0,r.jsx)(n.li,{children:"It sends the transaction to Jstz and waits for the response."}),"\n",(0,r.jsx)(n.li,{children:"It prints the response to the console."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is the code that assembles, signs, and sends the request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// If the user sends any message other than "show,"\n// send that message as a request to the smart function\nconst runFunction = buildRequest(contractAddress, input);\nconst nonce = await jstzClient.accounts.getNonce(address);\nconst operation = {\n  content: runFunction,\n  nonce,\n  source: address,\n};\n// Sign the operation\nconst signature = jstz_sdk.sign_operation(operation, secretKey);\n// Send the operation\nconst response = jstzClient.operations.injectAndPoll({\n  inner: operation,\n  public_key: publicKey,\n  signature: signature,\n});\n...\nconst {\n  result: {\n    inner: { body },\n  },\n} = await response; // Async so we need to await\n'})}),"\n",(0,r.jsx)(n.p,{children:"And that's it! You are now equipped to battle the evil forces of centralization. Go forth and do Jstz \ud83d\udc4a!"}),"\n",(0,r.jsxs)(n.p,{children:["If you want to take these applications further, you can change how the smart function distributes tez or stores data.\nYou can also try running the example web application at ",(0,r.jsx)(n.code,{children:"examples/call-from-web"})," to see how Jstz works with a web application."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);