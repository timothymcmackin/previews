"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6399],{20908:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"tutorials/smartpy-fa2-fungible/basic-fa2-token","title":"Part 1: Setting up a simple FA2 token","description":"In the first part of this tutorial, you create an FA2 token contact that has only the basic features that the standard requires.","source":"@site/docs/tutorials/smartpy-fa2-fungible/basic-fa2-token.md","sourceDirName":"tutorials/smartpy-fa2-fungible","slug":"/tutorials/smartpy-fa2-fungible/basic-fa2-token","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/basic-fa2-token","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1733461200000,"frontMatter":{"title":"Part 1: Setting up a simple FA2 token","authors":"Tim McMackin","last_update":{"date":"6 December 2024"}},"sidebar":"tutorialsSidebar","previous":{"title":"Create a fungible token with the SmartPy FA2 library","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible"},"next":{"title":"Part 2: Adding minting and burning entrypoints","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/minting-and-burning"}}');var s=n(74848),i=n(28453);const o={title:"Part 1: Setting up a simple FA2 token",authors:"Tim McMackin",last_update:{date:"6 December 2024"}},c=void 0,r={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Tutorial contract",id:"tutorial-contract",level:2},{value:"Using the library to create a contract",id:"using-the-library-to-create-a-contract",level:2},{value:"Adding the contract to a test scenario",id:"adding-the-contract-to-a-test-scenario",level:2},{value:"Adding tests",id:"adding-tests",level:2},{value:"Compiling the contract",id:"compiling-the-contract",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"(Optional) Deploy the contract to the Octez client mockup mode",id:"optional-deploy-the-contract-to-the-octez-client-mockup-mode",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["In the first part of this tutorial, you create an FA2 token contact that has only the basic features that the standard requires.\nFor example, the standard does not require the contract to have ",(0,s.jsx)(t.code,{children:"mint"})," and ",(0,s.jsx)(t.code,{children:"burn"})," entrypoints that allow administrators to create and destroy tokens.\nIn this case, you create the contract with all of the tokens that it will ever have."]}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(t.p,{children:"To run this part of the tutorial, makes sure that you have the following tools installed:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://www.python.org/",children:"Python"})," and the ",(0,s.jsx)(t.code,{children:"pip"})," package manager"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://smartpy.io/manual/introduction/installation",children:"SmartPy"})," version 0.20.0 or later; to verify the version of SmartPy you have installed, run ",(0,s.jsx)(t.code,{children:"pip list | grep smartpy"})]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"tutorial-contract",children:"Tutorial contract"}),"\n",(0,s.jsxs)(t.p,{children:["The completed contract that you create in this part is at ",(0,s.jsx)(t.a,{href:"https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_1_complete.py",children:"part_1_complete.py"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"using-the-library-to-create-a-contract",children:"Using the library to create a contract"}),"\n",(0,s.jsx)(t.p,{children:"The FA2 library provides classes that you can extend to create your contract class.\nEach class creates a certain type of token contract:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"main.Nft"}),": Non-fungible tokens, which are unique digital assets"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"main.Fungible"}),": Fungible tokens, which are interchangeable assets, like tez or other cryptocurrencies"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"main.SingleAsset"}),": Single-asset tokens, which are a simplified case of fungible tokens, allowing only one token type per contract"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Follow these steps to create your own token contract based on the ",(0,s.jsx)(t.code,{children:"main.Fungible"})," base class:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Create a Python file with a ",(0,s.jsx)(t.code,{children:".py"})," extension, such as ",(0,s.jsx)(t.code,{children:"fa2_fungible.py"}),", in any text editor."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"In the file, import SmartPy and its FA2 modules:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"import smartpy as sp\nfrom smartpy.templates import fa2_lib as fa2\n\n# Alias the main template for FA2 contracts\nmain = fa2.main\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create a SmartPy module to store your contract class and import the FA2 module:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"@sp.module\ndef my_module():\n    import main\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the module, create a contract class that inherits from the base class and the ",(0,s.jsx)(t.code,{children:"OnchainviewBalanceOf"})," class, which provides an on-chain view that provides token balances:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"class MyFungibleContract(\n    main.Fungible,\n    main.OnchainviewBalanceOf,\n):\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Create the contract's ",(0,s.jsx)(t.code,{children:"__init__()"})," method and initialize the superclasses:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"def __init__(self, contract_metadata, ledger, token_metadata):\n\n    # Initialize on-chain balance view\n    main.OnchainviewBalanceOf.__init__(self)\n\n    # Initialize fungible token base class\n    main.Fungible.__init__(self, contract_metadata, ledger, token_metadata)\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Note the order of these classes both in the ",(0,s.jsx)(t.code,{children:"class"})," statement and within the ",(0,s.jsx)(t.code,{children:"__init__()"})," method.\nYou must inherit and initialize these classes in a specific order for them to work, as described in ",(0,s.jsx)(t.a,{href:"https://smartpy.io/manual/libraries/FA2-lib/mixins",children:"Mixins"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Outside the module, add these two utility functions to call views in the contract:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'def _get_balance(fa2_contract, args):\n    """Utility function to call the contract\'s get_balance view to get an account\'s token balance."""\n    return sp.View(fa2_contract, "get_balance")(args)\n\n\ndef _total_supply(fa2_contract, args):\n    """Utility function to call the contract\'s total_supply view to get the total amount of tokens."""\n    return sp.View(fa2_contract, "total_supply")(args)\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"At this point, the contract looks like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'import smartpy as sp\nfrom smartpy.templates import fa2_lib as fa2\n\n# Alias the main template for FA2 contracts\nmain = fa2.main\n\n@sp.module\ndef my_module():\n    import main\n\n    class MyFungibleContract(\n        main.Fungible,\n        main.OnchainviewBalanceOf,\n    ):\n        def __init__(self, contract_metadata, ledger, token_metadata):\n\n            # Initialize on-chain balance view\n            main.OnchainviewBalanceOf.__init__(self)\n\n            # Initialize fungible token base class\n            main.Fungible.__init__(self, contract_metadata, ledger, token_metadata)\n\n\ndef _get_balance(fa2_contract, args):\n    """Utility function to call the contract\'s get_balance view to get an account\'s token balance."""\n    return sp.View(fa2_contract, "get_balance")(args)\n\n\ndef _total_supply(fa2_contract, args):\n    """Utility function to call the contract\'s total_supply view to get the total amount of tokens."""\n    return sp.View(fa2_contract, "total_supply")(args)\n'})}),"\n",(0,s.jsx)(t.p,{children:"Indentation is significant in Python, so make sure that your contract is indented like this example."}),"\n",(0,s.jsx)(t.p,{children:"This short contract is all of the necessary code for a basic FA2 token contract.\nThe inherited classes provide all of the necessary entrypoints."}),"\n",(0,s.jsx)(t.h2,{id:"adding-the-contract-to-a-test-scenario",children:"Adding the contract to a test scenario"}),"\n",(0,s.jsx)(t.p,{children:"SmartPy provides a testing framework that runs contracts in a realistic simulation called a test scenario.\nThis test scenario is also the way SmartPy compiles contracts to Michelson for deployment, so you must add your contract to a test scenario."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"At the end of the contract file, define a test scenario function with this code:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"@sp.add_test()\ndef test():\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The code within this scenario is ordinary Python, not SmartPy, so you can do all of the things that you can normally do in Python, including importing modules and calling external APIs.\nCode within a SmartPy module (annotated with ",(0,s.jsx)(t.code,{children:"@sp.module"}),") is SmartPy code and is limited by what you can do in smart contracts.\nImporting modules and calling external APIs isn't possible in SmartPy modules, except for the modules that SmartPy provides."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Inside the test scenario function, initialize the test scenario by passing a name for the scenario and the module to use in the scenario to the ",(0,s.jsx)(t.code,{children:"sp.test_scenario"})," function:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'# Create and configure the test scenario\nscenario = sp.test_scenario("fa2_lib_fungible", my_module)\n'})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Define test accounts to use in the scenario with the ",(0,s.jsx)(t.code,{children:"sp.test_account"})," function:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'# Define test accounts\nalice = sp.test_account("Alice")\nbob = sp.test_account("Bob")\n'})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Set up token metadata, which describes the tokens to users.\nFor example, these lines create metadata for two token types, named ",(0,s.jsx)(t.code,{children:"Token Zero"})," and ",(0,s.jsx)(t.code,{children:"Token One"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'# Define initial token metadata\ntok0_md = fa2.make_metadata(name="Token Zero", decimals=0, symbol="Tok0")\ntok1_md = fa2.make_metadata(name="Token One", decimals=0, symbol="Tok1")\n'})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"fa2.make_metadata"})," function creates a token metadata object that complies with the ",(0,s.jsx)(t.a,{href:"https://gitlab.com/tezos/tzip/-/blob/master/proposals/tzip-12/tzip-12.md",children:"TZIP-12"})," standard."]}),"\n",(0,s.jsx)(t.p,{children:"Your contract can have as many types of fungible tokens as you want, but the examples in this tutorial use these two token types.\nThe contract assigns them numeric IDs starting at 0."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create the starting ledger for the contract, which lists the tokens and their owners.\nThis example gives 10 of token 0 to the Alice test account and 10 of token 1 to the Bob test account:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"# Define tokens and initial owners\ninitial_ledger = {\n    (alice.address, 0): 10,\n    (bob.address, 1): 10,\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The type of this ledger is set by the FA2 standard, so casting it to the ",(0,s.jsx)(t.code,{children:"ledger_fungible"})," type helps you make sure that your ledger matches the standard."]}),"\n",(0,s.jsx)(t.p,{children:"The ledger is a big map where the key is a pair of the token owner and token ID and the value is the amount of tokens.\nIn table format, the ledger looks like this:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"key"}),(0,s.jsx)(t.th,{children:"value"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Alice, token ID 0"}),(0,s.jsx)(t.td,{children:"10"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Bob, token ID 1"}),(0,s.jsx)(t.td,{children:"10"})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["You can distribute tokens to any accounts that you want in the test scenario.\nBecause the contract has no ",(0,s.jsx)(t.code,{children:"mint"})," entrypoint, this initial ledger defines all of the tokens and token types that the contract contains."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create an instance of the contract in the test scenario and pass the values for its initial storage:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"# Instantiate the FA2 fungible token contract\ncontract = my_module.MyFungibleContract(sp.big_map(), initial_ledger, [tok0_md, tok1_md])\n"})}),"\n",(0,s.jsxs)(t.p,{children:["These are the parameters for the contract's ",(0,s.jsx)(t.code,{children:"__init__()"})," method:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"The contract metadata, which is blank for now"}),"\n",(0,s.jsx)(t.li,{children:"The initial ledger"}),"\n",(0,s.jsx)(t.li,{children:"The metadata for the token types, in a list"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Add the contract to the test scenario, which deploys (originates) it to the simulated Tezos environment:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"# Originate the contract in the test scenario\nscenario += contract\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"At this point, the contract looks like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'import smartpy as sp\nfrom smartpy.templates import fa2_lib as fa2\n\n# Alias the main template for FA2 contracts\nmain = fa2.main\n\n@sp.module\ndef my_module():\n    import main\n\n    class MyFungibleContract(\n        main.Fungible,\n        main.OnchainviewBalanceOf,\n    ):\n        def __init__(self, contract_metadata, ledger, token_metadata):\n\n            # Initialize on-chain balance view\n            main.OnchainviewBalanceOf.__init__(self)\n\n            # Initialize fungible token base class\n            main.Fungible.__init__(self, contract_metadata, ledger, token_metadata)\n\n\ndef _get_balance(fa2_contract, args):\n    """Utility function to call the contract\'s get_balance view to get an account\'s token balance."""\n    return sp.View(fa2_contract, "get_balance")(args)\n\n\ndef _total_supply(fa2_contract, args):\n    """Utility function to call the contract\'s total_supply view to get the total amount of tokens."""\n    return sp.View(fa2_contract, "total_supply")(args)\n\n\n@sp.add_test()\ndef test():\n    # Create and configure the test scenario\n    scenario = sp.test_scenario("fa2_lib_fungible", my_module)\n\n    # Define test accounts\n    alice = sp.test_account("Alice")\n    bob = sp.test_account("Bob")\n\n    # Define initial token metadata\n    tok0_md = fa2.make_metadata(name="Token Zero", decimals=0, symbol="Tok0")\n    tok1_md = fa2.make_metadata(name="Token One", decimals=0, symbol="Tok1")\n\n    # Define tokens and initial owners\n    initial_ledger = {\n        (alice.address, 0): 10,\n        (bob.address, 1): 10,\n    }\n\n    # Instantiate the FA2 fungible token contract\n    contract = my_module.MyFungibleContract(sp.big_map(), initial_ledger, [tok0_md, tok1_md])\n\n    # Originate the contract in the test scenario\n    scenario += contract\n'})}),"\n",(0,s.jsx)(t.h2,{id:"adding-tests",children:"Adding tests"}),"\n",(0,s.jsx)(t.p,{children:"SmartPy has built-in tools for testing contracts as part of the test scenario.\nIn test scenarios, you can call contract entrypoints, verify the contract storage, and do other things to make sure that the contract is working as expected."}),"\n",(0,s.jsx)(t.p,{children:"Follow these steps to add tests to the contract:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"At the end of the file, add this code to verify the initial state of the ledger:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'scenario.h2("Verify the initial owners of the tokens")\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=0)) == 10\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=0)) == 0\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=1)) == 0\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=1)) == 10\n)\nscenario.verify(_total_supply(contract, sp.record(token_id=0)) == 10)\nscenario.verify(_total_supply(contract, sp.record(token_id=1)) == 10)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["This code uses the ",(0,s.jsx)(t.code,{children:"get_balance_of"})," and ",(0,s.jsx)(t.code,{children:"total_supply"})," views to check the current owners of the tokens and the total amount of tokens when the contract is deployed."]}),"\n",(0,s.jsxs)(t.p,{children:["Note that the calls to these views are within the ",(0,s.jsx)(t.code,{children:"scenario.verify"})," function.\nTo verify details about the deployed contract, you must use this function to access the state of the contract within the test scenario."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Add this code to call the contract's ",(0,s.jsx)(t.code,{children:"transfer"})," entrypoint and verify that the tokens transferred correctly:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:'scenario.h2("Transfer tokens")\n# Bob sends 3 of token 1 to Alice\ncontract.transfer(\n    [\n        sp.record(\n            from_=bob.address,\n            txs=[sp.record(to_=alice.address, amount=3, token_id=1)],\n        ),\n    ],\n    _sender=bob,\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=0)) == 10\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=0)) == 0\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=1)) == 3\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=1)) == 7\n)\nscenario.verify(_total_supply(contract, sp.record(token_id=0)) == 10)\nscenario.verify(_total_supply(contract, sp.record(token_id=1)) == 10)\n\n# Alice sends 4 of token 0 to Bob\ncontract.transfer(\n    [\n        sp.record(\n            from_=alice.address,\n            txs=[sp.record(to_=bob.address, amount=4, token_id=0)],\n        ),\n    ],\n    _sender=alice,\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=0)) == 6\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=0)) == 4\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=1)) == 3\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=1)) == 7\n)\nscenario.verify(_total_supply(contract, sp.record(token_id=0)) == 10)\nscenario.verify(_total_supply(contract, sp.record(token_id=1)) == 10)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["This code calls the transfer entrypoint, passes the transfer information, and adds the ",(0,s.jsx)(t.code,{children:"_sender=bob"})," parameter to indicate that the transfer came from Bob's account.\nThen it calls the contract's views again to verify that the tokens were transferred and that the total supply of tokens remains the same.\nThen it tries again from Alice's account."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Test an entrypoint call that should fail by adding this code:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-smartpy",children:"# Bob cannot transfer Alice's tokens\ncontract.transfer(\n    [\n        sp.record(\n            from_=alice.address,\n            txs=[sp.record(to_=bob.address, amount=1, token_id=0)],\n        ),\n    ],\n    _sender=bob,\n    _valid=False,\n)\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This call should fail because it comes from Bob's account but the call tries to transfer tokens out of Alice's account.\nThe call includes the ",(0,s.jsx)(t.code,{children:"_valid=False"})," parameter to indicate that this call should fail."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"You can add any number of tests to your test scenario.\nIn practice, you should test all features of your contract thoroughly to identify any problems before deployment."}),"\n",(0,s.jsx)(t.h2,{id:"compiling-the-contract",children:"Compiling the contract"}),"\n",(0,s.jsxs)(t.p,{children:["To compile the contract, use the ",(0,s.jsx)(t.code,{children:"python"})," command, just like any other Python file:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"python fa2_fungible.py\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If SmartPy compiles your contract successfully, nothing is printed to the command line output.\nIts compiler writes your contract to a folder with the name in the ",(0,s.jsx)(t.code,{children:"sp.test_scenario"})," function, which is ",(0,s.jsx)(t.code,{children:"fa2_lib_fungible"})," in this example.\nThis folder has many files, including:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"log.txt"}),": A compilation log that lists the steps in the test scenario and connects them to the other files that the compiler created."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"step_003_cont_0_contract.tz"}),": The compiled Michelson contract, which is what you deploy to Tezos in the next section.\nThe compiler also creates a JSON version of the compiled contract."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"step_003_cont_0_storage.tz"}),": The compiled Michelson value of the initial contract storage, based on the parameters you passed when you instantiated the contract in the test scenario.\nThe compiler also creates a JSON and Python version of the storage."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"step_003_cont_0_types.py"}),": The Python types that the contract uses, which can help you call the contract from other SmartPy contracts."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"You can use the compiled contract and storage files to deploy the contract.\nIn the next section, you deploy the contract to a local Tezos sandbox."}),"\n",(0,s.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsxs)(t.p,{children:["If the ",(0,s.jsx)(t.code,{children:"python"})," command shows any errors, make sure that your contract matches the example.\nIn particular, check your indentation, because indentation is significant in Python and SmartPy."]}),"\n",(0,s.jsxs)(t.p,{children:["You can compare your contract with the completed contract here: ",(0,s.jsx)(t.a,{href:"https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_1_complete.py",children:"part_1_complete.py"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"optional-deploy-the-contract-to-the-octez-client-mockup-mode",children:"(Optional) Deploy the contract to the Octez client mockup mode"}),"\n",(0,s.jsx)(t.p,{children:"The Octez client provides a few local sandbox modes that you can use to test contracts without uploading them to a test network or running a local Tezos environment."}),"\n",(0,s.jsx)(t.p,{children:"Follow these steps to set up the Octez client mockup mode and deploy the contract to it:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Install the Octez client by following the steps in ",(0,s.jsx)(t.a,{href:"/developing/octez-client/installing",children:"Installing the Octez client"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Set up the Octez client mockup mode:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Run this command to start mockup mode:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"octez-client \\\n  --protocol ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK \\\n  --base-dir /tmp/mockup \\\n  --mode mockup \\\n  create mockup\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Now you can run commands in mockup mode by prefixing them with ",(0,s.jsx)(t.code,{children:"octez-client --mode mockup --base-dir /tmp/mockup"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create an alias for mockup mode:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"alias mockup-client='octez-client --mode mockup --base-dir /tmp/mockup'\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Now you can run commands in mockup mode with the ",(0,s.jsx)(t.code,{children:"mockup-client"})," alias, as in this example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mockup-client list known addresses\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Deploy the contract to mockup mode:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create two Octez accounts to represent the Alice and Bob accounts in the test scenario:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mockup-client gen keys alice\nmockup-client gen keys bob\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Get the addresses for Alice and Bob by running this command:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mockup-client list known addresses\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Replace the addresses in the initial storage value in the ",(0,s.jsx)(t.code,{children:"step_003_cont_0_storage.tz"})," file with the mockup addresses.\nFor example, the file might look like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-michelson",children:'(Pair {Elt (Pair "tz1Utg2AKcbLgVokY7J8QiCjcfo5KHk3VtHU" 1) 10; Elt (Pair "tz1XeaZgLqgCqMA3Egz5Q7bqiqdFefaNoQd5" 0) 10} (Pair {} (Pair 2 (Pair {} (Pair {Elt 0 10; Elt 1 10} {Elt 0 (Pair 0 {Elt "decimals" 0x30; Elt "name" 0x546f6b656e205a65726f; Elt "symbol" 0x546f6b30}); Elt 1 (Pair 1 {Elt "decimals" 0x30; Elt "name" 0x546f6b656e204f6e65; Elt "symbol" 0x546f6b31})})))))\n'})}),"\n",(0,s.jsx)(t.p,{children:"Now you can use this file as the initial storage value and give the initial tokens to the mockup addresses."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Deploy the contract by passing the compiled contract and initial storage value to the ",(0,s.jsx)(t.code,{children:"originate contract"})," command.\nFor example, if your compiled files are in the ",(0,s.jsx)(t.code,{children:"fa2_lib_fungible"})," folder, the command looks like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'mockup-client originate contract smartpy_fa2_fungible \\\n  transferring 0 from bootstrap1 \\\n  running fa2_lib_fungible/step_003_cont_0_contract.tz \\\n  --init "$(cat fa2_lib_fungible/step_003_cont_0_storage.tz)" --burn-cap 3 --force\n'})}),"\n",(0,s.jsx)(t.p,{children:"If you see errors that refer to unexpected characters, make sure the paths to the files are correct and that you changed only the content of addresses inside quotes in the storage file."}),"\n",(0,s.jsx)(t.p,{children:'If you see the error "Keys in a map literal must be in strictly ascending order, but they were unordered in literal," reverse the order of the two addresses.'}),"\n",(0,s.jsxs)(t.p,{children:["If the deployment succeeds, the Octez client prints the address of the contract and aliases it as ",(0,s.jsx)(t.code,{children:"smartpy_fa2_fungible"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Use the built-in ",(0,s.jsx)(t.code,{children:"get_balance_of"})," view to see the tokens that one of the accounts owns:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mockup-client run view get_balance_of \\\n  on contract smartpy_fa2_fungible \\\n  with input '{Pair \"tz1Utg2AKcbLgVokY7J8QiCjcfo5KHk3VtHU\" 1}'\n"})}),"\n",(0,s.jsx)(t.p,{children:"The response shows a Michelson value that includes the ID and amount of tokens that the address owns, as in this example:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-michelson",children:'{ Pair (Pair "tz1Utg2AKcbLgVokY7J8QiCjcfo5KHk3VtHU" 1) 10 }\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For more information, see ",(0,s.jsx)(t.a,{href:"https://octez.tezos.com/docs/user/mockup.html",children:"Mockup mode"})," in the Octez documentation."]}),"\n",(0,s.jsx)(t.p,{children:"Now you have a basic FA2 fungible token contract that starts with a predefined amount of tokens."}),"\n",(0,s.jsx)(t.p,{children:"In the next part, you add minting and burning functionality to the contract so an administrator can create and destroy tokens."})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var a=n(96540);const s={},i=a.createContext(s);function o(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);