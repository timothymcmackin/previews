"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9940],{95407:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"tutorials/smartpy-fa2-fungible/adding-metadata","title":"Part 3: Adding metadata","description":"In this part, you configure the metadata for the contract.","source":"@site/docs/tutorials/smartpy-fa2-fungible/adding-metadata.md","sourceDirName":"tutorials/smartpy-fa2-fungible","slug":"/tutorials/smartpy-fa2-fungible/adding-metadata","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/adding-metadata","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1715313600000,"frontMatter":{"title":"Part 3: Adding metadata","authors":"Tim McMackin","last_update":{"date":"10 May 2024"}},"sidebar":"tutorialsSidebar","previous":{"title":"Part 2: Adding minting and burning entrypoints","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/minting-and-burning"},"next":{"title":"Part 4: Customizing operations","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/customizing-operations"}}');var i=a(74848),s=a(28453);const o={title:"Part 3: Adding metadata",authors:"Tim McMackin",last_update:{date:"10 May 2024"}},r=void 0,c={},d=[{value:"Storing metadata with IPFS",id:"storing-metadata-with-ipfs",level:2},{value:"Tutorial contract",id:"tutorial-contract",level:2},{value:"Getting a Pinata API key",id:"getting-a-pinata-api-key",level:2},{value:"Uploading metadata",id:"uploading-metadata",level:2}];function l(t){const e={a:"a",code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...t.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"In this part, you configure the metadata for the contract."}),"\n",(0,i.jsx)(e.p,{children:"Contract metadata provides details about the contract itself, including its name, description, and what standards it follows.\nThis information lets off-chain applications like wallets and block explorers show information about the contract.\nContracts can also store other information in metadata, including the code for off-chain views and information about error messages."}),"\n",(0,i.jsx)(e.p,{children:"Contracts that manage tokens also store metadata about those tokens, including descriptions of the tokens and links to preview media."}),"\n",(0,i.jsx)(e.p,{children:"Generally, contracts store their metadata and token metadata off-chain and include only a link to it in their storage.\nStoring the metadata off-chain saves space and makes it easier for off-chain applications to access it."}),"\n",(0,i.jsx)(e.h2,{id:"storing-metadata-with-ipfs",children:"Storing metadata with IPFS"}),"\n",(0,i.jsx)(e.p,{children:"Many contracts store metadata with the InterPlanetary File System (IPFS) protocol.\nThis protocol stores files in a decentralized peer-to-peer network and indexes them by their hash.\nThat way, users can access media by its hash, and the hash allows them to verify that the files have not changed.\nAs long as one IPFS user has a copy of the data, they can re-upload it to IPFS with the same hash so it is seamlessly available again."}),"\n",(0,i.jsxs)(e.p,{children:["Therefore, uploading data to IPFS doesn't mean that it will be available forever; at least one user must keep a copy of it.\nInstructing an IPFS node to keep a copy of a file is called ",(0,i.jsx)(e.em,{children:"pinning"})," the file.\nSmartPy provides a function that uploads data to IPFS via the Pinata service and instructs Pinata to pin it."]}),"\n",(0,i.jsx)(e.h2,{id:"tutorial-contract",children:"Tutorial contract"}),"\n",(0,i.jsxs)(e.p,{children:["The completed contract that you create in this part is at ",(0,i.jsx)(e.a,{href:"https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_3_complete.py",children:"part_3_complete.py"}),"."]}),"\n",(0,i.jsx)(e.h2,{id:"getting-a-pinata-api-key",children:"Getting a Pinata API key"}),"\n",(0,i.jsxs)(e.p,{children:["SmartPy test scenarios can upload files to IPFS with ",(0,i.jsx)(e.a,{href:"https://www.pinata.cloud/",children:"Pinata"}),", so to follow this part of the tutorial, you need a free account on ",(0,i.jsx)(e.a,{href:"https://www.pinata.cloud",children:"https://www.pinata.cloud"})," and an API key."]}),"\n",(0,i.jsx)(e.p,{children:"Follow these steps to create a Pinata API key:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Create a free Pinata account at ",(0,i.jsx)(e.a,{href:"https://app.pinata.cloud/developers/api-keys",children:"https://app.pinata.cloud/developers/api-keys"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Go to the API Keys tab and click ",(0,i.jsx)(e.strong,{children:"New Key"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["On the Create New API Key page, expand API Endpoint Access and enable the ",(0,i.jsx)(e.code,{children:"pinFileToIPFS"})," permission, as in this picture:"]}),"\n",(0,i.jsx)("img",{src:"/img/tutorials/pinata-key-permissions.png",alt:"Selecting the permissions for the Pinata key",style:{width:300}}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["In the ",(0,i.jsx)(e.strong,{children:"Key Name"}),' field, give the key a name, such as "My Key."']}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Click ",(0,i.jsx)(e.strong,{children:"Create Key"}),"."]}),"\n",(0,i.jsx)(e.p,{children:"The API Key Info window shows the API key and secret, which you must copy immediately, because it is not shown again."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Copy the API Key and API Secret fields and save the values on your computer.\nYou need these values in the next section."}),"\n",(0,i.jsx)(e.p,{children:"You can see the new API key on the API Keys tab:"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"The new Pinata API key in the Pinata web app",src:a(71353).A+"",width:"1872",height:"726"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"uploading-metadata",children:"Uploading metadata"}),"\n",(0,i.jsxs)(e.p,{children:["The SmartPy ",(0,i.jsx)(e.code,{children:"sp.pin_on_ipfs"}),' function uploads metadata to IPFS via your Pinata account and "pins" it to ensure that it remains available until you remove it.\nIn this section, you add code to use this function to upload and pin contract metadata to IPFS when the test scenario runs.\nIt is still advisable to save a local copy of your metadata, just as you would with any upload service.']}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["After the code that instantiates the contract in the test scenario, use the ",(0,i.jsx)(e.code,{children:"sp.create_tzip16_metadata"})," function to create a metadata object that is compatible with the ",(0,i.jsx)(e.a,{href:"https://gitlab.com/tezos/tzip/-/blob/master/proposals/tzip-16/tzip-16.md",children:"TZIP-16"})," standard for contract metadata:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:'# Build contract metadata content\ncontract_metadata = sp.create_tzip16_metadata(\n    name="My FA2 fungible token contract",\n    description="This is an FA2 fungible token contract using SmartPy.",\n    version="1.0.0",\n    license_name="CC-BY-SA",\n    license_details="Creative Commons Attribution Share Alike license 4.0 https://creativecommons.org/licenses/by/4.0/",\n    interfaces=["TZIP-012", "TZIP-016"],\n    authors=["SmartPy <https://smartpy.io/#contact>"],\n    homepage="https://smartpy.io/ide?template=fa2_lib_fungible.py",\n    # Optionally, upload the source code to IPFS and add the URI here\n    source_uri=None,\n    offchain_views=contract.get_offchain_views(),\n)\n'})}),"\n",(0,i.jsxs)(e.p,{children:["This code must come after you create the contract but before you add the contract to the scenario because it uses the ",(0,i.jsx)(e.code,{children:"contract.get_offchain_views"})," function to retrieve the contract's off-chain views.\nOff-chain views are stored in metadata, not in the contract code or storage."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Optional: Edit the metadata fields with information about your contract."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Add permission information to the metadata with this code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:'# Add the info specific to FA2 permissions\ncontract_metadata["permissions"] = {\n    # The operator policy chosen:\n    # owner-or-operator-transfer is the default.\n    "operator": "owner-or-operator-transfer",\n    # Those two options should always have these values.\n    # It means that the contract doesn\'t use the hook mechanism.\n    "receiver": "owner-no-hook",\n    "sender": "owner-no-hook",\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["This metadata describes who is allowed to transfer tokens.\nThe permissions in this code allow token owners and operators to transfer tokens.\nFor more information about operators, see ",(0,i.jsx)(e.a,{href:"/architecture/tokens/FA2",children:"FA2 tokens"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Pin the metadata to IPFS and get its URI with this code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:"# Upload the metadata to IPFS and get its URI\nmetadata_uri = sp.pin_on_ipfs(contract_metadata, api_key=None, secret_key=None)\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Update the ",(0,i.jsx)(e.code,{children:"None"})," values in the ",(0,i.jsx)(e.code,{children:"sp.pin_on_ipfs"})," function with your Pinata API key and secret key.\nYou can also put them in the ",(0,i.jsx)(e.code,{children:"PINATA_KEY"})," and ",(0,i.jsx)(e.code,{children:"PINATA_SECRET"})," environment variables and remove the ",(0,i.jsx)(e.code,{children:"api_key"})," and ",(0,i.jsx)(e.code,{children:"secret_key"})," parameters from the function call."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Create the contract metadata and add it to the contract with this code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:"# Create the metadata big map based on the IPFS URI\ncontract_metadata = sp.scenario_utils.metadata_of_url(metadata_uri)\n\n# Update the scenario instance with the new metadata\ncontract.data.metadata = contract_metadata\n"})}),"\n",(0,i.jsx)(e.p,{children:"This code creates a big map that has a single entry that points to the metadata URI."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Run the ",(0,i.jsx)(e.code,{children:"python fa2_fungible.py"})," command to compile and test your contract.\nNow, SmartPy uploads the metadata as part of the compilation process."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:'In your Pinata account, verify that the metadata file uploaded correctly.\nBy default, the file is named "No name set" and looks like this in your Pinata files:'}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"The uploaded file on Pinata",src:a(99980).A+"",width:"1540",height:"270"})}),"\n",(0,i.jsx)(e.p,{children:"You can click this file to see it and verify that the name and description at the top of the file match the name and description of your contract.\nThe rest of the file is the code of off-chain views that the FA2 library adds automatically."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["The completed contract is at ",(0,i.jsx)(e.a,{href:"https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_3_complete.py",children:"part_3_complete.py"}),"."]}),"\n",(0,i.jsx)(e.p,{children:"Now when you deploy the completed contract, wallets and block explorers can show information about it."})]})}function h(t={}){const{wrapper:e}={...(0,s.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(l,{...t})}):l(t)}},71353:(t,e,a)=>{a.d(e,{A:()=>n});const n=a.p+"assets/images/created-pinata-key-83f12d338e45932536b13918123efaf5.png"},99980:(t,e,a)=>{a.d(e,{A:()=>n});const n=a.p+"assets/images/pinata-pinned-file-4676ce1ec636c3baed6ecc1fb93879db.png"},28453:(t,e,a)=>{a.d(e,{R:()=>o,x:()=>r});var n=a(96540);const i={},s=n.createContext(i);function o(t){const e=n.useContext(s);return n.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:o(t.components),n.createElement(s.Provider,{value:e},t.children)}}}]);