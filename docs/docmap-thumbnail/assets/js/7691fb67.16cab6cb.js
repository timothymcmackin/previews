"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9812],{98591:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"tutorials/smartpy-fa2-fungible/minting-and-burning","title":"Part 2: Adding minting and burning entrypoints","description":"In this part, you add entrypoints that allow an administrator account to create tokens and allow users to burn their own tokens.","source":"@site/docs/tutorials/smartpy-fa2-fungible/minting-and-burning.md","sourceDirName":"tutorials/smartpy-fa2-fungible","slug":"/tutorials/smartpy-fa2-fungible/minting-and-burning","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/minting-and-burning","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1713758400000,"frontMatter":{"title":"Part 2: Adding minting and burning entrypoints","authors":"Tim McMackin","last_update":{"date":"22 April 2024"}},"sidebar":"tutorialsSidebar","previous":{"title":"Part 1: Setting up a simple FA2 token","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/basic-fa2-token"},"next":{"title":"Part 3: Adding metadata","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible/adding-metadata"}}');var i=t(74848),s=t(28453);const r={title:"Part 2: Adding minting and burning entrypoints",authors:"Tim McMackin",last_update:{date:"22 April 2024"}},o=void 0,c={},l=[{value:"Tutorial contract",id:"tutorial-contract",level:2},{value:"Adding the admin, mint, and burn entrypoints",id:"adding-the-admin-mint-and-burn-entrypoints",level:2},{value:"(Optional) Test the contract in the Octez client mockup mode",id:"optional-test-the-contract-in-the-octez-client-mockup-mode",level:2}];function d(n){const e={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"In this part, you add entrypoints that allow an administrator account to create tokens and allow users to burn their own tokens."}),"\n",(0,i.jsxs)(e.p,{children:["The SmartPy FA2 library provides ",(0,i.jsx)(e.em,{children:"mixins"})," that add these entrypoints so you don't have to code them yourself.\nMixins are modular classes that add specific pieces of functionality."]}),"\n",(0,i.jsx)(e.h2,{id:"tutorial-contract",children:"Tutorial contract"}),"\n",(0,i.jsxs)(e.p,{children:["The completed contract that you create in this part is at ",(0,i.jsx)(e.a,{href:"https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_2_complete.py",children:"part_2_complete.py"}),"."]}),"\n",(0,i.jsx)(e.h2,{id:"adding-the-admin-mint-and-burn-entrypoints",children:"Adding the admin, mint, and burn entrypoints"}),"\n",(0,i.jsx)(e.p,{children:"To add mint and burn entrypoints to the contract, you need three mixins: the mixins for those two entrypoints and a mixin that enables administrator functionality.\nOnly the admin account can mint tokens, but anyone can burn their own tokens."}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["In the contract, update the ",(0,i.jsx)(e.code,{children:"class"})," statement to include the new mixins:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:"# Order of inheritance: [Admin], [<policy>], <base class>, [<other mixins>].\nclass MyFungibleContract(\n    main.Admin,\n    main.Fungible,\n    main.MintFungible,\n    main.BurnFungible,\n    main.OnchainviewBalanceOf,\n):\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Update the ",(0,i.jsx)(e.code,{children:"__init__()"})," function to accept the admin address and initialize the mixins:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:"def __init__(self, admin_address, contract_metadata, ledger, token_metadata):\n\n    # Initialize on-chain balance view\n    main.OnchainviewBalanceOf.__init__(self)\n\n    # Initialize the fungible token-specific entrypoints\n    main.BurnFungible.__init__(self)\n    main.MintFungible.__init__(self)\n\n    # Initialize fungible token base class\n    main.Fungible.__init__(self, contract_metadata, ledger, token_metadata)\n\n    # Initialize administrative permissions\n    main.Admin.__init__(self, admin_address)\n"})}),"\n",(0,i.jsx)(e.p,{children:"The order that you import and initialize the mixins is significant, so make sure your updates match the code above."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"In the test scenario, add an administrator test account to the existing Alice and Bob test accounts:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:'# Define test accounts\nadmin = sp.test_account("Admin")\nalice = sp.test_account("Alice")\nbob = sp.test_account("Bob")\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Update the command to deploy the contract to include the administrator address:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:"# Instantiate the FA2 fungible token contract\ncontract = my_module.MyFungibleContract(admin.address, sp.big_map(), initial_ledger, [tok0_md, tok1_md])\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"At the end of the test scenario, add a test to verify that the admin account can mint more of an existing token:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:'scenario.h2("Mint tokens")\n\n# Mint more of an existing token\ncontract.mint(\n    [\n        sp.record(to_=alice.address, amount=4, token=sp.variant("existing", 0)),\n        sp.record(to_=bob.address, amount=4, token=sp.variant("existing", 1)),\n    ],\n    _sender=admin,\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=0)) == 10\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=0)) == 4\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=1)) == 3\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=bob.address, token_id=1)) == 11\n)\nscenario.verify(_total_supply(contract, sp.record(token_id=0)) == 14)\nscenario.verify(_total_supply(contract, sp.record(token_id=1)) == 14)\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Add a test to verify that other users can't mint tokens:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:'# Other users can\'t mint tokens\ncontract.mint(\n    [\n        sp.record(to_=alice.address, amount=4, token=sp.variant("existing", 0)),\n    ],\n    _sender=alice,\n    _valid=False\n)\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Add a test to verify that the admin account can create a new token type:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:'# Create a token type\ntok2_md = fa2.make_metadata(name="Token Two", decimals=0, symbol="Tok2")\ncontract.mint(\n    [\n        sp.record(to_=alice.address, amount=5, token=sp.variant("new", tok2_md)),\n    ],\n    _sender=admin,\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=2)) == 5\n)\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Add a test to verify that users can burn their tokens but not other accounts' tokens:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-smartpy",children:"scenario.h2(\"Burn tokens\")\n\n# Verify that you can burn your own token\ncontract.burn([sp.record(token_id=2, from_=alice.address, amount=1)], _sender=alice)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=2)) == 4\n)\n# Verify that you can't burn someone else's token\ncontract.burn(\n    [sp.record(token_id=2, from_=alice.address, amount=1)],\n    _sender=bob,\n    _valid=False,\n)\nscenario.verify(\n    _get_balance(contract, sp.record(owner=alice.address, token_id=2)) == 4\n)\nscenario.verify(\n    _total_supply(contract, sp.record(token_id=2)) == 4\n)\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Run the ",(0,i.jsx)(e.code,{children:"python fa2_fungible.py"})," command to compile and test your contract.\nIf you see any errors, make sure that your code matches the code above or compare with the completed contract here: ",(0,i.jsx)(e.a,{href:"https://github.com/trilitech/tutorial-applications/blob/main/smartpy_fa2_fungible/part_2_complete.py",children:"part_2_complete.py"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["Note that there are many more output files in the ",(0,i.jsx)(e.code,{children:"fa2_lib_fungible"})," folder.\nThe SmartPy compiler creates output files for each call to an entrypoint in the test scenario.\nYou can use these files to verify that the scenario is testing the contract properly."]}),"\n",(0,i.jsx)(e.p,{children:"You can also use these files as precompiled parameters for contract calls, as shown in the next section."}),"\n",(0,i.jsx)(e.h2,{id:"optional-test-the-contract-in-the-octez-client-mockup-mode",children:"(Optional) Test the contract in the Octez client mockup mode"}),"\n",(0,i.jsx)(e.p,{children:"You can test the mint and burn entrypoints in mockup mode, but you must be sure to deploy the contract with an address that you can use as the administrator, as described in these steps:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Get the address of one of the existing bootstrap accounts in the mockup by running this command:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"mockup-client list known addresses\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Replace the first address in the initial storage value in the ",(0,i.jsx)(e.code,{children:"step_003_cont_0_storage.tz"})," file with the bootstrap account address.\nFor example, the file might look like this, with ",(0,i.jsx)(e.code,{children:"tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx"})," as the bootstrap account:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-michelson",children:'(Pair "tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx" (Pair {Elt (Pair "tz1Rp4Bv8iUhYnNoCryHQgNzN2D7i3L1LF9C" 1) 10; Elt (Pair "tz1WxrQuZ4CK1MBUa2GqUWK1yJ4J6EtG1Gwi" 0) 10} (Pair {} (Pair 2 (Pair {} (Pair {Elt 0 10; Elt 1 10} {Elt 0 (Pair 0 {Elt "decimals" 0x30; Elt "name" 0x546f6b656e205a65726f; Elt "symbol" 0x546f6b30}); Elt 1 (Pair 1 {Elt "decimals" 0x30; Elt "name" 0x546f6b656e204f6e65; Elt "symbol" 0x546f6b31})}))))))\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Deploy the contract by running this command:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'mockup-client originate contract smartpy_fa2_fungible \\\n  transferring 0 from bootstrap1 \\\n  running fa2_lib_fungible/step_003_cont_0_contract.tz \\\n  --init "$(cat fa2_lib_fungible/step_003_cont_0_storage.tz)" --burn-cap 3 --force\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Mint more of an existing token by following these steps:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Open the file ",(0,i.jsx)(e.code,{children:"fa2_lib_fungible/log.txt"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Find the output file that shows the parameters for the call to the ",(0,i.jsx)(e.code,{children:"mint"})," entrypoint.\nFor example, this logging information shows that the parameters are in the file ",(0,i.jsx)(e.code,{children:"fa2_lib_fungible/step_028_cont_0_params.tz"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"h2: Mint tokens\nfile fa2_lib_fungible/step_028_cont_0_params.py\nfile fa2_lib_fungible/step_028_cont_0_params.tz\nfile fa2_lib_fungible/step_028_cont_0_params.json\nExecuting mint([sp.record(to_ = sp.address('tz1WxrQuZ4CK1MBUa2GqUWK1yJ4J6EtG1Gwi'), token = existing(0), amount = 4), sp.record(to_ = sp.address('tz1Rp4Bv8iUhYnNoCryHQgNzN2D7i3L1LF9C'), token = existing(1), amount = 4)])...\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Use that output file as the parameter for a call to the ",(0,i.jsx)(e.code,{children:"mint"})," entrypoint.\nFor example, this command uses the file ",(0,i.jsx)(e.code,{children:"fa2_lib_fungible/step_028_cont_0_params.tz"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'mockup-client --wait none transfer 0 \\\n  from bootstrap1 to smartpy_fa2_fungible --entrypoint "mint" \\\n  --arg "$(cat fa2_lib_fungible/step_028_cont_0_params.tz)" --burn-cap 2\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Run this command to use the ",(0,i.jsx)(e.code,{children:"get_balance_of"})," view to see that the tokens have been minted and added to the account:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"mockup-client run view get_balance_of on contract smartpy_fa2_fungible with input '{Pair \"tz1WxrQuZ4CK1MBUa2GqUWK1yJ4J6EtG1Gwi\" 0}'\n"})}),"\n",(0,i.jsx)(e.p,{children:"The response shows that the account now has 14 of token type 0:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-michelson",children:'{ Pair (Pair "tz1WxrQuZ4CK1MBUa2GqUWK1yJ4J6EtG1Gwi" 0) 14 }\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Now you have an FA2 token contract with minting and burning functionality.\nIn the next part, you add metadata to provide information about the contract and its tokens to apps such as wallets."})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>o});var a=t(96540);const i={},s=a.createContext(i);function r(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),a.createElement(s.Provider,{value:e},n.children)}}}]);