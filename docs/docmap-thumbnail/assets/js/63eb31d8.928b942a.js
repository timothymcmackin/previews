"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8363],{89742:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"tutorials/build-your-first-app/getting-information","title":"Part 4: Getting information","description":"In this section, you improve the user experience of the application by providing information from Tezos on the page.","source":"@site/docs/tutorials/build-your-first-app/getting-information.md","sourceDirName":"tutorials/build-your-first-app","slug":"/tutorials/build-your-first-app/getting-information","permalink":"/previews/docs/docmap-thumbnail/tutorials/build-your-first-app/getting-information","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1697515200000,"frontMatter":{"title":"Part 4: Getting information","authors":"Tim McMackin","last_update":{"date":"17 October 2023"}},"sidebar":"tutorialsSidebar","previous":{"title":"Part 3: Sending transactions","permalink":"/previews/docs/docmap-thumbnail/tutorials/build-your-first-app/sending-transactions"},"next":{"title":"Create a fungible token with the SmartPy FA2 library","permalink":"/previews/docs/docmap-thumbnail/tutorials/smartpy-fa2-fungible"}}');var s=a(74848),o=a(28453);const i={title:"Part 4: Getting information",authors:"Tim McMackin",last_update:{date:"17 October 2023"}},r=void 0,c={},l=[{value:"Accessing the contract storage",id:"accessing-the-contract-storage",level:2},{value:"Summary",id:"summary",level:2}];function h(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"In this section, you improve the user experience of the application by providing information from Tezos on the page.\nSpecifically, you show the amount of tez that the user has stored in the smart contract and that is available to withdraw."}),"\n",(0,s.jsx)(t.p,{children:"Your app can do this because information on Tezos is public, including the code of smart contracts and their data storage."}),"\n",(0,s.jsx)(t.p,{children:"In this case, the contract's storage is a data type called a big-map.\nIt maps account addresses with a number that indicates the amount of tez that address has deposited.\nYour app can query that amount by getting the contract's storage and looking up the value for the user's account."}),"\n",(0,s.jsx)(t.p,{children:"You can look up the storage manually by going to a block explorer and going to the Storage tab.\nFor example, Better Call Dev shows the storage for this contract like this:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"The block explorer, showing the storage for the contract in one big-map object",src:a(69985).A+"",width:"428",height:"245"})}),"\n",(0,s.jsx)(t.p,{children:"You can expand the big-map object and search for the record that is related to your account address to see how much tez you have deposited."}),"\n",(0,s.jsx)(t.h2,{id:"accessing-the-contract-storage",children:"Accessing the contract storage"}),"\n",(0,s.jsx)(t.p,{children:"Your application can use the Taquito library to access the storage for the contract and look up the user's balance in the contract:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"App.svelte"})," file, in the ",(0,s.jsx)(t.code,{children:"<script>"})," section, add a ",(0,s.jsx)(t.code,{children:"bankBalance"})," variable to represent the user's balance in the contract:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"let bankBalance;\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Add a function to access the contract's storage and get the user's balance:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const getBankBalance = async (walletAddress) => {\n  const contract = await Tezos.wallet.at(contractAddress);\n  const storage = await contract.storage();\n  const balanceMutez = await storage.get(walletAddress);\n  bankBalance = isNaN(balanceMutez) ? 0 : balanceMutez / 1000000;\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Like the ",(0,s.jsx)(t.code,{children:"deposit"})," and ",(0,s.jsx)(t.code,{children:"withdraw"})," functions, this function creates an object that represents the contract.\nThen it retrieves the contract's storage.,\nIn this case, the contract's storage is a ",(0,s.jsx)(t.a,{href:"/smart-contracts/data-types/complex-data-types#big-maps",children:"big-map"}),", so Taquito represents it as a ",(0,s.jsx)(t.code,{children:"BigMapAbstraction"})," object and the application uses the ",(0,s.jsx)(t.code,{children:"get"})," method to look up a value from it.\nIf it does not find a value, it sets the user's balance to 0.\nIf it finds a value, it divides by 1 million because the contract stores values in mutez, which is 1 millionth of a tez."]}),"\n",(0,s.jsxs)(t.p,{children:["Your IDE may show an error on the ",(0,s.jsx)(t.code,{children:"get"})," method because it is not aware of the data type of the storage and that it has this method.\nYou can ignore this error."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Call the ",(0,s.jsx)(t.code,{children:"getBankBalance"})," function at the end of the ",(0,s.jsx)(t.code,{children:"deposit"}),", ",(0,s.jsx)(t.code,{children:"withdraw"}),", and ",(0,s.jsx)(t.code,{children:"connectWallet"})," functions by adding this line of code to each:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"await getBankBalance(address);\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"<main>"})," section, after the line that shows the wallet balance in tez, add this code to show the bank balance:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-html",children:"<p>Its balance in the bank is {bankBalance}.</p>\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Open the application in a web browser, connect your wallet again, and see your balance in the contract.\nYou can run deposits and withdrawals and see the amount change.\nIf the amount does not change, make sure that you call the ",(0,s.jsx)(t.code,{children:"getBankBalance"})," function after each transaction."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"For example, this image shows the bank balance at 18 tez:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"The completed application with a connected wallet and a bank balance of 18 tez",src:a(93125).A+"",width:"455",height:"322"})}),"\n",(0,s.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(t.p,{children:"Now you have an application that can:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Connect to wallets"}),"\n",(0,s.jsx)(t.li,{children:"Send transactions to Tezos"}),"\n",(0,s.jsx)(t.li,{children:"Retrieve information about Tezos"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The code for the completed application is in this GitHub repository: ",(0,s.jsx)(t.a,{href:"https://github.com/trilitech/tutorial-applications/tree/main/bank-tutorial",children:"https://github.com/trilitech/tutorial-applications/tree/main/bank-tutorial"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"If you want to continue with the application, you can try creating a better UI.\nHere are some ideas:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Prevent the user from selecting more tez to deposit than the wallet balance."}),"\n",(0,s.jsxs)(t.li,{children:["Use the Taquito ",(0,s.jsx)(t.a,{href:"https://tezostaquito.io/docs/transaction_limits",children:(0,s.jsx)(t.code,{children:"estimate"})})," function to get an estimate of the fees for the transaction instead of hard-coding them."]}),"\n",(0,s.jsx)(t.li,{children:"Show toasts or messages on the page to notify the user when transactions complete."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["You can also deploy your own smart contracts to use from your applications.\nFor a tutorial on deploying a simple smart contract, see ",(0,s.jsx)(t.a,{href:"/tutorials/smart-contract",children:"Deploy a smart contract"}),"."]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},69985:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/bank-app-block-explorer-storage-2bae6095996414099df6c617b2a95b1b.png"},93125:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/bank-app-complete-734fbf76e00ac11a5815725a69c0c2cd.png"},28453:(e,t,a)=>{a.d(t,{R:()=>i,x:()=>r});var n=a(96540);const s={},o=n.createContext(s);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);