"use strict";(self.webpackChunktezos_developer_docs=self.webpackChunktezos_developer_docs||[]).push([[3901],{80874:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"smart-contracts/logic/errors","title":"Handling errors","description":"Unlike in many programming languages, there is no exception management on Tezos.","source":"@site/docs/smart-contracts/logic/errors.md","sourceDirName":"smart-contracts/logic","slug":"/smart-contracts/logic/errors","permalink":"/previews/docs/ledger/smart-contracts/logic/errors","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1696478400000,"frontMatter":{"title":"Handling errors","authors":"Mathias Hiron (Nomadic Labs), Sasha Aldrick (TriliTech), Tim McMackin (TriliTech)","last_update":{"date":"5 October 2023"}},"sidebar":"documentationSidebar","previous":{"title":"Operations","permalink":"/previews/docs/ledger/smart-contracts/logic/operations"},"next":{"title":"Creating smart contracts","permalink":"/previews/docs/ledger/smart-contracts/creating"}}');var a=t(74848),i=t(28453);const s={title:"Handling errors",authors:"Mathias Hiron (Nomadic Labs), Sasha Aldrick (TriliTech), Tim McMackin (TriliTech)",last_update:{date:"5 October 2023"}},o=void 0,l={},c=[{value:"What happens after a failure?",id:"what-happens-after-a-failure",level:2},{value:"Automatic failures",id:"automatic-failures",level:2},{value:"Raising failures",id:"raising-failures",level:2},{value:"Error values",id:"error-values",level:2},{value:"Implementation details",id:"implementation-details",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Unlike in many programming languages, there is no exception management on Tezos.\nMore precisely, there is no way to catch or intercept problems and trigger some alternate behavior when problems happen."}),"\n",(0,a.jsxs)(n.p,{children:["Instead, Tezos uses ",(0,a.jsx)(n.em,{children:"failures"}),", which immediately cancel operations.\nWhen code introduces a failure, all of the operations are canceled and any completed operations are reverted, as if the initial call to the contract never happened.\nTo reduce the risk of bugs, there is no way to catch or prevent a failure after code introduces it."]}),"\n",(0,a.jsx)(n.h2,{id:"what-happens-after-a-failure",children:"What happens after a failure?"}),"\n",(0,a.jsx)(n.p,{children:"On Tezos, a failure causes several things to happen:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The execution of the contract is immediately stopped and all of its potential effects are cancelled."}),"\n",(0,a.jsx)(n.li,{children:"All prior effects of the contract are reverted, as if they never happened, like a database rollback."}),"\n",(0,a.jsx)(n.li,{children:"Any changes to the storage are reverted."}),"\n",(0,a.jsx)(n.li,{children:"The contract's balance is restored to what it was before execution started."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Furthermore, if the contract was called by another contract, or if it generated a call to another contract, all of these operations are cancelled as well.\nThe entire execution of everything, from the initial contract call by a user to the failure, is undone."}),"\n",(0,a.jsx)(n.p,{children:"This is a double-edged sword that you must keep in mind when designing a contract:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"positive impact"}),": If something doesn't happen as intended and a single failure happens somewhere during a contract call or subsequent calls it produces, nothing at all happens, and you don't end up in an inconsistent state corresponding to a partial execution."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"negative impact"}),": It takes only one small issue in one of the contracts called as a consequence of your initial call for everything that you wanted to happen to be undone.\nIn some cases, this can mean that your contract becomes unusable."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"automatic-failures",children:"Automatic failures"}),"\n",(0,a.jsx)(n.p,{children:"Some instructions automatically cause a failure.\nHere are a few examples:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Causing an overflow on a ",(0,a.jsx)(n.code,{children:"mutez"})," type, such as when adding or multiplying"]}),"\n",(0,a.jsxs)(n.li,{children:["Trying to do a bitwise left shift or right shift of a ",(0,a.jsx)(n.code,{children:"nat"})," type by more than 256"]}),"\n",(0,a.jsx)(n.li,{children:"Generating a transaction where the amount of tez transferred is greater than the balance of the contract that creates the transaction"}),"\n",(0,a.jsx)(n.li,{children:"Generating a transaction for an address that doesn't exist"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["There aren't too many of these cases, as most instructions that could cause an error use options as their return values, which allows (and also forces) you to explicitly handle the error case.\nFor example, integer division (",(0,a.jsx)(n.code,{children:"EDIV"}),") returns an option; if the division is successful, it returns ",(0,a.jsx)(n.code,{children:"Some"})," and if the code tried to divide by zero, it returns ",(0,a.jsx)(n.code,{children:"None"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"raising-failures",children:"Raising failures"}),"\n",(0,a.jsx)(n.p,{children:"If your code encounters a problem, you can raise a failure.\nThe failure includes an error value that can help users or tools of a contract understand what went wrong.\nSee the documentation for your language for how to raise a failure."}),"\n",(0,a.jsx)(n.h2,{id:"error-values",children:"Error values"}),"\n",(0,a.jsx)(n.p,{children:"The error value is meant to be used off-chain as information to identify the cause of the error.\nNothing can be done with it on-chain, because nothing at all happens on-chain when an error is produced."}),"\n",(0,a.jsxs)(n.p,{children:["The typical error value is a string with an error message, such as ",(0,a.jsx)(n.code,{children:"Error: deadline has expired"}),".\nInternally, all kinds of error values can be produced, such as integers or records.\nThe types supported depend on the language."]}),"\n",(0,a.jsx)(n.p,{children:"In particular, the error value is often used when testing  contracts, where the test verifies that a specific invalid call produces a specific error."}),"\n",(0,a.jsx)(n.h2,{id:"implementation-details",children:"Implementation details"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Michelson:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://tezos.gitlab.io/active/michelson.html#failures",children:"Failures"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://tezos.gitlab.io/active/michelson.html#control-structures",children:"Control structures"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://tezos.gitlab.io/active/michelson.html#fail",children:"FAIL"})}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://tezos.gitlab.io/active/michelson.html#assertion-macros",children:"Assertion macros"}),","]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Archetype: ",(0,a.jsx)(n.a,{href:"https://archetype-lang.org/docs/reference/declarations/entrypoint/#require",children:"require"}),", ",(0,a.jsx)(n.a,{href:"https://archetype-lang.org/docs/reference/declarations/entrypoint/#fail-if",children:"fail if"})]}),"\n",(0,a.jsxs)(n.li,{children:["SmartPy: ",(0,a.jsx)(n.a,{href:"https://smartpy.io/manual/scenarios/testing_contracts#exceptions",children:"Exceptions"})]}),"\n",(0,a.jsxs)(n.li,{children:["LIGO: ",(0,a.jsx)(n.a,{href:"https://ligolang.org/docs/language-basics/exceptions",children:"Exceptions"})]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(96540);const a={},i=r.createContext(a);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);