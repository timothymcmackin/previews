"use strict";(self.webpackChunktezos_developer_docs=self.webpackChunktezos_developer_docs||[]).push([[3436],{47836:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"tutorials/join-dal-baker/run-dal-node","title":"Step 3: Run an Octez DAL node","description":"The DAL node is responsible for temporarily storing data and providing it to bakers and Smart Rollups.","source":"@site/docs/tutorials/join-dal-baker/run-dal-node.md","sourceDirName":"tutorials/join-dal-baker","slug":"/tutorials/join-dal-baker/run-dal-node","permalink":"/previews/docs/ledger/tutorials/join-dal-baker/run-dal-node","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1736398800000,"frontMatter":{"title":"Step 3: Run an Octez DAL node","authors":"Tezos core developers, Tim McMackin","last_update":{"date":"9 January 2025"}},"sidebar":"tutorialsSidebar","previous":{"title":"Step 2: Set up baker accounts","permalink":"/previews/docs/ledger/tutorials/join-dal-baker/prepare-account"},"next":{"title":"Step 4: Run an Octez baking daemon","permalink":"/previews/docs/ledger/tutorials/join-dal-baker/run-baker"}}');var s=t(74848),r=t(28453);const i={title:"Step 3: Run an Octez DAL node",authors:"Tezos core developers, Tim McMackin",last_update:{date:"9 January 2025"}},a=void 0,d={},l=[];function c(e){const n={a:"a",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The DAL node is responsible for temporarily storing data and providing it to bakers and Smart Rollups.\nAs described in ",(0,s.jsx)(n.a,{href:"/tutorials/join-dal-baker",children:"Run a Tezos node in 5 steps"}),", bakers are not currently required to run a DAL node but DAL nodes are important for the scalability and bandwidth of Tezos."]}),"\n",(0,s.jsx)(n.p,{children:"Follow these steps to run the DAL node:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Ensure that the port on which the DAL node listens for connections from peer nodes (by default, 11732) is accessible from outside its system.\nYou may need to adapt your firewall rules or set up network address translation (NAT) to direct external traffic to the DAL node.\nFor more information, see ",(0,s.jsx)(n.a,{href:"https://tezos.gitlab.io/shell/dal_run.html",children:"Running a DAL attester node"})," in the Octez documentation."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Initialize the DAL node by running its ",(0,s.jsx)(n.code,{children:"config init"})," command, passing the address of your ",(0,s.jsx)(n.code,{children:"octez-node"})," instance in the ",(0,s.jsx)(n.code,{children:"--endpoint"})," argument and your baker's account address in the ",(0,s.jsx)(n.code,{children:"--attester-profiles"})," argument.\nFor example, this command initializes the DAL node with the address of a local ",(0,s.jsx)(n.code,{children:"octez-node"})," instance on port 8732 and stores data in the default DAL node directory (",(0,s.jsx)(n.code,{children:"~/.tezos-dal-node"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"octez-dal-node config init --endpoint http://127.0.0.1:8732 \\\n  --attester-profiles=tz1...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You cannot use the ",(0,s.jsx)(n.code,{children:"my_baker"})," alias from the Octez client as in the previous section, so you must specify the address of your baker's account explicitly."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start the DAL node by running this command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"octez-dal-node run\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You may append ",(0,s.jsx)(n.code,{children:'>>"$HOME/octez-dal-node.log" 2>&1'})," to redirect its output in a log file."]}),"\n",(0,s.jsx)(n.p,{children:"This, too, may take some time to launch the first time because it needs to generate a new identity file, this time for the DAL network."}),"\n",(0,s.jsxs)(n.p,{children:["If you need to change the address or port that the DAL node listens for connections to other nodes on, pass the ",(0,s.jsx)(n.code,{children:"--public-addr"})," argument.\nBy default, it listens on port 11732 on all available network interfaces, equivalent to ",(0,s.jsx)(n.code,{children:"--public-addr 0.0.0.0:11732"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Verify that the DAL node is connected to the DAL network by running this command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:10732/p2p/points/info\n"})}),"\n",(0,s.jsxs)(n.p,{children:["where ",(0,s.jsx)(n.code,{children:"10732"})," is the default port on which the DAL node serves RPC calls.\nYou can override it with the ",(0,s.jsx)(n.code,{children:"--rpc-addr"})," argument."]}),"\n",(0,s.jsxs)(n.p,{children:["You may need to install the ",(0,s.jsx)(n.code,{children:"curl"})," program."]}),"\n",(0,s.jsx)(n.p,{children:"The response lists the network connections that the DAL node has, as in this example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "point": "46.137.127.32:11732",\n    "info": {\n      "trusted": true,\n      "state": {\n        "event_kind": "running",\n        "p2p_peer_id": "idrpUzezw7VJ4NU6phQYuxh88RiU1t"\n      },\n      "p2p_peer_id": "idrpUzezw7VJ4NU6phQYuxh88RiU1t",\n      "last_established_connection": [\n        "idrpUzezw7VJ4NU6phQYuxh88RiU1t",\n        "2024-10-24T15:02:31.549-00:00"\n      ],\n      "last_seen": [\n        "idrpUzezw7VJ4NU6phQYuxh88RiU1t",\n        "2024-10-24T15:02:31.549-00:00"\n      ]\n    }\n  },\n  {\n    "point": "52.31.26.230:11732",\n    "info": {\n      "trusted": true,\n      "state": {\n        "event_kind": "running",\n        "p2p_peer_id": "idqrcQybXbKwWk42bn1XjeZ33xgduC"\n      },\n      "p2p_peer_id": "idqrcQybXbKwWk42bn1XjeZ33xgduC",\n      "last_established_connection": [\n        "idqrcQybXbKwWk42bn1XjeZ33xgduC",\n        "2024-10-24T15:02:31.666-00:00"\n      ],\n      "last_seen": [\n        "idqrcQybXbKwWk42bn1XjeZ33xgduC",\n        "2024-10-24T15:02:31.666-00:00"\n      ]\n    }\n  }\n]\n'})}),"\n",(0,s.jsx)(n.p,{children:"It may take a few minutes for the node to connect to the DAL network."}),"\n",(0,s.jsx)(n.p,{children:"You can also verify that the DAL node is connected by viewing its log.\nWhen the node is bootstrapped it logs messages that look like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Aug 12 17:44:19.985: started tracking layer 1's node\nAug 12 17:44:24.418: layer 1 node's block at level 7538687, round 0 is final\nAug 12 17:44:29.328: layer 1 node's block at level 7538688, round 0 is final\n"})}),"\n",(0,s.jsx)(n.p,{children:"The DAL node waits for blocks to be finalized, so this log lags 2 blocks behind the layer 1 node's log."}),"\n",(0,s.jsx)(n.p,{children:"Now the DAL node is connected to the DAL network but it is not yet receiving data."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Ensure that the DAL node runs persistently.\nLook up how to run programs persistently in the documentation for your operating system.\nYou can also refer to ",(0,s.jsx)(n.a,{href:"https://tezos.gitlab.io/introduction/services.html",children:"Setting up Octez Services"})," in the Octez documentation."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, if your operating system uses the ",(0,s.jsx)(n.code,{children:"systemd"})," software suite, your service file might look like this example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-systemd",children:"[Unit]\nDescription=Octez DAL node\nWants=network-online.target\nAfter=network-online.target\nRequires=octez-node.service\n\n[Install]\nWantedBy=multi-user.target\nRequiredBy=octez-baker.service\n\n[Service]\nType=simple\nUser=tezos\nExecStart=/usr/bin/octez-dal-node run --data-dir $HOME/.tezos-dal-node\nWorkingDirectory=$HOME/.tezos-dal-node\nRestart=on-failure\nRestartSec=5\nStandardOutput=append:/opt/octez-dal-node.log\nStandardError=append:/opt/octez-dal-node.log\nSyslogIdentifier=%n\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Now that you have a DAL node running, you can start a baking daemon that uses that DAL node.\nContinue to ",(0,s.jsx)(n.a,{href:"/tutorials/join-dal-baker/run-baker",children:"Step 4: Run an Octez baking daemon"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(96540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);