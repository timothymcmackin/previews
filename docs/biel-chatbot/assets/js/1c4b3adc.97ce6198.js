"use strict";(self.webpackChunktezos_developer_docs=self.webpackChunktezos_developer_docs||[]).push([[1998],{18367:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"developing/testing","title":"Testing locally","description":"Tezos smart contracts are immutable after deployment, so you must rigorously test them before deploying them to ensure functionality, prevent errors, and avoid potential financial losses. Importantly, contract testing doesn\'t require any tokens or a wallet account to execute.","source":"@site/docs/developing/testing.md","sourceDirName":"developing","slug":"/developing/testing","permalink":"/previews/docs/biel-chatbot/developing/testing","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1705986000000,"frontMatter":{"title":"Testing locally","authors":"Yuxin Li","last_update":{"date":"23 January 2024"}},"sidebar":"documentationSidebar","previous":{"title":"Installing and funding a wallet","permalink":"/previews/docs/biel-chatbot/developing/wallet-setup"},"next":{"title":"Testing on testnets","permalink":"/previews/docs/biel-chatbot/developing/testnets"}}');var a=n(74848),i=n(28453);const o={title:"Testing locally",authors:"Yuxin Li",last_update:{date:"23 January 2024"}},l=void 0,r={},c=[{value:"Tools for local testing",id:"tools-for-local-testing",level:2},{value:"Testing in high-level languages",id:"testing-in-high-level-languages",level:2},{value:"Structure of a test scenario",id:"structure-of-a-test-scenario",level:2},{value:"Programming languages for testing",id:"programming-languages-for-testing",level:2},{value:"Rules for testing",id:"rules-for-testing",level:2},{value:"Implementation details",id:"implementation-details",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"Tezos smart contracts are immutable after deployment, so you must rigorously test them before deploying them to ensure functionality, prevent errors, and avoid potential financial losses. Importantly, contract testing doesn't require any tokens or a wallet account to execute."}),"\n",(0,a.jsx)(t.h2,{id:"tools-for-local-testing",children:"Tools for local testing"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"The Michelson interpreter is an OCaml function that can be used by tools to simulate a call to any entry point of any smart contract, given an initial value of the storage and parameters. Some programming languages like LIGO or SmartPy use this as part of their testing frameworks."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["The mockup mode of ",(0,a.jsx)(t.code,{children:"octez-client"})," can be used to test contract calls and other features such as some RPC calls, all without running an actual node, saving the time of going through the consensus mechanism and waiting to get blocks created and validated. Tools like Completium, built by the team behind the Archetype language, use this for their testing framework. Find out more in the ",(0,a.jsx)(t.a,{href:"https://tezos.gitlab.io/user/mockup.html",children:"documentation of the mockup mode"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["For example, when you compile the contract in the tutorial ",(0,a.jsx)(t.a,{href:"/tutorials/smart-contract",children:"Create a smart contract"})," to Michelson, its first line defines the parameter type that the contract accepts:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"parameter (or (unit %reset) (or (int %decrement) (int %increment)))\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can call this contract in mockup mode by passing the compiled contract file, the storage value as a Michelson expression, and the parameter value to pass as a Michelson expression.\nFor example, this command sets the storage to 4 and passes 5 to the ",(0,a.jsx)(t.code,{children:"Increment"})," entrypoint:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'octez-client --mode mockup run script Counter.tz on storage 4 and input "(Right (Right 5))"\n'})}),"\n",(0,a.jsx)(t.p,{children:"The response in the console shows the new value of the storage and any operations emitted."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"testing-in-high-level-languages",children:"Testing in high-level languages"}),"\n",(0,a.jsxs)(t.p,{children:["High-level languages come with tools to help write tests locally, and some testing tools can be used independently of the language used to write the smart contract.\nFor example, ",(0,a.jsx)(t.a,{href:"https://smartpy.io/manual/scenarios/overview",children:"SmartPy"})," includes syntax dedicated to testing."]}),"\n",(0,a.jsx)(t.p,{children:"The following SmartPy test code snippet is for a Tezos smart contract that acts like a calculator. The code defines a series of tests to check the functionality of the calculator contract."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'if "templates" not in __name__:\n\n    @sp.add_test()\n    def test():\n        c1 = main.Calculator()\n        scenario = sp.test_scenario("Calculator")\n        scenario.h1("Calculator")\n        scenario += c1\n        c1.multiply(x=2, y=5)\n        c1.add(x=2, y=5)\n        c1.add(x=2, y=5)\n        c1.square(12)\n        c1.squareRoot(0)\n        c1.squareRoot(1234)\n        c1.factorial(100)\n        c1.log2(c1.data.result)\n        scenario.verify(c1.data.result == 524)\n'})}),"\n",(0,a.jsx)(t.p,{children:"The test scenario runs these operations sequentially and would check if all operations execute as expected and if the final result matches the expected value."}),"\n",(0,a.jsx)(t.h2,{id:"structure-of-a-test-scenario",children:"Structure of a test scenario"}),"\n",(0,a.jsx)(t.p,{children:"A test scenario usually consists of the following steps:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Decide the smart contract's initial storage and ",(0,a.jsx)(t.code,{children:"balance"})]}),"\n",(0,a.jsxs)(t.li,{children:["Valid calls to entrypoints, with different parameters and context information such as:","\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["the address of the ",(0,a.jsx)(t.code,{children:"caller"})]}),"\n",(0,a.jsxs)(t.li,{children:["the amount of ",(0,a.jsx)(t.code,{children:"tez"})," sent"]}),"\n",(0,a.jsxs)(t.li,{children:["the ",(0,a.jsx)(t.code,{children:"timestamp"})," of the block (value of ",(0,a.jsx)(t.code,{children:"now"})," during the call)"]}),"\n",(0,a.jsxs)(t.li,{children:["the ",(0,a.jsx)(t.code,{children:"level"})," of the block"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["Verify the contract's storage or ",(0,a.jsx)(t.code,{children:"balance"})," changed the way you expected."]}),"\n",(0,a.jsx)(t.li,{children:"Invalid calls to entrypoints, and they are expected to fail."}),"\n",(0,a.jsx)(t.li,{children:"Verification of the error caused by these invalid calls, making sure the error messages are the ones you thought would come up."}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"When executed, the test scenario is successful if all verifications are correct, and all invalid calls fail with the expected errors."}),"\n",(0,a.jsx)(t.p,{children:"More advanced scenarios may involve a local sandbox deployment and calls to multiple contracts to test interactions."}),"\n",(0,a.jsx)(t.h2,{id:"programming-languages-for-testing",children:"Programming languages for testing"}),"\n",(0,a.jsx)(t.p,{children:"The test scenarios are usually written using a full classical programming language, such as JavaScript or Python, with a library that gives you access to special features to:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Deploy contracts"}),"\n",(0,a.jsx)(t.li,{children:"Make calls to entrypoints"}),"\n",(0,a.jsx)(t.li,{children:"Manipulate all the types/values supported by Tezos"}),"\n",(0,a.jsx)(t.li,{children:"Generate testing accounts, to simulate calls from multiple accounts"}),"\n",(0,a.jsx)(t.li,{children:"Perform cryptographic computations similar to the ones available in the contract"}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"rules-for-testing",children:"Rules for testing"}),"\n",(0,a.jsx)(t.p,{children:"Testing a contract thoroughly is not easy and requires experience.\nHere are some tips to follow when getting started:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Write tests without looking at the implementation of the contract to avoid copying mistakes."}),"\n",(0,a.jsx)(t.li,{children:"If possible, have another developer write the test to avoid testing semantic errors incorrectly."}),"\n",(0,a.jsx)(t.li,{children:"Make sure to cover every possible execution path, whether it's valid or invalid."}),"\n",(0,a.jsx)(t.li,{children:"Create many small tests, each checking something very specific, rather than a long test that tries to do many things at once."}),"\n",(0,a.jsx)(t.li,{children:"Test around the limits\nFor example, if a value should be always above 10, include a call with the value 10 that should fail and a call with the value 11 that should succeed."}),"\n",(0,a.jsx)(t.li,{children:"Test extremes"}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["For more information about avoiding flaws in contracts, see ",(0,a.jsx)(t.a,{href:"https://opentezos.com/smart-contracts/avoiding-flaws/",children:"Avoiding flaws"})," on opentezos.com."]}),"\n",(0,a.jsx)(t.h2,{id:"implementation-details",children:"Implementation details"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Michelson: ",(0,a.jsx)(t.a,{href:"https://tezos.gitlab.io/user/mockup.html",children:"Mockup mode"})]}),"\n",(0,a.jsxs)(t.li,{children:["Archetype: ",(0,a.jsx)(t.a,{href:"https://completium.com/docs/contract/test-scenario",children:"Completium test scenario"})]}),"\n",(0,a.jsxs)(t.li,{children:["SmartPy: ",(0,a.jsx)(t.a,{href:"https://smartpy.io/manual/scenarios/overview",children:"Tests and scenarios"})]}),"\n",(0,a.jsxs)(t.li,{children:["LIGO: ",(0,a.jsx)(t.a,{href:"https://ligolang.org/docs/next/testing/",children:"Testing LIGO"})]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,a.jsxs)(t.p,{children:["When you're done testing contracts locally, you can deploy them to a test network and test them there.\nSee ",(0,a.jsx)(t.a,{href:"/developing/testnets",children:"Testing on testnets"})," and ",(0,a.jsx)(t.a,{href:"/developing/sandbox",children:"Using a local sandbox"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>l});var s=n(96540);const a={},i=s.createContext(a);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);