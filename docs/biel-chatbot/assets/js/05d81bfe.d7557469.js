"use strict";(self.webpackChunktezos_developer_docs=self.webpackChunktezos_developer_docs||[]).push([[1280],{95248:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"tutorials/create-an-nft/nft-web-app/defining-functions","title":"Part 2: Accessing wallets and minting NFTs","description":"Accessing the user\'s wallet is essential before your application can engage with the Tezos blockchain. It enables your app to view the tokens within the wallet and request the user to initiate transactions. However, it\'s important to note that accessing the wallet doesn\'t grant your app direct control over it.","source":"@site/docs/tutorials/create-an-nft/nft-web-app/defining-functions.md","sourceDirName":"tutorials/create-an-nft/nft-web-app","slug":"/tutorials/create-an-nft/nft-web-app/defining-functions","permalink":"/previews/docs/biel-chatbot/tutorials/create-an-nft/nft-web-app/defining-functions","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1733893200000,"frontMatter":{"title":"Part 2: Accessing wallets and minting NFTs","authors":"Yuxin Li","last_update":{"date":"11 December 2024"}},"sidebar":"tutorialsSidebar","previous":{"title":"Part 1: Setting up the application","permalink":"/previews/docs/biel-chatbot/tutorials/create-an-nft/nft-web-app/setting-up-app"},"next":{"title":"Part 3: Let\'s play","permalink":"/previews/docs/biel-chatbot/tutorials/create-an-nft/nft-web-app/lets-play"}}');var a=n(74848),i=n(28453);const o={title:"Part 2: Accessing wallets and minting NFTs",authors:"Yuxin Li",last_update:{date:"11 December 2024"}},c=void 0,l={},r=[{value:"Connecting to the user&#39;s wallet",id:"connecting-to-the-users-wallet",level:2},{value:"Design considerations",id:"design-considerations",level:2},{value:"Minting NFTs",id:"minting-nfts",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"Accessing the user's wallet is essential before your application can engage with the Tezos blockchain. It enables your app to view the tokens within the wallet and request the user to initiate transactions. However, it's important to note that accessing the wallet doesn't grant your app direct control over it."}),"\n",(0,a.jsx)(t.h2,{id:"connecting-to-the-users-wallet",children:"Connecting to the user's wallet"}),"\n",(0,a.jsxs)(t.p,{children:["In this section, you add code to connect to the user's wallet with the ",(0,a.jsx)(t.code,{children:"TezosToolkit"})," and ",(0,a.jsx)(t.code,{children:"BeaconWallet"})," objects."]}),"\n",(0,a.jsxs)(t.p,{children:["IMPORTANT: however you design your app, it is essential to use a single instance of the ",(0,a.jsx)(t.code,{children:"BeaconWallet"})," object.\nIt is also highly recommended use a single instance of the ",(0,a.jsx)(t.code,{children:"TezosToolkit"})," object.\nCreating multiple instances can cause problems in your app and with Taquito in general."]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Open the file named ",(0,a.jsx)(t.code,{children:"src/App.svelte"})," and add the following code in the ",(0,a.jsx)(t.code,{children:'<script lang="ts">'})," section after we initialize and set up the Ghostnet endpoint:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:'<script lang="ts">\n\nlet wallet;\nlet address;\nlet balance;\nlet statusMessage = "Mint an NFT";\nlet buttonActive = false;\n\nconst connectWallet = async () => {\n  try {\n    const newWallet = new BeaconWallet({\n      name: "Simple NFT app tutorial",\n      network: {\n       type: NetworkType.GHOSTNET,\n     },\n    });\n    await newWallet.requestPermissions();\n    address = await newWallet.getPKH();\n    const balanceMutez = await Tezos.tz.getBalance(address);\n    balance = balanceMutez.div(1000000).toFormat(2);\n    buttonActive = true;\n    wallet = newWallet;\n  } catch (error) {\n    console.error("Error connecting wallet:", error);\n  }\n};\n<\/script>\n'})}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"connectWallet"})," function creates a ",(0,a.jsx)(t.code,{children:"BeaconWallet"})," object that represents the user's wallet.\nIt provides a name for the app, which appears in the wallet UI when it asks the user to allow the connection.\nIt also includes the network to use, such as the Tezos main network or test network."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Add the following code in ",(0,a.jsx)(t.code,{children:'<script lang="ts">'})," to disconnect the wallet:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:"const disconnectWallet = () => {\n  wallet.client.clearActiveAccount();\n  wallet = undefined;\n  buttonActive = false;\n};\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"disconnectWallet"})," function runs these steps to disconnect the wallet and reset the state of the app:"]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["It closes the connection to the Beacon SDK with the ",(0,a.jsx)(t.code,{children:"wallet.client.clearActiveAccount()"})," command."]}),"\n",(0,a.jsxs)(t.li,{children:["It nullifies the wallet reference by setting ",(0,a.jsx)(t.code,{children:"wallet"})," to ",(0,a.jsx)(t.code,{children:"undefined"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["It deactivates the associated button or functionality by setting the ",(0,a.jsx)(t.code,{children:"buttonActive"})," flag to false."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Add this code inside ",(0,a.jsx)(t.code,{children:"<main>"}),", which creates a button that the user can click to connect or disconnect their wallet:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:'<main>\n  <h1>Simple NFT dApp</h1>\n\n  <div class="card">\n    {#if wallet}\n      <p>The address of the connected wallet is {address}.</p>\n      <p>Its balance in tez is {balance}.</p>\n      <button on:click={disconnectWallet}> Disconnect wallet </button>\n      <button on:click={requestNFT}>{statusMessage}</button>\n    {:else}\n      <button on:click={connectWallet}> Connect wallet </button>\n    {/if}\n  </div>\n</main>\n'})}),"\n",(0,a.jsx)(t.p,{children:"Now you have functions that allow your application to connect and disconnect wallets."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"design-considerations",children:"Design considerations"}),"\n",(0,a.jsx)(t.p,{children:"Interacting with a wallet in a decentralized application is a new paradigm for many developers and users.\nFollow these practices to make the process easier for users:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Let users manually connect their wallets instead of prompting users to connect their wallet immediately when the app loads.\nGetting a wallet pop-up window before the user can see the page is annoying.\nAlso, users may hesitate to connect a wallet before they have had time to look at and trust the application, even though connecting the wallet is harmless."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Provide a prominent button to connect or disconnect wallets."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Put the button in a predictable position, typically at the top right or left corner of the interface."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Use ",(0,a.jsx)(t.strong,{children:"Connect"}),' as the label for the button.\nAvoid words like "sync" because they can have different meanings in dApps.']}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Display the status of the wallet clearly in the UI.\nYou can also add information about the wallet, including token balances and the connected network for the user's convenience, as this tutorial application does.\nShowing information about the tokens and updating it after transactions allows the user to verify that the application is working properly."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Enable and disable functions of the application based on the status of the wallet connection.\nFor example, if the wallet is not connected, disable buttons for transactions that require a wallet connection."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"minting-nfts",children:"Minting NFTs"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Still in ",(0,a.jsx)(t.code,{children:"App.svelte"}),", add the following code to the",(0,a.jsx)(t.code,{children:' <script lang="ts">'})," section to initialize a deployed contract address. This contract has multiple entrypoints that allow us to interact with the Tezos blockchain, such as ",(0,a.jsx)(t.code,{children:"mint"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:'const nftContractAddress = "KT1Lr8m7HgfY5UF6nXDDcXDxDgEmKyMeds1b";\n'})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Add this code to build the function structure"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:"const requestNFT = async () => {\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Add the following code inside the ",(0,a.jsx)(t.code,{children:"requestNFT"})," function to set up button state:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:'if (!buttonActive) {\n  return;\n}\nbuttonActive = false;\nstatusMessage = "Minting NFT...";\n'})}),"\n",(0,a.jsx)(t.p,{children:"This asynchronous function, requestNFT, checks if a button (likely associated with minting an NFT) is active, and if so, it deactivates the button and sets a status message indicating that the NFT minting process has begun."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Add the following code inside the ",(0,a.jsx)(t.code,{children:"requestNFT"})," function to define the metadata for a specific NFT:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:'const metadata = new MichelsonMap();\nmetadata.set("name", stringToBytes("My Token")); // replace with your metadata\n\nconst mintItem = {\n  to_: address,\n  metadata: metadata,\n};\n'})}),"\n",(0,a.jsx)(t.p,{children:"Metadata for NFTs provides detailed information about the token, describing its unique attributes. This context helps in distinguishing each NFT. In this case the token has only a name, but you can add other fields."}),"\n",(0,a.jsx)(t.p,{children:"In the provided code, a new MichelsonMap instance is initialized to handle Tezos's native map data type, a structure used to store key-value pairs where each key is unique. The MichelsonMap utility allows for easier interaction with Tezos's smart contract language, Michelson."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Add the following code inside the ",(0,a.jsx)(t.code,{children:"requestNFT"})," function to access the wallet and mint an NFT."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:'try {\n  Tezos.setWalletProvider(wallet);\n\n  console.log("getting contract");\n  const nftContract = await Tezos.wallet.at(nftContractAddress);\n\n  console.log("minting");\n  const op = await nftContract.methodsObject.mint([mintItem]).send();\n\n  console.log(`Waiting for ${op.opHash} to be confirmed...`);\n  const hash = await op.confirmation(2).then(() => op.opHash);\n  console.log(`Operation injected: https://ghost.tzstats.com/${hash}`);\n} catch (error) {\n  console.error("Error minting NFT:", error);\n} finally {\n  statusMessage = "Mint another NFT";\n  buttonActive = true;\n}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Taquito can fetch the user's tez balance from the connected wallet.\nTo get the tez balances, the app uses the ",(0,a.jsx)(t.a,{href:"/dApps/wallets",children:"Beacon SDK"}),".\nThe ",(0,a.jsx)(t.code,{children:"mint"})," function takes two parameters: a metadata for the NFT and the user's wallet address."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Now the app is complete.\nYou can refer to the completed app at ",(0,a.jsx)(t.a,{href:"https://github.com/trilitech/tutorial-applications/tree/main/simple-nft-svelte",children:"https://github.com/trilitech/tutorial-applications/tree/main/simple-nft-svelte"})," if you have any problems with your app."]}),"\n",(0,a.jsx)(t.p,{children:"You'll start the app and mint NFTs with your dApp in the next section!"})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var s=n(96540);const a={},i=s.createContext(a);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);