"use strict";(self.webpackChunktezos_developer_docs=self.webpackChunktezos_developer_docs||[]).push([[4266],{52131:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"unity/sample-game","title":"Sample game","description":"The sample game for the Unity SDK is a single-player third-person shooter with survival elements.","source":"@site/docs/unity/sample-game.md","sourceDirName":"unity","slug":"/unity/sample-game","permalink":"/previews/docs/biel-chatbot/unity/sample-game","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1717387200000,"frontMatter":{"title":"Sample game","authors":"Tim McMackin","last_update":{"date":"3 June 2024"}},"sidebar":"documentationSidebar","previous":{"title":"Tutorial scenes","permalink":"/previews/docs/biel-chatbot/unity/scenes"},"next":{"title":"Prefabs","permalink":"/previews/docs/biel-chatbot/unity/prefabs"}}');var a=n(74848),i=n(28453);const r={title:"Sample game",authors:"Tim McMackin",last_update:{date:"3 June 2024"}},o=void 0,c={},h=[{value:"Architecture",id:"architecture",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Tokens",id:"tokens",level:2},{value:"User data",id:"user-data",level:2},{value:"Opening the sample game",id:"opening-the-sample-game",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"The sample game for the Unity SDK is a single-player third-person shooter with survival elements.\nPlayers receive tokens that represent in-game items and the game tracks and transfers them via the Tezos blockchain.\nYou can import this game into the Unity Editor and work with it yourself."}),"\n",(0,a.jsxs)(t.p,{children:["The game shows how developers might structure a large-scale dApp by separating different features into different components, as described below in ",(0,a.jsx)(t.a,{href:"#architecture",children:"Architecture"}),".\nIn particular, it handles some Tezos interaction from the Unity game itself, including connecting to the user's wallet and prompting them to sign a payload to authenticate.\nThe rest of the Tezos interaction happens in the backend application, including distributing tokens that represent in-game objects.\nThe Unity game also allows users to transfer those tokens to other accounts."]}),"\n",(0,a.jsxs)(t.p,{children:["The source code for the Unity frontend application is here: ",(0,a.jsx)(t.a,{href:"https://github.com/baking-bad/tezos-unity-game",children:"https://github.com/baking-bad/tezos-unity-game"}),".\nTo open it locally, see ",(0,a.jsx)(t.a,{href:"#opening-the-sample-game",children:"Opening the sample game"}),".\nTo play the game, go to ",(0,a.jsx)(t.a,{href:"https://game.baking-bad.org",children:"https://game.baking-bad.org"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["The source code for the backend application is here: ",(0,a.jsx)(t.a,{href:"https://github.com/k-karuna/tezos_game_back",children:"https://github.com/k-karuna/tezos_game_back"}),"."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"A screenshot from within the game interface",src:n(88235).A+"",width:"1912",height:"908"})}),"\n",(0,a.jsx)(t.h2,{id:"architecture",children:"Architecture"}),"\n",(0,a.jsx)(t.p,{children:"The sample game uses these main components:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"User wallets"})," as a source of user identity and authentication.\nThe user doesn't make any direct transactions from the wallet and pays no tez to the application or in fees.\nFor more information about Tezos wallets, see ",(0,a.jsx)(t.a,{href:"/developing/wallet-setup",children:"Installing and funding a wallet"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"Unity WebGL application"})," is the front end of the application.\nIt connects to the user wallet, sends the sign request, runs the game interface, and sends requests to the backend."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"backend application"})," hosts a REST API for the Unity application to call.\nThe Unity application calls it from the ",(0,a.jsx)(t.code,{children:"Assets/Scripts/Api/GameApi.cs"})," file for tasks such as these:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Getting the signed payload from the wallet"}),"\n",(0,a.jsx)(t.li,{children:"Verifying the signed payload"}),"\n",(0,a.jsx)(t.li,{children:"Tracking events such as the beginning and end of a game session"}),"\n",(0,a.jsx)(t.li,{children:"Sending tokens to players' accounts"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The backend application is responsible for most of the interaction with the smart contract, including transferring tokens to players.\nIt securely manages the private key for the administrator account, which is responsible for minting and transferring tokens.\nThis way, the game client itself has no access to the private key."}),"\n",(0,a.jsxs)(t.p,{children:["For information about the REST API endpoints, see this page: ",(0,a.jsx)(t.a,{href:"https://game.baking-bad.org/back/swagger/",children:"https://game.baking-bad.org/back/swagger/"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"backend database"})," stores persistent information about players, such as the number of games they have played."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"smart contract"})," is a program that runs on the Tezos blockchain to manage tokens that represent in-game items.\nIt maintains a ledger of tokens and owners and allows the backend's administrator account to transfer them to players.\nThe sample game uses a custom contract, but you can use the SDK's built-in FA2-compliant contract; see ",(0,a.jsx)(t.a,{href:"/unity/managing-contracts",children:"Managing contracts"}),".\nYou can view and interact with the contract on a block explorer, such as tzkt.io: ",(0,a.jsx)(t.a,{href:"https://tzkt.io/KT1TSZfPJ5uZW1GjcnXmvt1npAQ2nh5S1FAj/operations",children:"https://tzkt.io/KT1TSZfPJ5uZW1GjcnXmvt1npAQ2nh5S1FAj/operations"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"Interplanetary File System (IPFS)"})," stores metadata for the tokens, including pictures and descriptions.\nLinks in the smart contract point to this metadata."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"This diagram shows the basic interaction between these components:"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"The architecture of the sample game, showing interaction between the user wallet, the Unity WebGL application, the backend, and the smart contract",src:n(25824).A+"",width:"1120",height:"561"})}),"\n",(0,a.jsx)(t.h2,{id:"authentication",children:"Authentication"}),"\n",(0,a.jsxs)(t.p,{children:["The game uses the user's Tezos account as a source of authentication.\nIt prompts the user to connect their Tezos wallet so it can retrieve the user's account address.\nFor more information about connecting to user wallets, see ",(0,a.jsx)(t.a,{href:"/unity/connecting-accounts",children:"Connecting accounts"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"When the wallet is connected, the game prompts the user to sign a payload to prove that they have the key for the account.\nThe process follows these general steps:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"The user loads the game client and clicks the button to connect."}),"\n",(0,a.jsx)(t.li,{children:"The game client requests an authentication payload from the backend."}),"\n",(0,a.jsxs)(t.li,{children:["The backend ",(0,a.jsx)(t.a,{href:"https://github.com/k-karuna/tezos_game_back/blob/e6bc9c021b86704ec1ce1b5e3fd799977d05034f/api/views.py#L20",children:"generates a random string"})," and sends it to the Unity application."]}),"\n",(0,a.jsxs)(t.li,{children:["The Unity application ",(0,a.jsx)(t.a,{href:"https://github.com/baking-bad/tezos-unity-game/blob/7e3fb6454896896f7e0ac77f09d2b5f02e104aa7/Assets/Scripts/Managers/UserDataManager.cs#L108",children:"sends the string as a signing request payload"})," to the wallet."]}),"\n",(0,a.jsx)(t.li,{children:"The user signs the payload in their wallet application."}),"\n",(0,a.jsxs)(t.li,{children:["The Unity application ",(0,a.jsx)(t.a,{href:"https://github.com/baking-bad/tezos-unity-game/blob/9b71d3832dac076d74bd822c19b5f93909434190/Assets/Scripts/Managers/UserDataManager.cs#L78",children:"receives the signed payload and sends it to the backend"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["The backend ",(0,a.jsx)(t.a,{href:"https://github.com/k-karuna/tezos_game_back/blob/e6bc9c021b86704ec1ce1b5e3fd799977d05034f/api/views.py#L50",children:"verifies that the payload is correctly signed"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["The game ",(0,a.jsx)(t.a,{href:"https://github.com/baking-bad/tezos-unity-game/blob/9b71d3832dac076d74bd822c19b5f93909434190/Assets/Scripts/Managers/UserDataManager.cs#L80",children:"allows the user to play if validation is successful"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Here is a diagram of the process:"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Authentication flow diagram",src:n(4045).A+"",width:"975",height:"519"})}),"\n",(0,a.jsxs)(t.p,{children:["For more information about signing messages, see ",(0,a.jsx)(t.a,{href:"/unity/quickstart#signing-messages",children:"Signing messages"})," in the Unity SDK quickstart."]}),"\n",(0,a.jsx)(t.h2,{id:"tokens",children:"Tokens"}),"\n",(0,a.jsxs)(t.p,{children:["The game uses Tezos tokens to represent in-game items, such as weapons, armor, and power-ups.\nBecause these tokens are compliant with the ",(0,a.jsx)(t.a,{href:"/architecture/tokens/FA2",children:"FA2"})," standard, players can see their tokens in their wallets and in applications such as block explorers.\nThey could also set up a third-party platform to show and trade their tokens."]}),"\n",(0,a.jsxs)(t.p,{children:["The smart contract that manages the tokens has one ",(0,a.jsx)(t.a,{href:"https://better-call.dev/mainnet/KT1TSZfPJ5uZW1GjcnXmvt1npAQ2nh5S1FAj/tokens",children:"token type"})," for each in-game item.\nFor example, tokens with the ID 1 represent armor:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Example of a token type",src:n(49266).A+"",width:"1800",height:"942"})}),"\n",(0,a.jsxs)(t.p,{children:["The contract pre-mints a supply of 1000 of each token type so tokens are available when players claim them.\nWhen a player claims a token with the Claim Reward button and solves a captcha, the game client calls the backend, which verifies the captcha and calls the contract's ",(0,a.jsx)(t.code,{children:"transfer"})," entrypoint to send one of that token type to the player's account.\nThis diagram shows the interaction between the game and the player's wallet:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"A diagram of the interaction between the player&#39;s wallet and the components of the application, showing how tokens are read from the wallet information and distributed from the smart contract to the wallet",src:n(14753).A+"",width:"1140",height:"623"})}),"\n",(0,a.jsx)(t.p,{children:"An account can have only one of each token type, which makes the tokens similar to NFTs, but they are not NFTs because any number of accounts can have one of each token.\nTherefore, they are technically fungible tokens because tokens of the same type are interchangeable, but the backend sends only one token of each type to each account."}),"\n",(0,a.jsxs)(t.p,{children:["To see the tokens that an account has, you can check the ledger in the contract's storage.\nThe ledger has entries that are indexed by the account address and the token type.\nFor example, this ledger entry shows that account ",(0,a.jsx)(t.code,{children:"tz1eQQnDbkTpTnu3FXix28xKdaWYRqrsZcZv"})," has one token of type 16:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"The contract ledger on Better Call Dev, showing one entry",src:n(46273).A+"",width:"1954",height:"1420"})}),"\n",(0,a.jsxs)(t.p,{children:["The contract uses standard FA2 entrypoints including ",(0,a.jsx)(t.code,{children:"transfer"}),", plus other custom entrypoints for this implementation.\nYou can see these entrypoints on block explorers: ",(0,a.jsx)(t.a,{href:"https://better-call.dev/mainnet/KT1TSZfPJ5uZW1GjcnXmvt1npAQ2nh5S1FAj/interact",children:"https://better-call.dev/mainnet/KT1TSZfPJ5uZW1GjcnXmvt1npAQ2nh5S1FAj/interact"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"user-data",children:"User data"}),"\n",(0,a.jsxs)(t.p,{children:["The game uses the Unity SDK to get player data from the backend and work with it locally.\nThe ",(0,a.jsx)(t.a,{href:"https://github.com/baking-bad/tezos-unity-game/blob/master/Assets/Scripts/Managers/UserDataManager.cs",children:(0,a.jsx)(t.code,{children:"UserDataManager.cs"})})," file manages this player data, which includes:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"The tokens that the account owns"}),"\n",(0,a.jsx)(t.li,{children:"The player's statistics"}),"\n",(0,a.jsx)(t.li,{children:"Information about the active game session"}),"\n",(0,a.jsx)(t.li,{children:"The player's currently equipped equipment"}),"\n",(0,a.jsx)(t.li,{children:"Pending rewards, which represent in-game items that the user has earned but has not received a token for yet"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Some of this information (such as the tokens that the player owns) comes from Tezos and other information (such as the player's statistics) comes from the backend.\nInformation about the current game session and pending rewards are non-persistent data that are stored by the Unity application."}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"UserDataManager"})," class responds to ",(0,a.jsx)(t.a,{href:"/unity/reference/EventManager",children:"events"})," such as when the user connects their wallet and then loads information from the backend and from Tezos directly."]}),"\n",(0,a.jsx)(t.h2,{id:"opening-the-sample-game",children:"Opening the sample game"}),"\n",(0,a.jsx)(t.p,{children:"Follow these steps to open the sample game in the Unity editor:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Clone the sample game repository at ",(0,a.jsx)(t.a,{href:"https://github.com/baking-bad/tezos-unity-game",children:"https://github.com/baking-bad/tezos-unity-game"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["In Unity Hub, click ",(0,a.jsx)(t.strong,{children:"Add > Add project from disk"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Select the repository folder and click ",(0,a.jsx)(t.strong,{children:"Add Project"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"If Unity Hub prompts you to install a specific version of Unity Editor, follow the prompts to install that version."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Click the project in Unity Hub to open it in Unity Editor."}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},14753:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/sample-game-architecture-play-58468ebba2d8dfbe6d21be11bc0f9c83.png"},25824:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/sample-game-architecture-fbe1efce10156cb61b0c5e62fa1eb543.png"},46273:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/sample-game-ledger-entry-32ef6359813ea35aebd80e4a2f735c82.png"},49266:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/sample-game-token-types-f3014fab23dc0a3f984acc52ec4ff59b.png"},88235:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/sample-game-ui-e7e22e6f0917ce2e3a8b25e8265a87f0.png"},4045:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/unity-sample-game-authentication-48d292654d877391ae750c848f96c3f8.png"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(96540);const a={},i=s.createContext(a);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);