"use strict";(self.webpackChunktezos_developer_docs=self.webpackChunktezos_developer_docs||[]).push([[1545],{34679:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"smart-contracts/logic/operations","title":"Operations","description":"The execution of the code of an entrypoint can have only two effects:","source":"@site/docs/smart-contracts/logic/operations.md","sourceDirName":"smart-contracts/logic","slug":"/smart-contracts/logic/operations","permalink":"/previews/docs/biel-chatbot/smart-contracts/logic/operations","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1696478400000,"frontMatter":{"title":"Operations","authors":"Mathias Hiron (Nomadic Labs), Sasha Aldrick (TriliTech), Tim McMackin (TriliTech)","last_update":{"date":"5 October 2023"}},"sidebar":"documentationSidebar","previous":{"title":"Loops and iterations","permalink":"/previews/docs/biel-chatbot/smart-contracts/logic/loops"},"next":{"title":"Handling errors","permalink":"/previews/docs/biel-chatbot/smart-contracts/logic/errors"}}');var s=n(74848),i=n(28453);const o={title:"Operations",authors:"Mathias Hiron (Nomadic Labs), Sasha Aldrick (TriliTech), Tim McMackin (TriliTech)",last_update:{date:"5 October 2023"}},a=void 0,l={},d=[{value:"Order of execution",id:"order-of-execution",level:2},{value:"Operation examples",id:"operation-examples",level:2},{value:"Operation Walkthrough",id:"operation-walkthrough",level:2},{value:"Implementation details",id:"implementation-details",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"The execution of the code of an entrypoint can have only two effects:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Changing the value of the storage of the contract"}),"\n",(0,s.jsx)(t.li,{children:"Generating new operations that run after the entrypoint execution is over"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"These operations can include:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Transferring tez to an account or to a smart contract entrypoint (",(0,s.jsx)(t.code,{children:"TRANSFER_TOKENS"}),")"]}),"\n",(0,s.jsxs)(t.li,{children:["Originating a new smart contract (",(0,s.jsx)(t.code,{children:"CREATE_CONTRACT"}),")"]}),"\n",(0,s.jsxs)(t.li,{children:["Setting the delegate of the current smart contract (",(0,s.jsx)(t.code,{children:"SET_DELEGATE"}),")"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:'Only the first type is technically a transaction, but the terms "operation" and "transaction" are often used interchangeably in courses, documentation, and tools.\nDon\'t worry too much about the difference.'}),"\n",(0,s.jsx)(t.h2,{id:"order-of-execution",children:"Order of execution"}),"\n",(0,s.jsx)(t.p,{children:"The code of a contract never directly executes an operation or a transfer of tez.\nInstead, it adds operations to a list and the list is added to a stack of operations to run after code of the entrypoint is complete."}),"\n",(0,s.jsx)(t.p,{children:"The operations generated by a contract are executed in the order that they are added to the list.\nAll the operations generated by a contract and the operations these end up generating are executed before any other operations previously added to the stack."}),"\n",(0,s.jsx)(t.p,{children:"For example, if a contract generates operations A and B, and operation A generates operation C, operation C runs before operation B."}),"\n",(0,s.jsx)(t.h2,{id:"operation-examples",children:"Operation examples"}),"\n",(0,s.jsx)(t.p,{children:'For example, assume three contracts named A, B, and C that each have an entrypoint named "Start."\nContract A\'s storage has a value named "text," which is a string.\nContract A also has an entrypoint named "Add," which adds text to the storage string based on a string that the sender passes.'}),"\n",(0,s.jsx)(t.p,{children:"This table shows the logic of the entrypoints:"}),"\n",(0,s.jsxs)("table",{children:[(0,s.jsx)("caption",{children:"Entrypoint Logic"}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Contract A"}),(0,s.jsx)("td",{children:"Contract B"}),(0,s.jsx)("td",{children:"Contract C"})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{children:"start()"}),":",(0,s.jsxs)("ol",{children:[(0,s.jsx)("li",{children:'Replace text with "Start A,"'}),(0,s.jsx)("li",{children:"Call B.start()"}),(0,s.jsx)("li",{children:"Call C.start()"}),(0,s.jsx)("li",{children:'Append "End A" to text'})]})]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{children:"add(str)"}),":",(0,s.jsx)("ol",{children:(0,s.jsxs)("li",{children:["Append ",(0,s.jsx)("code",{children:"str"})," to text"]})})]})]})}),(0,s.jsx)("td",{children:(0,s.jsx)("ul",{children:(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{children:"start()"}),":",(0,s.jsxs)("ol",{children:[(0,s.jsx)("li",{children:'Call A.add("Start B,")'}),(0,s.jsx)("li",{children:'Call A.add("End B,")'})]})]})})}),(0,s.jsx)("td",{children:(0,s.jsx)("ul",{children:(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{children:"start()"}),":",(0,s.jsxs)("ol",{children:[(0,s.jsx)("li",{children:'Call A.add("Start C,")'}),(0,s.jsx)("li",{children:'Call A.add("End C,")'})]})]})})})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"operation-walkthrough",children:"Operation Walkthrough"}),"\n",(0,s.jsxs)(t.p,{children:["If a user calls ",(0,s.jsx)(t.code,{children:"A.start()"}),", the following happens:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"A.start()"})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:'Replaces its storage text with "Start A,"'}),"\n",(0,s.jsxs)(t.li,{children:["Adds operation",(0,s.jsx)(t.code,{children:" B.start()"})," to the list of operations"]}),"\n",(0,s.jsxs)(t.li,{children:["Adds operation ",(0,s.jsx)(t.code,{children:"C.start()"})," to the list of operations"]}),"\n",(0,s.jsx)(t.li,{children:'Adds "End A," to its storage, which becomes "Start A, End A"'}),"\n",(0,s.jsxs)(t.li,{children:["Pushes the operations from the list ",(0,s.jsx)(t.code,{children:"[B.start(), C.start()]"})," to the stack;",(0,s.jsx)(t.code,{children:" B.start()"})," is on the top"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"B.start()"})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Adds operation ",(0,s.jsx)(t.code,{children:'A.add("Start B,")'})," to the list of operations"]}),"\n",(0,s.jsxs)(t.li,{children:["Adds operation ",(0,s.jsx)(t.code,{children:'A.add("End B,")'})," to the list of operations"]}),"\n",(0,s.jsxs)(t.li,{children:["Pushes the operations from the list ",(0,s.jsx)(t.code,{children:'[A.add("Start B,"), A.add("End B,")]'})," to the top of the stack; the operation stack is now ",(0,s.jsx)(t.code,{children:'[A.add("Start B,"), A.add("End B,"), C.start()]'})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:'A.add("Start B")'})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:'Replaces its storage with "Start A,End A,Start B,"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:'A.add("End B")'})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:'Replaces its storage with "Start A,End A,Start B,End B,"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"C.start()"})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Adds operation ",(0,s.jsx)(t.code,{children:'A.add("Start C,")'})," to the list of operations"]}),"\n",(0,s.jsxs)(t.li,{children:["Adds operation ",(0,s.jsx)(t.code,{children:'A.add("End C,")'})," to the list of operations"]}),"\n",(0,s.jsxs)(t.li,{children:["Pushes the operations from the list ",(0,s.jsx)(t.code,{children:'[A.add("Start C,"), A.add("End C,")]'})," to the top of the stack"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:'A.add("Start C")'})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:'Replaces its storage with "Start A,End A,Start B,End B,Start C,"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:'A.add("End C")'})," runs:","\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:'Replaces its storage with "Start A,End A,Start B,End B,Start C, End C,"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:'At the end of all operations, A\'s storage is "Start A,End A,Start B,End B,Start C, End C,".'}),"\n",(0,s.jsx)(t.p,{children:"To summarize:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"All of the code in an entrypoint runs before the operations it generates run"}),"\n",(0,s.jsx)(t.li,{children:"If a contract A generates a call to a contract B then a call to a contract C, all of the operations generated by B run before contract C runs."}),"\n",(0,s.jsx)(t.li,{children:"If any of these operations cause a failure, everything is cancelled, including operations that have already completed."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"implementation-details",children:"Implementation details"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Michelson: ",(0,s.jsx)(t.a,{href:"https://tezos.gitlab.io/michelson-reference/#type-operation",children:"Operations"})]}),"\n",(0,s.jsxs)(t.li,{children:["Archetype: ",(0,s.jsx)(t.a,{href:"https://archetype-lang.org/docs/reference/instructions/operation",children:"Operation"})]}),"\n",(0,s.jsxs)(t.li,{children:["LIGO: ",(0,s.jsx)(t.a,{href:"https://ligolang.org/docs/advanced/entrypoints-contracts#inter-contract-invocations",children:"Inter-contract invocations"})]}),"\n",(0,s.jsxs)(t.li,{children:["SmartPy: ",(0,s.jsx)(t.a,{href:"https://smartpy.io/manual/data-types/operations",children:"Operations"})]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const s={},i=r.createContext(s);function o(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);